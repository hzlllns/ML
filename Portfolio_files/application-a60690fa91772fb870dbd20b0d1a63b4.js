Array.prototype.indexOf||(Array.prototype.indexOf=function(t){"use strict";if(null==this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0===i)return-1;var n=0;if(arguments.length>1&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&1/0!=n&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1;for(var s=n>=0?n:Math.max(i-Math.abs(n),0);i>s;s++)if(s in e&&e[s]===t)return s;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var i,n;if(null==this)throw new TypeError("this is null or not defined");var s=Object(this),r=s.length>>>0;if("[object Function]"!=={}.toString.call(t))throw new TypeError(t+" is not a function");for(e&&(i=e),n=0;r>n;){var a;Object.prototype.hasOwnProperty.call(s,n)&&(a=s[n],t.call(i,a,n,s)),n++}}),function(t){"use strict";var e=Array.prototype.slice,i=function(t){return("0"+t.toString()).substr(-2)},n={day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},s={precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1},r={unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."},a={precision:3,separator:".",delimiter:""},o=[null,"kb","mb","gb","tb"],l=["AM","PM"];t.reset=function(){this.defaultLocale="en",this.locale="en",this.defaultSeparator=".",this.placeholder=/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,this.fallbacks=!1,this.translations={}},t.locales={},t.locales.get=function(e){var i=this[e]||this[t.locale]||this["default"];return"function"==typeof i&&(i=i(e)),i instanceof Array==!1&&(i=[i]),i},t.locales["default"]=function(e){var i,n=[],s=[];return e&&n.push(e),!e&&t.locale&&n.push(t.locale),t.fallbacks&&t.defaultLocale&&n.push(t.defaultLocale),n.forEach(function(e){i=e.split("-")[0],~s.indexOf(e)||s.push(e),t.fallbacks&&i&&i!==e&&!~s.indexOf(i)&&s.push(i)}),n.length||n.push("en"),s},t.pluralization={},t.pluralization.get=function(e){return this[e]||this[t.locale]||this["default"]},t.pluralization["default"]=function(t){switch(t){case 0:return["zero","other"];case 1:return["one"];default:return["other"]}},t.reset(),t.currentLocale=function(){return this.locale||this.defaultLocale},t.isSet=function(t){return void 0!==t&&null!==t},t.lookup=function(t,e){e=this.prepareOptions(e);var i,n,s,r=this.locales.get(e.locale);for(r[0];r.length;)if(i=r.shift(),n=t.split(this.defaultSeparator),s=this.translations[i]){for(;n.length&&(s=s[n.shift()],void 0!==s&&null!==s););if(void 0!==s&&null!==s)return s}return this.isSet(e.defaultValue)?e.defaultValue:void 0},t.prepareOptions=function(){for(var t,i=e.call(arguments),n={};i.length;)if(t=i.shift(),"object"==typeof t)for(var s in t)t.hasOwnProperty(s)&&(this.isSet(n[s])||(n[s]=t[s]));return n},t.translate=function(t,e){e=this.prepareOptions(e);var i=this.lookup(t,e);return void 0===i||null===i?this.missingTranslation(t):("string"==typeof i?i=this.interpolate(i,e):i instanceof Object&&this.isSet(e.count)&&(i=this.pluralize(e.count,i,e)),i)},t.interpolate=function(t,e){e=this.prepareOptions(e);var i,n,s,r,a=t.match(this.placeholder);if(!a)return t;for(;a.length;)i=a.shift(),s=i.replace(this.placeholder,"$1"),n=e[s],this.isSet(e[s])||(n="[missing "+i+" value]"),r=new RegExp(i.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),t=t.replace(r,n);return t},t.pluralize=function(t,e,i){i=this.prepareOptions(i);var n,s,r,a,o;if(n=e instanceof Object?e:this.lookup(e,i),!n)return this.missingTranslation(e);for(s=this.pluralization.get(i.locale),r=s(Math.abs(t));r.length;)if(a=r.shift(),this.isSet(n[a])){o=n[a];break}return i.count=String(t),this.interpolate(o,i)},t.missingTranslation=function(){var t='[missing "';return t+=this.currentLocale()+".",t+=e.call(arguments).join("."),t+='" translation]'},t.toNumber=function(t,e){e=this.prepareOptions(e,this.lookup("number.format"),s);var i,n,r=0>t,a=Math.abs(t).toFixed(e.precision).toString(),o=a.split("."),l=[];for(t=o[0],i=o[1];t.length>0;)l.unshift(t.substr(Math.max(0,t.length-3),3)),t=t.substr(0,t.length-3);return n=l.join(e.delimiter),e.strip_insignificant_zeros&&i&&(i=i.replace(/0+$/,"")),e.precision>0&&i&&(n+=e.separator+i),r&&(n="-"+n),n},t.toCurrency=function(t,e){return e=this.prepareOptions(e,this.lookup("number.currency.format"),this.lookup("number.format"),r),t=this.toNumber(t,e),t=e.format.replace("%u",e.unit).replace("%n",t)},t.localize=function(t,e){switch(t){case"currency":return this.toCurrency(e);case"number":return t=this.lookup("number.format"),this.toNumber(e,t);case"percentage":return this.toPercentage(e);default:return t.match(/^(date|time)/)?this.toTime(t,e):e.toString()}},t.parseDate=function(t){var e,i;if("object"==typeof t)return t;if(e=t.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?(Z|\+0000)?/)){for(var n=1;6>=n;n++)e[n]=parseInt(e[n],10)||0;e[2]-=1,i=e[7]?new Date(Date.UTC(e[1],e[2],e[3],e[4],e[5],e[6])):new Date(e[1],e[2],e[3],e[4],e[5],e[6])}else"number"==typeof t?(i=new Date,i.setTime(t)):t.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/)?(i=new Date,i.setTime(Date.parse(t))):(i=new Date,i.setTime(Date.parse(t)));return i},t.strftime=function(t,e){var s=this.lookup("date");s||(s=n),s.meridian||(s.meridian=l);var r=t.getDay(),a=t.getDate(),o=t.getFullYear(),c=t.getMonth()+1,d=t.getHours(),u=d,p=d>11?1:0,h=t.getSeconds(),m=t.getMinutes(),y=t.getTimezoneOffset(),v=Math.floor(Math.abs(y/60)),f=Math.abs(y)-60*v,g=(y>0?"-":"+")+(v.toString().length<2?"0"+v:v)+(f.toString().length<2?"0"+f:f);return u>12?u-=12:0===u&&(u=12),e=e.replace("%a",s.abbr_day_names[r]),e=e.replace("%A",s.day_names[r]),e=e.replace("%b",s.abbr_month_names[c]),e=e.replace("%B",s.month_names[c]),e=e.replace("%d",i(a)),e=e.replace("%e",a),e=e.replace("%-d",a),e=e.replace("%H",i(d)),e=e.replace("%-H",d),e=e.replace("%I",i(u)),e=e.replace("%-I",u),e=e.replace("%m",i(c)),e=e.replace("%-m",c),e=e.replace("%M",i(m)),e=e.replace("%-M",m),e=e.replace("%p",s.meridian[p]),e=e.replace("%S",i(h)),e=e.replace("%-S",h),e=e.replace("%w",r),e=e.replace("%y",i(o)),e=e.replace("%-y",i(o).replace(/^0+/,"")),e=e.replace("%Y",o),e=e.replace("%z",g)},t.toTime=function(t,e){var i=this.parseDate(e),n=this.lookup(t);return i.toString().match(/invalid/i)?i.toString():n?this.strftime(i,n):i.toString()},t.toPercentage=function(t,e){return e=this.prepareOptions(e,this.lookup("number.percentage.format"),this.lookup("number.format"),a),t=this.toNumber(t,e),t+"%"},t.toHumanSize=function(t,e){for(var i,n,s=1024,r=t,a=0;r>=s&&4>a;)r/=s,a+=1;return 0===a?(i=this.t("number.human.storage_units.units.byte",{count:r}),n=0):(i=this.t("number.human.storage_units.units."+o[a]),n=r-Math.floor(r)===0?0:1),e=this.prepareOptions(e,{precision:n,format:"%n%u",delimiter:""}),t=this.toNumber(r,e),t=e.format.replace("%u",i).replace("%n",t)},t.t=t.translate,t.l=t.localize,t.p=t.pluralize}("undefined"==typeof exports?this.I18n={}:exports),I18n.translations={en:{date:{formats:{"default":"%b %e, %Y","short":"%b %d","long":"%B %d, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]},time:{formats:{"default":"%a, %d %b %Y %H:%M:%S %z","short":"%d %b %H:%M","long":"%B %d, %Y %H:%M"},am:"am",pm:"pm"},support:{array:{words_connector:", ",two_words_connector:" and ",last_word_connector:", and "}},number:{format:{separator:".",delimiter:"",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%u%n",unit:"$",separator:".",delimiter:"",precision:2,significant:!1,strip_insignificant_zeros:!1}},percentage:{format:{delimiter:"",format:"%n%"}},precision:{format:{delimiter:""}},human:{format:{delimiter:"",precision:3,significant:!0,strip_insignificant_zeros:!0},storage_units:{format:"%n %u",units:{"byte":{one:"Byte",other:"Bytes"},kb:"KB",mb:"MB",gb:"GB",tb:"TB"}},decimal_units:{format:"%n %u",units:{unit:"",thousand:"Thousand",million:"Million",billion:"Billion",trillion:"Trillion",quadrillion:"Quadrillion"}}}},errors:{format:"%{attribute} %{message}",messages:{inclusion:"is not included in the list",exclusion:"is reserved",invalid:"is invalid",confirmation:"doesn't match %{attribute}",accepted:"must be accepted",empty:"can't be empty",blank:"can't be blank",present:"must be blank",too_long:"is too long (maximum is %{count} characters)",too_short:"is too short (minimum is %{count} characters)",wrong_length:"is the wrong length (should be %{count} characters)",not_a_number:"is not a number",not_an_integer:"must be an integer",greater_than:"must be greater than %{count}",greater_than_or_equal_to:"must be greater than or equal to %{count}",equal_to:"must be equal to %{count}",less_than:"must be less than %{count}",less_than_or_equal_to:"must be less than or equal to %{count}",other_than:"must be other than %{count}",odd:"must be odd",even:"must be even",taken:"has already been taken",in_between:"must be in between %{min} and %{max}"}},activerecord:{errors:{messages:{record_invalid:"Validation failed: %{errors}",restrict_dependent_destroy:{one:"Cannot delete record because a dependent %{record} exists",many:"Cannot delete record because dependent %{record} exist"}}}},datetime:{distance_in_words:{half_a_minute:"half a minute",less_than_x_seconds:{one:"less than 1 second",other:"less than %{count} seconds"},x_seconds:{one:"1 second",other:"%{count} seconds"},less_than_x_minutes:{one:"less than a minute",other:"less than %{count} minutes"},x_minutes:{one:"1 minute",other:"%{count} minutes"},about_x_hours:{one:"about 1 hour",other:"about %{count} hours"},x_days:{one:"1 day",other:"%{count} days"},about_x_months:{one:"about 1 month",other:"about %{count} months"},x_months:{one:"1 month",other:"%{count} months"},about_x_years:{one:"about 1 year",other:"about %{count} years"},over_x_years:{one:"over 1 year",other:"over %{count} years"},almost_x_years:{one:"almost 1 year",other:"almost %{count} years"}},prompts:{year:"Year",month:"Month",day:"Day",hour:"Hour",minute:"Minute",second:"Seconds"}},helpers:{select:{prompt:"Please select"},submit:{create:"Create %{model}",update:"Update %{model}",submit:"Save %{model}"}},grape:{errors:{format:"%{attribute} %{message}",messages:{coerce:"is invalid",presence:"is missing",regexp:"is invalid",values:"does not have a valid value",missing_vendor_option:{problem:"missing :vendor option.",summary:"when version using header, you must specify :vendor option. ",resolution:"eg: version 'v1', :using => :header, :vendor => 'twitter'"},missing_mime_type:{problem:"missing mime type for %{new_format}",resolution:"you can choose existing mime type from Grape::ContentTypes::CONTENT_TYPES or add your own with content_type :%{new_format}, 'application/%{new_format}' "},invalid_with_option_for_represent:{problem:"You must specify an entity class in the :with option.",resolution:"eg: represent User, :with => Entity::User"},missing_option:"You must specify :%{option} options.",invalid_formatter:"cannot convert %{klass} to %{to_format}",invalid_versioner_option:{problem:"Unknown :using for versioner: %{strategy}",resolution:"available strategy for :using is :path, :header, :param"},unknown_validator:"unknown validator: %{validator_type}",unknown_options:"unknown options: %{options}",incompatible_option_values:"%{option1}: %{value1} is incompatible with %{option2}: %{value2}"}}},language_name:"English",invoice:"Invoice",tax_invoice:"Tax Invoice",from:"From",to:"To",description:"Description",date_issued:"Date Issued",payment_due:"Payment Due",amount_due:"Amount Due",subtotal:"Subtotal",total:"Total",quote:"Quote",line_item:{date:"Date",description:"Description",quantity:"Qty",unit_price:"Unit Price",amount:"Amount"},active_record:{attributes:{project:{trello_board_id:"Trello Board",basecamp_project_id:"Basecamp Project"}}}},ces:{language_name:"Czech",invoice:"Faktura",tax_invoice:"Da\u0148ov\xfd doklad",from:"Od",to:"Pro",description:"Popis",date_issued:"Datum vystaven\xed",payment_due:"Datum splatnosti",amount_due:"K \xfahrad\u011b",subtotal:"Mezisou\u010det",total:"Celkem",quote:"Cit\xe1t",line_item:{date:"Datum",description:"Popis",quantity:"Jednotek",unit_price:"J. cena",amount:"\u010c\xe1stka"},number:{format:{separator:".",delimiter:"",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%u%n",separator:".",delimiter:"",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%b %e, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}},da:{language_name:"Dansk",invoice:"Faktura",tax_invoice:"Faktura",from:"Fra",to:"Til",description:"Beskrivelse",date_issued:"Udstedelsesdato",payment_due:"Betalingsfrist",amount_due:"Til betaling",subtotal:"Subtotal",total:"Total",quote:"Citat",line_item:{date:"Dato",description:"Beskrivelse",quantity:"Antal",unit_price:"Enhedspris",amount:"Bel\xf8b"},number:{format:{separator:".",delimiter:"",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%u%n",separator:".",delimiter:"",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%e. %b. %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"Januar","Februar","Marts","April","Maj","Juni","Juli","August","September","Oktober","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],order:["year","month","day"]}},de:{language_name:"Deutsch",invoice:"Rechnung Nr.",tax_invoice:"Rechnung Nr.",from:"Von",to:"An",description:"Beschreibung",date_issued:"Ausstellungsdatum",payment_due:"Zahlbar bis",amount_due:"Zu bezahlen",subtotal:"Zwischensumme",total:"Total",quote:"Offerte",line_item:{date:"Datum",description:"Beschreibung",quantity:"Menge",unit_price:"Preis",amount:"Betrag"},number:{format:{separator:",",delimiter:".",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%n %u",separator:",",delimiter:".",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%b %e, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}},es:{language_name:"Espa\xf1ol",invoice:"Factura",tax_invoice:"Impuestos",from:"De",to:"Para",description:"Descripci\xf3n",date_issued:"Fecha de emisi\xf3n",payment_due:"Adeudo",amount_due:"Importe adeudado",subtotal:"Subtotal",total:"Total",quote:"Presupuesto n\xba",line_item:{date:"Fecha",description:"Descripci\xf3n",quantity:"Cantidad",unit_price:"Precio unitario",amount:"Importe"},number:{format:{separator:".",delimiter:"",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%u%n",separator:".",delimiter:"",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%b %e, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}},fr:{language_name:"Fran\xe7ais",invoice:"Facture",tax_invoice:"Facture",from:"De",to:"\xc0",description:"Description",date_issued:"Date d'\xe9mission",payment_due:"\xc9ch\xe9ance de paiement",amount_due:"Montant d\xfb",subtotal:"Sous total",total:"Total",quote:"Devis",line_item:{date:"Date",description:"Description",quantity:"Quantit\xe9",unit_price:"Prix Unitaire",amount:"Montant"},number:{format:{separator:",",delimiter:" ",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%n %u",separator:",",delimiter:" ",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%b %e, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}},hun:{language_name:"Magyar",invoice:"Sz\xe1mla",tax_invoice:"Sz\xe1mla",from:"Kibocs\xe1t\xf3",to:"Vev\u0151",description:"Megnevez\xe9s",date_issued:"Sz\xe1mla kelte",payment_due:"Fizet\xe9si hat\xe1rid\u0151",amount_due:"Esed\xe9kes \xf6sszeg",subtotal:"R\xe9sz\xf6sszeg",total:"V\xe9g\xf6sszeg",line_item:{date:"D\xe1tum",description:"Megnevez\xe9s",quantity:"Mennyis\xe9g",unit_price:"Egys\xe9g\xe1r",amount:"\xc9rt\xe9k"},number:{format:{separator:".",delimiter:"",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%n",separator:".",delimiter:"",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%b %e, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}},isl:{language_name:"\xcdslenska",invoice:"Reikningur",tax_invoice:"VSK Reikningur",from:"Fr\xe1",to:"Til",description:"L\xfdsing",date_issued:"Dagsetning",payment_due:"Gjalddagi",amount_due:"Upph\xe6\xf0",subtotal:"Samtals \xe1n VSK",total:"Samtals",quote:"Vitna",line_item:{date:"Dagsetning",description:"L\xfdsing",quantity:"Magn",unit_price:"Einingaver\xf0",amount:"Upph\xe6\xf0"},number:{format:{separator:",",delimiter:".",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%u %n",separator:",",delimiter:".",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%b %e, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}},it:{language_name:"Italiano",invoice:"Fattura",tax_invoice:"Fattura con IVA",from:"Da",to:"Per",description:"Descrizione",date_issued:"Data emissione",payment_due:"Pagamento dovuto",amount_due:"Totale",subtotal:"Totale parziale",total:"Totale",quote:"Quota",line_item:{date:"Data",description:"Descrizione",quantity:"Quantit\xe0",unit_price:"Prezzo unitario",amount:"Totale"},number:{format:{separator:".",delimiter:"",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%u%n",separator:".",delimiter:"",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%b %e, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}},ne:{language_name:"Nederlands",invoice:"Factuur",tax_invoice:"Factuur",from:"Van",to:"Voor",description:"Omschrijving",date_issued:"Factuurdatum",payment_due:"Betaling Uiterlijk",amount_due:"Factuurbedrag",subtotal:"Subtotaal",total:"Totaal",quote:"Citaat",line_item:{date:"Datum",description:"Omschrijving",quantity:"Aantal",unit_price:"Prijs per stuk",amount:"Bedrag"},number:{format:{separator:".",delimiter:"",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%u%n",separator:".",delimiter:"",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%b %e, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}},pol:{language_name:"Polski",invoice:"Faktura",tax_invoice:"Faktura VAT",from:"Sprzedawca",to:"Nabywca",description:"Opis",date_issued:"Data Wystawienia",payment_due:"Termin Zap\u0142aty",amount_due:"Nale\u017ano\u015bc Og\xf3\u0142em",subtotal:"Suma",total:"Razem",quote:"Wycena",line_item:{date:"Data",description:"Opis",quantity:"Ilo\u015b\u0107",unit_price:"Cena",amount:"Warto\u015bc Netto"},number:{format:{separator:".",delimiter:"",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%n %u",separator:".",delimiter:"",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%d.%m.%Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"Stycznia","Lutego","Marca","Kwietnia","Maja","Czerwca","Lipca","Sierpnia","Wrze\u015bnia","Pa\u017adziernika","Listopada","Grudnia"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}},"pt-BR":{language_name:"Portugu\xeas Brasileiro",invoice:"Nota",tax_invoice:"Nota Fiscal",from:"De",to:"Para",description:"Descri\xe7\xe3o",date_issued:"Data de Emiss\xe3o",payment_due:"Data de Vencimento",amount_due:"Valor",subtotal:"Subtotal",total:"Total",quote:"Quote",line_item:{date:"Data",description:"Descri\xe7\xe3o",quantity:"Quantidade",unit_price:"Pre\xe7o Unit\xe1rio",amount:"Valor"},number:{format:{separator:".",delimiter:"",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%u%n",separator:".",delimiter:"",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%b %e, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}},ron:{language_name:"Romanian",invoice:"Factura",tax_invoice:"Factura",from:"Furnizor",to:"Cumparator",description:"Descriere",date_issued:"Data emiterii",payment_due:"Scadenta",amount_due:"Total de plata",subtotal:"Subtotal",total:"Total",quote:"Citat",line_item:{date:"Data",description:"Descriere",quantity:"Cant.",unit_price:"P.U.",amount:"Valoare"},number:{format:{separator:",",delimiter:".",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%n %u",separator:",",delimiter:".",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%b %e, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}},sv:{language_name:"Svenska",invoice:"Faktura",tax_invoice:"Moms",from:"Fr\xe5n",to:"Till",description:"Beskrivning",date_issued:"Fakturadatum",payment_due:"F\xf6rfallodatum",amount_due:"Restbelopp",subtotal:"Summa",total:"Totalt",quote:"Citat",line_item:{date:"Datum",description:"Beskrivning",quantity:"Antal",unit_price:"\xc1-pris",amount:"Summa"},number:{format:{separator:",",delimiter:" ",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%n %u",separator:",",delimiter:" ",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%b %e, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}},tr:{language_name:"T\xfcrk\xe7e",invoice:"Fatura",tax_invoice:"Fatura Vergisi",from:"G\xf6nderici",to:"Al\u0131c\u0131",description:"A\xe7\u0131klama",date_issued:"Olu\u015fturulma Tarihi",payment_due:"Son \xd6deme Tarihi",amount_due:"Miktar",subtotal:"Ara Toplam",total:"Toplam",quote:"Aktar\u0131lan s\xf6z",line_item:{date:"Tarih",description:"A\xe7\u0131klama",quantity:"Miktar",unit_price:"Birim Fiyat",amount:"Tutar"},number:{format:{separator:".",delimiter:"",precision:3,significant:!1,strip_insignificant_zeros:!1},currency:{format:{format:"%u%n",separator:".",delimiter:"",precision:2,significant:!1,strip_insignificant_zeros:!1}}},date:{formats:{"default":"%b %e, %Y",month_and_year:"%B %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],order:["year","month","day"]}}},function(){Backbone.Epoxy.binding.addHandler("currencyCounter",function(t,e){var i,n,s;if(null!=e)return s=t.text(),"String"===e.constructor.name?(e=new Money(Paydirt.Formatters.currencyToFloat(e)),i="format"):i="toString",n=new Money(Paydirt.Formatters.currencyToFloat(s)),""!==s&&e!==n?t.countTo({from:n,to:e,speed:500,formatter:function(t){return new Money(t)[i]()}}):t.text(e[i]())}),Backbone.Epoxy.binding.addFilter("equal",function(t,e){return t===e}),Backbone.Epoxy.binding.addFilter("zero",function(t){return 0===+t}),Backbone.Epoxy.binding.addHandler("isChecked",function(t,e){return t.prop("checked",!!e)})}.call(this),function(){Types.Money=signTypeFunction("Money",function(t){return new Money(t)})}.call(this),function(){window.Paydirt={}}.call(this),function(){var t,e;_.extend(Paydirt,Backbone.Events),Paydirt.online_components={navigator:!0,websockets:!0},Paydirt.initialize=function(t,e){var i;return null==e&&(e={}),this.baseURL=t.baseURL,null==e.docked&&(e.docked=!0),Paydirt.isoDateFormat="YYYY-MM-DDTHH:mm:ssZ",Paydirt.day_names=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],I18n.fallbacks=!0,moment.defaultFormat="MMM D, YYYY",moment.lang("en",{calendar:{lastDay:"[(yesterday)]",sameDay:"[]",nextDay:"[(tomorrow)]",lastWeek:"[(last] dddd[)]",nextWeek:"dddd [at] LT",sameElse:"L"}}),Paydirt.document=function(t){var e;return e=Paydirt.invoices.findWhere({id:t}),_.isEmpty(e)&&(e=Paydirt.quotes.findWhere({id:t})),e},Paydirt.locales=t.locales,Paydirt.currencies=new Paydirt.Collections.Currencies(t.currencies),Paydirt.account=new Paydirt.Models.Account(t.account),Paydirt.user_assignments=new Paydirt.Collections.UserAssignments(t.user_assignments),Paydirt.users=new Paydirt.Collections.Users(t.users),Paydirt.user=Paydirt.users.get(t.user_id),Paydirt.work_signals=new Paydirt.Collections.WorkSignals(t.work_signals),Paydirt.preset_line_items=new Paydirt.Collections.PresetLineItems(t.preset_line_items),Paydirt._blocks=new Paydirt.Collections.Blocks(t.blocks),Paydirt.blocks=Paydirt._blocks.subcollection({filter:function(){return function(t){return!t.get("running")}}(this)}),Paydirt.runningBlocks=Paydirt._blocks.subcollection({filter:function(){return function(t){return t.get("user_id")===Paydirt.user.id&&t.get("running")}}(this)}),Paydirt.jobs=new Paydirt.Collections.Jobs(t.jobs),Paydirt.expenses=new Paydirt.Collections.Expenses(t.expenses),Paydirt.projects=new Paydirt.Collections.Projects,Paydirt.trackerProjects=Paydirt.projects.subcollection({filter:function(){return function(t){return t.get("show_in_tracker")}}(this)}),Paydirt.invoices=new Paydirt.Collections.Invoices(t.invoices),Paydirt.recurring_invoices=new Paydirt.Collections.RecurringInvoices(t.recurring_invoices),Paydirt.quotes=new Paydirt.Collections.Quotes(t.quotes),Paydirt.clients=new Paydirt.Collections.Clients(t.clients),Paydirt.projects.reset(t.projects),moment.lang("en",{week:{dow:Paydirt.account.get("first_day_of_week")}}),i=Paydirt.day_names[Paydirt.account.get("first_day_of_week")],d3.time.week=d3.time[i],d3.time.weeks=d3.time[i].range,d3.time.weeks.utc=d3.time[i].utc.range,Paydirt.tracker=new Paydirt.Models.Tracker({block:Paydirt.runningBlocks.first(),mode:e.trackerMode||"in-app",docked:e.docked}),Paydirt.trackerView=new Paydirt.Views.Tracker.Show({tracker:Paydirt.tracker}),$(".tracker-container").html(Paydirt.trackerView.render().el),window.location.pathname.match(/^\/settings/)||window.location.pathname.match(/^\/intent/)||window.location.pathname.match(/^\/welcome/)||window.location.pathname.match(/^\/users/)||window.location.pathname.match(/^\/document_emails/)||window.location.pathname.match(/^\/tracker/)||(Paydirt.router=window.location.pathname.match(/^\/extensions/)?new Paydirt.ExtensionRouter:new Paydirt.Router,Backbone.history.start({pushState:!0})),Math.abs(new moment-new moment(Paydirt.user.get("now")))>12e5&&null==Paydirt.Cookies.read("last_time_zone_warning")&&(Paydirt.Cookies.write("last_time_zone_warning","warned",.0138),$.fancybox.open({type:"ajax",href:"/settings/time_zone_warning",openSpeed:600,closeSpeed:200,margin:0,padding:0,scrolling:"visible",modal:!0})),$(document).ajaxError(function(t,e){return Paydirt.Flash.error(e.responseText)}),$(document).trigger("paydirt.initialized"),top.postMessage({name:"paydirt.initialized"},"*"),this.subscribeTo(t.pusher),Paydirt.online=!0,Paydirt.setOnline({user_session:!0})},Paydirt.subscribeTo=function(t){var e;return null!=this.pusher&&null!=this.pusher.disconnect&&this.pusher.disconnect(),this.pusher=new Pusher(t.key,{encrypted:!0,authEndpoint:""+Paydirt.baseURL+"/pusher/auth"}),e=this.pusher.subscribe(t.channel),e.bind("data",function(t){return function(e){return e.client?t.clients.updateFromPush(e.client):e.project?t.projects.updateFromPush(e.project):e.job?t.jobs.updateFromPush(e.job):e.block?(e.block.user_id===t.user.id||t.user.canViewAllTimeLogged())&&t._blocks.updateFromPush(e.block):e.invoice?t.user.canManageInvoices()&&t.invoices.updateFromPush(e.invoice):e.quote?t.user.canManageInvoices()&&t.quotes.updateFromPush(e.quote):e.work_signal&&t.work_signals.updateFromPush(e.work_signal),e.user_assignment?t.user_assignments.updateFromPush(e.user_assignment):void 0}}(this))},window.addEventListener("online",function(){return function(){return Paydirt.setOnline({navigator:!0})}}(this)),window.addEventListener("offline",function(){return function(){return Paydirt.setOnline({navigator:!1})}}(this)),Paydirt.setOnline=function(t){var e;return _.extend(Paydirt.online_components,t),e=this.online_components.user_session&&this.online_components.websockets&&this.online_components.navigator,this.online!==e?(this.online=e,e&&Paydirt.getSubscription(),this.trigger("change:online")):void 0
},t=5e3,e=null,Paydirt.getSubscription=function(){var i;return clearTimeout(e),i=$.get(""+Paydirt.baseURL+"/data/subscription").success(function(e){return t=5e3,Paydirt.subscribeTo(e.pusher)}).fail(function(){return 18e5>t&&(t=2*t),console.log("Unable to fetch a new data subscription from server. Retrying in "+t/1e3+" seconds."),e=setTimeout(Paydirt.getSubscription,t)})}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Model=function(e){function n(){return this.parse=t(this.parse,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.markClean=function(){return Paydirt.dirty===this?(Paydirt.dirty=null,window.onbeforeunload=null):void 0},n.prototype.markDirty=function(){return Paydirt.canBeDirtied===this?(Paydirt.dirty=this,window.onbeforeunload=function(t){return function(){return"You have unsaved changes to "+t.dirtyMessage()+"."}}(this),!0):void 0},n.prototype.sum=function(t,e){return t.reduce(function(t,i){return t+(+i.get(e)||0)},0)},n.prototype.dirtyMessage=function(){return"this page"},n.prototype.parse=function(t){return null!=this.get("updated_at")&&moment(this.get("updated_at"))>=moment(t.updated_at)?{}:t},n}(TypedModel)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Collection=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.updateFromPush=function(t){var e;if(e=this.get(t.id),t.destroyed||t["destroyed?"])return this.remove(t.id),null!=e&&"function"==typeof e.teardown?e.teardown():void 0;if(null==e)return this.add(t);if(moment(e.get("updated_at"))>=moment(t.updated_at));else if(e.set(this===Paydirt.invoices?e.parse({invoice:t}):this===Paydirt.quotes?e.parse({quote:t}):t),e.markClean(),t.position&&e.hasChanged("position"))return e.collection.sort()},i.prototype.sum=function(t){return this.reduce(function(e,i){return e+(+i.get(t)||0)},0)},i}(Backbone.Collection)}.call(this),function(){Paydirt.Routes={reports:function(){return"/reports"},reports_timesheets:function(){return"/reports/timesheets"},reports_projects:function(){return"/reports/projects"},blocks:function(t){var e;return null==t&&(t=null),e="/time",null!=t&&(e=""+e+"?"+$.param(t)),e},block:function(t){return""+this.blocks()+"/"+t},new_block:function(t){var e;return e=""+this.blocks()+"/log",null!=t&&(e=""+this.blocks()+"/log?job="+t),e},edit_block:function(t){return""+this.block(t)+"/edit"},duplicate_block:function(t){return""+this.block(t)+"/duplicate"},clients:function(){return"/clients"},client:function(t){return""+this.clients()+"/"+t},new_client:function(){return""+this.clients()+"/new"},edit_client:function(t){return""+this.client(t)+"/edit"},client_keywords:function(t){return""+this.client(t)+"/keywords"},client_quotes:function(t){return""+this.client(t)+"/quotes"},client_invoices:function(t){return""+this.client(t)+"/invoices"},client_invoices_new:function(t,e){var i;return i=""+this.client_invoices(t)+"/new",null!=e&&(i=""+i+"?for="+e),i},quotes:function(){return"/quotes"},quotes_history:function(){return""+this.quotes()+"/history"},quote:function(t){return""+this.quotes()+"/"+t},print_quote:function(t){return""+this.quote(t)+"/print"},public_quote:function(t,e){return""+this.quote(t)+"/view/"+e},edit_quote:function(t){return""+this.quote(t)+"/edit"},duplicate_quote:function(t){return""+this.quote(t)+"/duplicate"},convert_quote_to_invoice:function(t){return""+this.quote(t)+"/convert_to_invoice"},mark_quote:function(t,e){return""+this.quote(t)+"/mark_"+e},invoices:function(){return"/invoices"},invoices_history:function(){return"/invoices/all"},invoice:function(t){return""+this.invoices()+"/"+t},print_invoice:function(t){return""+this.invoice(t)+"/print"},public_invoice:function(t,e){return""+this.invoice(t)+"/view/"+e},edit_invoice:function(t){return""+this.invoice(t)+"/edit"},add_to_invoice:function(t){return""+this.invoice(t)+"/add"},duplicate_invoice:function(t){return""+this.invoice(t)+"/duplicate"},convert_to_draft_invoice:function(t){return""+this.invoice(t)+"/convert_to_draft"},recurring_invoices:function(){return"/invoices/recurring"},recurring_invoice:function(t){return"/recurring_invoices/"+t},edit_recurring_invoice:function(t){return"/recurring_invoices/"+t+"/edit"},schedule_recurring_invoice:function(t){return"/recurring_invoices/"+t+"/schedule"},new_document_email:function(t,e){return"/document_emails/new?document_id="+t+"&type="+e},new_invoice_payment_email:function(t,e){return""+this.new_document_email(t,"thankyou")+"&invoice_payment_id="+e},trello_board:function(t){return"https://trello.com/b/"+t},trello_card:function(t){return"https://trello.com/c/"+t},basecamp_project:function(t,e){return"https://basecamp.com/"+t+"/projects/"+e},basecamp_todo:function(t,e,i){return""+this.basecamp_project(t,e)+"/todos/"+i},redbooth_project:function(t){return"https://redbooth.com/a/#!/projects/"+t+"/tasks"},redbooth_task:function(t,e){return""+this.redbooth_project(t)+"/"+e}}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Router=function(e){function n(){return this.currentPath=t(this.currentPath,this),this._markStateClean=t(this._markStateClean,this),this._popstate=t(this._popstate,this),this.navigateToBack=t(this.navigateToBack,this),this.handleClick=t(this.handleClick,this),this.render=t(this.render,this),this.navigate=t(this.navigate,this),this.render404=t(this.render404,this),this.recurringInvoicesSchedule=t(this.recurringInvoicesSchedule,this),this.recurringInvoicesEdit=t(this.recurringInvoicesEdit,this),this.recurringInvoicesShow=t(this.recurringInvoicesShow,this),this.invoicesEdit=t(this.invoicesEdit,this),this.invoicesAdd=t(this.invoicesAdd,this),this.invoicesShow=t(this.invoicesShow,this),this.invoicesRecurring=t(this.invoicesRecurring,this),this.invoicesAll=t(this.invoicesAll,this),this.invoicesPaid=t(this.invoicesPaid,this),this.invoicesIndex=t(this.invoicesIndex,this),this.quotesEdit=t(this.quotesEdit,this),this.quotesShow=t(this.quotesShow,this),this.quotesHistory=t(this.quotesHistory,this),this.quotesIndex=t(this.quotesIndex,this),this.getClient=t(this.getClient,this),this.clientsEdit=t(this.clientsEdit,this),this.clientsKeywords=t(this.clientsKeywords,this),this.clientsNewInvoice=t(this.clientsNewInvoice,this),this.clientsInvoices=t(this.clientsInvoices,this),this.clientsQuotes=t(this.clientsQuotes,this),this.clientsShow=t(this.clientsShow,this),this.clientsNew=t(this.clientsNew,this),this.clientsArchived=t(this.clientsArchived,this),this.clientsIndex=t(this.clientsIndex,this),this.blocksDuplicate=t(this.blocksDuplicate,this),this.blocksEdit=t(this.blocksEdit,this),this.blocksNew=t(this.blocksNew,this),this.blocksIndex=t(this.blocksIndex,this),this.reportsProjects=t(this.reportsProjects,this),this.reportsTimesheets=t(this.reportsTimesheets,this),this.reportsIndex=t(this.reportsIndex,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.routes=function(){var t,e,i,n,s,r;return r={"time/log":"blocksNew","time/:id/edit":"blocksEdit","time/:id/duplicate":"blocksDuplicate",time:"blocksIndex"},t={clients:"clientsIndex","clients/new":"clientsNew","clients/archived":"clientsArchived","clients/:id":"clientsShow","clients/:id/quotes":"clientsQuotes","clients/:id/invoices":"clientsInvoices","clients/:id/invoices/new":"clientsNewInvoice","clients/:id/keywords":"clientsKeywords","clients/:id/edit":"clientsEdit"},n={quotes:"quotesIndex","quotes/history":"quotesHistory","quotes/:id":"quotesShow","quotes/:id/edit":"quotesEdit"},i={"invoices/paid":"invoicesPaid","invoices/all":"invoicesAll","invoices/recurring":"invoicesRecurring","invoices/:id":"invoicesShow","invoices/:id/edit":"invoicesEdit","invoices/:id/add":"invoicesAdd",invoices:"invoicesIndex","recurring_invoices/:id":"recurringInvoicesShow","recurring_invoices/:id/edit":"recurringInvoicesEdit","recurring_invoices/:id/schedule":"recurringInvoicesSchedule"},s={reports:"reportsIndex","reports/timesheets":"reportsTimesheets","reports/projects":"reportsProjects"},e={"*404":"render404"},Paydirt.user.canViewFinancialInformation()&&_.extend(r,t),Paydirt.user.canManageInvoices()&&_.extend(r,n,i),Paydirt.user.canViewFinancialInformation()&&Paydirt.user.canManageInvoices()&&_.extend(r,s),_.extend(r,e),r},n.prototype.initialize=function(){return $(document).on("click","a[data-behaviour~=backbone_link]",function(t){return function(e){return t.handleClick(e)}}(this)),Paydirt.tour=Paydirt.Utilities.getParameterByName("tour"),window.onpopstate=this._popstate},n.prototype.reportsIndex=function(){return this.view=new Paydirt.Views.ReportsIndex,this.render("Reports")},n.prototype.reportsTimesheets=function(){return this.view=new Paydirt.Views.ReportsTimesheets,this.render("Timesheets Report")},n.prototype.reportsProjects=function(){return this.view=new Paydirt.Views.ReportsProjects,this.render("Project Budget Report")},n.prototype.blocksIndex=function(t){return null==t&&(t={}),this.view=new Paydirt.Views.Blocks.Index({collection:Paydirt.blocks}),this.render("Time Logged")},n.prototype.blocksNew=function(t){var e;return null==t&&(t={}),Paydirt.block=new Paydirt.Models.Block,Paydirt.canBeDirtied=Paydirt.block,e=Paydirt.Utilities.getParameterByName("job"),this.view=new Paydirt.Views.Blocks.New({model:Paydirt.block,jobId:e}),this.render("Log Time Worked")},n.prototype.blocksEdit=function(t){var e,i;return e=Paydirt.blocks.get(parseInt(t)),i=function(t){return function(){return Paydirt.block=e.clone(),Paydirt.canBeDirtied=Paydirt.block,t.view=new Paydirt.Views.Blocks.Edit({model:Paydirt.block}),t.render("Edit Log Entry")}}(this),null!=e?i():(e=new Paydirt.Models.Block({id:t}),e.fetch().done(function(){return function(){return i()}}(this)).fail(function(t){return function(){return t.navigate(Paydirt.Routes.blocks(),{trigger:!0})}}(this)))},n.prototype.blocksDuplicate=function(t){return Paydirt.block=Paydirt.blocks.get(parseInt(t)).clone(),Paydirt.canBeDirtied=Paydirt.block,Paydirt.block.id=void 0,Paydirt.block.duplicated=!0,this.view=new Paydirt.Views.Blocks.Duplicate({model:Paydirt.block}),this.render("Duplicate Log Entry")},n.prototype.clientsIndex=function(){return this.view=new Paydirt.Views.Clients.Index({collection:Paydirt.clients.active(),active:!0}),this.render("Clients")},n.prototype.clientsArchived=function(){return this.view=new Paydirt.Views.Clients.Index({collection:Paydirt.clients.inactive(),active:!1}),this.render("Archived Clients")},n.prototype.clientsNew=function(){return Paydirt.client=new Paydirt.Models.Client,this.view=new Paydirt.Views.Clients.New({model:Paydirt.client}),this.render("Add a Client")},n.prototype.clientsShow=function(t){return this.getClient(t),this.view=new Paydirt.Views.Clients.Show({model:Paydirt.client,subView:Paydirt.Views.Clients.Work}),this.render(Paydirt.client.get("business_name")),"setup-jobs"===Paydirt.tour?(Paydirt.Guiders.Clients.Show.initialize(),Paydirt.Guiders.Clients.Show.tour.start()):void 0},n.prototype.clientsQuotes=function(t){return this.getClient(t),this.view=new Paydirt.Views.Clients.Show({model:Paydirt.client,subView:Paydirt.Views.Clients.Quotes}),this.render()},n.prototype.clientsInvoices=function(t){return this.getClient(t),this.view=new Paydirt.Views.Clients.Show({model:Paydirt.client,subView:Paydirt.Views.Clients.Invoices}),this.render()},n.prototype.clientsNewInvoice=function(t,e){var i;return null==e&&(e={}),i=e["for"],this.getClient(t),this.view=new Paydirt.Views.Clients.Show({model:Paydirt.client,subView:Paydirt.Views.Clients.NewInvoice,subViewOptions:{client:Paydirt.client,invoiceFor:i}}),this.render(),$("body").addClass("with_invoice")},n.prototype.clientsKeywords=function(t){return this.getClient(t),this.view=new Paydirt.Views.Clients.Show({model:Paydirt.client,subView:Paydirt.Views.Clients.Keywords}),this.render()},n.prototype.clientsEdit=function(t){return this.getClient(t),this.view=new Paydirt.Views.Clients.Show({model:Paydirt.client,subView:Paydirt.Views.Clients.Edit}),this.render("Edit "+Paydirt.client.get("business_name"))},n.prototype.getClient=function(t){return Paydirt.client=Paydirt.clients.get(parseInt(t))},n.prototype.quotesIndex=function(t){return null==t&&(t={}),this.view=new Paydirt.Views.Quotes.Index({collection:Paydirt.quotes.current(),current:!0}),this.render("Current Quotes")},n.prototype.quotesHistory=function(t){return null==t&&(t={}),this.view=new Paydirt.Views.Quotes.Index({collection:Paydirt.quotes.historical(),current:!1}),this.render("Accepted & Declined Quotes")},n.prototype.quotesShow=function(t){return Paydirt.quote=Paydirt.quotes.get(parseInt(t)),I18n.locale=Paydirt.quote.locale(),this.view=new Paydirt.Views.Quotes.Show({model:Paydirt.quote}),this.render("Quote "+Paydirt.quote.formattedNumber()+" ("+Paydirt.quote.client().get("business_name")+")"),$("body").addClass("with_invoice")},n.prototype.quotesEdit=function(t){return Paydirt.quote=Paydirt.quotes.get(parseInt(t)).clone(),Paydirt.canBeDirtied=Paydirt.quote,I18n.locale=Paydirt.quote.locale(),this.view=new Paydirt.Views.Documents.Edit({model:Paydirt.quote}),this.render("Edit Quote "+Paydirt.quote.formattedNumber()+" ("+Paydirt.quote.client().get("business_name")+")"),$("body").addClass("with_invoice")},n.prototype.invoicesIndex=function(t){return null==t&&(t={}),this.view=new Paydirt.Views.Invoices.Index,this.render("Current Invoices"),"saved-invoice"===Paydirt.tour?(Paydirt.Guiders.Invoices.Index.initialize(),Paydirt.Guiders.Invoices.Index.tour.start()):void 0},n.prototype.invoicesPaid=function(t){return null==t&&(t={}),this.view=new Paydirt.Views.Invoices.Index({current:!1,paid:!0}),this.render("Paid Invoices")},n.prototype.invoicesAll=function(t){return null==t&&(t={}),this.view=new Paydirt.Views.Invoices.Index({current:!0,paid:!0}),this.render("All Invoices")},n.prototype.invoicesRecurring=function(t){return null==t&&(t={}),this.view=new Paydirt.Views.Invoices.Index({recurring:!0}),this.render("Recurring Invoices")},n.prototype.invoicesShow=function(t){return Paydirt.invoice=Paydirt.invoices.get(parseInt(t)),I18n.locale=Paydirt.invoice.locale(),this.view=new Paydirt.Views.Invoices.Show({model:Paydirt.invoice}),this.render("Invoice "+Paydirt.invoice.formattedNumber()+" ("+Paydirt.invoice.client().get("business_name")+")"),$("body").addClass("with_invoice"),"send-invoice"!==Paydirt.tour||Paydirt.invoice.get("sent")?"setup-payments"===Paydirt.tour?(Paydirt.Guiders.Invoices.SetupPayments.initialize(),Paydirt.account.get("paypal_enabled")||Paydirt.account.get("stripe_enabled")?Paydirt.Guiders.Invoices.SetupPayments.tour.lastStep():Paydirt.Guiders.Invoices.SetupPayments.tour.start()):void 0:(Paydirt.Guiders.Invoices.Send.initialize(),Paydirt.account.get("paypal_enabled")||Paydirt.account.get("stripe_enabled")?Paydirt.Guiders.Invoices.Send.tour.introduceSendButton():Paydirt.Guiders.Invoices.Send.tour.start())},n.prototype.invoicesAdd=function(t){return Paydirt.invoice=Paydirt.invoices.get(parseInt(t)).clone(),Paydirt.canBeDirtied=Paydirt.invoice,I18n.locale=Paydirt.invoice.locale(),this.view=new Paydirt.Views.Documents.Add({model:Paydirt.invoice,client:Paydirt.invoice.client()}),this.render("Add to Invoice "+Paydirt.invoice.formattedNumber()+" ("+Paydirt.invoice.client().get("business_name")+")"),$("body").addClass("with_invoice")},n.prototype.invoicesEdit=function(t){return Paydirt.invoice=Paydirt.invoices.get(parseInt(t)).clone(),Paydirt.canBeDirtied=Paydirt.invoice,I18n.locale=Paydirt.invoice.locale(),this.view=new Paydirt.Views.Documents.Edit({model:Paydirt.invoice}),this.render("Edit Invoice "+Paydirt.invoice.formattedNumber()+" ("+Paydirt.invoice.client().get("business_name")+")"),$("body").addClass("with_invoice"),"send-demo-invoice"===Paydirt.tour?(Paydirt.Guiders.Invoices.Edit.initialize(),Paydirt.Guiders.Invoices.Edit.tour.start()):void 0},n.prototype.recurringInvoicesShow=function(t){return Paydirt.invoice=Paydirt.recurring_invoices.get(parseInt(t)),I18n.locale=Paydirt.invoice.locale(),this.view=new Paydirt.Views.Invoices.ShowRecurring({model:Paydirt.invoice}),this.render("Recurring Invoice "+Paydirt.invoice.formattedNumber()+" ("+Paydirt.invoice.client().get("business_name")+")"),$("body").addClass("with_invoice")},n.prototype.recurringInvoicesEdit=function(t){return Paydirt.invoice=Paydirt.recurring_invoices.get(parseInt(t)).clone(),Paydirt.canBeDirtied=Paydirt.invoice,I18n.locale=Paydirt.invoice.locale(),this.view=new Paydirt.Views.Documents.Edit({model:Paydirt.invoice}),this.render("Edit Recurring Invoice "+Paydirt.invoice.formattedNumber()+" ("+Paydirt.invoice.client().get("business_name")+")"),$("body").addClass("with_invoice")},n.prototype.recurringInvoicesSchedule=function(t){return Paydirt.invoice=Paydirt.recurring_invoices.get(parseInt(t)).clone(),Paydirt.canBeDirtied=Paydirt.invoice,I18n.locale=Paydirt.invoice.locale(),this.view=new Paydirt.Views.Documents.Schedule({model:Paydirt.invoice}),this.render("Edit Schedule: Recurring Invoice "+Paydirt.invoice.formattedNumber()+" ("+Paydirt.invoice.client().get("business_name")+")"),$("body").addClass("with_invoice")},n.prototype.render404=function(){return this.view=new Paydirt.Views.PageNotFound,this.render("Page Not Found")},n.prototype.navigate=function(t,e){var i,s;return $(".tipsy, .autogrow-shadow").remove(),i=$.Deferred(),i.promise().then(function(i){return function(){return i._previousPath=i.currentPath(),I18n.fallbacks=!0,I18n.locale=I18n.defaultLocale,i._markStateClean(),i.onpopstate=null,n.__super__.navigate.call(i,t,e),"undefined"!=typeof _gaq&&null!==_gaq?_gaq.push(["_trackPageview","/"+Backbone.history.getFragment()]):void 0}}(this)),Paydirt.dirty?(s=modalConfirm({message:"You haven't saved your changes to "+Paydirt.dirty.dirtyMessage()+". Are you sure you want to discard your changes?",cancel:"No, don't discard changes",confirm:"Yes, discard changes"},i),i.promise()):i.resolve()},n.prototype.render=function(t){var e,i;return null!=this._currentView&&($("body").first().trigger("navigate"),this._currentView.teardown()),this._currentView=this.view,$("#main").html(this.view.render().el),window.scroll(0,0),$("body").removeClass("with_invoice"),i=window.location.pathname,/^\/reports/.test(i)?e=$("#nav-reports"):/^\/clients/.test(i)?e=$("#nav-clients"):/^\/time/.test(i)?e=$("#nav-time"):/^\/quotes/.test(i)?e=$("#nav-quotes"):/^\/invoices/.test(i)?e=$("#nav-invoices"):/^\/recurring_invoices/.test(i)&&(e=$("#nav-invoices")),$("#nav li").removeClass("selected"),null!=e&&e.addClass("selected"),null!=t?Paydirt.Utilities.setPageTitle(t):void 0},n.prototype.handleClick=function(t,e){return t.button>0||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey?void 0:(t.preventDefault(),e?this.navigate(e,{trigger:!0}):this.navigate(t.currentTarget.pathname+t.currentTarget.search,{trigger:!0}))},n.prototype.navigateToBack=function(t){return null==t&&(t=Paydirt.Routes.blocks()),null!=this._previousPath?this._previousPath===this.currentPath()?this.navigate(t,{trigger:!0}):this.navigate(this._previousPath,{trigger:!0}):this.navigate(t,{trigger:!0})},n.prototype._popstate=function(t){return this._markStateClean(),"function"==typeof this.onpopstate?this.onpopstate(t):void 0},n.prototype._markStateClean=function(){return Paydirt.dirty=null,Paydirt.canBeDirtied=null,window.onbeforeunload=null},n.prototype.currentPath=function(){return window.location.pathname+window.location.search},n}(Backbone.Router)}.call(this),function(){Paydirt.Models={}}.call(this),function(){Paydirt.Collections={}}.call(this),function(){Paydirt.Mixins={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},n=[].slice;Paydirt.View=function(e){function s(){return this.teardown=t(this.teardown,this),this.doAction=t(this.doAction,this),this.callValidAction=t(this.callValidAction,this),this.callConfirmAction=t(this.callConfirmAction,this),this.callKeyUpAction=t(this.callKeyUpAction,this),this.callEscAction=t(this.callEscAction,this),this.callEnterAction=t(this.callEnterAction,this),this.callCtrlEnterAction=t(this.callCtrlEnterAction,this),this.callInputAction=t(this.callInputAction,this),this.callChangeAction=t(this.callChangeAction,this),this.callFocusAction=t(this.callFocusAction,this),this.callClickAction=t(this.callClickAction,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),s.__super__.constructor.apply(this,arguments)}return i(s,e),s.prototype.bindingFilters={formatDate:function(t){return new moment(t).format()},pluralize:function(t,e){var i;return i=null!=t.length?t.length:t,""+(0===i?"no":i)+" "+e+(1===i?"":"s")},nonZero:function(t){return parseFloat(t)>0}},s.prototype.initialize=function(t){return this.events=_.extend(this.events||{},{"click [data-onclick]":"callClickAction","focus [data-onfocus]":"callFocusAction","change [data-onchange]":"callChangeAction","input [data-oninput]":"callInputAction","keydown [data-onctrlenter]":"callCtrlEnterAction","keydown [data-onenter]":"callEnterAction","keydown [data-onesc]":"callEscAction","keyup [data-onkeyup]":"callKeyUpAction","confirm [data-onconfirm]":"callConfirmAction","valid [data-onvalid]":"callValidAction"}),_.extend.apply(_,[this].concat(n.call(this.mixins||[]))),this.subViews={},s.__super__.initialize.call(this,t)},s.prototype.render=function(){return this.$el.html(this.template({model:this.model,collection:this.collection})),this.applyBindings(),this},s.prototype.callClickAction=function(t){return this.doAction($(t.currentTarget).data("onclick"),t)},s.prototype.callFocusAction=function(t){return this.doAction($(t.currentTarget).data("onfocus"),t)},s.prototype.callChangeAction=function(t){return this.doAction($(t.currentTarget).data("onchange"),t)},s.prototype.callInputAction=function(t){return this.doAction($(t.currentTarget).data("oninput"),t)},s.prototype.callCtrlEnterAction=function(t){var e;return e=t.keyCode?t.keyCode:t.which,13===e&&t.ctrlKey?(t.preventDefault(),this.doAction($(t.currentTarget).data("onctrlenter"),t)):!0},s.prototype.callEnterAction=function(t){var e;return e=t.keyCode?t.keyCode:t.which,13!==e||t.shiftKey?!0:(t.preventDefault(),this.doAction($(t.currentTarget).data("onenter"),t))},s.prototype.callEscAction=function(t){var e;return e=t.keyCode?t.keyCode:t.which,27===e?this.doAction($(t.currentTarget).data("onesc"),t):void 0},s.prototype.callKeyUpAction=function(t){return this.doAction($(t.currentTarget).data("onkeyup"),t)},s.prototype.callConfirmAction=function(t){return null!=$(t.currentTarget).data("onconfirm")?this.doAction($(t.currentTarget).data("onconfirm"),t):void 0},s.prototype.callValidAction=function(t){return this.doAction($(t.currentTarget).data("onvalid"),t)},s.prototype.doAction=function(t,e){var i,n,s,r,a,o,l;for(t=t.split(","),l=[],n=s=0,r=t.length;r>s;n=++s)i=t[n],i=i.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()}),_.isFunction(this[i])&&!(null!=(a=e.originalEvent)?a.isDataHandlerPrevented:void 0)?(n===t.length-1&&null!=(o=e.originalEvent)&&(o.isDataHandlerPrevented=!0),e.preventDefault(),l.push(this[i](e))):l.push(void 0);return l},s.prototype.teardown=function(){var t,e,i;i=this.subViews;for(e in i)t=i[e],t.teardown();return this.off(),this.stopListening(),this.remove(),this.undelegateEvents(),this},s}(Backbone.Epoxy.View)}.call(this),function(){Paydirt.Views={}}.call(this),function(){Paydirt.Templates||(Paydirt.Templates={})}.call(this),function(){Paydirt.Guiders={},window.skipButton="<a href='#' class='grey button_aligned' data-behaviour='end_tour'>Cancel Tour</a>",window.arwRight=" <i class='icon-circle-arrow-right'></i>",window.arwLeft="<i class='icon-circle-arrow-left'></i> ",window.checklistButton="<a href='/welcome' class='action button_aligned'>"+arwLeft+" Back to my checklist</a>"}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=function(t){function i(t,i){null==i&&(i={}),this.zero=e(this.zero,this),this.amount=e(this.amount,this),this.format=e(this.format,this),this.toJSON=e(this.toJSON,this),this.toString=e(this.toString,this),this.valueOf=e(this.valueOf,this),this._amount=t,this.sign=i.sign}return n(i,t),i.prototype.valueOf=function(){return this.amount()},i.prototype.toString=function(){return Paydirt.Formatters.currency(this.amount(),{sign:""})},i.prototype.toJSON=function(){return this.amount()},i.prototype.format=function(t){return null==t&&(t={}),Paydirt.Formatters.currency(this.amount(),_.defaults(t,{sign:this.sign}))},i.prototype.amount=function(){return Math.round(100*this._amount)/100},i.prototype.zero=function(){return 0===this._amount?!0:void 0},i}(Number),window.Money=t}.call(this),function(){$(function(){var t,e,i,n,s,r,a,o,l;return o=["data-validates-numericality","data-validates-presence","data-validates-format"],l=jQuery.map(o,function(t){return"["+t+"]"}).join(", "),$(o).each(function(t,e){var n;return n="["+e+"]",$(document).on("blur",n,function(t){return i(this,t,!1,e)}),"data-validates-format"!==e?($(document).on("keyup",n,function(t){return i(this,t,!1,e)}),$(document).on("change",n,function(t){return $(this).is("select")?i(this,t,!1,e):void 0})):void 0}),i=function(t,i,n,o){var l;if((8!==i.keyCode&&9!==i.keyCode&&16!==i.keyCode&&46!==i.keyCode||$(t).hasClass("invalid"))&&!$(t).data("skip-validation")){switch(o){case"data-validates-presence":l=a(t);break;case"data-validates-numericality":l=r(t);break;case"data-validates-format":l=s(t),l&&$(t).trigger("valid_format")}if(l){if(e(t,o),$(t).closest(".faux_input").removeClass("invalid"),$(t).closest(".faux_input").removeClass("invalidOnSubmit"),$(t).removeClass("invalid"),$(t).removeClass("invalidOnSubmit"),$(t).nextAll("span.error_message").remove(),$(t).has("[data-behaviour~=chosen]"))return $(t).next(".chzn-container").removeClass("invalid")}else if($(t).addClass("invalid"),$(t).closest(".faux_input").addClass("invalid"),$(t).has("[data-behaviour~=chosen]"))return $(t).next(".chzn-container").addClass("invalid")}},a=function(t){return/^\s*$/.test($(t).val())?!1:!0},r=function(e){return _.isNaN(parseFloat($(e).val()))?($(e).hasClass("invalid")||t(e,"data-validates-numericality"),!1):!0},s=function(e){var i,n,s;return s=$(e).data("validates-format-with"),i=/^\/(.*)\/(\w*)$/.exec(s),n=new RegExp(i[1],i[2]),$(e).data("validates-format-allow-blank")&&""===$(e).val()?!0:n.test($(e).val())?!0:($(e).hasClass("invalid")||t(e,"data-validates-format"),!1)},t=function(t,e){return $(t).closest("span").after('<span class="error_message">'+$(t).attr(e)+"</span>")},e=function(t){return $(t).closest("span").next("span.error_message").remove()},$(document).on("submit","[data-behaviour~=validate]",function(){return n(this)&&$(this).trigger("valid"),!1}),$(document).on("submit","[data-behaviour~=validate-form]",function(){return n(this)}),Paydirt.Utilities.validateForm=n=function(t){return $(o).each(function(t,e){return $("["+e+"]:visible").each(function(t,e){return $(e).trigger("blur")}),$("["+e+"][data-behaviour~=chosen]:hidden").each(function(t,e){return $(e).trigger("blur")})}),$(t).find(":input.invalid:visible").filter(l).length||$(t).find(".chzn-container.invalid").length?($(t).find("input[type=submit]").css({position:"relative"}).animate({left:"-10px"},90).animate({left:"10px"},90).animate({left:"-10px"},90).animate({left:"10px"},90).animate({left:"-10px"},90).animate({left:"0px"},90),$(t).find(":input.invalid:visible").addClass("invalidOnSubmit"),!1):!0}})}.call(this),function(){window.fancyConfirm=function(t,e){var i,n,s,r,a,o,l;return a=!1,r=["Just a moment","Hang on","Woah Nelly","Easy, tiger","Hold up"],s=t.heading||r[parseInt(Math.random()*r.length)],i=null!=(o=t.cancel)?o:"No, don't do it!",n=null!=(l=t.confirm)?l:"Yes, continue",$.fancybox({modal:!0,padding:0,content:$("<div/>",{"class":"box confirmation"}).append($("<div/>",{"class":"modal-title"}).append($("<h2/>",{text:s})),$("<div/>",{"class":"content"}).append($("<p />",{html:t.message})),$("<div/>",{"class":"actions"}).append($("<div/>",{"class":"span-10"}).append($("<span />",{"class":"decline",id:"fancyConfirm_cancel",text:i})),$("<div/>",{"class":"span-14 last t-right"}).append($("<span />",{"class":"action",id:"fancyConfirm_ok",text:n})))),afterShow:function(){return $("#fancyConfirm_cancel").click(function(){return a=!1,$.fancybox.close()}),$("#fancyConfirm_ok").click(function(){return a=!0,$.fancybox.close()})},afterClose:function(){return null!=e?e.call(this,a):void 0}})}}.call(this),function(){window.fancyLoad=function(t){return $.fancybox({modal:!0,padding:10,content:"<p class='fancy-loading-message'><i class='icon-refresh icon-spin'></i>&nbsp;"+t.content+"</p>",helpers:{overlay:{css:{background:"rgba(226, 226, 226, 1)"}}},tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin fancybox-skin-bare"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>'}})}}.call(this),function(){var t;$(function(){return $(document).on("click",".no-click, .disabled",function(t){return t.stopPropagation(),t.preventDefault()}),$("textarea[data-behaviour~=autogrow]").livequery(function(){return $(this).autogrow()}),$(document).on("blur",".time_field",function(){var t;return t=Paydirt.Formatters.time($(this).val()),t?$(this).val(t):$(this).val("").trigger("change")}),$(document).on("click","a.open_tracker",function(t){var e,i,n;return t.preventDefault(),(null!=(e=Paydirt.tracker)?e.get("showing"):void 0)?(null!=(i=Paydirt.trackerView)&&i.hide(),setTimeout(function(){var t;return null!=(t=Paydirt.trackerView)?t.show():void 0},500)):null!=(n=Paydirt.trackerView)?n.show():void 0}),$(".tooltip,[data-behaviour~=tooltip]").livequery(function(){var t,e,i;return t=null!=(e=$(this).data("tooltip-fade"))?e:!1,$(this).tipsy({gravity:null!=(i=$(this).data("tooltip-gravity"))?i:"s",fade:t,html:!0}),$(this).click(function(t){return function(){return $(t).tipsy("hide")}}(this))}),$('input[type="checkbox"][data-behaviour~=checkbox_icon]').livequery(function(){var t;return $(this).hide(),t=$("<i/>"),t.$el=$(this),t.setState=function(t){return this.removeClass().addClass(t?"icon-check":"icon-check-empty"),this.$el.prop("checked",t)},t.toggleState=function(){return this.setState(!this.$el.prop("checked"))},t.on("click",function(){return t.toggleState()}),t.$el.on("change",function(){return t.setState($(this).prop("checked"))}),t.setState(t.$el.prop("checked")),$(this).after(t),t.on("click",function(e){return function(){return t.addClass($(e).prop("checked")?"icon-check":"icon-check-empty")}}(this))}),$(document).on("click","a[data-confirm]",function(t){var e,i,n,s;return t.preventDefault(),e=$(t.currentTarget),i=$.Deferred(),n={message:e.data("confirm"),cancel:e.data("cancel-text"),confirm:e.data("confirm-text")},s=modalConfirm(n,i),i.promise().then(function(){return e.trigger("confirm")}),i.promise()}),$(document).on("click","[data-behaviour~=install_chrome_extension]",function(t){var e;return null!=("undefined"!=typeof chrome&&null!==chrome&&null!=(e=chrome.webstore)?e.install:void 0)?(t.preventDefault(),chrome.webstore.install(void 0,void 0,function(e){return""===e||e.match(/verified/)?window.open($(t.target).attr("href")):void 0})):void 0}),window.modalConfirm=function(t,e){return fancyConfirm({message:t.message,cancel:t.cancel,confirm:t.confirm},function(t){return Paydirt.Utilities.resolveOrReject(e,t)})},$(document).on("click","a.dismiss",function(){return $(this).closest("div").fadeOut(300,function(){return $(this).remove()})}),$(window).scroll(function(){var t;return t=$(".follow").first(),t.length>0?t.css($(this).scrollTop()>t.parent().offset().top-20?{position:"fixed",width:t.width(),top:"20px"}:{position:"",width:"",top:""}):void 0}),Paydirt.Flash.show(),t(),$("select[data-behaviour~=chosen]").livequery(function(){return $(this).chosen({allow_single_deselect:$(this).data("allow-single-deselect"),search_contains:!0})}),$("#account_line_item_rounding_type").change(function(){return"0"===$(this).val()?$("#line_item_rounding_value_fields").hide():$("#line_item_rounding_value_fields").show()
}),$(".currency_input").livequery(function(){return $(this).prop("autocomplete","off")}),$(document).on("blur",".currency_input,[data-behaviour~=currency_input]",function(){return $(this).val(Paydirt.Formatters.currency($(this).val(),{sign:$(this).data("currency-sign")}))})}),t=function(){var t;return t=$(".datepicker:text, [data-behaviour~=datepicker]:text"),t.livequery(function(){var t,e,i;return 0===$(this).parents("tbody:hidden").length&&(e=this,$(e).hasClass("no-icon")||(t="form-9",$(this).wrap("<div class='faux_input "+t+"' />")),$(this).datepicker({showOn:$(e).hasClass("no-icon")?"focus":"button",buttonImage:$(e).hasClass("no-icon")?null:"/static_assets/calendar.png",buttonImageOnly:!0,buttonText:function(){return $(e).hasClass("no-icon")?"":"Open calendar"},dateFormat:null!=(i=$(e).data("dateformat"))?i:"M d, yy",showAnim:""})),$(this).change(function(){return $(this).val(Paydirt.Formatters.date($(this).datepicker("option","dateFormat"),$(this).datepicker("getDate"))),$("#"+$(this).prop("id")+"_alt").val(Paydirt.Formatters.date("dd/mm/yy",$(this).datepicker("getDate")))})}),$.each(t,function(t,e){return $(e).after($(e).clone().prop({type:"hidden","class":"",id:""+$(e).prop("id")+"_alt",value:Paydirt.Formatters.date("dd/mm/yy",$(e).datepicker("getDate"))}))}),$(document).on("focus blur",".faux_input input",function(){return setTimeout(function(t){return function(){return $(t).is(":focus")?$(t).closest(".faux_input").addClass("focus"):$(t).closest(".faux_input").removeClass("focus")}}(this),10)})},$.fn.shake=function(){return this.css({position:"relative"}).animate({left:"-10px"},90).animate({left:"10px"},90).animate({left:"-10px"},90).animate({left:"10px"},90).animate({left:"-10px"},90).animate({left:"0px"},90)}}.call(this),function(){$(function(){return $(".export-button").on("click",function(){return $(this).hasClass("no-click")?void 0:$(this).addClass("no-click").after('&nbsp;&nbsp;&nbsp;<span class="grey">You will receive this data by email shortly.</span>')}).on("ajax:success",function(t,e){return Paydirt.Flash.show(e.flash,"notice")}),$("#spf-check-email-address").click(function(t){var e;return e=$("#account_billing_email_address").val(),t.preventDefault(),$("#spf-check-results").html("<i class='icon-refresh icon-spin'></i>Checking "+e).show(),$.post("/settings/check_spf",{email_address:e}).done(function(t){return $("#spf-check-results").html(t)})})})}.call(this),function(){$(function(){return $(document).on("click","[data-action='toggle-user-permissions']",function(t){return t.preventDefault(),$(this).parents(".user").find(".user-permissions").slideToggle()}),$(document).on("change","table#import-users input:checkbox",function(t){var e,i,n,s;return e=$(t.currentTarget),n=e.closest("tr"),s=e.is(":checked"),n.toggleClass("selected",s),i=n.find("input:text"),i.data("skip-validation",!s),s?void 0:i.removeClass("invalid")}),$(document).on("click","[data-behaviour~=select-all-users]",function(t){return t.preventDefault(),$("#import-users").find("input:checkbox").prop({checked:!0}).trigger("change")}),$(document).on("click","[data-behaviour~=select-none-users]",function(t){return t.preventDefault(),$("#import-users").find("input:checkbox").prop({checked:!1}).trigger("change")})})}.call(this),function(){$(function(){var t;return t="#send-invoice-email",$(document).on("keyup",".liquid_substituted",function(){var e;return e=!1,$(".liquid_substituted").each(function(){return $(this).val().match(/\[.*missing.*\]/)?e=!0:void 0}),e?($(".liquid_warning").show(),$(t).prop({disabled:!0})):($(".liquid_warning").slideUp(),$(t).prop({disabled:!1}))}),$(document).on("ajax:success","#invoice_email_form",function(t,e){var i,n;return n=e.invoice_payment,Paydirt.Flash.notice(e.flash),$.fancybox.close(),n&&Paydirt.invoice.payments.get(n.id).set(n),i=Paydirt.document(e.document_email.document_id),i.emails.add(e.document_email),i.activities.reset(e.document_activities),e.sent_email_to_self?$.fancybox($("#sent_email_to_self"),{modal:!0}):i.set({sent:!0})}),$(document).on("ajax:error","#invoice_email_form",function(){return $("input[name*=skip_address_validation]").val("1")}),$(document).on("click",".add_address",function(t){return t.preventDefault(),$(".additional_address.cc").show(),$(this).hide()})})}.call(this),function(){Paydirt.Flash={show:function(t,e){return null!=t&&""!==t&&$("#flash").html('<div class="flash '+e+'">'+t+"</div>"),$("#flash .flash").each(function(t){return function(e,i){return $(i).hasClass("blocking_error")?t.blocking_error($(i).html()):($(i).addClass("showing"),clearTimeout(window.flashTimout),window.flashTimout=setTimeout(function(){return $("#flash .flash").removeClass("showing")},1e4))}}(this))},blocking_error:function(t){var e;return t="<i class='icon-warning-sign'></i>&nbsp; "+t,e=new Paydirt.Views.Notification({cssClass:"blocking-error",message:t,confirm:"Okay",onConfirm:function(){return $.fancybox.close()}}),$.fancybox({modal:!0,padding:0,content:e.render().$el})},success:function(t){return this.show(t,"success")},notice:function(t){return this.show(t,"notice")},deleted:function(t){return this.show(t,"deleted")},error:function(t){return this.show(t,"error")}}}.call(this),function(){Paydirt.Formatters={currency:function(t,e){var i,n,s,r,a,o,l;return null==e&&(e={}),_.defaults(e,{sign:(null!=(r=Paydirt.invoice)?r.currency().get("sign"):void 0)||(null!=(a=Paydirt.quote)?a.currency().get("sign"):void 0)||(null!=(o=Paydirt.client)?o.currency().get("sign"):void 0)||(null!=(l=Paydirt.account)?l.currency().get("sign"):void 0)||"$"}),s=e.sign,t=Paydirt.Formatters.currencyToFloat(t),n=e.precision,null==n&&(n=t.toFixed(0)!==""+t?2:0),i=I18n.toCurrency(t,{unit:s,precision:n}),null!=e.code&&(i=""+i+"<span class='currency_code'>"+e.code+"</span>"),i},numberWithPrecision:function(t,e){return null==e&&(e={}),t=parseFloat(t),t.toFixed(null!=e.precision?e.precision:t.toFixed(0)!==""+t?2:0)},time:function(t,e){var i,n,s,r,a,o,l,c,d,u,p,h,m,y;return null==e&&(e=null),""!==t&&(t=t.match(/^\s*(\S*)\s*$/)[1],(s=t.match(/^(\d{1,2})(:|\.)?(\d{2})?(a|am|p|pm)?$/i))?(n=s[1],a=null!=(m=s[3])?m:"0",r=null!=(y=s[4])?y.toLowerCase():void 0,"a"===r&&(r="am"),"p"===r&&(r="pm")):(s=t.match(/^now$/))?(o=moment(),n=o.format("H"),a=o.format("m"),r=o.format("a")):(s=t.match(/^(\+|\-)?((\d+)h)?\s*((\d+)m)?\s*$/i))&&(h=null!=e?moment(e,"h:mma"):moment(),l=s[1],"+"===l?l=1:"-"===l&&(l=-1),c=parseInt(s[3],10),d=parseInt(s[5],10),null==d||_.isNaN(d)||h.add("m",d*l),null==c||_.isNaN(c)||h.add("h",c*l),n=h.format("H"),a=h.format("m"),r=h.format("a")),n=parseInt(n,10),a=parseInt(a,10),n>=0&&23>=n&&a>=0&&59>=a)?(null==r&&(n>=13?r="pm":e?(e=moment(e,"h:mma"),u=parseInt(e.format("h"),10),p=e.format("a"),r=0>n-u&&12!==u||12===n?"am"===p?"pm":"am":p):r=8>n||n>=12?"pm":"am"),n>12&&(n-=12),1===(""+a).length&&(a="0"+a),i=""+n+":"+a+r):void 0},date:function(t,e){return $.datepicker.formatDate(t,e)},hhmmaToMoment:function(t){return new moment(""+t+" 01-01-2001","hh:mma DD-MM-YYYY")},pdFormatToMoment:function(t){return new moment(t,"hh:mma MMM D, YYYY")},hexToRgba:function(t,e){return null==e&&(e=150),t="#"===t.charAt(0)?t.substring(1,7):t,[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16),e]},secondsToHMS:function(t){var e,i,n,s;return n=Math.floor(t/3600),e=t%3600,s=Math.floor(e/60),i=e%60,t=Math.ceil(i),{hours:n,minutes:s,seconds:t}},secondsToHours:function(t){return(t/60/60).toFixed(2)},secondsToHM:function(t){var e;return e=Paydirt.Formatters.secondsToHMS(t),""+e.hours+":"+Paydirt.Formatters.paddedNumber(e.minutes,{length:2})},hoursToSeconds:function(t){return parseInt(60*t*60,10)},hoursMinutesToSeconds:function(t){var e,i,n;return(i=t.match(/^(\d*):(\d\d)$/))?(e=parseInt(i[1],10)||0,n=parseInt(i[2],10),n>=60&&(e+=1,n=0),t=3600*e+60*n):t=(i=t.match(/^(\d+)\.?(\d+)?$/))?Math.round(3600*parseFloat(t)):0,t},currencyToFloat:function(t){var e,i,n,s;return t?(e=Paydirt.currencies.map(function(t){return Paydirt.Utilities.escapeRegExp(t.get("sign"))}),i=new RegExp("^("+e.join("|")+")"),"string"==typeof t&&t.match(i)&&(t=t.replace(i,"")),"string"==typeof t&&(n=new RegExp(Paydirt.Utilities.escapeRegExp(I18n.t("number.currency.format.delimiter")),"g"),s=new RegExp(Paydirt.Utilities.escapeRegExp(I18n.t("number.currency.format.separator")),"g"),t=t.replace(n,""),t=t.replace(s,".")),t=parseFloat(t),_.isNaN(t)&&(t=0),t):0},numberToPercentage:function(t){return t=parseFloat(t),_.isNaN(t)&&(t=0),""+t+"%"},percentageToNumber:function(t){var e;return e=parseFloat(t),_.isNaN(e)&&(e=0),e},paddedNumber:function(t,e){var i;if(null==e&&(e={}),t=""+t,i=e.length,!i)return t;for(;t.length<i;)t="0"+t;return t},preserveWhitespace:function(t){return t.replace(/(\r\n|\n)/g,"&#x000A;")},secondsToWordedDuration:function(t){var e,i;return i=Paydirt.Formatters.secondsToHMS(t),i.hours>0?(e=""+i.hours+" hour"+Paydirt.Formatters.pl(i.hours),i.minutes>0?e=""+e+" and "+i.minutes+" minute"+Paydirt.Formatters.pl(i.minutes):i.seconds>0&&(e=""+e+" and "+i.seconds+" second"+Paydirt.Formatters.pl(i.seconds))):i.minutes>0?(e=""+i.minutes+" minute"+Paydirt.Formatters.pl(i.minutes),i.seconds>0&&(e=""+e+" and "+i.seconds+" second"+Paydirt.Formatters.pl(i.seconds))):e=i.seconds>0?""+i.seconds+" second"+Paydirt.Formatters.pl(i.seconds):"",e},pl:function(t){return t>1?"s":""}}}.call(this),function(){Paydirt.Cookies={read:function(t){var e,i,n,s;for(t=""+t+"=",i=document.cookie.split(";"),n=0,s=i.length;s>n;n++){for(e=i[n];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(t))return e.substring(t.length,e.length)}return null},write:function(t,e,i){var n,s;return s="",i&&(n=new Date,n.setTime(n.getTime()+864e5*i),s="expires="+n.toGMTString()+";"),document.cookie=""+t+"="+e+"; "+s+" path=/;"},destroy:function(t){return this.write(t,"",-1)}}}.call(this),function(){Paydirt.Utilities={setPageTitle:function(t){return $("title").text("Paydirt: "+t)},timeStamp:function(){return Math.round((new Date).getTime()/1e3)},getParameterByName:function(t,e){var i;return null==e&&(e=window.location.search),i=RegExp("[?&]"+t+"=([^&]*)").exec(e),i&&decodeURIComponent(i[1].replace(/\+/g," "))},escapeRegExp:function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},spriteTag:function(){return function(t,e){var i;return null==e&&(e={}),i=""+(e["class"]||"")+" "+t,"<img src='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7' class='"+i+"' alt='' />"}}(this),resolveOrReject:function(t,e){return e?t.resolve():t.reject(),t},"delete":function(t,e,i){return null==e&&(e={}),null==i&&(i="_self"),Paydirt.Utilities.post(t,e,i,"delete")},post:function(t,e,i,n){var s,r;return null==e&&(e={}),null==i&&(i="_self"),null==n&&(n="post"),s=$.param(e),r=$("<form method='POST' action='"+t+"?"+s+"' target='"+i+"'></form>"),r.append($("<input name='"+this.csrfParam()+"' value='"+this.csrfToken()+"' type='hidden' />")),r.append($('<input name="_method" value="'+n+'" type="hidden" />')),$("body").append(r),r.submit()},getJobIdFromExternalId:function(t){var e,i,n,s,r,a,o;return null==t&&(t=window.location.search),i=null,(s=Paydirt.Utilities.getParameterByName("trello_card_id",t))?i=null!=(r=Paydirt.jobs.findWhere({trello_card_id:s}))?r.id:void 0:(e=Paydirt.Utilities.getParameterByName("basecamp_todo_id",t))?i=null!=(a=Paydirt.jobs.findWhere({basecamp_todo_id:+e}))?a.id:void 0:(n=Paydirt.Utilities.getParameterByName("redbooth_task_id",t))&&(i=null!=(o=Paydirt.jobs.findWhere({redbooth_task_id:+n}))?o.id:void 0),i},csrfParam:function(){return $("meta[name=csrf-param]").prop("content")},csrfToken:function(){return $("meta[name=csrf-token]").prop("content")}},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}}.call(this),function(){$(function(){return $("#feedback").focus(function(){return $(this).parent().addClass("focussed"),$("#feedback_form").on("ajax:before",function(){return $(this).find(".submit input").val("Sending...").prop("disabled",!0)}).on("ajax:success",function(){var t;return t=$("<p />").addClass("result").text("Thanks for your feedback!"),$(this).html(t)}).on("ajax:error",function(){var t;return $(this).find(".result").remove(),t=$("<p />").addClass("result").text("Please try again"),$(this).prepend(t),$(this).find(".submit input").val("Try again").prop("disabled",!1)})})})}.call(this),function(){Paydirt.Eventy={record:function(t,e){var i,n,s;return n=(null!=(s=Paydirt.account)?s.get("unique_id"):void 0)||Paydirt.Cookies.read("unique_id"),i={event_name:t,identifier:n,properties:e},$.post("/eventy/record",i)}}}.call(this),function(){$(document).on("click",".close-modal,[data-behaviour~=close_modal]",function(t){return $.fancybox.close(),t.preventDefault()})}.call(this),function(){$("[data-behaviour~=determine_timezone]").livequery(function(){return $(this).val(determine_timezone().timezone.olson_tz)})}.call(this),function(){$("[data-behaviour~=inline-modal]").fancybox(),$(document).on("click","a.modal,[data-behaviour~=modal]",function(t){return t.preventDefault(),$.fancybox($(t.currentTarget),{openSpeed:600,closeSpeed:200,margin:0,padding:0,modal:!0,type:"ajax"}),!0}),$(document).on("click","[data-behaviour~=youtube-modal]",function(t){return t.preventDefault(),$.fancybox($(t.currentTarget),{type:"iframe",margin:0,padding:0,width:"853px",height:"480px"}),!0}),$("[data-behaviour~=modal_image]").fancybox({padding:0})}.call(this),function(){$('[data-behaviour="toggle-annual-plans"] input[name="annual"]').on("change",function(){return $(".plan-type[data-period]").removeClass("selected"),"true"===$(this).val()?($(".annual-plans").show(),$(".monthly-plans").hide(),$('.plan-type[data-period="annual"]').addClass("selected")):($(".annual-plans").hide(),$(".monthly-plans").show(),$('.plan-type[data-period="monthly"]').addClass("selected"))}),$("[data-behaviour~=enterprise-plan-toggle]").on("click",function(t){return t.preventDefault(),"enterprise"===$(this).data("type")?($(".enterprise-plans").show(),$(".regular-plans").hide()):($(".regular-plans").show(),$(".enterprise-plans").hide())})}.call(this),function(){$(document).on("ajax:success",'[data-section] [data-remote="true"]',function(t,e){return $(this).closest("[data-section]").replaceWith($(e.html))})}.call(this),function(){var t,e,i,n,s,r,a,o,l;l=function(t){return"<div class='avatar'><img src='"+Paydirt.users.get(t.id).get("avatar_url")+"' /></div> "+t.text},t=function(){var t;return t=Paydirt.clients.map(function(t){var e,i;return e={id:"client-"+t.id,text:t.get("business_name"),match:t.get("business_name")},i=t.projects.map(function(e){var i,n;return n={id:"project-"+e.id,text:e.get("name"),match:""+t.get("business_name")+" "+e.get("name")},i=e.jobs.map(function(i){return{id:"job-"+i.id,text:i.get("name"),match:""+t.get("business_name")+" "+e.get("name")+" "+i.get("name")}}),i.unshift(n),i}),i=_.flatten(i),i.unshift(e),i}),t=_.flatten(t)},n=function(e){var i,n,s,r,a,o;return i=t(),o=e.term.split(" "),n=i,o.forEach(function(t){var e;return e=new RegExp(Paydirt.Utilities.escapeRegExp(t),"i"),n=_.filter(n,function(t){return e.test(t.match)})}),r=30,s=e.page-1,a=n.slice(r*s,r*s+r),e.callback(n.length>r*(s+1)?{results:a,more:!0}:{results:a})},e=function(t){var e,i,n,s,r,a,o;switch(r=t.id.split("-"),e=r[0],n=r[1],e){case"client":i=Paydirt.clients.get(n);break;case"project":o=Paydirt.projects.get(n),i=o.client();break;case"job":s=Paydirt.jobs.get(n),o=s.project(),i=o.client()}return a="<span data-type='"+e+"' data-id='"+n+"'>"+i.badge()+" "+(null!=o?"":i.get("business_name"))+"</span>",null!=o&&(a=""+a+" <i class='icon-caret-right'></i> "+o.get("name")),null!=s&&(a=""+a+" <i class='icon-caret-right'></i> "+s.get("name")),a},i=function(t,e){var i,n,s,r,a,o,l,c;switch(c=t.val(),o=c.split("-"),i=o[0],r=o[1],i){case"client":n=Paydirt.clients.get(r),s={id:"client-"+n.id,text:n.get("business_name"),match:n.get("business_name")};break;case"project":l=Paydirt.projects.get(r),n=l.client(),s={id:"project-"+l.id,text:l.get("name"),match:""+n.get("business_name")+" "+l.get("name")};break;case"job":a=Paydirt.jobs.get(r),l=a.project(),n=l.client(),s={id:"job-"+a.id,text:a.get("name"),match:""+n.get("business_name")+" "+l.get("name")+" "+a.get("name")}}return e(s)},s=function(){var t;return t=Paydirt.clients.map(function(t){return t.projects.map(function(e){return e.jobs.map(function(i){var n,s;return!e.get("completed")&&!i.get("completed")&&Paydirt.user.canLogTimeFor(i)||(null!=(n=Paydirt.block)&&null!=(s=n.job())?s.id:void 0)===i.id?{id:i.id,text:""+t.get("business_name")+" - "+e.get("name")+" - "+i.get("name"),match:""+t.get("business_name")+" "+e.get("name")+" "+i.get("name")}:null})})}),t=_.compact(_.flatten(t))},o=function(t){var e,i,n,r,a,o;return e=s(),o=t.term.split(" "),i=e,o.forEach(function(t){var e;return e=new RegExp(Paydirt.Utilities.escapeRegExp(t),"i"),i=_.filter(i,function(t){return e.test(t.match)})}),r=30,n=t.page-1,a=i.slice(r*n,r*n+r),t.callback(i.length>r*(n+1)?{results:a,more:!0}:{results:a})},r=function(t){var e,i,n,s;return i=Paydirt.jobs.get(t.id),s=i.project(),e=s.client(),n="<span>"+e.badge()+"</span>",n=""+n+" <i class='icon-caret-right'></i> "+s.get("name"),n=""+n+" <i class='icon-caret-right'></i> "+i.get("name")},a=function(t,e){var i,n,s,r,a;return a=t.val(),s=Paydirt.jobs.get(a),r=s.project(),i=r.client(),n={id:s.id,text:""+i.get("business_name")+" - "+r.get("name")+" - "+s.get("name"),match:""+i.get("business_name")+" "+r.get("name")+" "+s.get("name")},e(n)},$("[data-behaviour~=select2]").livequery(function(){var t,s,c,d,u,p,h;switch(t=$(this),h=t.data("type")){case"user":s=Paydirt.users.map(function(t){return{id:t.id,text:t.get("name")}}),c=l;break;case"user-assignment":s=Paydirt.users.current().map(function(t){return{id:t.id,text:t.get("name")}}),c=l,u=!0;break;case"job":c=r,p=o,d=a;break;case"clientProjectJob":c=e,p=n,d=i}return t.select2({allowClear:t.data("allow-clear"),data:s,formatSelect:c,formatResult:c,query:p,initSelection:d,loadMorePadding:200,multiple:u})})}.call(this),function(){$(document).on("click",'[data-behaviour~="select_contents"]',function(){return $(this).select()})}.call(this),function(){var t;t=RegExp(" *[^ @;]+@([^@ ;.]+.)+([^@ ;.,])+ *","i"),$(document).on("change","[data-behaviour~=verify_email]",function(){var e;return e=$(this),e.siblings('span.error_message[data-valid-type="could-not-verify"]').remove(),t.test(e.val())?(e.trigger("valid_format"),$.get("/users/verify_email",{email:e.val()}).done(function(){return function(t){return t.success?e.siblings('span.error_message[data-valid-type="could-not-verify"]').remove():e.after("<span class='error_message warning' data-valid-type='could-not-verify'>We think this address might be invalid. You can still use it, but please double-check.</span>")}}(this))):void 0})}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["blocks/client_summary"]=function(t){return function(){var t,e;return t=window.HAML.cleanValue,e=[],e.push(""+t(this.badge())),e.push("<div class='duration'></div>\n<div class='value'></div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["blocks/duplicate"]=function(t){return function(){var t;return t=[],t.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>Duplicate a log entry</h1>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <form class='backbone block_form'>\n      <div class='span-18'>\n        <div class='box settings top'>\n          <div class='title'>\n            <h2>Time Worked</h2>\n          </div>\n          <div class='block_form_container'></div>\n        </div>\n      </div>\n      <div class='last span-6'>\n        <input class='massive' type='submit' value='Add Log Entry'>\n        <span class='cancel'>\n          or\n          <a class='cancel' href='#'>Cancel</a>\n        </span>\n        <hr class='space'>\n        <div class='info well'>\n          <p>This log entry has been duplicated from an existing log entry, but has not yet been saved.</p>\n        </div>\n      </div>\n    </form>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["blocks/edit"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>Edit Time</h1>\n    </div>\n  </div>"),this.isNew()||i.push("  <div class='page-links'>\n    <div class='container'>\n      <a class='action' href='"+e(t(Paydirt.Routes.duplicate_block(this.id)))+"' data-behaviour='backbone_link'>\n        <i class='icon-copy'></i>\n        Duplicate this log entry\n      </a>\n      <a class='action' id='delete_log' href='#' data-confirm='Are you sure you want to permanently delete this log entry?' data-cancel-text=\"No, don't delete it\" data-confirm-text='Yes, delete this log'>\n        <i class='icon-remove-sign'></i>\n        Delete\n      </a>\n    </div>\n  </div>"),i.push("</div>\n<div id='middle'>\n  <div class='container'>\n    <form class='backbone block_form'>\n      <div class='span-18'>\n        <div class='box settings top'>\n          <div class='title'>\n            <h2>Time Worked</h2>\n          </div>\n          <div class='block_form_container'></div>\n        </div>\n      </div>\n      <div class='last span-6'>\n        <input class='massive' type='submit' value='Save changes'>\n        <span class='cancel'>\n          or\n          <a class='cancel' href='#'>Cancel</a>\n        </span>"),this.get("billed")&&(i.push("        <hr class='space'>\n        <hr class='double'>"),null!=this.invoice()?i.push("        Billed in\n        <a href='"+e(t(Paydirt.Routes.invoice(this.invoice().id)))+"' data-behaviour='backbone_link'>"+t(this.invoice().formattedNumber())+"</a>"):this.get("external_billing_reference")&&(i.push("        "+t("Billed with the reference '"+this.get("external_billing_reference")+"'")),i.push("        <div class='right'>\n          <a class='delete remove_external_billing_reference' href='#' data-confirm='Are you sure you want to remove the external billing reference from this log entry? This will mark the log entry as unbilled again.'>\n            &times;\n          </a>\n        </div>"))),i.push("      </div>\n    </form>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["blocks/form"]=function(t){return function(){var t,e,i,n,s;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='option_label'>\n  <label>Time</label>\n</div>\n<div class='option_field'>\n  <div class='inline-inputs span-24'>\n    <div class='left'>\n      <input class='datepicker inline' id='start_date' type='text' value='"+e(t(this.block.startDate()))+"' data-validates-presence>\n    </div>\n    <div class='duration_only_mode left'>\n      <span class='grey'>duration</span>\n      <input class='inline' id='duration' type='text' value='"+e(t(this.block.isNew()&&!this.block.duplicated?"0:00":Paydirt.Formatters.secondsToHM(this.block.get("duration"))))+"' autocomplete='off' data-validates-presence>\n      <span class='calculated_duration grey'></span>\n    </div>\n    <div class='left start_and_end_mode'>\n      <input class='form-6 inline' id='start_time' type='text' value='"+e(t(this.block.isNew()&&!this.block.duplicated||this.block.get("duration_only")?"":this.block.startTime()))+"' autocomplete='off' placeholder='start time'>\n      <span class='grey'>to</span>"),this.block.automateEndDate||i.push("      <input class='datepicker inline' id='end_date' type='text' value='"+e(t(this.block.endDate()))+"' data-validates-presence>"),i.push("      <input class='form-6 inline' id='end_time' type='text' value='"+e(t(this.block.isNew()&&!this.block.duplicated||this.block.get("duration_only")?"":this.block.endTime()))+"' autocomplete='off' placeholder='end time'>\n      <span class='calculated_duration grey'></span>\n    </div>\n    <div class='right t-right'>\n      or\n      <a class='toggle_duration_type' href='#' tabindex='-1'>"+t(this.block.alternativeDurationTypeDescription())+"</a>\n    </div>\n  </div>"),this.block.get("paused_duration")>0&&i.push("  <div class='span-24' id='paused_duration_container'>\n    <a class='delete tooltip' id='remove_paused_duration' href='#' title='remove' data-tooltip-gravity='e'>&times;</a>\n    <span class='grey'>"+t(this.block.wordedPausedDuration())+"</span>\n  </div>"),i.push("</div>\n<hr>\n<div class='option_label'>\n  <label for='job_id'>Task</label>\n</div>\n<div class='option_field'>\n  <input class='fullwidth' id='job_id' type='hidden' value='"+e(t(Paydirt.block.get("job_id")))+"' data-behaviour='select2' data-placeholder='Select a Task' data-type='job'>\n</div>\n<hr>\n<div class='option_label'>\n  <label for='description'>Description</label>\n</div>\n<div class='option_field'>\n  <textarea id='description' style='height: 150px;'>"+t(this.block.get("description"))+"</textarea>\n  <span class='field-desc'>\n    <a href='http://en.wikipedia.org/wiki/Markdown#Syntax_examples' target='_blank'>Markdown </a>\n    is allowed.\n  </span>\n</div>\n<hr>\n<div class='summary_line'>\n  <div class='option_label'>\n    <div class='avatar small-round'>\n      <img src='"+e(t(this.block.user().get("medium_avatar_url")))+"' title='"+e(t(this.block.user().get("name")))+"'>\n    </div>\n  </div>\n  <div class='option_field'>\n    <div class='right'>\n      <a class='show_optional_fields' href='#'>edit</a>\n    </div>\n    <div class='left'>\n      Performed by "+this.block.user().get("name")+".\n      This time is\n      <span class='billable_description'>"+this.block.billableDescription()+".</span>\n    </div>\n  </div>\n  <hr class='space'>\n</div>\n<div class='optional_fields'>"),Paydirt.user.canViewAllTimeLogged()&&(i.push("  <div class='option_label'>\n    <label for='user_id'>Team member</label>\n  </div>\n  <div class='option_field'>\n    <select class='form-18' id='user_id' data-behaviour='chosen' disabled='"+e(t(!Paydirt.account.features("extra_users")))+"'>"),Paydirt.users.current().each(function(n){return function(s){return i.push("      <option value='"+e(t(s.id))+"' selected='"+e(t(n.block.get("user_id")===s.id))+"'>"+t(s.get("name"))+"</option>"),""}}(this)),i.push("    </select>\n    <span class='field-desc'>"),i.push(Paydirt.account.get("features").extra_users?"      <a href='/users'>Add people to your team</a>\n      in your account settings.":"      <a href='/settings/account/plan'>Upgrade your account</a>\n      to add more users."),i.push("    </span>\n  </div>\n  <hr>")),i.push("  <div class='option_label'>\n    <label>This time is</label>\n  </div>\n  <div class='option_field'>\n    <div class='billability_fields'>\n      <div class='left'>\n        <select class='billability_field form-18' id='block_billable' data-behaviour='chosen'>\n          <option selected='"+e(t(this.block.get("billable")))+"' value='1'>Billable</option>\n          <option selected='"+e(t(!this.block.get("billable")))+"' value='0'>Not billable</option>\n        </select>\n      </div>"),Paydirt.user.canViewFinancialInformation()&&i.push("      <div class='hourly_rate_field left'>\n        &nbsp;\n        <span class='grey'>at</span>\n        &nbsp;\n        <input class='form-5 t-center' id='hourly_rate' type='text' name='block_formatted_hourly_rate' value='"+e(t(Paydirt.Formatters.currency(this.block.get("hourly_rate"),{sign:null!=(n=this.block.job())?n.client().currency().get("sign"):void 0})))+"' data-behaviour='currency_input' data-currency-sign='"+e(t(null!=(s=this.block.job())?s.client().currency().get("sign"):void 0))+"' data-validates-presence>\n        &nbsp;\n        <span class='grey'>per hour</span>\n      </div>"),i.push("    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["blocks/index"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>Time</h1>\n    </div>\n  </div>\n  <div class='page-links'>\n    <div class='container'>\n      <a class='action' href='"+e(t(Paydirt.Routes.new_block()))+"' data-behaviour='backbone_link'>\n        Log Time Worked\n      </a>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <div class='span-24' id='blocks'>\n      <div class='box clearfix filter'>\n        <div class='span-24' id='filters_row'>\n          <div class='item'>\n            <select class='form-7' id='date_range_type' data-behaviour='chosen'>\n              <option value='7-days'>7 Days</option>\n              <option value='30-days'>30 Days</option>\n              <option value='custom'>Custom</option>\n              <option value='all-time'>All Time</option>\n            </select>\n          </div>\n          <div id='date_fields'>\n            <div class='item label'>from</div>\n            <div class='item'>\n              <input class='datepicker' id='start_date' type='text'>\n            </div>\n            <div class='item label'>to</div>\n            <div class='item'>\n              <input class='datepicker' id='end_date' type='text'>\n            </div>\n          </div>\n          <div class='item label'>for</div>\n          <div class='item'>\n            <input class='form-28' id='autocompleter' type='hidden' data-behaviour='select2' data-placeholder='Any client, project or task' data-allow-clear='true' data-type='clientProjectJob'>\n          </div>"),Paydirt.user.canViewAllTimeLogged()&&i.push("          <div class='item label'>By</div>\n          <div class='item'>\n            <input class='form-12' id='user_name' type='hidden' data-behaviour='select2' data-placeholder='All Users' data-allow-clear='true' data-type='user'>\n          </div>"),i.push("          <div class='item label right'>"),Paydirt.user.canViewFinancialInformation()&&i.push("            <a id='toggle_advanced_search' href='#'>\n              <i class='icon-circle-arrow-down tooltip' title='Advanced Search'></i>\n            </a>"),i.push("          </div>\n        </div>"),Paydirt.user.canViewFinancialInformation()&&(i.push("        <div class='hide span-24' id='advanced_filters_row'>\n          <hr class='nomargin'>\n          <div class='item label'>Billable status:</div>\n          <div class='item'>\n            <select class='form-8' id='billable_type' data-behaviour='chosen'>\n              <option value=''>Both</option>\n              <option value='true'>Billable</option>\n              <option value='false'>Not billable</option>\n            </select>\n          </div>\n          <div class='item label'>Billed status:</div>\n          <div class='item'>\n            <select class='form-8' id='billed_type' data-behaviour='chosen'>\n              <option value=''>Both</option>\n              <option value='true'>Billed</option>\n              <option value='false'>Not billed</option>\n            </select>\n          </div>\n          <div class='item label'>Invoice number:</div>\n          <div class='item'>\n            <select class='form-8' id='invoice_number' data-behaviour='chosen' data-placeholder='All Invoices' data-allow-single-deselect='true'>\n              <option></option>"),Paydirt.invoices.each(function(n){return i.push("              <option value='"+e(t(n.id))+"'>"+t(n.formattedNumber())+"</option>"),""}),i.push("            </select>\n          </div>\n        </div>")),i.push("      </div>\n      <hr class='clear space'>\n      <div class='span-24' id='graph_row'>\n        <div class='change_period span-1'>\n          <a id='previous' href='#'>\n            <span>\n              &nbsp;\n            </span>\n          </a>\n        </div>\n        <div class='span-22' id='graph'></div>\n        <div class='change_period last span-1'>\n          <a id='next' href='#'>\n            <span>\n              &nbsp;\n            </span>\n          </a>\n        </div>\n      </div>\n      <hr class='clear space'>\n      <div id='blocks_summary'></div>\n      <hr class='clear space'>\n      <div id='block_list'></div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")
}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["blocks/list_item"]=function(t){return function(){var t,e,i,n;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='block'>\n  <div class='block-items'>\n    <div class='block-user item'>\n      <div class='avatar small-round' title='"+e(t(this.user.get("name")))+"' data-behaviour='tooltip'>\n        <img src='"+e(t(this.user.get("medium_avatar_url")))+"'>\n      </div>"),i.push("      "+t(this.user.get("name"))),i.push("    </div>\n    <div class='for item'>\n      <a href='"+e(t(Paydirt.Routes.client(this.client.id)))+"' data-behaviour='backbone_link'>"),i.push("        "+t(this.client.badge())),i.push("      </a>"),null!=this.block.project()&&(i.push("      "+t(this.block.project().get("name"))),i.push("      &raquo;")),i.push("      "+t(this.block.job().get("name"))),i.push("      <br>\n      <div class='block-description'>"),i.push((null!=(n=this.description)?n.length:void 0)?"        <p>"+t(marked(this.description,{sanitize:!0}).replace(/(<([^>]+)>)/gi,""))+"</p>":"        <span class='grey'>No description</span>"),i.push("      </div>\n    </div>\n    <div class='item time'>\n      <i class='icon icon-time'></i>"),this.block.get("duration_only")?i.push("      <span class='grey'>Not specified</span>"):(i.push("      "+t(""+this.block.startTime()+" - "+this.block.endTime())),this.block.startDate()!==this.block.endDate()&&i.push("      "+t("("+this.block.endedAt().format("MMM D")+")"))),i.push("      <div class='duration'>"),i.push("        "+t(Paydirt.Formatters.secondsToHM(this.block.get("duration")))),i.push("      </div>"),Paydirt.user.get("permissions").view_financial_information&&(i.push("      <div class='block-value'>\n        <i class='icon icon-money'></i>"),i.push(this.block.get("billable")?"        "+t(Paydirt.Formatters.currency(this.block.get("value"),{sign:this.block.client().currency().get("sign")})):"        <span class='grey'>Not billable</span>"),i.push("      </div>")),i.push("    </div>\n  </div>\n  <div class='full-detail-container'>\n    <div class='full-detail'>\n      <div class='full-description'>"),i.push(this.description?"        "+t(marked(this.description,{sanitize:!0})):"        <span class='grey'>No description</span>"),i.push("      </div>\n      <div class='full-details'>"),Paydirt.user.get("permissions").view_financial_information&&(i.push("        This time is"),i.push("        "+t(this.block.billableDescription()))),i.push("      </div>\n    </div>\n  </div>\n  <div class='controls'>\n    <a class='edit_block' href='"+e(t(Paydirt.Routes.edit_block(this.block.id)))+"' data-behaviour='backbone_link'>"),i.push("      "+t(Paydirt.Utilities.spriteTag("icons-edit-dark",{"class":"inactive"}))),i.push("      "+t(Paydirt.Utilities.spriteTag("icons-edit",{"class":"active"}))),i.push("    </a>\n    <a class='delete' href='#' data-block-id='"+e(t(this.block.id))+"' data-confirm='Are you sure you want to delete this log entry?' data-cancel-text=\"No, don't delete it\" data-confirm-text='Yes, delete it'>\n      &times;\n    </a>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["blocks/list_links"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<hr class='space'>\n<div class='span-24'>\n  <div class='right'>\n    <a class='"+["button_link",""+e(t(this["class"]))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' id='"+e(t(this.id))+"' href='#' title='"+e(t(this.title))+"' data-behaviour='"+e(t(this.behaviour))+"'>\n      Mark these logs as billed\n    </a>\n    &nbsp;&nbsp;&nbsp;\n    <a class='button_link' id='export_csv' href='#'>\n      Download list as CSV\n    </a>\n    &nbsp;&nbsp;&nbsp;\n    <a class='button_link' id='print_blocks' href='#'>\n      Print list\n    </a>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["blocks/new"]=function(t){return function(){var t;return t=[],t.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>Log Time</h1>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <form class='backbone block_form'>\n      <div class='span-18'>\n        <div class='box settings top'>\n          <div class='title'>\n            <h2>Time Worked</h2>\n          </div>\n          <div class='block_form_container'></div>\n        </div>\n      </div>\n      <div class='last span-6'>\n        <input class='massive' type='submit' value='Add Log Entry'>\n        <span class='cancel'>\n          or\n          <a class='cancel' href='#'>Cancel</a>\n        </span>\n      </div>\n    </form>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["blocks/summary"]=function(t){return function(){var t;return t=[],t.push("<div class='span-18'>\n  <div class='box clearfix' id='summary'>\n    <div class='empty hide'>No time logged</div>\n  </div>\n</div>\n<div class='last span-6'>\n  <div class='box clearfix' id='totals'>\n    <div class='span-24'>\n      <div class='span-8'>\n        <h2 class='label'>Time</h2>\n      </div>\n      <div class='last span-14'>\n        <div class='total' id='total-duration'>\n          <div class='amount t-right'></div>\n        </div>\n      </div>\n    </div>"),Paydirt.user.canViewFinancialInformation()&&t.push("    <hr class='space'>\n    <div class='span-24'>\n      <div class='span-8'>\n        <h2 class='label'>Value</h2>\n      </div>\n      <div class='last span-14'>\n        <div class='total' id='total-value'></div>\n      </div>\n    </div>"),t.push("  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/edit"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<form class='backbone client_form' data-behaviour='validate'>\n  <div class='span-18'>\n    <div class='form'></div>\n  </div>\n  <div class='last span-6'>\n    <div class='follow'>\n      <input class='massive' type='submit' value='Save changes'>\n      <span class='cancel'>\n        or\n        <a class='cancel' href='"+e(t(Paydirt.Routes.client(this.id)))+"' data-behaviour='backbone_link'>Cancel</a>\n      </span>\n      <hr class='clear space'>"),i.push(this.get("active")?"      <a class='action archive right' href='#' data-confirm='Are you sure you want to move this client to your list of archived clients, and mark all of their tasks as finished?' data-cancel-text=\"No, don't archive client\" data-confirm-text='Yes, archive this client'>\n        Archive Client\n      </a>":"      <a class='action archive right' href='#' data-confirm='Are you sure you want to move this client to your list of current clients?' data-cancel-text=\"No, don't move client\" data-confirm-text='Yes, move client'>\n        Un-archive Client\n      </a>"),i.push("      <hr class='clear space'>\n      <a class='delete_client destroy right' href='#' data-confirm='Deleting this client will also remove all tasks, expenses, quotes, invoices and time logs associated with it. Are you sure you want to delete it?' data-cancel-text=\"No, don't delete it\" data-confirm-text='Yes, delete this client'>\n        Delete Client\n      </a>\n    </div>\n  </div>\n</form>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/form"]=function(t){return function(){var t,e,i,n,s,r,a,o,l,c,d,u;e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='box settings top'>\n  <div class='title'>\n    <h2>Client Details</h2>\n  </div>\n  <div class='option_label'>\n    <label for='business_name'>Business name</label>\n  </div>\n  <div class='option_field'>\n    <input id='business_name' type='text' value='"+e(t(this.get("business_name")))+"' autofocus='"+e(t(this.isNew()))+"' data-validates-presence>\n  </div>\n  <hr>\n  <div class='option_label'>\n    <label for='billing_contact_name'>Contact name</label>\n  </div>\n  <div class='option_field'>\n    <input id='billing_contact_name' type='text' value='"+e(t(this.get("billing_contact_name")))+"'>\n    <span class='field-desc'>Who do you address your invoices to?</span>\n  </div>\n  <hr>\n  <div class='option_label'>\n    <label for='billing_email_address'>Email address</label>\n  </div>\n  <div class='option_field'>\n    <input id='billing_email_address' type='text' value='"+e(t(this.get("billing_email_address")))+"'>\n    <span class='field-desc'>What email address do you send your invoices to?</span>\n  </div>\n  <hr>\n  <div class='option_label'>\n    <label for='billing_address'>Business Address</label>\n  </div>\n  <div class='option_field'>\n    <textarea id='billing_address' rows='"+e(t(6))+"' style='width: 250px'>"+t(this.get("billing_address"))+"</textarea>\n    <span class='field-desc'>This address is displayed on invoices.</span>\n  </div>\n</div>\n<hr class='space'>\n<div class='box settings top'>\n  <div class='title'>\n    <h2>Billing Preferences</h2>\n  </div>\n  <div class='option_label'>\n    <label for='currency_id'>Billing currency</label>\n  </div>\n  <div class='option_field'>\n    <select class='form-20' id='currency_id' data-behaviour='chosen' disabled='"+e(t(!Paydirt.account.features("multiple_currencies")))+"'>"),Paydirt.currencies.each(function(n){return function(s){return i.push("      <option value='"+e(t(s.id))+"' selected='"+e(t(s.id===n.get("currency_id")))+"' data-search-text='"+e(t(s.get("code")))+"'>"+t(""+s.get("name")+" ("+s.get("code")+", "+s.get("sign")+")")+"</option>"),""}}(this)),i.push("    </select>\n    <span class='field-desc'>Changing this currency will also change the currency for all existing invoices, tasks, expenses, and time logs for this client.</span>"),Paydirt.account.features("multiple_currencies")||i.push("    <p class='grey input_aligned'>\n      <a href='/settings/account/plan'>Upgrade your account</a>\n      to enable multiple currencies.\n    </p>"),i.push("  </div>\n  <hr>\n  <div class='option_label'>\n    <label for='hourly_rate'>Hourly rate</label>\n  </div>\n  <div class='option_field'>\n    <input class='form-5' id='hourly_rate' type='text' value='"+e(t(Paydirt.Formatters.currency(this.get("hourly_rate"),{sign:this.currency().get("sign")})))+"' data-behaviour='currency_input' data-currency-sign='"+e(t(this.currency().get("sign")))+"'>\n    <span class='field-desc'>What's your regular hourly rate for this client? You can change this on individual tasks if you need to.</span>\n  </div>\n  <hr>\n  <div class='option_label'>\n    <label for='locale'>Invoice language</label>\n  </div>\n  <div class='option_field'>\n    <select class='form-20' id='locale' data-behaviour='chosen' disabled='"+e(t(!Paydirt.account.features("multiple_languages")))+"'>"),d=Paydirt.locales;for(a in d)r=d[a],i.push("      <option value='"+e(t(a))+"' selected='"+e(t(a===this.get("locale")))+"'>"+t(r)+"</option>");for(i.push("    </select>\n    <span class='field-desc'>\n      Changing the invoice language will also change the language for all existing invoices for this client.\n      <br>\n      Want to see your language here? Drop us a line and we'll get onto it.\n    </span>"),Paydirt.account.features("multiple_languages")||i.push("    <p class='grey input_aligned'>\n      <a href='/settings/account/plan'>Upgrade your account</a>\n      to bill in multiple languages\n    </p>"),i.push("  </div>\n  <hr>\n  <div class='option_label'>\n    <label for='shortname'>Invoice numbering</label>\n  </div>\n  <div class='option_field'>\n    <div class='span-24'>\n      <div class='span-12'>\n        <select class='form-20' id='shortname_type' data-behaviour='chosen'>\n          <option value='new' selected='"+e(t(this.isNew()&&Paydirt.account.get("use_client_shortnames")))+"' data-html='Create a new prefix'>New prefix</option>"),n=Paydirt.clients.where({shortname:""}).length,s="No prefix <span class='grey'>("+n+" other "+(1===n?"client uses":"clients use")+" no prefix)</span>",i.push("          <option value='' selected='"+e(t(this.isNew()&&!Paydirt.account.get("use_client_shortnames")||null==this.get("shortname")||""===this.get("shortname")))+"' data-html='"+e(t(s))+"'>No prefix</option>"),u=_.uniq(_.compact(Paydirt.clients.pluck("shortname"))).sort(),l=0,c=u.length;c>l;l++)o=u[l],n=Paydirt.clients.where({shortname:o}).length,s="<b>"+o+"</b> <span class='grey'>("+n+" "+(1===n?"client uses":"clients use")+" this prefix)</span>",i.push("          <option value='"+e(t(o))+"' selected='"+e(t(o===this.get("shortname")))+"' data-html='"+e(t(s))+"'>"),i.push("            "+t(o)),i.push("          </option>");return i.push("        </select>\n      </div>\n      <div class='last span-12'>\n        <input class='"+["form-5",""+e(t(this.isNew()&&Paydirt.account.get("use_client_shortnames")?void 0:"hide"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' id='shortname' type='text' value='"+e(t(this.get("shortname")))+"'>\n      </div>\n    </div>\n    <span class='field-desc'>\n      Invoice numbers are generated sequentially per prefix. Eg: abc-001, abc-002 &amp; xyz-001, xyz-002\n      <br>\n      If you prefer plain invoices numbers (001, 002, 003) choose \"No prefix\".\n      <a href='/help/guides/invoicing/numbers'>Learn more</a>\n    </span>\n  </div>\n  <hr>\n  <div class='option_label'>\n    <label for='invoicing_threshold'>Invoicing threshold</label>\n  </div>\n  <div class='option_field'>\n    <input class='form-5' id='invoicing_threshold' type='text' value='"+e(t(Paydirt.Formatters.currency(this.get("invoicing_threshold"),{sign:this.currency().get("sign")})))+"' data-behaviour='currency_input' data-currency-sign='"+e(t(this.currency().get("sign")))+"'>\n    <span class='field-desc'>Remind me to invoice this client when I exceed this amount of unbilled work.</span>\n  </div>\n</div>\n<hr class='space'>\n<div class='box settings top'>\n  <div class='title'>\n    <h2>Paydirt Identity</h2>\n  </div>\n  <div class='info setting_description'>\n    <p>Paydirt uses a badge for each client so that you spot them at a glance. Upload your client's logo, or create a simple monogram.</p>\n  </div>\n  <hr class='space'>\n  <div class='option_label'>\n    <label for='color'>Color</label>\n  </div>\n  <div class='option_field'>\n    <input class='colorpicker form-8' id='color' type='text' value='"+e(t(this.get("color")))+"' data-validates-presence>\n  </div>\n  <hr>\n  <div class='option_label' id='badge_type'>\n    <input id='logo_radio' type='radio' name='badge_type' value='logo' checked='"+e(t("logo"===this.badgeType()))+"'>\n    <label for='logo_radio'>Upload an image</label>\n    <hr class='clear space'>\n    <input id='monogram_radio' type='radio' name='badge_type' value='monogram' checked='"+e(t("monogram"===this.badgeType()))+"'>\n    <label for='monogram_radio'>Use a monogram</label>\n  </div>\n  <div class='option_field'>\n    <div class='span-10'>\n      <div id='logo_selector'>\n        <input id='logo' type='file' accept='image/png,image/jpeg,/image/jpg'>\n        <span class='field-desc'>PNG or JPG less than 50KB. Images are resized and cropped square.</span>\n        <span class='hide red' id='logo_error'>The selected image was larger than 50KB. Please choose a smaller image.</span>\n      </div>\n      <div id='monogram_selector'>\n        <input class='form-3' id='monogram' type='text' maxlength='"+e(t(2))+"' value='"+e(t(this.get("monogram")))+"' data-validates-presence>\n      </div>\n    </div>\n    <div class='span-1'>&nbsp;</div>\n    <div class='last span-13'>\n      <div class='demo'>\n      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/index"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>"),i.push(this.active?"        Clients":"        <a href='"+e(t(Paydirt.Routes.clients()))+"' data-behaviour='backbone_link'>Clients</a>\n        <i class='icon-angle-right'></i>\n        Archived"),i.push("      </h1>\n    </div>\n  </div>\n  <div class='page-links'>\n    <div class='container'>"),i.push(Paydirt.account.canAddClient()?"      <a class='action' href='#' data-onclick='showClientForm'>\n        Add a Client\n      </a>":"      <a class='action' href='/settings/account/plan'>Upgrade your account to add more clients</a>"),i.push("    </div>\n  </div>\n  <div class='action-bar new_client'>\n    <div class='container'>\n      <div class='new_client_form_container'></div>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div class='secondary_navigation'>\n        <a href='/clients' data-behaviour='backbone_link'>Current</a>\n        <a href='/clients/archived' data-behaviour='backbone_link'>Archived</a>\n      </div>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <div class='box empty hide'>\n      <p class='t-center'>"),i.push(this.active?"        You haven't added any of your clients to Paydirt yet. Want to\n        <a href='"+e(t(Paydirt.Routes.new_client()))+"' data-behaviour='backbone_link'>add your first client</a>\n        ?":"        You haven't archived any clients yet. Archive a client if you are no longer working for them."),i.push("      </p>\n    </div>\n    <div class='clients'></div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/inline_new"]=function(t){return function(){var t;return t=[],t.push("<form class='dropdown_inline_form'>\n  <h4>New Client</h4>\n  <input class='form-20 inline_input' id='client_business_name' type='text' placeholder='Business name' data-validates-presence data-onenter='addNewClient'>\n  <a class='action' href='#' data-onclick='addNewClient'>\n    Add Client\n  </a>\n  <div class='or'>\n    or\n  </div>\n  <a class='action' href='#' data-onclick='editClientDetails'>\n    Add and edit details\n  </a>\n</form>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/invoices"]=function(t){return function(){var t;return t=[],t.push("<div class='span-24'>\n  <div class='span-18'>\n    <div class='section'>\n      <h2>Invoice History</h2>\n    </div>\n    <div class='invoices_list'></div>\n  </div>\n  <div class='last span-6'>\n    <div class='invoices_summary'></div>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/keywords"]=function(t){return function(){var t;return t=[],t.push("<div class='span-18'>\n  <div class='keywords_container'></div>\n</div>\n<div class='last span-6'>\n  <div class='info well'>\n    <h2>What are keywords?</h2>\n    <p>Keywords allow the Paydirt browser extension to automatically determine who you're working for. It scans the pages you visit for your clients' keywords, and when it finds one, it prompts you to start a timer for the matching client.</p>\n    <p>Each keyword is simply a unique word related to a client - like their business name, website address, or email address.</p>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/list"]=function(t){return function(){var t,e,i,n,s,r,a;e=window.HAML.escape,t=window.HAML.cleanValue,i=[],r=Object.keys(this.groupedClients).length>1,a=this.groupedClients;for(s in a)n=a[s],i.push("<div class='client_list_summary'>\n  <div class='span-12'>\n    <div class='right'>\n      <h3 class='label'>"),r&&i.push("        "+t(n.first().currency().get("code"))),i.push("        Total\n      </h3>\n    </div>\n  </div>\n  <div class='clearfix client last span-12'>\n    <div class='figures'>\n      <div class='"+["figure",""+e(t(n.totalAmountUnbilled().zero()?"zero":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n        <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n        <span class='amount'>"+t(n.totalAmountUnbilled().format({sign:""}))+"</span>\n        <br>\n        <span class='grey'>unbilled</span>\n      </div>\n      <div class='"+["figure",""+e(t(n.totalAmountOwing().zero()?"zero":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n        <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n        <span class='amount'>"+t(n.totalAmountOwing().format({sign:""}))+"</span>\n        <br>\n        <span class='grey'>owing</span>\n      </div>\n      <div class='"+["figure",""+e(t(n.totalAmountOverdue().zero()?"zero":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n        <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n        <span class='amount'>"+t(n.totalAmountOverdue().format({sign:""}))+"</span>\n        <br>\n        <span class='grey'>overdue</span>\n      </div>\n    </div>\n  </div>\n</div>");return i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/list_item"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='clearfix client'>\n  <div class='client-title span-12'>\n    <div class='span-3'>\n      <a href='"+e(t(Paydirt.Routes.client(this.model.id)))+"' data-behaviour='backbone_link'>"),i.push("        "+t(this.model.badge({size:"mid"}))),i.push("      </a>\n    </div>\n    <div class='last span-21'>\n      <h3>\n        <a href='"+e(t(Paydirt.Routes.client(this.model.id)))+"' data-behaviour='backbone_link'>"+t(this.model.get("business_name"))+"</a>\n      </h3>\n      <div class='client-actions'>\n        <a href='"+e(t(Paydirt.Routes.client(this.model.id)))+"' data-behaviour='backbone_link'>\n          Tasks &amp; Expenses\n        </a>"),Paydirt.user.canManageInvoices()&&i.push("        <a href='"+e(t(Paydirt.Routes.client_quotes(this.model.id)))+"' data-behaviour='backbone_link'>\n          Quotes\n        </a>\n        <a href='"+e(t(Paydirt.Routes.client_invoices(this.model.id)))+"' data-behaviour='backbone_link'>\n          Invoices\n        </a>\n        <a href='"+e(t(Paydirt.Routes.client_invoices_new(this.model.id)))+"' data-behaviour='backbone_link'>\n          New Invoice\n        </a>"),i.push("        <a href='"+e(t(Paydirt.Routes.edit_client(this.model.id)))+"' data-behaviour='backbone_link'>\n          Edit\n        </a>\n      </div>\n    </div>\n  </div>\n  <div class='figures last span-12'>\n    <div class='"+["figure",""+e(t(0===this.model.amountUnbilled()?"zero":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      <span class='currency'>"+t(this.model.currency().get("sign"))+"</span>\n      <span class='amount'>"+t(Paydirt.Formatters.currency(this.model.amountUnbilled(),{sign:""}))+"</span>\n      <br>\n      <span class='grey'>unbilled</span>\n    </div>\n    <div class='"+["figure",""+e(t(this.model.amountOwing().zero()?"zero":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      <span class='currency'>"+t(this.model.currency().get("sign"))+"</span>\n      <span class='amount'>"+t(this.model.amountOwing().format({sign:""}))+"</span>\n      <br>\n      <span class='grey'>owing</span>\n    </div>\n    <div class='"+["figure",""+e(t(this.model.amountOverdue().zero()?"zero":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      <span class='currency'>"+t(this.model.currency().get("sign"))+"</span>\n      <span class='amount'>"+t(this.model.amountOverdue().format({sign:""}))+"</span>\n      <br>\n      <span class='grey'>overdue</span>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/new"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>New Client</h1>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <form class='backbone client_form' data-behaviour='validate'>\n      <div class='form span-18'></div>\n      <div class='last span-6'>\n        <input class='massive' type='submit' value='Save Client'>\n        <span class='cancel'>\n          or\n          <a class='cancel' href='"+e(t(Paydirt.Routes.clients()))+"' data-behaviour='backbone_link'>Cancel</a>\n        </span>\n      </div>\n    </form>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/new_invoice"]=function(t){return function(){var t,e;return t=window.HAML.cleanValue,e=[],e.push("<div class='span-18'>\n  <div id='invoice_options'>\n    <a class='toggle_options' href='#' data-onclick='toggleInvoiceOptions'>\n      <i class='icon-cog'></i>\n      &nbsp;\n      <span class='text'>Show Options</span>\n    </a>\n    <div class='hide' id='invoice_creation_options'>\n      <div id='block_date_range'>\n        <h4>Date range for this invoice</h4>\n        <div class='line_item_option'>\n          <input id='all_time' type='radio' name='date_range' value='false' checked='checked' data-onchange='setDateRange'>\n          <label for='all_time'>Include all unbilled time</label>\n        </div>\n        <div class='line_item_option'>\n          <div class='left'>\n            <input id='time_range' type='radio' name='date_range' value='true' data-onchange='setDateRange'>\n            <label for='time_range'>Only time logged between</label>\n          </div>\n          <div class='left'>\n            <input class='datepicker' type='text' name='block_start_date' placeholder='start date' data-onchange='setDateRange'>\n            <span class='or'>and</span>\n            <input class='datepicker' type='text' name='block_end_date' placeholder='end date' data-onchange='setDateRange'>\n          </div>\n        </div>\n      </div>\n      <div id='invoice_description_options'>\n        <h4>Invoice description</h4>\n        <div class='line_item_option'>\n          <input id='include_total_hours' type='checkbox' data-onchange='showPreview'>\n          <label for='include_total_hours'>Include total number of hours</label>\n        </div>\n      </div>\n      <div id='line_item_creation_options'></div>\n    </div>\n  </div>\n  <div class='preview' id='invoice-page'>\n    <i class='icon-refresh icon-spin spinner'></i>\n    <div class='template-border'>INVOICE &bull; PREVIEW &bull; ONLY</div>\n    <div id='invoice_contents'></div>\n    <div class='bottom template-border'>INVOICE &bull; PREVIEW &bull; ONLY</div>\n  </div>\n</div>\n<div class='last span-6'>\n  <div class='invoice_builder'>\n    <button class='massive' type='submit' data-onclick='draftWorkInvoice'>\n      <span>Draft this invoice</span>\n      <i class='icon-circle-arrow-right'></i>\n    </button>\n    <hr class='space'>\n    <div data-bind='collection:$collection'></div>\n    <div class='component-empty-state' data-bind='toggle:not(length($collection))'>\n      No unbilled tasks or expenses for\n      <br>"),e.push("      "+t(this.model.get("business_name"))),e.push("    </div>\n  </div>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/quotes"]=function(t){return function(){var t;return t=[],t.push("<div class='span-24'>\n  <div class='span-18'>\n    <div class='section'>\n      <h2>Quote History</h2>\n    </div>\n    <div class='quotes_list'></div>\n  </div>\n  <div class='last span-6'>\n    <div class='quotes_summary'></div>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/show"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>\n        <a href='"+e(t(Paydirt.Routes.clients()))+"' data-behaviour='backbone_link'>Clients</a>\n        <i class='icon-angle-right'></i>\n        <a href='"+e(t(Paydirt.Routes.client(Paydirt.client.id)))+"' data-behaviour='backbone_link'>"+t(Paydirt.client.get("business_name"))+"</a>\n      </h1>\n    </div>\n  </div>\n  <div class='page-links'>\n    <div class='container'>"),Paydirt.user.canManageInvoices()&&(this.get("active")?(Paydirt.router.currentPath()===Paydirt.Routes.client_quotes(this.id)&&i.push("      <a class='action' href='#new-quote' data-onclick='draftQuote'>\n        New Quote\n      </a>"),Paydirt.router.currentPath()===Paydirt.Routes.client_invoices(this.id)&&i.push("      <a class='action new_invoice_link' href='#new-invoice' data-onclick='draftInvoice'>\n        New Blank Invoice\n      </a>\n      <a class='action new_invoice_link' href='"+e(t(Paydirt.Routes.client_invoices_new(this.id)))+"' data-behaviour='backbone_link'>\n        Select Time &amp; Expenses to Invoice\n      </a>")):(Paydirt.router.currentPath()===Paydirt.Routes.client_quotes(this.id)&&i.push("      <a class='action disabled' href='#' data-behaviour='tooltip' data-tooltip-gravity='n' title='"+e(t(this.get("active")?void 0:"You can't create an quote for an archived client"))+"'>\n        New Quote\n      </a>"),Paydirt.router.currentPath()===Paydirt.Routes.client_invoices(this.id)&&i.push("      <a class='action disabled new_invoice_link' href='#' data-behaviour='tooltip' data-tooltip-gravity='n' title='"+e(t(this.get("active")?void 0:"You can't create an invoice for an archived client"))+"'>\n        New Invoice\n      </a>"))),Paydirt.router.currentPath()===Paydirt.Routes.client(this.id)&&(i.push("      <div class='action-group btn-group'>\n        <a class='action' href='#' data-onclick='addProject'>New Project</a>\n        <a class='action dropdown-toggle' href='#' data-toggle='dropdown'>\n          <i class='icon-caret-down'></i>\n        </a>\n        <ul class='dropdown-menu'>\n          <li>"),i.push(Paydirt.account.get("trello_connected")?"            <a href='#' data-onclick='importTrelloBoard'>Create from Trello Board</a>":"            <a href='/settings/account/integrations'>Create from Trello Board</a>"),i.push("          </li>\n          <li>"),i.push(Paydirt.account.get("basecamp_connected")?"            <a href='#' data-onclick='importBasecampProject'>Create from Basecamp Project</a>":"            <a href='/settings/account/integrations'>Create from Basecamp Project</a>"),i.push("          </li>\n          <li>"),i.push(Paydirt.account.get("redbooth_connected")?"            <a href='#' data-onclick='importRedboothProject'>Create from Redbooth Project</a>":"            <a href='/settings/account/integrations'>Create from Redbooth Project</a>"),i.push("          </li>\n        </ul>\n      </div>")),i.push("    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div class='"+["secondary_navigation",""+e(t(Paydirt.tour?"temp_hide":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n        <a href='"+e(t(Paydirt.Routes.client(this.id)))+"' data-behaviour='backbone_link'>\n          Tasks &amp; Expenses\n        </a>"),Paydirt.user.canManageInvoices()&&i.push("        <a href='"+e(t(Paydirt.Routes.client_quotes(this.id)))+"' data-behaviour='backbone_link'>\n          Quotes\n        </a>\n        <a href='"+e(t(Paydirt.Routes.client_invoices(this.id)))+"' data-behaviour='backbone_link'>\n          Invoices\n        </a>"),Paydirt.user.get("installed_extension")&&i.push("        <a href='"+e(t(Paydirt.Routes.client_keywords(this.id)))+"' data-behaviour='backbone_link'>\n          Keywords\n        </a>"),i.push("        <a href='"+e(t(Paydirt.Routes.edit_client(this.id)))+"' data-behaviour='backbone_link'>\n          <i class='icon-pencil'></i>\n          Edit Client\n        </a>\n      </div>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <div class='span-24 subview'></div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")
}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["clients/work"]=function(t){return function(){var t,e;return t=window.HAML.cleanValue,e=[],e.push("<div data-bind='collection:$collection'></div>\n<div class='component-empty-state' data-bind='toggle:not(length($collection))'>\n  You don't have any projects for "+this.model.get("business_name")+".\n  <a href='#' data-onclick='addProject'>Add a project</a>\n  to start tracking time and logging expenses for this client.\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["document_activities/index"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='box settings top'>\n  <div class='title'>\n    <a class='add right' id='add_invoice_activity' href='#'>Add a note</a>\n    <h3>Activity</h3>\n  </div>\n  <div class='hide pad ten' id='invoice_activity_form'>\n    <form class='backbone'>\n      <input type='text' name='date' value='"+e(t(moment().format()))+"' data-behaviour='datepicker'>\n      <textarea name='description' placeholder='Description'></textarea>\n      <input class='action' id='submit_invoice_activity' type='submit' value='Add note'>\n      <span class='cancel'>\n        or\n        <a class='cancel' id='cancel_invoice_activity' href='#'>Cancel</a>\n      </span>\n    </form>\n  </div>\n  <div class='nano'>\n    <div class='content' id='invoice-activity'></div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["document_activities/show"]=function(t){return function(){var t,e,i,n,s;switch(e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='invoice_activity'>\n  <a class='delete' href='#' title='Remove activity' data-confirm='Are you sure you want to remove this activity?'>&times;</a>\n  <p class='date'>"+t(this.activity.get("date"))+"</p>\n  <p>"),this.activity.get("type")){case"Created":i.push("    "+this.documentType+" created"),null!=(s=this.activity.document().get("quote_id"))&&(null!=(n=Paydirt.quotes.get(s))?(i.push("    from quote\n    <a href='"+e(t(Paydirt.Routes.quote(n.id)))+"' data-behaviour='backbone_link'>"),i.push("      "+t(n.formattedNumber())),i.push("    </a>")):i.push("    from a quote"));break;case"Sent":i.push("    "+this.documentType+" labeled\n    <i>Sent</i>");break;case"Drafted":i.push("    "+this.documentType+" labeled\n    <i>Draft</i>");break;case"Accepted":i.push("    Quote was\n    <i>Accepted</i>");break;case"Declined":i.push("    Quote was\n    <i>Declined</i>");break;case"Emailed":if(this.activity.document_email().get("failed"))i.push("    Failed to email "+this.documentType+" to "+this.activity.document_email().get("to_email_address"));else{switch(this.activity.document_email().get("type")){case"NewQuoteEmail":i.push("    Emailed quote to");break;case"NewInvoiceEmail":i.push("    Emailed invoice to");break;case"ReminderInvoiceEmail":i.push("    Sent reminder to");break;case"ThankyouInvoiceEmail":i.push("    Sent thankyou to")}i.push("    "+t(this.activity.document_email().get("to_email_address"))),null!=this.activity.document_email().get("cc_email_address")&&""!==this.activity.document_email().get("cc_email_address")&&i.push("    <br>\n    (CC to "+this.activity.document_email().get("cc_email_address")+")")}break;case"PaymentReceived":i.push("    Logged payment of "+Paydirt.Formatters.currency(new Money(this.activity.get("amount")).amount(),{sign:this.activity.document().currency().get("sign")}));break;case"PaymentRemoved":i.push("    Removed payment of "+Paydirt.Formatters.currency(new Money(this.activity.get("amount")).amount(),{sign:this.activity.document().currency().get("sign")}));break;case"Paid":i.push("    "+this.documentType+" labeled\n    <i>Paid</i>");break;case"Unpaid":i.push("    "+this.documentType+" labeled\n    <i>Unpaid</i>");break;case"Updated":i.push("    "+this.documentType+" modified");break;case"Custom":i.push("    "+t(this.activity.get("description")))}return i.push("  </p>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["documents/add"]=function(t){return function(){var t;return t=[],t.push("<div id='invoice_header'></div>\n<div id='middle'>\n  <div class='container'>\n    <div id='add_to_invoice'></div>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["documents/edit"]=function(t){return function(){var t,e,i,n;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='invoice_header'></div>\n<div id='middle'>\n  <div class='container'>\n    <div id='edit_invoice_page'>\n      <form class='backbone'>\n        <div class='span-18'>\n          <div id='invoice-page'>\n            <div class='clearfix shell'>\n              <div id='logo_uploader_container'></div>\n              <hr class='clear space'>\n              <div class='my_business span-7'>\n                <div class='span-6'>\n                  <h3 class='invoice-from'>"),i.push("                    "+t(I18n.t("from"))),i.push("                    &nbsp;\n                  </h3>\n                </div>\n                <div class='last span-18'>\n                  <input type='text' name='account_business_name' placeholder='Your business name' value='"+e(t(this.document.get("account_business_name")))+"'>\n                </div>\n                <hr class='clear'>\n                <input type='text' name='account_contact_name' placeholder='Your name' value='"+e(t(this.document.get("account_contact_name")))+"'>\n                <div class='account_address'>\n                  <textarea class='street_address' name='account_address' rows='"+e(t(4))+"' placeholder='Your address'>"+t(this.document.get("account_address"))+"</textarea>\n                </div>\n              </div>\n              <div class='span-7'>\n                <div class='span-6'>\n                  <h3 class='invoice-to'>"),i.push("                    "+t(I18n.t("to"))),i.push("                    &nbsp;\n                  </h3>\n                </div>\n                <div class='last span-18'>\n                  <input type='text' name='client_business_name' placeholder=\"Recipient's business name\" value='"+e(t(this.document.get("client_business_name")))+"'>\n                </div>\n                <hr class='clear'>\n                <input type='text' name='client_contact_name' placeholder=\"Recipient's name\" value='"+e(t(this.document.get("client_contact_name")))+"'>\n                <div class='client_address'>\n                  <textarea class='street_address' name='client_address' rows='"+e(t(4))+"' placeholder=\"Recipient's address\">"+t(this.document.get("client_address"))+"</textarea>\n                </div>\n              </div>\n              <div class='span-1'>&nbsp;</div>\n              <div class='last span-9'>\n                <div class='formatted-number-input'>"),"ClientInvoice"!==this.document.get("type")&&"ClientQuote"!==this.document.get("type")||""===this.document.client().get("shortname")?("FreeformInvoice"===this.document.get("type")||"FreeformQuote"===this.document.get("type"))&&i.push("                  #"):i.push("                  "+t(""+this.document.client().get("shortname")+"&nbsp;-&nbsp;")),"RecurringInvoice"!==this.document.get("type")&&i.push("                  <input class='form-5 number' type='text' name='padded_number' value='"+e(t(this.document.paddedNumber()))+"'>"),i.push("                </div>\n                <h3 class='invoice-number'>\n                  <span class='invoice-type'>"),"ClientInvoice"===this.document.get("type")||"FreeformInvoice"===this.document.get("type")?(i.push("                    "+t(I18n.t("invoice"))),i.push("                    <hr class='clear'>")):"ClientQuote"===this.document.get("type")||"FreeformQuote"===this.document.get("type")?(i.push("                    "+t(I18n.t("quote"))),i.push("                    <hr class='clear'>")):"RecurringInvoice"===this.document.get("type")&&i.push("                    <div class='info'>\n                      <p>Recurring invoices have their number, issued date, and due date set automatically</p>\n                    </div>"),i.push("                  </span>\n                </h3>\n                <div id='invoice-dates'>"),"RecurringInvoice"!==this.document.get("type")&&(i.push("                  <label for='issued_at'>"+t(""+I18n.t("date_issued")+":")+"</label>\n                  <input class='datepicker form-7 issued_at' type='text' name='issued_at'>"),("ClientInvoice"===this.document.get("type")||"FreeformInvoice"===this.document.get("type"))&&(i.push("                  <hr class='clear microspace'>\n                  <label for='due_at'>"+t(""+I18n.t("payment_due")+":")+"</label>\n                  <input class='datepicker due_at form-7' type='text' name='due_at'>"),"ClientInvoice"===this.document.get("type")&&i.push("                  <br>\n                  <div class='due_at_helper right'>\n                    Due&nbsp;\n                    <input class='due_at_offset' type='text' name='due_at_offset'>\n                    &nbsp;days from issue\n                  </div>"))),i.push("                </div>\n              </div>\n              <hr class='clear space'>\n              <div class='last span-16'>\n                <h3 class='invoice-description'>"+t(I18n.t("description"))+"</h3>\n                <hr class='clear'>\n                <textarea class='invoice_description' type='text' name='description' rows='"+e(t(2))+"' data-behaviour='autogrow'>"+t(this.document.get("description"))+"</textarea>\n              </div>\n              <hr class='clear space'>\n              <table id='line_items'>\n                <tr>\n                  <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>\n                  <th class='description'>"+t(I18n.t("line_item.description"))+"</th>\n                  <th>"+t(I18n.t("line_item.quantity"))+"</th>\n                  <th>"+t(I18n.t("line_item.unit_price"))+"</th>\n                  <th class='tax_header' data-id='"+e(t(0))+"'></th>\n                  <th class='tax_header' data-id='"+e(t(1))+"'></th>\n                  <th>\n                    <span class='right'>"+t(I18n.t("line_item.amount"))+"</span>\n                  </th>\n                </tr>\n                <tbody id='line_items'></tbody>\n                <tr>\n                  <td class='rule' colspan='"+e(t(5))+"' data-original-colspan='"+e(t(5))+"'></td>\n                </tr>\n                <tr class='add_fields'>\n                  <td colspan='"+e(t(3))+"' data-original-colspan='"+e(t(3))+"'>"),"ClientInvoice"===this.document.get("type")||"ClientQuote"===this.document.get("type")||"RecurringInvoice"===this.document.get("type")?(i.push("                    <span class='add btn-group'>\n                      <a class='add_line_item btn'>Add a line item</a>\n                      <a class='btn dropdown-toggle' data-toggle='dropdown'>\n                        <i class='icon-caret-down'></i>\n                      </a>\n                      <ul class='dropdown-menu'>"),Paydirt.preset_line_items.each(function(n){return i.push("                        <li>\n                          <a class='add_line_item' href='#' data-line-item-description='"+e(t(n.get("description")))+"' data-line-item-rate='"+e(t(n.get("rate")))+"'>"),i.push("                            "+t(marked(n.get("description"),{sanitize:!0}).replace(/(<([^>]+)>)/gi,""))),i.push("                          </a>\n                        </li>"),""}),Paydirt.preset_line_items.length>0&&i.push("                        <li class='divider'></li>"),i.push("                        <a href='/settings/invoicing#preset_line_items_container' target='_blank'>Manage your preset line items</a>\n                      </ul>\n                    </span>")):i.push("                    <a class='add add_line_item' id='add_quantity_line_item' href='#'>\n                      Add a line item\n                    </a>"),i.push("                  </td>\n                  <td>\n                    <b class='right'>"+t(I18n.t("subtotal"))+"</b>\n                  </td>\n                  <td class='nowrap' id='invoice_subtotal'></td>\n                </tr>\n                <tr class='tax_total' data-id='"+e(t(0))+"'>\n                  <td colspan='"+e(t(4))+"' data-original-colspan='"+e(t(4))+"'>\n                    <b class='right'></b>\n                  </td>\n                  <td class='nowrap tax_subtotal' id='invoice_tax_0' data-id='"+e(t(0))+"'></td>\n                </tr>\n                <tr class='tax_total' data-id='"+e(t(1))+"'>\n                  <td colspan='"+e(t(4))+"' data-original-colspan='"+e(t(4))+"'>\n                    <b class='right'></b>\n                  </td>\n                  <td class='nowrap tax_subtotal' id='invoice_tax_1' data-id='"+e(t(1))+"'></td>\n                </tr>\n                <tr>\n                  <td colspan='"+e(t(4))+"' data-original-colspan='"+e(t(4))+"'>\n                    <b class='right'>"+t(I18n.t("total"))+"</b>\n                  </td>\n                  <td class='nowrap' id='invoice_total'></td>\n                </tr>\n              </table>\n              <div class='last span-24'>\n                <hr class='clear space'>\n                <hr class='clear space'>\n                <hr class='clear space'>"),n="ClientInvoice"===this.document.get("type")||"FreeformInvoice"===this.document.get("type")||"RecurringInvoice"===this.document.get("type")?"Payment Details":"Terms and Conditions",i.push("                <textarea class='invoice_footer' name='footer' rows='"+e(t(2))+"' data-behaviour='autogrow' placeholder='"+e(t(n))+"'>"+t(this.document.get("footer"))+"</textarea>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class='last span-6' id='invoice_sidebar'></div>\n      </form>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["documents/new_client"]=function(t){return function(){var t,e,i,n,s,r;e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<form class='backbone client_form' data-behaviour='validate'>\n  <div class='box settings top' style='width: 600px'>\n    <div class='title'>\n      <h2>"+this.type+" for a new client</h2>\n    </div>\n    <div class='clearfix'>\n      <div class='option_label'>\n        <label for='business_name'>Business name</label>\n      </div>\n      <div class='option_field'>\n        <input id='business_name' type='text' value='"+e(t(this.model.get("business_name")))+"' autofocus='"+e(t(this.model.isNew()))+"' data-validates-presence>\n      </div>\n      <hr>\n      <div class='option_label'>\n        <label for='email'>Contact email</label>\n        <br>\n      </div>\n      <div class='option_field'>\n        <input id='billing_email_address' type='text' value='"+e(t(this.model.get("billing_email_address")))+"'>\n        <span class='field-desc'>You can add your client's email address later if you like</span>\n      </div>\n      <hr>\n      <div class='option_label'>\n        <label for='currency_id'>Billing currency</label>\n      </div>\n      <div class='option_field'>\n        <select class='form-20' id='currency_id' data-behaviour='chosen' disabled='"+e(t(!Paydirt.account.features("multiple_currencies")))+"'>"),Paydirt.currencies.each(function(n){return function(s){return i.push("          <option value='"+e(t(s.id))+"' selected='"+e(t(s.id===n.model.get("currency_id")))+"' data-search-text='"+e(t(s.get("code")))+"'>"+t(""+s.get("name")+" ("+s.get("code")+", "+s.get("sign")+")")+"</option>"),""}}(this)),i.push("        </select>"),Paydirt.account.features("multiple_currencies")||i.push("        <p class='grey input_aligned'>\n          <a href='/settings/account/plan'>Upgrade your account</a>\n          to enable multiple currencies.\n        </p>"),i.push("      </div>\n      <hr>\n      <div class='option_label'>\n        <label for='locale'>"+this.type+" language</label>\n      </div>\n      <div class='option_field'>\n        <select class='form-20' id='locale' data-behaviour='chosen' disabled='"+e(t(!Paydirt.account.features("multiple_languages")))+"'>"),r=Paydirt.locales;for(s in r)n=r[s],i.push("          <option value='"+e(t(s))+"' selected='"+e(t(s===this.model.get("locale")))+"'>"+t(n)+"</option>");return i.push("        </select>"),Paydirt.account.features("multiple_languages")||i.push("        <p class='grey input_aligned'>\n          <a href='/settings/account/plan'>Upgrade your account</a>\n          to bill in multiple languages\n        </p>"),i.push("      </div>\n    </div>\n    <div class='items' style='padding: 10px 15px'>\n      <div class='span-10'>\n        <a class='cancel massive_aligned' href='#'>Cancel</a>\n      </div>\n      <div class='last span-14'>\n        <button class='massive' type='submit'>\n          Create Client\n          <span class='amp'>&amp;</span>\n          "+this.type+"\n          <i class='icon-circle-arrow-right'></i>\n        </button>\n      </div>\n    </div>\n  </div>\n</form>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["documents/schedule"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='invoice_header'>\n  <div id='page-head'>\n    <div class='page-title'>\n      <div class='container'>\n        <span class='disabled label' data-bind='classes:{enabled:enabled, disabled:not(enabled)}, text:select(enabled, \"enabled\", \"disabled\")'></span>\n        <h1>\n          <a href='/invoices/recurring' data-behaviour='backbone_link'>Recurring Invoices</a>\n          <i class='icon-angle-right'></i>\n          <a href='"+e(t(Paydirt.Routes.recurring_invoice(this.model.id)))+"' data-behaviour='backbone_link'>"+t(this.model.formattedNumber())+"</a>\n          <i class='icon-angle-right'></i>\n          Edit Schedule\n        </h1>\n      </div>\n    </div>\n    <div class='page-links sml'>\n      <div class='container'>\n        <a class='action' data-bind='toggle:not(enabled)' data-onclick='enableRecurring'>Enable Recurring Invoice</a>\n        <a class='action' data-bind='toggle:enabled' data-onclick='disableRecurring'>Disable Recurring Invoice</a>\n      </div>\n    </div>\n    <div class='page-tabs'>\n      <div class='container'>\n        <div id='show_edit_links'>"),i.push("          "+t(Paydirt.Templates["invoices/show_edit_links_recurring"]({model:this.model,mode:"edit_schedule"}))),i.push("        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <div class='span-12'>\n      <div class='box settings top'>\n        <div class='title'>\n          <h2>Conditions</h2>\n        </div>\n        <form class='backbone clearfix' id='schedule_form'></form>\n        <div class='items' style='padding: 10px 15px'>\n          <div class='right span-12'>\n            <button class='massive' type='button' data-onclick='save'>\n              Save Schedule\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class='last span-12'>\n      <div class='box settings top'>\n        <div class='title'>\n          <h2>Schedule</h2>\n        </div>\n        <ul class='schedule-list' data-bind='html:scheduleList'></ul>\n      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["expenses/invoice_fields"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='job_fields' data-bind='classes:{\"selected\":selected}'>\n  <div class='clickable' data-onclick='toggleSelected'>\n    <h3 class='job_name' data-bind='text:name'></h3>\n    <div class='checkbox_container'>\n      <i class='icon-check-empty' data-bind='toggle:not(selected)'></i>\n      <i class='icon-check' data-bind='toggle:selected'></i>\n      <input class='hide invoice_job_checkbox' type='checkbox' data-bind='checked:selected' data-onchange='showPreview' data-expense-id='"+e(t(this.model.id))+"'>\n    </div>\n  </div>\n  <div class='unbilled-value'>\n    <div class='unbilled_value'>\n      <span class='currency'>"+t(this.model.client().currency().get("sign"))+"</span>\n      <span class='amount' data-bind='text:total'></span>\n      <br>\n      unbilled\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["expenses/list"]=function(t){return function(){var t,e;return t=window.HAML.cleanValue,e=[],e.push("<div data-bind='collection:$collection'></div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["expenses/show"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='expense'>\n  <div class='expense-show' data-bind='toggle:not(editing)'>\n    <div class='span-22'>\n      <h3 data-bind='text:name'></h3>\n    </div>\n    <div class='last span-2'>\n      <div class='btn-group pull-right'>\n        <a class='btn dropdown-toggle' href='#' data-toggle='dropdown'>\n          <i class='icon-caret-down'></i>\n        </a>\n        <ul class='dropdown-menu'>\n          <li>\n            <a href='#' data-onclick='editExpense'>\n              <i class='icon-pencil'></i>\n              Edit\n            </a>\n          </li>\n          <li class='divider'></li>\n          <li>\n            <a href='#' data-onconfirm='destroyExpense' data-confirm='Are you sure you want to remove this expense?'>\n              <i class='icon-remove-sign'></i>\n              Delete\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n    <div class='span-4'>\n      &nbsp;\n    </div>\n    <div class='span-4 t-right'>\n      <span class='amount' data-bind='text:quantity'></span>\n      <br>\n      <span class='grey'>qty</span>\n    </div>\n    <div class='span-8 t-right'>\n      <span class='currency'>"+t(this.model.client().currency().get("sign"))+"</span>\n      <span class='amount' data-bind='currencyCounter:value'></span>\n      <br>\n      <span class='grey'>each</span>\n    </div>\n    <div class='last span-8 t-right'>\n      <span class='currency'>"+t(this.model.client().currency().get("sign"))+"</span>\n      <span class='amount' data-bind='currencyCounter:total'></span>\n      <br>\n      <span class='grey'>total</span>\n    </div>\n  </div>\n  <div class='expense-edit' data-bind='toggle:editing'>\n    <form class='backbone-form' data-onvalid='saveExpense' data-behaviour='validate'>\n      <div>\n        <input type='text' name='name' placeholder='Name' autofocus data-bind='value:name' data-validates-presence>\n      </div>\n      <div>\n        <div class='span-4 t-right'>\n          <div>\n            <input class='form-4' type='text' name='quantity' placeholder='Qty' data-bind='attr:{value:quantity}' data-validates-presence>\n          </div>\n          <div>\n            <span class='grey'>qty</span>\n          </div>\n        </div>\n        <div class='span-8 t-right'>\n          <div>\n            <input class='currency_input form-5' type='text' name='value' placeholder='Value' data-currency-sign='"+e(t(Paydirt.client.currency().get("sign")))+"' data-bind='attr:{value:value}' data-validates-presence>\n          </div>\n          <div>\n            <span class='grey'>each</span>\n          </div>\n        </div>\n        <div class='last span-12'>\n          <div class='right'>\n            <a class='cancel' href='#' data-onclick='cancelEditExpense'>Cancel</a>\n            &nbsp; or &nbsp;\n            <input type='submit' value='Save'>\n          </div>\n        </div>\n      </div>\n    </form>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["extensions/blocks/new"]=function(t){return function(){var t;return t=[],t.push("<div class='container'>\n  <div class='span-2'>&nbsp;</div>\n  <div class='span-20'>\n    <form class='backbone block_form shrinkable' id='new-block'>\n      <div class='box settings top'>\n        <div class='title'>\n          <h2>Time Worked</h2>\n        </div>\n        <div class='block_form_container'></div>\n        <hr class='space'>\n        <div class='submit-row'>\n          <div class='right'>\n            <span class='cancel'>\n              <a class='cancel' href='#'>Cancel</a>\n              &nbsp;\n              or\n            </span>\n            <input type='submit' value='Add Log Entry'>\n          </div>\n        </div>\n      </div>\n    </form>\n  </div>\n  <div class='last span-2'>&nbsp;</div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoice_payments/index"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='box settings solo' id='payments'>\n  <div class='title'>\n    <a class='"+["right","add",""+e(t(Paydirt.invoice.paid()||!Paydirt.invoice.get("sent")?"hide":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' id='add_invoice_payment' href='#'>Add a payment</a>\n    <h3>Payments</h3>\n  </div>\n  <div class='"+["contents",""+e(t(Paydirt.invoice.get("sent")?void 0:"hide"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n    <div class='clearfix invoice_payments_summary pad ten'>\n      <div class='clearfix' id='invoice_amount_paid'>\n        <div class='span-6'>\n          <span class='label'>Paid</span>\n        </div>\n        <div class='last span-18'>\n          <div class='"+["totals",""+e(t(Paydirt.invoice.paid()?"complete":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n            <span>"+t(Paydirt.invoice.amountPaid().format({precision:2}))+"</span>\n          </div>\n        </div>\n      </div>\n      <div class='"+e(t(Paydirt.invoice.paid()?"hide":void 0))+"' id='invoice_amount_owing'>\n        <div class='span-6'>\n          <span class='label'>Owing</span>\n        </div>\n        <div class='last span-18'>\n          <div class='totals'>\n            <span>"+t(Paydirt.invoice.amountOwing().format({precision:2}))+"</span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class='hide pad ten' id='invoice_payment_form'>\n      <form class='backbone'>\n        <div class='span-12'>\n          <input class='currency_input' id='invoice_payment_amount' type='text' value='"+e(t(Paydirt.invoice.amountOwing().format({sign:Paydirt.invoice.currency().get("sign")})))+"' data-currency-sign='"+e(t(Paydirt.invoice.currency().get("sign")))+"'>\n        </div>\n        <div class='last span-12'>\n          <input id='invoice_payment_received_at' type='text' value='"+e(t(moment().format()))+"' data-behaviour='datepicker'>\n        </div>\n        <textarea id='invoice_payment_description' rows='"+e(t(2))+"' placeholder='Optional payment description or notes'></textarea>\n        <input class='action' id='submit_invoice_payment' type='submit' value='Record Payment'>\n        <span class='cancel'>\n          or\n          <a class='cancel' id='cancel_invoice_payment' href='#'>Cancel</a>\n        </span>\n      </form>\n    </div>\n    <div id='invoice_payments'></div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoice_payments/settings"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],Paydirt.user.get("dismissed_notices").invoice_credit_card_settings||!Paydirt.account.get("paypal_feature")&&!Paydirt.account.get("stripe_feature")||(i.push("<div class='box settings solo' id='payment_settings'>\n  <div class='title'>\n    <h3>Payment Settings</h3>\n    <a class='grey' id='hide_payment_settings' href='/settings/notices/dismiss/invoice_credit_card_settings' data-remote style='float: right'>hide</a>\n  </div>\n  <div class='clearfix pad settings ten'>\n    <p class='center grey'>\n      Accept credit card payments for invoices?\n    </p>\n    <div class='span-1'>&nbsp;</div>\n    <div class='span-10'>"),Paydirt.account.get("paypal_feature")&&i.push("      <input id='accept_paypal' type='checkbox' checked='"+e(t(!!Paydirt.account.get("paypal_enabled")))+"' style='margin: 8px 10px 0 0' disabled='"+e(t(!!Paydirt.account.get("paypal_enabled")))+"'>\n      <label for='accept_paypal'>\n        <img src='/static_assets/paypal_logo.png' alt='PayPal'>\n      </label>"),i.push("    </div>\n    <div class='span-1'>&nbsp;</div>\n    <div class='last span-10'>"),Paydirt.account.get("stripe_feature")&&i.push("      <input id='accept_stripe' type='checkbox' checked='"+e(t(!!Paydirt.account.get("stripe_connected")))+"' style='margin: 8px 10px 0 0' disabled='"+e(t(!!Paydirt.account.get("stripe_connected")))+"'>\n      <label for='accept_stripe'>\n        <img src='/static_assets/stripe_logo.png' alt='Stripe'>\n      </label>"),i.push("    </div>\n  </div>\n</div>\n<hr class='space'>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoice_payments/show"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='invoice_payment'>\n  <a class='delete' data-confirm='Are you sure you want to remove this payment?' title='Remove payment' href='#'>&times;</a>\n  <p class='date'>"+t(this.payment.get("received_at"))+"</p>\n  <p>\n    Received "+this.payment.amount().format()+"\n    <span class='grey'>\x92"),i.push(this.payment.get("thankyou_invoice_email")?"    (thanked on "+this.payment.get("thankyou_invoice_email")+")":"    (\n    <a class='modal' href='"+e(t(Paydirt.Routes.new_invoice_payment_email(Paydirt.invoice.id,this.payment.id)))+"'>\n    Send a thank-you email\n    </a>\n    )"),i.push("    \x91</span>\n  </p>"),null!=this.payment.get("description")&&""!==this.payment.get("description")&&(i.push("  <p>"),i.push("    "+t("&ldquo;"+this.payment.get("description")+"&rdquo;")),i.push("  </p>")),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")
}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoice_taxes/form"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='span-24 tax_form'>\n  <div class='span-10'>\n    <input class='form-5 name' type='text' name='name' value='"+e(t(this.model.get("name")))+"' autocomplete='off' data-validates-presence placeholder='Name'>\n  </div>\n  <div class='span-10'>\n    <input class='form-4 percentage' type='text' name='percentage' value='"+e(t(Paydirt.Formatters.numberToPercentage(this.model.get("percentage"))))+"' autocomplete='off' placeholder='Percentage'>\n  </div>\n  <div class='span-2'>\n    &nbsp;\n  </div>\n  <div class='last span-2'>\n    <a class='delete' href='#'>&times;</a>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoice_taxes/index"]=function(t){return function(){var t,e;return t=window.HAML.cleanValue,e=[],e.push("<div class='expandable title'>\n  <div class='right'>"+t(Paydirt.Utilities.spriteTag("icons-settings-cog"))+"</div>\n  <h3>Taxes</h3>\n</div>\n<div class='clearfix pad setting ten'>\n  <div id='taxes'>\n    <div class='empty hide'>\n      <p>There aren't any taxes on this document</p>\n    </div>\n  </div>\n  <a class='right' id='add_tax' href='#'>Add a Tax</a>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/add_header"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>\n        <a href='/invoices' data-behaviour='backbone_link'>Invoices</a>\n        <i class='icon-angle-right'></i>\n        <a href='"+e(t(Paydirt.Routes.invoice(this.model.id)))+"' data-behaviour='backbone_link'>"+t(this.model.formattedNumber())+"</a>\n        <i class='icon-angle-right'></i>\n        Add\n      </h1>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div id='show_edit_links'>"),i.push("        "+t(Paydirt.Templates["invoices/show_edit_links"]({model:this.model}))),i.push("      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/all"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>\n        <a href='"+e(t(Paydirt.Routes.invoices()))+"' data-behaviour='backbone_link'>Invoices </a>\n        <i class='icon-angle-right'></i>\n        All invoices\n      </h1>\n    </div>\n  </div>\n  <div class='page-links'>\n    <div class='container'>\n      <a class='action' href='#' data-onclick='toggleInvoiceBuilder'>New Invoice</a>\n    </div>\n  </div>\n  <div class='action-bar new_invoice'>\n    <div class='container'>\n      <div class='new_invoice_button'></div>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div class='secondary_navigation'>\n        <a href='/invoices' data-behaviour='backbone_link'>Current</a>\n        <a href='/invoices/paid' data-behaviour='backbone_link'>Paid</a>\n        <a href='/invoices/all' data-behaviour='backbone_link'>All</a>\n        <a href='/invoices/recurring' data-behaviour='backbone_link'>Recurring</a>\n      </div>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <div class='invoice_browser'></div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/browser"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='span-17'>\n  <div class='box clearfix filter' id='invoice_browser_controls'>\n    <div class='span-24' id='filters_row'>\n      <div class='change_period item'>\n        <a id='previous' href='#'>\n          <span>&nbsp;</span>\n        </a>\n      </div>\n      <div class='item'>\n        <select class='form-7 left' id='date_range_type' data-behaviour='chosen'>\n          <option value='30-days'>30 Days</option>\n          <option value='custom'>Custom</option>\n          <option value='all-time'>All Time</option>\n        </select>\n      </div>\n      <div class='item'>\n        <div class='left' id='date_fields'>\n          <div class='item label'>from</div>\n          <div class='item'>\n            <input class='datepicker' id='start_date' type='text'>\n          </div>\n          <div class='item label'>to</div>\n          <div class='item'>\n            <input class='datepicker' id='end_date' type='text'>\n          </div>\n        </div>\n      </div>\n      <div class='change_period item'>\n        <a id='next' href='#'>\n          <span>&nbsp;</span>\n        </a>\n      </div>\n      <div class='item label right'>\n        <a class='grey' id='toggle_advanced_search' href='#'>Advanced search</a>\n      </div>\n    </div>\n    <div class='hide span-24' id='advanced_filters_row'>\n      <div class='item label'>Show invoices for</div>\n      <div class='item'>\n        <select class='form-20' id='autocompleter' data-behaviour='chosen' data-placeholder='Any client or project' data-allow-single-deselect='true'>\n          <option></option>"),Paydirt.clients.each(function(){return function(n){return i.push("          <option value='client-"+e(t(n.id))+"' data-type='client' data-id='"+e(t(n.id))+"' data-html='"+e(t(n.badge()))+" "+e(t(n.get("business_name")))+"' data-search-text='"+e(t(n.get("business_name")))+"'>"),i.push("            "+t(n.get("business_name"))),i.push("          </option>"),n.projects.each(function(s){return i.push("          <option value='project-"+e(t(s.id))+"' data-type='project' data-id='"+e(t(s.id))+"' data-html=\""+e(t(n.badge()))+" <i class='icon-caret-right'></i> "+e(t(s.get("name")))+"\" data-search-text='"+e(t(n.get("business_name")))+"' data-selected-text=\""+e(t(n.get("business_name")))+" <i class='icon-caret-right'></i> "+e(t(s.get("name")))+'">'),i.push("            "+t(""+n.get("business_name")+" <i class='icon-caret-right'></i> "+s.get("name"))),i.push("          </option>"),""}),""}}(this)),i.push("        </select>\n      </div>\n      <div class='item label'>that were</div>\n      <div class='item'>\n        <select class='form-6' id='date_criteria' data-behaviour='chosen'>\n          <option value='created_at'>created</option>\n          <option value='issued_at'>issued</option>\n          <option value='paid_at'>paid</option>\n        </select>\n      </div>\n      <div class='item label'>during this time period.</div>\n    </div>\n  </div>\n  <hr class='space'>\n  <div id='invoice_list'></div>\n  <div id='export_csv'>\n    <a class='action right' href='#' data-onclick='exportCSV'>Download invoices as CSV</a>\n  </div>\n</div>\n<div class='last span-7' id='invoice_browser_summary'></div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/browser_summary"]=function(t){return function(){var t,e,i,n,s;t=window.HAML.cleanValue,e=[],e.push("<div class='section'>\n  <h2>Summary</h2>\n</div>\n<hr class='double'>\n<div class='span-8'>\n  <h3 class='label'>Total</h3>\n</div>\n<div class='last span-16'>\n  <div class='total'>"),_.isEmpty(this.groupedInvoices)&&e.push("    <div class='t-right'>\n      <span class='amount nothing'>zero</span>\n    </div>"),s=this.groupedInvoices;for(i in s)n=s[i],e.push("    <div class='t-right'>\n      <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n      <span class='amount'>"+t(n.amountTotal().format({sign:"",code:n.first().currency().get("code")}))+"</span>\n    </div>\n    <hr class='space'>");return e.push("  </div>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/edit_header"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>\n        <a href='/invoices' data-behaviour='backbone_link'>Invoices</a>\n        <i class='icon-angle-right'></i>\n        <a href='"+e(t(Paydirt.Routes.invoice(this.model.id)))+"' data-behaviour='backbone_link'>"+t(this.model.formattedNumber())+"</a>\n        <i class='icon-angle-right'></i>\n        Edit\n      </h1>\n    </div>\n  </div>\n  <div class='page-links sml'>\n    <div class='container'>\n      <a class='action' href='#add_items' data-onclick='addItems'>\n        <i class='icon-plus-sign'></i>\n        Add logged Time &amp; Expenses to this invoice\n      </a>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div id='show_edit_links'>"),i.push("        "+t(Paydirt.Templates["invoices/show_edit_links"]({model:this.model,mode:"edit"}))),i.push("      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/edit_header_free"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>\n        Free Invoice Template\n        <i class='icon-angle-right'></i>\n        Make an invoice to print, or download as a PDF\n      </h1>\n      <p class='left'>\n        Want to track payments, accept credit cards, and be automatically notified of late invoices? Check out our\n        <a href='/features/online-invoicing?"+e(t(jQuery.param({utm_source:"pd",utm_medium:"site",utm_campaign:"free_invoice_creator"})))+"'>online invoicing features</a>\n        or \n        <a href='/signup?"+e(t(jQuery.param({utm_source:"pd",utm_medium:"site",utm_campaign:"free_invoice_creator"})))+"'>start a free trial.</a>\n      </p>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/edit_header_recurring"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <span class='disabled label' data-bind='classes:{enabled:enabled, disabled:not(enabled)}, text:select(enabled, \"enabled\", \"disabled\")'></span>\n      <h1>\n        <a href='/invoices/recurring' data-behaviour='backbone_link'>Recurring Invoices</a>\n        <i class='icon-angle-right'></i>\n        <a href='"+e(t(Paydirt.Routes.recurring_invoice(this.model.id)))+"' data-behaviour='backbone_link'>"+t(this.model.formattedNumber())+"</a>\n        <i class='icon-angle-right'></i>\n        Edit Template\n      </h1>\n    </div>\n  </div>\n  <div class='page-links sml'>\n    <div class='container'>\n      <a class='action' data-bind='toggle:not(enabled)' data-onclick='enableRecurring'>Enable Recurring Invoice</a>\n      <a class='action' data-bind='toggle:enabled' data-onclick='disableRecurring'>Disable Recurring Invoice</a>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div id='show_edit_links'>"),i.push("        "+t(Paydirt.Templates["invoices/show_edit_links_recurring"]({model:this.model,mode:"edit"}))),i.push("      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/edit_sidebar"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='follow' id='invoice-controls'>\n  <input class='massive' id='save-invoice' type='submit' value='Save Changes'>\n  <span class='cancel'>\n    or\n    <a class='cancel' href='"+e(t(Paydirt.Routes.invoice(this.invoice.id)))+"' data-behaviour='backbone_link'>Discard changes</a>\n  </span>\n  <hr class='space'>\n  <div id='invoice-options'>\n    <div class='box settings'>\n      <div class='solo' id='taxes_container'></div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/edit_sidebar_free"]=function(t){return function(){var t,e,i,n,s,r;e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='invoice-controls'>\n  <a class='action massive' href='/free_invoice_creator/save' data-behaviour='modal'>\n    <i class='icon-save'></i>\n    &nbsp;\n    Save Invoice\n  </a>\n  <a class='action massive' href='/free_invoice_creator/send_by_email' data-behaviour='modal'>\n    <i class='icon-envelope'></i>\n    &nbsp;\n    Send Invoice\n  </a>\n  <a class='action massive' href='/free_invoice_creator/setup_paypal' data-behaviour='modal'>\n    $&nbsp;&nbsp;&nbsp;Setup PayPal\n  </a>\n  <hr class='space'>\n  <div class='box clearfix dark t-center'>\n    <div class='span-12'>\n      <a id='print_invoice' href='#'>"),i.push("        "+t(Paydirt.Utilities.spriteTag("icons-print"))),i.push("        &nbsp;\n        Print Invoice\n      </a>\n    </div>\n    <div class='last span-12'>\n      <a id='download_pdf' href='#'>"),i.push("        "+t(Paydirt.Utilities.spriteTag("icons-pdf"))),i.push("        &nbsp;\n        Download PDF\n      </a>\n    </div>\n  </div>\n  <hr class='space'>\n  <div id='invoice-options'>\n    <div class='box settings'>\n      <div class='top' id='taxes_container'></div>\n      <div class='bottom'>\n        <div class='expandable midset title'>\n          <div class='right'>"+t(Paydirt.Utilities.spriteTag("icons-settings-cog"))+"</div>\n          <h3>Language &amp; Currency</h3>\n        </div>\n        <div class='pad setting ten'>\n          <select id='locale' data-behaviour='chosen' style='width: 230px;'>"),r=Paydirt.locales;for(s in r)n=r[s],i.push("            <option value='"+e(t(s))+"' selected='"+e(t(s===Paydirt.invoice.locale()))+"'>"+t(n)+"</option>");return i.push("          </select>\n          <select id='currency_id' data-behaviour='chosen' style='width: 230px;'>"),Paydirt.currencies.each(function(n){return i.push("            <option value='"+e(t(n.id))+"' selected='"+e(t(n.id===Paydirt.invoice.currency().id))+"' data-search-text='"+e(t(n.get("code")))+"'>"+t(""+n.get("name")+" ("+n.get("code")+", "+n.get("sign")+")")+"</option>"),""}),i.push("          </select>\n        </div>\n      </div>\n    </div>\n  </div>\n  <hr class='space'>\n  <div id='share-options'>\n    <div class='box settings'>\n      <div class='title'>\n        <h3>Like it? Give us a shout out!</h3>\n      </div>\n      <hr class='space'>\n      <div class='span-3'>&nbsp;</div>\n      <div class='span-6'>\n        <a class='twitter-share-button' href='https://twitter.com/share' data-via='paydirtapp' data-related='paydirtapp' data-count='vertical' data-url='https://paydirtapp.com/free_invoice_creator'>Tweet</a>\n        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=\"//platform.twitter.com/widgets.js\";fjs.parentNode.insertBefore(js,fjs);}}(document,\"script\",\"twitter-wjs\");</script>\n      </div>\n      <div class='span-6'>\n        <div class='fb-like' data-href='https://paydirtapp.com/free_invoice_creator' data-send='false' data-layout='box_count' data-width='450' data-show-faces='true' data-font='arial'></div>\n        <div id='fb-root'></div>\n        <script>\n          (function(d, s, id) {\n          var js, fjs = d.getElementsByTagName(s)[0];\n          if (d.getElementById(id)) return;\n          js = d.createElement(s); js.id = id;\n          js.src = \"//connect.facebook.net/en_US/all.js#xfbml=1\";\n          fjs.parentNode.insertBefore(js, fjs);\n          }(document, 'script', 'facebook-jssdk'));\n        </script>\n      </div>\n      <div class='span-6'>\n        <div class='g-plusone' data-size='tall' data-href='https://paydirtapp.com/free_invoice_creator'></div>\n        <script>\n          (function() {\n          var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;\n          po.src = 'https://apis.google.com/js/plusone.js';\n          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);\n          })();\n        </script>\n      </div>\n      <div class='last span-3'>&nbsp;</div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/edit_sidebar_recurring"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='follow' id='invoice-controls'>\n  <input class='massive' id='save-invoice' type='submit' value='Save Changes'>\n  <span class='cancel'>\n    or\n    <a class='cancel' href='"+e(t(Paydirt.Routes.recurring_invoice(this.model.id)))+"' data-behaviour='backbone_link'>Discard changes</a>\n  </span>\n  <hr class='space'>\n  <div id='invoice-options'>\n    <div class='box settings'>\n      <div class='solo' id='taxes_container'></div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/email_button"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push(this.invoice.get("sent")?this.invoice.overdue()?"<a class='action massive modal' id='send_remind_link' href='"+e(t(Paydirt.Routes.new_document_email(this.invoice.id,"reminder")))+"'>\n  <i class='icon-envelope'></i>\n  &nbsp;\n  Send Reminder\n</a>":"<a class='action massive modal' id='send_remind_link' href='"+e(t(Paydirt.Routes.new_document_email(this.invoice.id,"new")))+"'>\n  <i class='icon-envelope'></i>\n  &nbsp;\n  Re-send Invoice\n</a>":"<a class='action massive modal' id='send_remind_link' href='"+e(t(Paydirt.Routes.new_document_email(this.invoice.id,"new")))+"'>\n  <i class='icon-envelope'></i>\n  &nbsp;\n  Send Invoice\n</a>"),i.push("<span class='alternative'>\n  or"),i.push(this.invoice.get("sent")?this.invoice.payments.length>0?"  <a id='convert_sent_invoice_to_draft' href='#' data-confirm=\"You can convert this invoice to a draft, but it's already had payments added to it. Converting it to a draft will <b>remove</b> all existing payments. Want to go ahead?\" data-cancel-text=\"No, don't convert\" data-confirm-text='Yes, convert to draft'>\n    Convert invoice to draft\n  </a>":"  <a id='convert_invoice_to_draft' href='#'>\n    Convert invoice to draft\n  </a>":"  <a id='mark_invoice_as_sent' href='#'>\n    Mark it as Sent\n  </a>"),i.push("</span>\n<hr class='space'>\n<div class='hide' id='sent_email_to_self'>\n  <div class='box clearfix' style='padding-top: 0; padding-bottom: 0; width: 375px;'>\n    <div class='clearfix shell t-center'>\n      <h2>You just sent this invoice to yourself</h2>\n      <hr>\n      <p>It should arrive in your inbox in the next minute or so.</p>\n      <p>Does everything look good? Time to email it to your client!</p>\n      <p>\n        <a class='action massive' id='send_to_client' href='"+e(t(Paydirt.Routes.new_document_email(this.invoice.id,"new")))+"' data-behaviour='modal'>\n          <i class='icon-envelope'></i>\n          &nbsp;\n          Compose an email to my client\n        </a>\n      </p>\n      <p class='grey'>\n        Not ready to send this invoice to your client?\n        <a href='#' data-behaviour='close_modal'>Close this popup</a>\n        .\n      </p>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/index"]=function(t){return function(){var t;return t=[],t.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>Invoices</h1>\n    </div>\n  </div>\n  <div class='page-links'>\n    <div class='container'>\n      <a class='action' href='#' data-onclick='toggleInvoiceBuilder'>New Invoice</a>\n    </div>\n  </div>\n  <div class='action-bar new_invoice'>\n    <div class='container'>\n      <div class='new_invoice_button'></div>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div class='secondary_navigation'>\n        <a href='/invoices' data-behaviour='backbone_link'>Current</a>\n        <a href='/invoices/paid' data-behaviour='backbone_link'>Paid</a>\n        <a href='/invoices/all' data-behaviour='backbone_link'>All</a>\n        <a href='/invoices/recurring' data-behaviour='backbone_link'>Recurring</a>\n      </div>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <div class='span-17'>\n      <div class='current_invoices_list'></div>\n    </div>\n    <div class='current_invoices_list_summary last span-7'></div>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/list"]=function(t){return function(){var t;return t=[],t.push("<div class='invoices'></div>\n<div class='box empty hide'>\n  <p class='t-center'></p>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/list_item"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='grid invoice'>\n  <div class='invoice_client_details'>"),i.push("    "+t(this.model.client().badge())),i.push("    <span class='number'>"+t(this.model.formattedNumber())+"</span>\n  </div>\n  <div class='btn-group invoice-actions'>\n    <a class='btn dropdown-toggle' href='#' data-toggle='dropdown'>\n      <i class='icon-caret-down'></i>\n    </a>\n    <ul class='dropdown-menu pull-right'>\n      <li>\n        <a href='"+e(t(Paydirt.Routes.print_invoice(this.model.id)))+"' target='_blank'>\n          <i class='icon-print'></i>\n          Print\n        </a>\n      </li>\n      <li>\n        <a href='"+e(t(Paydirt.Routes.invoice(this.model.id)))+".pdf' target='_blank'>\n          <i class='icon-download-alt'></i>\n          Get PDF\n        </a>\n      </li>\n      <li>\n        <a href='"+e(t(Paydirt.Routes.blocks({range:"all-time",invoice:this.model.id})))+"' data-behaviour='backbone_link'>\n          <i class='icon-time'></i>\n          Billed Time\n        </a>\n      </li>\n      <li>\n        <a href='"+e(t(Paydirt.Routes.public_invoice(this.model.id,this.model.get("private_id"))))+"' target='_blank'>\n          <i class='icon-globe'></i>\n          View Online\n        </a>\n      </li>\n    </ul>\n  </div>\n  <div class='"+["tag",""+e(t(this.model.state()))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>"),i.push("    "+t(this.model.state().toUpperCase())),this.model.paid()&&i.push("    "+t(this.model.get("paid_at"))),i.push("  </div>\n  <div class='description'>"),i.push(this.model.get("description")?"    <p>"+t(marked(this.model.get("description")).replace(/(<([^>]+)>)/gi,"").substr(0,60))+"</p>":"    No description"),i.push("  </div>\n  <div class='total'>\n    \x91<span class='currency'>"+t(this.model.currency().get("sign"))+"</span>\x92\n    <span class='amount'>"+t(this.model.get("total").format({sign:""}))+"</span>\n  </div>\n  <div class='currency_code'>"+t(this.model.currency().get("code"))+"</div>\n  <a class='overlay' href='"+e(t(Paydirt.Routes.invoice(this.model.id)))+"' data-behaviour='backbone_link'></a>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/list_summary"]=function(t){return function(){var t,e,i,n,s,r,a,o;t=window.HAML.cleanValue,e=[],e.push("<div class='flush_left section'>\n  <h2>Summary</h2>\n</div>\n<hr class='double'>\n<div class='span-8'>\n  <h3 class='label'>Paid</h3>\n</div>\n<div class='last span-16'>\n  <div class='total'>"),_.isEmpty(this.groupedInvoices)&&e.push("    <div class='t-right'>\n      <span class='amount nothing'>zero</span>\n    </div>\n    <hr class='space'>"),s=this.groupedInvoices;for(i in s)n=s[i],e.push("    <div class='t-right'>\n      <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n      <span class='amount'>"+t(n.amountPaid().format({sign:"",code:n.first().currency().get("code")}))+"</span>\n    </div>\n    <hr class='space'>");e.push("  </div>\n</div>\n<hr class='clear double'>\n<div class='span-8'>\n  <h3 class='label'>Owing</h3>\n</div>\n<div class='last span-16'>\n  <div class='total'>"),_.isEmpty(this.groupedInvoices)&&e.push("    <div class='t-right'>\n      <span class='amount nothing'>zero</span>\n    </div>\n    <hr class='space'>"),r=this.groupedInvoices;for(i in r)n=r[i],e.push("    <div class='t-right'>\n      <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n      <span class='amount'>"+t(n.amountOwing().format({sign:"",code:n.first().currency().get("code")}))+"</span>\n    </div>\n    <hr class='space'>");e.push("  </div>\n</div>\n<hr class='clear double'>\n<div class='span-8'>\n  <h3 class='label'>Overdue</h3>\n</div>\n<div class='last span-16'>\n  <div class='total'>"),_.isEmpty(this.groupedInvoices)&&e.push("    <div class='t-right'>\n      <span class='amount nothing'>zero</span>\n    </div>\n    <hr class='space'>"),a=this.groupedInvoices;for(i in a)n=a[i],e.push("    <div class='t-right'>\n      <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n      <span class='amount'>"+t(n.amountOverdue().format({sign:"",code:n.first().currency().get("code")}))+"</span>\n    </div>\n    <hr class='space'>");e.push("  </div>\n</div>\n<hr class='clear double'>\n<div class='span-8'>\n  <h3 class='label'>Total</h3>\n</div>\n<div class='last span-16'>\n  <div class='total'>"),_.isEmpty(this.groupedInvoices)&&e.push("    <div class='t-right'>\n      <span class='amount nothing'>zero</span>\n    </div>\n    <hr class='space'>"),o=this.groupedInvoices;for(i in o)n=o[i],e.push("    <div class='t-right'>\n      <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n      <span class='amount'>"+t(n.amountTotal().format({sign:"",code:n.first().currency().get("code")}))+"</span>\n    </div>\n    <hr class='space'>");return e.push("  </div>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/logo_uploader"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='logo_bar'>"),null!=this.invoice.logoPath()?i.push("  <img src='"+e(t(this.invoice.logoPath()))+"'>"):"ClientInvoice"!==this.invoice.get("type")||null==window.FormData||Paydirt.user.get("dismissed_notices").add_logo||i.push("  <div class='span-14' id='logo_widget'>\n    <div id='show_logo_fields_container'>\n      <a id='show_logo_fields' href='#'>Add your business's logo</a>\n      <a class='dismiss grey right' href='/settings/notices/dismiss/add_logo' data-remote>hide</a>\n    </div>\n    <div class='hide' id='logo_fields'>\n      <input id='logo' type='file' accept='image/png,image/jpeg,/image/jpg'>\n      <br>\n      <span class='field-desc'>JPG or PNG, max width 769px, max height 300px. Larger images will be resized.</span>\n    </div>\n    <div class='hide' id='logo_preview'>\n      <div id='temporary_logo'></div>\n      <hr>\n      <button id='submit_logo' type='button'>Save Logo</button>\n      &nbsp;&nbsp;or&nbsp;&nbsp;\n      <a class='cancel grey' href='#'>Choose another logo</a>\n    </div>\n  </div>"),i.push("</div>\n<hr class='space'>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/new"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='new_document_autocompleter'>\n  <h4>New Invoice</h4>\n  <select class='autocompleter form-20' id='new_invoice_client_id' data-behaviour='chosen' data-placeholder='Select a client to invoice' data-allow-single_deselect>\n    <option></option>\n    <option value='new' data-html=\"<i class='icon-plus-sign'></i> Add a new client...\">Add a new client...</option>"),Paydirt.clients.active().each(function(n){return i.push("    <option value='"+e(t(n.id))+"' data-html='"+e(t(n.badge()))+" "+e(t(n.get("business_name")))+"'>"+t(n.get("business_name"))+"</option>"),""}),i.push("  </select>\n  <a class='action' href='#' data-onclick='showInvoiceBuilder'>\n    Select Tasks &amp; Expenses\n  </a>\n  <span class='or'>or</span>\n  <a class='action' href='#' data-onclick='draftBlankInvoice'>\n    Draft Blank Invoice\n  </a>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/page"]=function(t){return function(){var t,e,i;
return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='"+e(t("RecurringInvoice"===this.invoice.get("type")?"template":void 0))+"' id='invoice-page'>"),"RecurringInvoice"===this.invoice.get("type")&&i.push("  <div class='template-border'>RECURRING &bull; INVOICE &bull; TEMPLATE</div>\n  <div class='bottom template-border'>RECURRING &bull; INVOICE &bull; TEMPLATE</div>"),i.push("  <i class='icon-refresh icon-spin spinner'></i>\n  <div class='overlays'>\n    <div class='"+["draft",""+e(t("draft"===this.invoice.state()?"current":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      &nbsp;\n    </div>\n    <div class='"+["sent",""+e(t("sent"===this.invoice.state()?"current":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      &nbsp;\n    </div>\n    <div class='"+["overdue",""+e(t("overdue"===this.invoice.state()?"current":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      &nbsp;\n    </div>\n    <div class='"+["paid",""+e(t("paid"===this.invoice.state()?"current":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      &nbsp;\n    </div>\n  </div>\n  <div id='invoice_contents'></div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/paid"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>\n        <a href='"+e(t(Paydirt.Routes.invoices()))+"' data-behaviour='backbone_link'>Invoices </a>\n        <i class='icon-angle-right'></i>\n        Paid\n      </h1>\n    </div>\n  </div>\n  <div class='page-links'>\n    <div class='container'>\n      <a class='action' href='#' data-onclick='toggleInvoiceBuilder'>New Invoice</a>\n    </div>\n  </div>\n  <div class='action-bar new_invoice'>\n    <div class='container'>\n      <div class='new_invoice_button'></div>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div class='secondary_navigation'>\n        <a href='/invoices' data-behaviour='backbone_link'>Current</a>\n        <a href='/invoices/paid' data-behaviour='backbone_link'>Paid</a>\n        <a href='/invoices/all' data-behaviour='backbone_link'>All</a>\n        <a href='/invoices/recurring' data-behaviour='backbone_link'>Recurring</a>\n      </div>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <div class='invoice_browser'></div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/recurring"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>\n        <a href='"+e(t(Paydirt.Routes.invoices()))+"' data-behaviour='backbone_link'>Invoices </a>\n        <i class='icon-angle-right'></i>\n        Recurring invoices\n      </h1>\n    </div>\n  </div>\n  <div class='page-links'>\n    <div class='container'>\n      <a class='action' href='#' data-onclick='showRecurringInvoiceModal'>Create a Recurring Invoice</a>\n    </div>\n  </div>\n  <div class='action-bar new_invoice'>\n    <div class='container'>\n      <div class='new_invoice_button'></div>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div class='secondary_navigation'>\n        <a href='/invoices' data-behaviour='backbone_link'>Current</a>\n        <a href='/invoices/paid' data-behaviour='backbone_link'>Paid</a>\n        <a href='/invoices/all' data-behaviour='backbone_link'>All</a>\n        <a href='/invoices/recurring' data-behaviour='backbone_link'>Recurring</a>\n      </div>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>"),Paydirt.user.get("dismissed_notices").about_recurring||i.push("    <div class='box empty t-center'>\n      <h2>Do you bill your clients at regular intervals?</h2>\n      <p>With Recurring Invoices you can automatically generate invoices according to a schedule. When a new invoice is generated we'll email you to let you know. </p>\n      <p>\n        You'll have a chance to review and edit the drafted invoice before sending it to your client. Generated invoices are \n        <u>not</u>\n        sent to your client automatically.\n      </p>\n      <p>\n        <a class='button_link dismiss grey' href='/settings/notices/dismiss/about_recurring' data-remote>Ok, got it!</a>\n      </p>\n    </div>"),i.push("    <div class='current_invoices_list'></div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/show"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>\n        <a href='/invoices' data-behaviour='backbone_link'>Invoices </a>\n        <i class='icon-angle-right'></i>"),i.push("        "+t(Paydirt.invoice.formattedNumber())),i.push("      </h1>\n    </div>\n  </div>\n  <div class='page-links sml'>\n    <div class='container'>\n      <div class='action-group'>\n        <a class='action' href='"+e(t(Paydirt.Routes.print_invoice(this.invoice.id)))+"' target='_blank'>\n          <i class='icon-print'></i>\n          Print\n        </a>\n        <a class='action' href='"+e(t(Paydirt.Routes.invoice(this.invoice.id)))+".pdf' target='_blank'>\n          <i class='icon-download-alt'></i>\n          Get PDF\n        </a>\n        <a class='action' href='"+e(t(Paydirt.Routes.public_invoice(this.invoice.id,this.invoice.get("private_id"))))+"' target='_blank'>\n          <b>$</b>\n          Payment Page\n        </a>\n      </div>\n      <a class='action' href='"+e(t(Paydirt.Routes.blocks({range:"all-time",invoice:this.invoice.id})))+"' data-behaviour='backbone_link'>\n        <i class='icon-time'></i>\n        Billed Time\n      </a>\n      <a class='action' id='duplicate_invoice' href='#'>\n        <i class='icon-copy'></i>\n        Duplicate\n      </a>\n      <a class='action' id='delete_invoice' href='#' data-confirm='Are you sure you want to permanently delete this invoice?<br/><br/>Everything will go back to how it was before the invoice was created: all the work it contains will be marked as unbilled again.' data-cancel-text=\"No, don't delete it\" data-confirm-text='Yes, delete invoice'>\n        <i class='icon-remove-sign'></i>\n        Delete\n      </a>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div id='show_edit_links'></div>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <div class='span-18' id='invoice_page_container'></div>\n    <div class='last span-6'>\n      <div id='invoice-options'>\n        <div id='email_button'></div>\n        <hr class='double'>\n        <div id='invoice_payments_settings_container'></div>\n        <div id='invoice_payments_container'></div>\n        <hr class='space'>\n        <div id='invoice_activity_container'></div>\n      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/show_edit_links"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='secondary_navigation'>\n  <a class='"+e(t("show"===this.mode?"selected":void 0))+"' href='"+e(t(Paydirt.Routes.invoice(this.model.id)))+"' data-behaviour='backbone_link'>\n    Manage Invoice\n  </a>"),i.push(this.model.payments.length>0?"  <a class='"+["tooltip","disabled",""+e(t("edit"===this.mode?"selected":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' href='#' title=\"You can't edit this invoice because payments have been added to it\" data-tooltip-gravity='ne'>\n    <i class='icon-pencil'></i>\n    Edit Invoice\n  </a>":this.model.get("sent")?"  <a class='edit_sent_invoice' href='#' data-confirm=\"You can edit this invoice, but you've already marked it as sent. Editing it will convert it back to a draft. Want to go ahead?\" data-cancel-text=\"No, don't edit\" data-confirm-text='Yes, edit it' data-class='"+e(t("edit"===this.mode?"selected":void 0))+"'>\n    <i class='icon-pencil'></i>\n    Edit Invoice\n  </a>":"  <a class='"+["edit_invoice",""+e(t("edit"===this.mode?"selected":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' href='"+e(t(Paydirt.Routes.edit_invoice(this.model.id)))+"' data-behaviour='backbone_link'>\n    <i class='icon-pencil'></i>\n    Edit Invoice\n  </a>"),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/show_edit_links_recurring"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='secondary_navigation'>\n  <a class='"+e(t("show"===this.mode?"selected":void 0))+"' href='"+e(t(Paydirt.Routes.recurring_invoice(this.model.id)))+"' data-behaviour='backbone_link'>\n    Preview Invoice\n  </a>\n  <a class='"+e(t("edit_schedule"===this.mode?"selected":void 0))+"' href='"+e(t(Paydirt.Routes.schedule_recurring_invoice(this.model.id)))+"' data-behaviour='backbone_link'>\n    Schedule\n  </a>\n  <a class='"+["edit_invoice",""+e(t("edit"===this.mode?"selected":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' href='"+e(t(Paydirt.Routes.edit_recurring_invoice(this.model.id)))+"' data-behaviour='backbone_link'>\n    <i class='icon-pencil'></i>\n    Edit Template\n  </a>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["invoices/show_recurring"]=function(t){return function(){var t,e;return t=window.HAML.cleanValue,e=[],e.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <span class='disabled label' data-bind='classes:{enabled:enabled, disabled:not(enabled)}, text:select(enabled, \"enabled\", \"disabled\")'></span>\n      <h1>\n        <a href='/invoices/recurring' data-behaviour='backbone_link'>Recurring Invoices </a>\n        <i class='icon-angle-right'></i>"),e.push("        "+t(Paydirt.invoice.formattedNumber())),e.push("      </h1>\n    </div>\n  </div>\n  <div class='page-links sml'>\n    <div class='container'>\n      <a class='action' href='#' data-onconfirm='deleteInvoice' data-confirm='Are you sure you want to permanently delete this recurring invoice?<br /><br />Deleting this recurring invoice will not delete any invoices that have been generated from it.' data-cancel-text=\"No, don't delete it\" data-confirm-text='Yes, delete invoice'>\n        <i class='icon-remove-sign'></i>\n        Delete\n      </a>\n      <a class='action' data-bind='toggle:not(enabled)' data-onclick='enableRecurring'>Enable Recurring Invoice</a>\n      <a class='action' data-bind='toggle:enabled' data-onclick='disableRecurring'>Disable Recurring Invoice</a>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div id='show_edit_links'>"),e.push("        "+t(Paydirt.Templates["invoices/show_edit_links_recurring"]({model:this.model,mode:"show"}))),e.push("      </div>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <div class='span-18' id='invoice_page_container'></div>\n    <div class='last span-6'>\n      <div id='invoice-options'>\n        <div class='box settings solo t-center'></div>\n        <a class='action massive' href='#' data-onclick='duplicateRecurringInvoice'>Generate an invoice now</a>\n      </div>\n    </div>\n  </div>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["jobs/edit"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<form class='backbone job_form' data-behaviour='validate' data-onvalid='submitJob'>\n  <div class='values'>\n    <div class='span-14'>\n      <input type='text' name='name' tabindex='"+e(t(1))+"' autofocus placeholder='Task Name' data-bind='value:name' data-validates-presence>\n      <div class='add-estimate' data-bind='toggle:none(estimate,add_estimate)'>\n        <a href='#' data-onclick='addEstimate'>+ Add a time estimate</a>\n      </div>\n      <div class='estimate-fields' data-bind='toggle:any(estimate,add_estimate)'>\n        <div class='clearfix'>\n          <span class='grey'>Estimate</span>\n          <input class='form-5' type='text' name='estimate' data-bind='value:formattedEstimate' tabindex='"+e(t(4))+"'>\n          <span class='grey'>hours</span>\n          &nbsp;\n          <a href='#' data-onclick='removeEstimate' data-behaviour='tooltip' data-tooltip-gravity='w' title='Remove estimate' tabindex='"+e(t(-1))+"'>\n            <i class='icon-remove-sign'></i>\n          </a>\n        </div>\n      </div>\n    </div>\n    <div class='span-7'>\n      <div class='right'>\n        <input class='form-5' type='text' name='price' tabindex='"+e(t(2))+"' data-bind='value:formattedPrice,toggle:showJobPrice'>\n        <div class='btn-group price-type-select'>\n          <a class='btn dropdown-toggle' href='#' tabindex='"+e(t(3))+"' data-toggle='dropdown'>\n            <span data-bind='text:humanPriceType'></span>\n            &nbsp;\n            <i class='icon-caret-down'></i>\n          </a>\n          <ul class='dropdown-menu'>\n            <li data-bind='classes:{selected:equal(price_type,3)}'>\n              <a href='#' data-onclick='changePriceType' data-price-type='"+e(t(3))+"'>\n                <i class='icon-ok'></i>\n                Client rate ("+this.model.client().get("hourly_rate").format()+" /hr)\n                <br>\n                <small class='explanation'>Time logged is billable at <b>this client's hourly rate</b>.</small>\n              </a>\n            </li>\n            <li class='divider'></li>\n            <li data-bind='classes:{selected:equal(price_type,0)}'>\n              <a href='#' data-onclick='changePriceType' data-price-type='"+e(t(0))+"'>\n                <i class='icon-ok'></i>\n                Custom hourly rate\n                <br>\n                <small class='explanation'>Time logged is billable at <b>the hourly rate you choose</b> for this particular task.</small>\n              </a>\n            </li>\n            <li class='divider'></li>\n            <li data-bind='classes:{selected:equal(price_type,2)}'>\n              <a href='#' data-onclick='changePriceType' data-price-type='"+e(t(2))+"'>\n                <i class='icon-ok'></i>\n                User hourly rate\n                <br>\n                <small class='explanation'>Time logged is billable at each <b>user's own hourly rate</b>.</small>\n              </a>\n            </li>\n            <li class='divider'></li>\n            <li data-bind='classes:{selected:equal(price_type,1)}'>\n              <a href='#' data-onclick='changePriceType' data-price-type='"+e(t(1))+"'>\n                <i class='icon-ok'></i>\n                Fixed price\n                <br>\n                <small class='explanation'>A <b>fixed dollar amount</b> for the task, regardless of the amount of time logged. Time logged is <b>not billable</b>.</small>\n              </a>\n            </li>\n            <li class='divider'></li>\n            <li data-bind='classes:{selected:equal(price_type,4)}'>\n              <a href='#' data-onclick='changePriceType' data-price-type='"+e(t(4))+"'>\n                <i class='icon-ok'></i>\n                Not billable\n                <br>\n                <small class='explanation'>Time logged is <b>not billable</b>.</small>\n              </a>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n    <div class='last span-3'>\n      <div class='right'>\n        <input type='submit' value='Save' tabindex='"+e(t(5))+"'>\n        <br>\n        or\n        <a class='cancel' href='#' tabindex='"+e(t(6))+"' data-onclick='cancelJobEdit'>cancel</a>\n      </div>\n    </div>\n  </div>\n</form>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["jobs/invoice_fields"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='job_fields' data-bind='classes:{\"selected\":selected}'>\n  <div class='clickable' data-onclick='toggleSelected'>\n    <h3 class='job_name' data-bind='text:name'></h3>\n    <div class='checkbox_container'>\n      <i class='icon-check-empty' data-bind='toggle:not(selected)'></i>\n      <i class='icon-check' data-bind='toggle:selected'></i>\n      <input class='hide invoice_job_checkbox' type='checkbox' data-bind='checked:selected' data-onchange='showPreview' data-job-id='"+e(t(this.model.id))+"'>\n    </div>\n  </div>\n  <div class='unbilled-value'>\n    <div data-bind='toggle:fixedPrice'>\n      <p data-bind='toggle:selected'>\n        Bill\n        &nbsp;\n        <input class='amount_to_invoice currency_input' type='text' data-onchange='setAmountToInvoice,showPreview' data-bind='attr:{value:amount_to_invoice}' data-currency-sign='"+e(t(this.model.client().currency().get("sign")))+"'>\n        &nbsp;\n        in this invoice\n      </p>\n      <p data-bind='toggle:unbilled_duration'>\n        Plus"),i.push("        "+t(Paydirt.Formatters.currency(this.model.get("unbilled_hourly_value")))),i.push("        unbilled at hourly rates\n      </p>\n    </div>\n    <div>\n      <div data-bind='toggle:unbilled_value'>\n        <span class='currency'>"+t(this.model.client().currency().get("sign"))+"</span>\n        <span class='amount' data-bind='text:unbilled_value'></span>\n        <br>\n        unbilled\n        <i class='icon-question-sign' title='before rounding' data-behaviour='tooltip' data-tooltip-gravity='ne' data-bind='toggle:any(perHour,perUser)'></i>\n      </div>\n      <div data-bind='toggle:all(fixedPrice,unbilled_duration)'>\n        <span class='currency'>"+t(this.model.client().currency().get("sign"))+"</span>\n        <span class='amount' data-bind='text:unbilled_value'></span>\n        <br>\n        <span data-bind='text:formattedUnbilledDuration'></span>\n        billable hours unbilled\n      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["jobs/list"]=function(t){return function(){var t,e;return t=window.HAML.cleanValue,e=[],e.push("<div>\n  <div class='jobs-list' data-bind='collection:$childCollection, classes:{paginated:collectionIsPaginated}'></div>\n  <div class='show-all-jobs' data-bind='toggle:collectionIsPaginated'>\n    <a href='#' data-onclick='showAllJobs'>\n      Show all\n      <span data-bind='text:fullCollectionSize'></span>\n      tasks\n    </a>\n  </div>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["jobs/show"]=function(t){return function(){var t,e,i,n;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='job-box' data-bind='toggle:not(editing),classes:{completed:completed}'>\n  <div class='job_details'>\n    <div class='btn-group job-dropdown pull-right'>\n      <a class='btn dropdown-toggle' href='#' data-toggle='dropdown'>\n        <i class='icon-caret-down'></i>\n      </a>\n      <ul class='dropdown-menu'>\n        <li>\n          <a href='#' data-onclick='editJob'>\n            <i class='icon-pencil'></i>\n            Edit\n          </a>\n        </li>\n        <li data-bind='toggle:completed'>\n          <a href='#' data-onclick='markCurrent'>\n            <i class='icon-check'></i>\n            Mark current\n          </a>\n        </li>\n        <li data-bind='toggle:not(completed)'>\n          <a href='#' data-onclick='logTime'>\n            <i class='icon-plus-sign-alt'></i>\n            Add a time log\n          </a>\n        </li>\n        <li data-bind='toggle:not(completed)'>\n          <a href='#' data-onclick='startTimer'>\n            <i class='icon-time'></i>\n            Start a timer\n          </a>\n        </li>\n        <li data-bind='toggle:not(completed)'>\n          <a href='#' data-onclick='markComplete'>\n            <i class='icon-check'></i>\n            Mark complete\n          </a>\n        </li>\n        <li data-bind='toggle:all(hasAssignments,not(completed))'>\n          <a href='#' data-onclick='toggleUserAssignmentsWidget'>\n            <i class='icon-user'></i>\n            Assign users\n          </a>\n        </li>"),(null!=(n=this.model.get("trello_card_id"))?n.length:void 0)>0?i.push("        <li class='divider'></li>\n        <li>\n          <a target='_blank' href='"+e(t(Paydirt.Routes.trello_card(this.model.get("trello_card_id"))))+"'>\n            <i class='icon-eye-open'></i>\n            View Trello card\n          </a>\n        </li>"):null!=this.model.get("basecamp_todo_id")?i.push("        <li class='divider'></li>\n        <li>\n          <a target='_blank' href='"+e(t(Paydirt.Routes.basecamp_todo(this.model.project().get("basecamp_account_id"),this.model.project().get("basecamp_project_id"),this.model.get("basecamp_todo_id"))))+"'>\n            <i class='icon-eye-open'></i>\n            View Basecamp Todo\n          </a>\n        </li>"):null!=this.model.get("redbooth_task_id")&&i.push("        <li class='divider'></li>\n        <li>\n          <a target='_blank' href='"+e(t(Paydirt.Routes.redbooth_task(this.model.project().get("redbooth_project_id"),this.model.get("redbooth_task_id"))))+"'>\n            <i class='icon-eye-open'></i>\n            View Redbooth Task\n          </a>\n        </li>"),i.push("        <li class='divider'></li>\n        <li>\n          <a href='#' data-onconfirm='destroyJob' data-confirm='Are you sure you want to delete this task? This will also remove all time logged towards it.' data-cancel-text=\"No, don't delete it\" data-confirm-text='Yes, delete this task'>\n            <i class='icon-remove-sign'></i>\n            Delete\n          </a>\n        </li>\n      </ul>\n    </div>\n    <div class='space-dropdown'>\n      <div class='span-17'>\n        <h3 class='job_name' data-bind='text:name'></h3>\n        <div class='job-metrics'>\n          <a class='job-metric' data-bind=\"attr:{href:format('/time?range=all-time&for=job&id=$1',id)}\" data-behaviour='backbone_link'>\n            <i class='icon-time'></i>\n            &nbsp;\n            <b data-bind='text:formattedTotalDuration'></b>\n            <span class='grey'>hrs logged</span>\n          </a>\n          <span class='separator'>&nbsp;</span>\n          <a class='job-metric' data-bind=\"attr:{href:format('/time?range=all-time&for=job&id=$1&billed=false',id)},classes:{zero:zero(unbilled_duration)}\" data-behaviour='backbone_link'>\n            <b data-bind='text:formattedUnbilledDuration'></b>\n            <span class='grey'>hrs unbilled</span>\n          </a>\n          <span class='separator'>&nbsp;</span>\n          <span class='job-metric' data-bind='classes:{zero:zero(unbilled_value)}'>\n            <span data-bind='currencyCounter:formattedUnbilledValue'></span>\n            <span class='grey'>unbilled</span>\n          </span>\n          <span class='separator'>&nbsp;</span>\n          <span class='completed job-metric' data-bind='toggle:completed'>Completed</span>\n        </div>\n      </div>\n      <div class='last span-7'>\n        <div class='job-price-pill' data-bind='html:priceWithPriceType'></div>\n      </div>\n      <div class='job_assignments' data-bind='toggle:showUserAssignments'>\n        <span class='grey'>\n          <i class='icon-user'></i>\n          &nbsp;\n          Assigned\n        </span>\n        <a href='#' data-bind='text:assigneeNames,toggle:not(assignmentsOpen)' data-onclick='toggleUserAssignmentsWidget'></a>\n        <span class='assignments' data-bind='toggle:assignmentsOpen'>\n          <input class='assignments-input' type='hidden' data-behaviour='select2' data-type='user-assignment' data-onchange='toggleAssignment' data-bind='value:assigneeIds'>\n          <button type='button' data-onclick='toggleUserAssignmentsWidget'>done</button>\n        </span>\n      </div>\n    </div>\n    <div class='progress' data-bind='toggle:estimate'>\n      <div class='pbar' data-bind='css:{width:progressPercent},classes:{complete:progressComplete,warning:progressWarning}'>\n        <div class='progress-percent'>\n          <span data-bind='text:progressPercent'></span>\n          of\n          <span data-bind='text:formattedEstimate'></span>\n          hours\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<div class='job-box job-form-container' data-bind='toggle:editing'></div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["line_item_taxes/edit"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<input class='includes_tax' type='checkbox' value='"+e(t(1))+"'>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["line_items/edit"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td>\n  <div class='controls'>\n    <input type='hidden' name='position' value='"+e(t(this.position))+"'>"),i.push("    "+t(Paydirt.Utilities.spriteTag("icons-handle",{"class":"reorder hide"}))),i.push("    <div class='outset_left_container'>"),i.push("      "+t(Paydirt.Utilities.spriteTag("icons-remove",{"class":"remove_line_item"}))),i.push("    </div>\n  </div>\n</td>\n<td>\n  <textarea class='line_item' name='description' rows='1' data-behaviour='autogrow'>"+t(this.description)+"</textarea>\n</td>\n<td>\n  <input class='line_item_quantity form-4' type='text' name='quantity'>\n</td>\n<td class='nowrap'>\n  <input class='form-5 inline line_item_rate' type='text' name='rate'>"),"TimeLineItem"===this.type&&i.push("  <span class='grey'>/ h</span>"),i.push("</td>\n<td class='grey line_item_subtotal nowrap'>\n  <span>"),i.push("    "+t(this.subtotal.format())),i.push("  </span>\n</td>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates.notification=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='"+["box","modal",""+e(t(this.cssClass))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <div class='content'>"),null!=this.icon&&i.push("    <div class='notification-icon'>"+t(this.icon)+"</div>"),null!=this.heading&&i.push("    <h2>"+t(this.heading)+"</h2>"),null!=this.message&&i.push("    <p>"+t(this.message)+"</p>"),i.push("  </div>"),(this.confirm||this.decline)&&(i.push("  <div class='actions'>\n    <div class='span-10'>"),this.decline&&i.push("      <span class='decline' data-onclick='decline'>"+t(this.decline)+"</span>"),i.push("    </div>\n    <div class='last span-14 t-right'>"),this.confirm&&i.push("      <span class='action' data-onclick='confirm'>"+t(this.confirm)+"</span>"),i.push("    </div>\n  </div>")),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates.page_not_found=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>That page could not be loaded</h1>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <div class='box'>\n      <p>Sorry - we can't find the page you're looking for, or you don't have permission to access it.</p>\n      <p>If you're having trouble using Paydirt, please get in touch by emailing talk@paydirtapp.com and we'll do all we can to help.</p>\n      <p>\n        You might want to\n        <a href='"+e(t(Paydirt.Routes.blocks()))+"'>go back to the Time page</a>\n        .\n      </p>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["preset_line_items/form"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<form class='backbone inline_form'>\n  <div class='span-24'>\n    <div class='span-12'>\n      <textarea name='description' placeholder='Description' data-behaviour='autogrow'>"+t(this.model.get("description"))+"</textarea>\n    </div>\n    <div class='span-6'>\n      <input class='form-5 t-right' type='text' name='rate' value='"+e(t(Paydirt.Formatters.currency(this.model.get("rate"),{sign:""})))+"' placeholder='Unit Price'>\n    </div>\n    <div class='last span-6'>\n      <div class='right'>\n        <a class='cancel' href='#'>Cancel</a>\n        &nbsp;or&nbsp;\n        <input type='submit' value='Save'>\n      </div>\n    </div>\n  </div>\n</form>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["preset_line_items/index"]=function(t){return function(){var t;return t=[],t.push("<div class='box settings top'>\n  <div class='clearfix title'>\n    <a class='add right' id='add_preset_line_item' href='#'>Add a Preset Line Item</a>\n    <h2>Preset Line Items</h2>\n  </div>\n  <div class='info setting_description'>\n    <p>Save commonly used line items and add them to your Quotes &amp; Invoices in a click.</p>\n  </div>\n  <div class='clearfix fifteen pad'>\n    <div class='clearfix'>\n      <div class='span-12'>\n        <label>Description</label>\n      </div>\n      <div class='span-6'>\n        <label>Unit Price</label>\n      </div>\n      <div class='last span-6'></div>\n    </div>\n    <hr class='both'>\n    <div class='row-items' id='preset_line_items'>\n      <div class='empty hide'>\n        <p>Your account doesn't have any preset line items.</p>\n      </div>\n    </div>\n    <div id='preset_line_items_form'></div>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")
}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["preset_line_items/show"]=function(t){return function(){var t,e;return t=window.HAML.cleanValue,e=[],e.push("<div class='span-12'>"),e.push("  "+t(marked(this.model.get("description"),{sanitize:!0}))),e.push("</div>\n<div class='span-6'>"),e.push("  "+t(Paydirt.Formatters.currency(this.model.get("rate"),{sign:""}))),e.push("</div>\n<div class='last span-6'>\n  <div class='right'>\n    <a class='edit_link' href='#'>\n      <i class='icon-pencil'></i>\n    </a>\n    &nbsp;&nbsp;&nbsp;\n    <a class='delete' href='#'>&times;</a>\n  </div>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["projects/import"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='box clearfix modal' style='width: 450px;'>\n  <div class='modal-title'>\n    <h2>Import "+(this.extension?"this":"a")+" "+this.importTarget+"</h2>\n  </div>\n  <div class='content'>\n    <div class='hide' id='project-form'>"),null==this.client_id&&(i.push("      <div id='client-select'>\n        <p>You don't have a Paydirt project associated with this "+this.importTarget+". Lets create one now.</p>\n        <label for='client-id'>Select a client</label>\n        <select class='fullwidth' name='client-id'>"),Paydirt.clients.each(function(n){return i.push("          <option value='"+e(t(n.id))+"'>"+t(n.get("business_name"))+"</option>"),""}),i.push("        </select>\n      </div>\n      <hr class='microspace'>")),null==this.project_id&&i.push("      <div id='project-select'>\n        <hr class='clear space'>\n        <label for='project-id'>"+this.importTarget+" to import</label>\n        <select class='fullwidth' name='project-id'></select>\n      </div>\n      <hr class='microspace'>"),i.push("      <div id='sync-options'></div>\n    </div>\n    <div class='hide notice' id='project-progress'>\n      <div class='right'>\n        <i class='icon-refresh icon-spin' state='loading'></i>\n        <b class='hide' state='success'>done!</b>\n      </div>\n      <span class='progress-message'></span>\n    </div>\n    <div class='error hide' id='project-error'>\n      <i class='icon-remove-sign'></i>\n      <span id='error-message'></span>\n      <br>\n      <a href='#' data-onclick='reset'>Try again</a>\n    </div>\n  </div>\n  <div class='actions'>\n    <div class='span-10'>\n      <span class='decline' data-onclick='close'>cancel</span>\n    </div>\n    <div class='last span-14 t-right'>\n      <button class='arrow button_link' id='submit-button' data-onclick='submitProjectId'>Import "+this.importTarget+"</button>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["projects/invoice_fields"]=function(t){return function(){var t,e;return t=window.HAML.escape,e=[],e.push("<div class='project_container'>\n  <h2 class='project-name' data-bind='text:name'></h2>\n  <hr class='nomargin space'>\n  <div class='jobs-list'></div>\n  <div class='expenses-list'></div>\n  <div class='component-empty-state' data-bind='toggle:none(length($jobs),length($expenses))'>\n    No unbilled tasks or expenses\n  </div>\n</div>"),e.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["projects/show"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='manage-project' data-bind=\"attr:{'data-project-id':id},classes:{completed:completed,contracted:not(showDetails)}\">\n  <div class='project-details'>\n    <div class='project-show' data-bind='toggle:not(editing)'>\n      <div class='project-head'>\n        <div class='pull-right'>\n          <div class='btn-group pull-right'>\n            <a class='btn dropdown-toggle' href='#' data-toggle='dropdown'>\n              <i class='icon-caret-down'></i>\n            </a>\n            <ul class='dropdown-menu'>\n              <li>\n                <a href='#' data-onclick='editProject'>\n                  <i class='icon-pencil'></i>\n                  Edit\n                </a>\n              </li>\n              <li>\n                <a href='"+e(t(Paydirt.Routes.client_invoices_new(this.model.client().id,this.model.id)))+"' data-behaviour='backbone_link'>\n                  <i class='icon-file-alt'></i>\n                  Draft an Invoice\n                </a>\n              </li>\n              <li data-bind='toggle:completed'>\n                <a href='#' data-onclick='markProjectCurrent'>\n                  <i class='icon-check'></i>\n                  Mark current\n                </a>\n              </li>\n              <li data-bind='toggle:not(showDetails)'>\n                <a href='#' data-onclick='showProjectDetails'>\n                  <i class='icon-angle-down'></i>\n                  Show details\n                </a>\n              </li>\n              <li data-bind='toggle:not(completed)'>\n                <a href='#' data-onclick='markProjectComplete'>\n                  <i class='icon-check'></i>\n                  Mark complete\n                </a>\n              </li>\n              <li data-bind='toggle:showDetails'>\n                <a href='#' data-onclick='hideProjectDetails'>\n                  <i class='icon-angle-up'></i>\n                  Hide details\n                </a>\n              </li>"),this.model.integrationServiceName()&&i.push("              <li class='divider'></li>\n              <li>\n                <a href='#' data-onclick='syncWithIntegration'>\n                  <i class='icon-refresh'></i>\n                  Sync with "+this.model.integrationServiceName()+"\n                </a>\n              </li>"),i.push("              <li class='divider'></li>\n              <li>\n                <a href='#' data-onconfirm='destroyProject' data-confirm='Deleting this project will also remove all tasks, expenses, and time logged towards it. Are you sure you want to do that?' data-cancel-text=\"No, don't delete it\" data-confirm-text='Yes, delete project'>\n                  <i class='icon-remove-sign'></i>\n                  Delete\n                </a>\n              </li>\n            </ul>\n          </div>\n        </div>\n        <h1 class='clickable project-name' data-onclick='toggleProjectDetails'>\n          <span data-bind='text:name'></span>\n          <span class='completed' data-bind='toggle:completed'>\n            <i class='icon-ok'></i>\n            Completed\n          </span>\n        </h1>\n        <div class='grey'>\n          Has\n          <span data-bind=\"text:pluralize($jobs, 'task')\"></span>\n          and\n          <span data-bind=\"text:pluralize($expenses, 'expense')\">\x92\x91</span>\n          &nbsp;\n          <i class='icon-caret-right'></i>\n          &nbsp;\n          <b data-bind='toggle:nonZero(unbilled_value)'>"),i.push("            "+t(this.model.client().currency().get("sign"))),i.push("            \x91<span data-bind='currencyCounter:unbilled_value'></span>\x92\n            &nbsp;\n            unbilled\n            &nbsp;\n            <i class='icon-caret-right'></i>\n            &nbsp;\n            <a href='"+e(t(Paydirt.Routes.client_invoices_new(this.model.client().id,this.model.id)))+"' data-behaviour='backbone_link'>\n              Draft an Invoice\n            </a>\n          </b>\n          <b data-bind='toggle:not(nonZero(unbilled_value))'>\n            Fully billed\n          </b>"),this.model.get("trello_board_id")?i.push("          &nbsp;\n          <i class='icon-caret-right'></i>\n          &nbsp;\n          Linked to a\n          <a href='"+e(t(Paydirt.Routes.trello_board(this.model.get("trello_board_id"))))+"' target='_blank'>\n            Trello Board\n          </a>"):this.model.get("basecamp_project_id")?i.push("          &nbsp;\n          <i class='icon-caret-right'></i>\n          &nbsp;\n          Linked to a\n          <a href='"+e(t(Paydirt.Routes.basecamp_project(this.model.get("basecamp_account_id"),this.model.get("basecamp_project_id"))))+"' target='_blank'>Basecamp Project</a>"):this.model.get("redbooth_project_id")&&i.push("          &nbsp;\n          <i class='icon-caret-right'></i>\n          &nbsp;\n          Linked to a\n          <a href='"+e(t(Paydirt.Routes.redbooth_project(this.model.get("redbooth_project_id"))))+"' target='_blank'>Redbooth Project</a>"),(this.model.get("trello_board_id")||this.model.get("redbooth_project_id")||this.model.get("basecamp_project_id"))&&i.push("          &nbsp;\n          <i class='icon-caret-right'></i>\n          &nbsp;\n          <a href='#' data-onclick='showSyncOptions'>"+this.model.integrationServiceName()+" Options</a>\n          &nbsp;\n          <i class='icon-caret-right'></i>\n          &nbsp;\n          <a href='#' data-onclick='syncWithIntegration'>Sync Now</a>"),i.push("        </div>\n      </div>\n    </div>\n    <div class='project-edit' data-bind='toggle:editing'>\n      <form class='backbone inline_form project_form' data-behaviour='validate' data-onvalid='saveProject'>\n        <div class='span-11'>\n          <input type='text' name='name' placeholder='Project name' data-bind='value:name' data-validates-presence autofocus>\n        </div>\n        <div class='right'>\n          <a class='cancel' href='#' data-onclick='cancelEditProject'>Cancel</a>\n          &nbsp;\n          or\n          &nbsp;\n          <input type='submit' value='Save'>\n        </div>\n      </form>\n    </div>\n  </div>\n  <div class='project-contents span-24'>\n    <div class='span-16'>\n      <div class='section'>\n        <h2>Tasks</h2>\n        <div class='right'>\n          <a class='add add_job' href='#' data-onclick='addJob'>Add</a>\n        </div>\n      </div>\n      <div class='component-empty-state' data-bind='toggle:not(length($jobs))'>\n        Add a task to log time for\n        <span data-bind='text:name'></span>\n      </div>\n      <div>\n        <div class='jobs-list-container'></div>\n        <div class='task-summary' data-bind='toggle:length($jobs)'>\n          <div class='span-15'>\n            <h3 class='label right'>Total</h3>\n          </div>\n          <div class='last span-9'>\n            <div class='job-totals'>\n              <div class='summary-totals'>\n                <div class='span-12 summary-total'>\n                  <span class='amount' data-bind='text:formattedTotalDuration'></span>\n                  <br>\n                  <span class='grey'>hours worked</span>\n                </div>\n                <div class='last span-12 summary-total'>\n                  <span class='currency'>"+t(this.model.client().currency().get("sign"))+"</span>\n                  <span class='amount' data-bind='currencyCounter:jobs_unbilled_value'></span>\n                  <br>\n                  <span class='grey'>unbilled</span>\n                </div>\n              </div>\n              <div class='progress' data-bind='toggle:has_estimate'>\n                <div class='pbar' data-bind='css:{width:progressPercent},classes:{complete:progressComplete}'>\n                  <div class='progress-percent' data-bind='text:humanProgressDescription'></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class='last span-8'>\n      <div class='section'>\n        <h2>Expenses</h2>\n        <div class='right'>\n          <a class='add' href='#' data-onclick='addExpense'>Add</a>\n        </div>\n      </div>\n      <div data-bind='toggle:length($expenses)'>\n        <div class='expenses-list'></div>\n        <div class='expenses-summary'>\n          <div class='span-15'>\n            <h3 class='label right'>Total</h3>\n          </div>\n          <div class='last span-9'>\n            <div class='expenses-totals'>\n              <div class='summary-totals'>\n                <div class='summary-total'>\n                  <span class='currency'>"+t(this.model.client().currency().get("sign"))+"</span>\n                  <span class='amount' data-bind='currencyCounter:expenses_unbilled_value'></span>\n                  <br>\n                  <span class='grey'>unbilled</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class='component-empty-state' data-bind='toggle:not(length($expenses))'>\n        No expenses logged.\n      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["projects/sync_options"]=function(t){return function(){var t;return t=[],t.push("<div class='box clearfix modal' style='width: 450px;'>\n  <div class='modal-title'>\n    <h2>"+this.model.integrationServiceName()+" options for this project</h2>\n  </div>\n  <div class='content'>\n    <div id='sync-options'></div>\n  </div>\n  <div class='actions'>\n    <div class='span-10'>\n      <span class='decline' data-onclick='close'>cancel</span>\n    </div>\n    <div class='last span-14 t-right'>\n      <button class='arrow button_link' id='submit-button' data-onclick='submitOptions'>Save Options</button>\n    </div>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["projects/sync_options_fields"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='project-sync-options'>\n  <div class='sync-option-description'>\n    <label>Import all "+this.jobName+"s?</label>\n  </div>\n  <div class='sync-option'>\n    <label for='import-true'>\n      <input id='import-true' type='radio' name='import-jobs' value='1' data-bind='isChecked:import_jobs'>\n      Yes\n      <span class='field-desc'>\n        import all of the "+this.jobName+"s each time I sync\n      </span>\n    </label>\n    <label for='import-false'>\n      <input id='import-false' type='radio' name='import-jobs' value='0' data-bind='isChecked:not(import_jobs)'>\n      No\n      <span class='field-desc'>\n        only import the "+this.jobName+"s I log time for in "+this.importServiceName+"\n      </span>\n    </label>\n  </div>\n  <div class='sync-option-description'>\n    <label>Keep completeness in sync?</label>\n  </div>\n  <div class='sync-option'>\n    <label for='accept-completeness-true'>\n      <input id='accept-completeness-true' type='radio' name='accept-completeness' value='1' data-bind='isChecked:accept_completeness'>\n      Yes\n      <span class='field-desc'>\n        sync tasks' completeness from the "+this.importTarget+"\n      </span>\n    </label>\n    <label for='accept-completeness-false'>\n      <input id='accept-completeness-false' type='radio' name='accept-completeness' value='0' data-bind='isChecked:not(accept_completeness)'>\n      No\n      <span class='field-desc'>\n        don't mark Paydirt tasks as complete\n      </span>\n    </label>\n  </div>\n  <div class='sync-option-description'>\n    <label>By default, how should imported tasks be billed?</label>\n    <span class='field-desc'>Select a default pricing for imported tasks. You can change the pricing of individual tasks if you need to.</span>\n  </div>\n  <div class='sync-option'>\n    <select name='default-price-type' data-bind='value:default_price_type'>\n      <option value='"+e(t(3))+"'>\n        At the client's hourly rate\n      </option>\n      <option value='"+e(t(2))+"'>\n        At each user's own hourly rate\n      </option>\n      <option value='"+e(t(4))+"'>\n        Time is not billable\n      </option>\n    </select>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/browser"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='span-17'>\n  <div class='box clearfix filter' id='invoice_browser_controls'>\n    <div class='span-24' id='filters_row'>\n      <div class='change_period item'>\n        <a id='previous' href='#'>\n          <span>&nbsp;</span>\n        </a>\n      </div>\n      <div class='item'>\n        <select class='form-7 left' id='date_range_type' data-behaviour='chosen'>\n          <option value='30-days'>30 Days</option>\n          <option value='custom'>Custom</option>\n          <option value='all-time'>All Time</option>\n        </select>\n      </div>\n      <div class='item'>\n        <div class='left' id='date_fields'>\n          <div class='item label'>from</div>\n          <div class='item'>\n            <input class='datepicker' id='start_date' type='text'>\n          </div>\n          <div class='item label'>to</div>\n          <div class='item'>\n            <input class='datepicker' id='end_date' type='text'>\n          </div>\n        </div>\n      </div>\n      <div class='change_period item'>\n        <a id='next' href='#'>\n          <span>&nbsp;</span>\n        </a>\n      </div>\n      <div class='item label right'>\n        <a class='grey' id='toggle_advanced_search' href='#'>Advanced search</a>\n      </div>\n    </div>\n    <div class='hide span-24' id='advanced_filters_row'>\n      <div class='item label'>Show quotes for</div>\n      <div class='item'>\n        <select class='form-20' id='autocompleter' data-behaviour='chosen' data-placeholder='Any client' data-allow-single-deselect='true'>\n          <option></option>"),Paydirt.clients.each(function(){return function(n){return i.push("          <option value='client-"+e(t(n.id))+"' data-type='client' data-id='"+e(t(n.id))+"' data-html='"+e(t(n.badge()))+" "+e(t(n.get("business_name")))+"' data-search-text='"+e(t(n.get("business_name")))+"'>"),i.push("            "+t(n.get("business_name"))),i.push("          </option>"),""}}(this)),i.push("        </select>\n      </div>\n      <div class='item label'>that were</div>\n      <div class='item'>\n        <select class='form-8' id='date_criteria' data-behaviour='chosen' data-allow-single-deselect='true'>\n          <option value='issued_at' selected>issued</option>\n          <option value='accepted_at'>accepted</option>\n          <option value='declined_at'>declined</option>\n        </select>\n      </div>\n      <div class='item label'>during this time period.</div>\n    </div>\n  </div>\n  <hr class='space'>\n  <div id='invoice_list'></div>\n  <div id='export_csv'>\n    <a class='action right' href='#' data-onclick='exportCSV'>Download quotes as CSV</a>\n  </div>\n</div>\n<div class='last span-7' id='invoice_browser_summary'></div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/browser_summary"]=function(t){return function(){var t,e,i,n,s,r,a;t=window.HAML.cleanValue,e=[],e.push("<div class='flush_left section'>\n  <h2>Summary</h2>\n</div>\n<hr class='double'>\n<div class='span-8'>\n  <h3 class='label'>Accepted</h3>\n</div>\n<div class='last span-16'>\n  <div class='total'>"),_.isEmpty(this.groupedQuotes)&&e.push("    <div class='t-right'>\n      <span class='amount nothing'>zero</span>\n    </div>"),s=this.groupedQuotes;for(i in s)n=s[i],e.push("    <div class='t-right'>\n      <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n      <span class='amount'>"+t(n.amountAccepted().format({sign:"",code:n.first().currency().get("code")}))+"</span>\n    </div>\n    <hr class='space'>");e.push("    <hr class='space'>\n  </div>\n</div>\n<hr class='clear double'>\n<div class='span-8'>\n  <h3 class='label'>Declined</h3>\n</div>\n<div class='last span-16'>\n  <div class='total'>"),_.isEmpty(this.groupedQuotes)&&e.push("    <div class='t-right'>\n      <span class='amount nothing'>zero</span>\n    </div>"),r=this.groupedQuotes;for(i in r)n=r[i],e.push("    <div class='t-right'>\n      <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n      <span class='amount'>"+t(n.amountDeclined().format({sign:"",code:n.first().currency().get("code")}))+"</span>\n    </div>\n    <hr class='space'>");e.push("    <hr class='space'>\n  </div>\n</div>\n<hr class='clear double'>\n<div class='span-8'>\n  <h3 class='label'>Total</h3>\n</div>\n<div class='last span-16'>\n  <div class='total'>"),_.isEmpty(this.groupedQuotes)&&e.push("    <div class='t-right'>\n      <span class='amount nothing'>zero</span>\n    </div>"),a=this.groupedQuotes;for(i in a)n=a[i],e.push("    <div class='t-right'>\n      <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n      <span class='amount'>"+t(n.amountTotal().format({sign:"",code:n.first().currency().get("code")}))+"</span>\n    </div>\n    <hr class='space'>");return e.push("    <hr class='space'>\n  </div>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/edit_header"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>\n        <a href='"+e(t(Paydirt.Routes.quotes()))+"' data-behaviour='backbone_link'>Quotes</a>\n        <i class='icon-angle-right'></i>\n        <a href='"+e(t(Paydirt.Routes.quotes(this.model.id)))+"' data-behaviour='backbone_link'>"+t(this.model.formattedNumber())+"</a>\n        <i class='icon-angle-right'></i>\n        Edit\n      </h1>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div id='show_edit_links'>"),i.push("        "+t(Paydirt.Templates["quotes/show_edit_links"]({model:this.model,mode:"edit"}))),i.push("      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/edit_header_free"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>\n        Free Quote Template\n        <i class='icon-angle-right'></i>\n        Make a quote to print, or download as a PDF\n      </h1>\n      <p class='left'>\n        Want to send quotes by email, mark them as accepted or declined, and turn them into invoices? Check out our\n        <a href='/features/online-quoting?"+e(t(jQuery.param({utm_source:"pd",utm_medium:"site",utm_campaign:"free_quote_template"})))+"'>online quoting features</a>\n        or \n        <a href='/signup?"+e(t(jQuery.param({utm_source:"pd",utm_medium:"site",utm_campaign:"free_quote_template"})))+"'>start a free trial.</a>\n      </p>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/edit_sidebar"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='follow' id='invoice-controls'>\n  <input class='massive' id='save-invoice' type='submit' value='Save Changes'>\n  <span class='cancel'>\n    or\n    <a class='cancel' href='"+e(t(Paydirt.Routes.quote(this.quote.id)))+"' data-behaviour='backbone_link'>Discard changes</a>\n  </span>\n  <hr class='space'>\n  <div id='invoice-options'>\n    <div class='box settings'>\n      <div class='solo' id='taxes_container'></div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/edit_sidebar_free"]=function(t){return function(){var t,e,i,n,s,r;e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='invoice-controls'>\n  <a class='action massive' href='/free_quote_template/save' data-behaviour='modal'>\n    <i class='icon-save'></i>\n    &nbsp;\n    Save Quote\n  </a>\n  <a class='action massive' href='/free_quote_template/send_by_email' data-behaviour='modal'>\n    <i class='icon-envelope'></i>\n    &nbsp;\n    Send Quote\n  </a>\n  <hr class='space'>\n  <div class='box clearfix dark t-center'>\n    <div class='span-12'>\n      <a id='print_invoice' href='#'>"),i.push("        "+t(Paydirt.Utilities.spriteTag("icons-print"))),i.push("        &nbsp;\n        Print Quote\n      </a>\n    </div>\n    <div class='last span-12'>\n      <a id='download_pdf' href='#'>"),i.push("        "+t(Paydirt.Utilities.spriteTag("icons-pdf"))),i.push("        &nbsp;\n        Download PDF\n      </a>\n    </div>\n  </div>\n  <hr class='space'>\n  <div id='invoice-options'>\n    <div class='box settings'>\n      <div class='top' id='taxes_container'></div>\n      <div class='bottom'>\n        <div class='expandable midset title'>\n          <div class='right'>"+t(Paydirt.Utilities.spriteTag("icons-settings-cog"))+"</div>\n          <h3>Language &amp; Currency</h3>\n        </div>\n        <div class='pad setting ten'>\n          <select id='locale' data-behaviour='chosen' style='width: 230px;'>"),r=Paydirt.locales;for(s in r)n=r[s],i.push("            <option value='"+e(t(s))+"' selected='"+e(t(s===Paydirt.quote.locale()))+"'>"+t(n)+"</option>");return i.push("          </select>\n          <select id='currency_id' data-behaviour='chosen' style='width: 230px;'>"),Paydirt.currencies.each(function(n){return i.push("            <option value='"+e(t(n.id))+"' selected='"+e(t(n.id===Paydirt.quote.currency().id))+"' data-search-text='"+e(t(n.get("code")))+"'>"+t(""+n.get("name")+" ("+n.get("code")+", "+n.get("sign")+")")+"</option>"),""}),i.push("          </select>\n        </div>\n      </div>\n    </div>\n  </div>\n  <hr class='space'>\n  <div id='share-options'>\n    <div class='box settings'>\n      <div class='title'>\n        <h3>Like it? Give us a shout out!</h3>\n      </div>\n      <hr class='space'>\n      <div class='span-3'>&nbsp;</div>\n      <div class='span-6'>\n        <a class='twitter-share-button' href='https://twitter.com/share' data-via='paydirtapp' data-related='paydirtapp' data-count='vertical' data-url='https://paydirtapp.com/free_quote_template'>Tweet</a>\n        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=\"//platform.twitter.com/widgets.js\";fjs.parentNode.insertBefore(js,fjs);}}(document,\"script\",\"twitter-wjs\");</script>\n      </div>\n      <div class='span-6'>\n        <div class='fb-like' data-href='https://paydirtapp.com/free_quote_template' data-send='false' data-layout='box_count' data-width='450' data-show-faces='true' data-font='arial'></div>\n        <div id='fb-root'></div>\n        <script>\n          (function(d, s, id) {\n          var js, fjs = d.getElementsByTagName(s)[0];\n          if (d.getElementById(id)) return;\n          js = d.createElement(s); js.id = id;\n          js.src = \"//connect.facebook.net/en_US/all.js#xfbml=1\";\n          fjs.parentNode.insertBefore(js, fjs);\n          }(document, 'script', 'facebook-jssdk'));\n        </script>\n      </div>\n      <div class='span-6'>\n        <div class='g-plusone' data-size='tall' data-href='https://paydirtapp.com/free_quote_template'></div>\n        <script>\n          (function() {\n          var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;\n          po.src = 'https://apis.google.com/js/plusone.js';\n          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);\n          })();\n        </script>\n      </div>\n      <div class='last span-3'>&nbsp;</div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/email_button"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push(this.quote.get("sent")?"<a class='action massive modal' id='send_remind_link' href='"+e(t(Paydirt.Routes.new_document_email(this.quote.id,"new_quote")))+"'>\n  <i class='icon-envelope'></i>\n  &nbsp;\n  Re-send Quote\n</a>":"<a class='action massive modal' id='send_remind_link' href='"+e(t(Paydirt.Routes.new_document_email(this.quote.id,"new_quote")))+"'>\n  <i class='icon-envelope'></i>\n  &nbsp;\n  Send Quote\n</a>"),this.quote.get("sent")||i.push("<span class='alternative'>\n  or\n  <a id='mark_quote_as_sent' href='#'>\n    Mark it as Sent\n  </a>\n</span>"),i.push("<hr class='space'>\n<hr class='double'>\n<a class='action massive' href='#' data-onclick='convertQuoteToInvoice'>\n  <i class='icon-file-alt'></i>\n  &nbsp;\n  Create Invoice\n</a>\n<hr class='space'>\n<div class='hide' id='sent_email_to_self'>\n  <div class='box clearfix' style='padding-top: 0; padding-bottom: 0; width: 375px;'>\n    <div class='clearfix shell t-center'>\n      <h2>You just sent this quote to yourself</h2>\n      <hr>\n      <p>It should arrive in your inbox in the next minute or so.</p>\n      <p>Does everything look good? Time to email it to your client!</p>\n      <p>\n        <a class='action massive' id='send_to_client' href='"+e(t(Paydirt.Routes.new_document_email(this.quote.id,"new_quote")))+"' data-behaviour='modal'>\n          <i class='icon-envelope'></i>\n          &nbsp;\n          Compose an email to my client\n        </a>\n      </p>\n      <p class='grey'>\n        Not ready to send this quote to your client?\n        <a href='#' data-behaviour='close_modal'>Close this popup</a>\n        .\n      </p>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/index"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>"),i.push(this.current?"        Quotes":"        <a href='"+e(t(Paydirt.Routes.quotes()))+"' data-behaviour='backbone_link'>Quotes</a>\n        <i class='icon-angle-right'></i>\n        Accepted &amp; Declined"),i.push("      </h1>\n    </div>\n  </div>\n  <div class='page-links'>\n    <div class='container'>\n      <a class='action' href='#' data-onclick='toggleQuoteBuilder'>New Quote</a>\n    </div>\n  </div>\n  <div class='action-bar new_quote'>\n    <div class='container'>\n      <div class='new_quote_button'></div>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div class='secondary_navigation'>\n        <a href='"+e(t(Paydirt.Routes.quotes()))+"' data-behaviour='backbone_link'>Current</a>\n        <a href='"+e(t(Paydirt.Routes.quotes_history()))+"' data-behaviour='backbone_link'>Accepted &amp; Declined</a>\n      </div>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container quotes_body'>\n    <div class='span-17'>\n      <div class='quotes_main'></div>\n    </div>\n    <div class='last span-7'>\n      <div class='quotes_summary'></div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")
}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/list"]=function(t){return function(){var t;return t=[],t.push("<div class='quotes'></div>\n<div class='box empty hide'>\n  <p class='t-center'></p>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/list_item"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='grid invoice'>\n  <div class='invoice_client_details'>"),i.push("    "+t(this.model.client().badge())),i.push("    <span class='number'>"+t(this.model.formattedNumber())+"</span>\n  </div>\n  <div class='btn-group invoice-actions'>\n    <a class='btn dropdown-toggle' href='#' data-toggle='dropdown'>\n      <i class='icon-caret-down'></i>\n    </a>\n    <ul class='dropdown-menu pull-right'>\n      <li>\n        <a href='"+e(t(Paydirt.Routes.print_quote(this.model.id)))+"' target='_blank'>\n          <i class='icon-print'></i>\n          Print\n        </a>\n      </li>\n      <li>\n        <a href='"+e(t(Paydirt.Routes.quote(this.model.id)))+".pdf' target='_blank'>\n          <i class='icon-download-alt'></i>\n          Get PDF\n        </a>\n      </li>\n      <li>\n        <a href='"+e(t(Paydirt.Routes.public_quote(this.model.id,this.model.get("private_id"))))+"' target='_blank'>\n          <i class='icon-globe'></i>\n          View Online\n        </a>\n      </li>\n    </ul>\n  </div>\n  <div class='"+["tag",""+e(t(this.model.state()))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>"),i.push("    "+t(this.model.state().toUpperCase())),i.push("  </div>\n  <div class='description'>"),i.push(this.model.get("description")?"    <p>"+t(marked(this.model.get("description")).replace(/(<([^>]+)>)/gi,"").substr(0,60))+"</p>":"    No description"),i.push("  </div>\n  <div class='total'>\n    \x91<span class='currency'>"+t(this.model.currency().get("sign"))+"</span>\x92\n    <span class='amount'>"+t(this.model.get("total").format({sign:""}))+"</span>\n  </div>\n  <div class='currency_code'>"+t(this.model.currency().get("code"))+"</div>\n  <a class='overlay' href='"+e(t(Paydirt.Routes.quote(this.model.id)))+"' data-behaviour='backbone_link'></a>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/list_summary"]=function(t){return function(){var t,e,i,n,s,r,a;t=window.HAML.cleanValue,e=[],e.push("<div class='flush_left section'>\n  <h2>Summary</h2>\n</div>\n<hr class='double'>\n<div class='span-8'>\n  <h3 class='label'>Drafted</h3>\n</div>\n<div class='last span-16'>\n  <div class='total'>"),_.isEmpty(this.groupedQuotes)&&e.push("    <div class='t-right'>\n      <span class='amount nothing'>zero</span>\n    </div>\n    <hr class='space'>"),s=this.groupedQuotes;for(i in s)n=s[i],e.push("    <div class='t-right'>\n      <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n      <span class='amount'>"+t(n.amountDrafted().format({sign:"",code:n.first().currency().get("code")}))+"</span>\n    </div>\n    <hr class='space'>");e.push("  </div>\n</div>\n<hr class='clear double'>\n<div class='span-8'>\n  <h3 class='label'>Sent</h3>\n</div>\n<div class='last span-16'>\n  <div class='total'>"),_.isEmpty(this.groupedQuotes)&&e.push("    <div class='t-right'>\n      <span class='amount nothing'>zero</span>\n    </div>\n    <hr class='space'>"),r=this.groupedQuotes;for(i in r)n=r[i],e.push("    <div class='t-right'>\n      <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n      <span class='amount'>"+t(n.amountSent().format({sign:"",code:n.first().currency().get("code")}))+"</span>\n    </div>\n    <hr class='space'>");e.push("  </div>\n</div>\n<hr class='clear double'>\n<div class='span-8'>\n  <h3 class='label'>Total</h3>\n</div>\n<div class='last span-16'>\n  <div class='total'>"),_.isEmpty(this.groupedQuotes)&&e.push("    <div class='t-right'>\n      <span class='amount nothing'>zero</span>\n    </div>\n    <hr class='space'>"),a=this.groupedQuotes;for(i in a)n=a[i],e.push("    <div class='t-right'>\n      <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n      <span class='amount'>"+t(n.amountTotal().format({sign:"",code:n.first().currency().get("code")}))+"</span>\n    </div>\n    <hr class='space'>");return e.push("  </div>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/logo_uploader"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='logo_bar'>"),null!=this.invoice.logoPath()?i.push("  <img src='"+e(t(this.invoice.logoPath()))+"'>"):"ClientInvoice"!==this.invoice.get("type")||null==window.FormData||Paydirt.user.get("dismissed_notices").add_logo||i.push("  <div class='span-14' id='logo_widget'>\n    <div id='show_logo_fields_container'>\n      <a id='show_logo_fields' href='#'>Add your business's logo</a>\n      <a class='dismiss grey right' href='/settings/notices/dismiss/add_logo' data-remote>hide</a>\n    </div>\n    <div class='hide' id='logo_fields'>\n      <input id='logo' type='file' accept='image/png,image/jpeg,/image/jpg'>\n      <br>\n      <span class='field-desc'>JPG or PNG, max width 769px, max height 300px. Larger images will be resized.</span>\n    </div>\n    <div class='hide' id='logo_preview'>\n      <div id='temporary_logo'></div>\n      <hr>\n      <button id='submit_logo' type='button'>Save Logo</button>\n      &nbsp;&nbsp;or&nbsp;&nbsp;\n      <a class='cancel grey' href='#'>Choose another logo</a>\n    </div>\n  </div>"),i.push("</div>\n<hr class='space'>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/new"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='new_document_autocompleter'>\n  <h4>New Quote</h4>\n  <select class='autocompleter form-20' id='new_quote_client_id' data-behaviour='chosen' data-placeholder='Select a client to quote' data-allow-single_deselect>\n    <option></option>\n    <option value='new' data-html=\"<i class='icon-plus-sign'></i> Draft a quote for a new client...\">Draft a quote for a new client...</option>"),Paydirt.clients.active().each(function(n){return i.push("    <option value='"+e(t(n.id))+"' data-html='"+e(t(n.badge()))+" "+e(t(n.get("business_name")))+"'>"+t(n.get("business_name"))+"</option>"),""}),i.push("  </select>\n  <a class='action' href='#' data-onclick='draftQuote'>\n    Draft Quote\n  </a>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/page"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='invoice-page'>\n  <i class='icon-refresh icon-spin spinner'></i>\n  <div class='overlays'>\n    <div class='"+["draft",""+e(t("draft"===this.quote.state()?"current":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      &nbsp;\n    </div>\n    <div class='"+["sent",""+e(t("sent"===this.quote.state()?"current":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      &nbsp;\n    </div>\n    <div class='"+["accepted",""+e(t("accepted"===this.quote.state()?"current":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      &nbsp;\n    </div>\n    <div class='"+["declined",""+e(t("declined"===this.quote.state()?"current":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      &nbsp;\n    </div>\n  </div>\n  <div id='invoice_contents'></div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/show"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>\n        <a href='"+e(t(Paydirt.Routes.quotes()))+"' data-behaviour='backbone_link'>Quotes</a>\n        <i class='icon-angle-right'></i>"),i.push("        "+t(Paydirt.quote.formattedNumber())),i.push("      </h1>\n    </div>\n  </div>\n  <div class='page-links sml'>\n    <div class='container'>\n      <div class='action-group'>\n        <a class='action' href='"+e(t(Paydirt.Routes.print_quote(this.quote.id)))+"' target='_blank'>\n          <i class='icon-print'></i>\n          Print\n        </a>\n        <a class='action' href='"+e(t(Paydirt.Routes.quote(this.quote.id)))+".pdf' target='_blank'>\n          <i class='icon-download-alt'></i>\n          Get PDF\n        </a>\n        <a class='action' href='"+e(t(Paydirt.Routes.public_quote(this.quote.id,this.quote.get("private_id"))))+"' target='_blank'>\n          <i class='icon-globe'></i>\n          View Online\n        </a>\n      </div>\n      <div class='action-group'>\n        <a class='action' id='duplicate_quote' href='#'>\n          <i class='icon-copy'></i>\n          Duplicate\n        </a>\n        <a class='action' href='#' data-onclick='convertQuoteToInvoice'>\n          <i class='icon-file-alt'></i>\n          Create Invoice\n        </a>\n      </div>\n      <a class='action' id='delete_quote' href='#' data-confirm='Are you sure you want to permanently delete this quote?' data-cancel-text=\"No, don't delete it\" data-confirm-text='Yes, delete quote'>\n        <i class='icon-remove-sign'></i>\n        Delete\n      </a>\n    </div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div id='show_edit_links'></div>\n    </div>\n  </div>\n</div>\n<div id='middle'>\n  <div class='container'>\n    <div class='span-18' id='quote_page_container'></div>\n    <div class='last span-6'>\n      <div id='invoice-options'>\n        <div id='email_button'></div>\n        <hr class='double'>\n        <div id='state_container'></div>\n        <hr class='both double'>\n        <div id='invoice_activity_container'></div>\n      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/show_edit_links"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='secondary_navigation'>\n  <a class='"+e(t("show"===this.mode?"selected":void 0))+"' href='"+e(t(Paydirt.Routes.quote(this.model.id)))+"' data-behaviour='backbone_link'>\n    Manage Quote\n  </a>"),i.push(this.model.get("sent")?"  <a class='"+["edit_sent_quote",""+e(t("edit"===this.mode?"selected":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' href='#' data-confirm=\"You can edit this quote, but you've already marked it as sent. Editing it will convert it back to a draft. Want to go ahead?\" data-cancel-text=\"No, don't edit\" data-confirm-text='Yes, edit it'>\n    <i class='icon-pencil'></i>\n    Edit Quote\n  </a>":"  <a class='"+["edit_quote",""+e(t("edit"===this.mode?"selected":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' href='"+e(t(Paydirt.Routes.edit_quote(this.model.id)))+"' data-behaviour='backbone_link'>\n    <i class='icon-pencil'></i>\n    Edit Quote\n  </a>"),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["quotes/state"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='span-14'>\n  <h3 class='label'>Quote Status</h3>\n</div>\n<div class='last span-10'>\n  <div class='btn-group document_state'>\n    <button class='dropdown-toggle' data-toggle='dropdown'>"),i.push("      "+t(this.quote.state().capitalize())),i.push("      <i class='icon-caret-down'></i>\n    </button>\n    <ul class='dropdown-menu pull-right'>\n      <li class='"+e(t("draft"===this.quote.state()?"current":void 0))+"'>\n        <a href='#draft' data-state='draft'>\n          Draft\n          <i class='icon-check-empty'></i>\n          <i class='icon-check'></i>\n        </a>\n      </li>\n      <li class='"+e(t("sent"===this.quote.state()?"current":void 0))+"'>\n        <a href='#sent' data-state='sent'>\n          Sent\n          <i class='icon-check-empty'></i>\n          <i class='icon-check'></i>\n        </a>\n      </li>\n      <li class='"+e(t("accepted"===this.quote.state()?"current":void 0))+"'>\n        <a href='#accepted' data-state='accepted'>\n          Accepted\n          <i class='icon-check-empty'></i>\n          <i class='icon-check'></i>\n        </a>\n      </li>\n      <li class='"+e(t("declined"===this.quote.state()?"current":void 0))+"'>\n        <a href='#declined' data-state='declined'>\n          Declined\n          <i class='icon-check-empty'></i>\n          <i class='icon-check'></i>\n        </a>\n      </li>\n    </ul>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["recurring_invoices/list"]=function(t){return function(){var t,e;return t=window.HAML.cleanValue,e=[],e.push("<table class='recurring-invoice-list' data-bind='toggle:(length($collection))'>\n  <thead>\n    <tr>\n      <th>Number</th>\n      <th>Client</th>\n      <th>Details</th>\n      <th>Schedule</th>\n      <th>Active</th>\n    </tr>\n  </thead>\n  <tbody data-bind='collection:$collection'></tbody>\n</table>\n<div class='box empty' data-bind='toggle:not(length($collection))'>\n  <p class='t-center'>\n    You haven't created any recurring invoices.\n    <a href='/help/guides/invoicing/recurring' target='_blank'>Learn how to create a recurring invoice</a>\n  </p>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["recurring_invoices/list_item"]=function(t){return function(){var t,e,i,n,s;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<td>\n  <a href='"+e(t(Paydirt.Routes.recurring_invoice(this.model.id)))+"' data-behaviour='backbone_link'>"+t(this.model.formattedNumber())+"</a>\n</td>\n<td>"),i.push("  "+t(this.model.client().badge())),i.push("  &nbsp;"),i.push("  "+t(this.model.client().get("business_name"))),i.push("</td>\n<td>"),i.push((null!=(s=this.model.get("description"))?s.length:void 0)>0?"  "+t(marked(this.model.get("description")).replace(/(<([^>]+)>)/gi,"")):"  <span class='grey'>(no description)</span>"),i.push("  <br>\n  <span class='total-price'>"+t(this.model.get("total").format({sign:this.model.client().currency().get("sign")}))+"</span>\n  &nbsp;\n  <a href='"+e(t(Paydirt.Routes.edit_recurring_invoice(this.model.id)))+"' data-behaviour='backbone_link tooltip' data-tooltip-gravity='w' title='Edit template'>\n    <i class='icon-pencil'></i>\n  </a>\n</td>\n<td>\n  <b>\n    Every "+this.model.get("interval")+" "+this.model.humanEvery()+"\n    on "+this.model.humanOn()+"\n  </b>\n  <br>"),n=new moment(this.model.get("upcoming_recurring_dates")[0]).format(),i.push("  Next invoice &ndash;\n  <span data-bind='toggle:enabled'>"+t(n)+"</span>\n  <span class='grey' data-bind='toggle:not(enabled)'>\n    <del class='grey'>"+t(n)+"</del>\n    (disabled)\n  </span>\n  &nbsp;\n  <a href='"+e(t(Paydirt.Routes.schedule_recurring_invoice(this.model.id)))+"' data-behaviour='backbone_link tooltip' data-tooltip-gravity='w' title='Edit schedule'>\n    <i class='icon-pencil'></i>\n  </a>\n</td>\n<td class='t-center'>\n  <i class='grey icon-remove' data-bind='toggle:not(enabled)'></i>\n  <i class='icon-ok' data-bind='toggle:enabled'></i>\n  <a href='javascript:void(0)' data-onclick='enableRecurring' data-bind='toggle:not(enabled)'>enable</a>\n  <a href='javascript:void(0)' data-onclick='disableRecurring' data-bind='toggle:enabled'>disable</a>\n</td>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["recurring_invoices/new"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='box settings top' style='width: 600px'>\n  <div class='title'>\n    <h2>New Recurring Invoice</h2>\n  </div>\n  <form>\n    <div class='option_label'>\n      <label for='client_id'>Client</label>\n    </div>\n    <div class='option_field'>\n      <select class='autocompleter form-20' id='client_id' name='client_id' data-behaviour='chosen' data-placeholder='Select a client to invoice' data-allow-single_deselect data-onchange='setClientId' data-validates-presence>\n        <option></option>"),Paydirt.clients.active().each(function(n){return i.push("        <option value='"+e(t(n.id))+"' data-html='"+e(t(n.badge()))+" "+e(t(n.get("business_name")))+"'>"+t(n.get("business_name"))+"</option>"),""}),i.push("      </select>\n    </div>\n    <hr>\n    <div class='backbone clearfix' id='schedule_form'></div>\n  </form>\n  <hr>\n  <div class='option_label'>\n    <label>Schedule</label>\n  </div>\n  <div class='option_field'>\n    <ul class='schedule-list' data-bind='html:scheduleList'></ul>\n  </div>\n  <div class='items' style='padding: 10px 15px; clear: both;'>\n    <div class='right span-14'>\n      <button class='massive' type='button' data-onclick='save'>\n        Compose Invoice\n        <i class='icon-circle-arrow-right'></i>\n      </button>\n      <br>\n      <span class='right'>\n        or\n        <a class='cancel' href='#' data-behaviour='close_modal'>cancel</a>\n      </span>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["recurring_invoices/schedule_form"]=function(t){return function(){var t,e,i,n,s;for(e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='option_label'>\n  <label for='currency_id'>Repeat every</label>\n</div>\n<div class='option_field'>\n  <div class='inline-inputs'>\n    <input class='form-3 inline t-center' type='text' name='invoice[interval]' value='"+e(t(this.model.get("interval")))+"'>\n    <select class='form-8' name='invoice[every]' data-behaviour='chosen' data-bind='value:every'>\n      <option value='"+e(t(0))+"'>week(s)</option>\n      <option value='"+e(t(1))+"'>month(s)</option>\n      <option value='"+e(t(2))+"'>year(s)</option>\n    </select>\n    <span class='on-type' data-bind='toggle:week'>\n      <span class='grey'>on</span>\n      <select class='form-12' name='invoice[week_on]' data-behaviour='chosen' data-bind='value:week_on'>\n        <option value='"+e(t(0))+"'>Sundays</option>\n        <option value='"+e(t(1))+"'>Mondays</option>\n        <option value='"+e(t(2))+"'>Tuesdays</option>\n        <option value='"+e(t(3))+"'>Wednesdays</option>\n        <option value='"+e(t(4))+"'>Thursdays</option>\n        <option value='"+e(t(5))+"'>Fridays</option>\n        <option value='"+e(t(6))+"'>Saturdays</option>\n      </select>\n    </span>\n    <span class='on-type' data-bind='toggle:month'>\n      <span class='grey'>on</span>\n      <select class='form-13' name='invoice[month_on]' data-behaviour='chosen' data-bind='value:month_on'>"),n=s=1;27>=s;n=++s)i.push("        <option value='"+e(t(n))+"'>the "+moment().lang().ordinal(n)+" of the month</option>");return i.push("        <option value='31'>the last day of the month</option>\n      </select>\n    </span>\n  </div>\n  <div class='clear'>\n    <span class='field-desc'>How often should an invoice be created?</span>\n  </div>\n</div>\n<hr>\n<div class='option_label'>\n  <label for='invoice[recurring_start_date]'>Starting on</label>\n</div>\n<div class='option_field'>\n  <div data-bind='toggle:not(year)'>\n    <select name='invoice[recurring_start_date]' data-bind='options:startDates'></select>\n  </div>\n  <div data-bind='toggle:year'>\n    <input type='text' name='invoice[annual_recurring_start_date]' data-behaviour='datepicker' data-bind='value:formatDate(recurring_start_date)'>\n  </div>\n  <span class='field-desc'>And when should the first invoice be created?</span>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["reports/header"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='page-head'>\n  <div class='page-title'>\n    <div class='container'>\n      <h1>"),this.report?(i.push("        <a href='"+e(t(Paydirt.Routes.reports()))+"' data-behaviour='backbone_link'>Reports</a>\n        <i class='icon-angle-right'></i>"),i.push("        "+t(this.report))):i.push("        Reports"),i.push("      </h1>\n    </div>\n  </div>\n  <div class='page-links'>\n    <div class='container'></div>\n  </div>\n  <div class='page-tabs'>\n    <div class='container'>\n      <div class='secondary_navigation'>\n        <a href='"+e(t(Paydirt.Routes.reports()))+"' data-behaviour='backbone_link'>Overview</a>\n        <a href='"+e(t(Paydirt.Routes.reports_timesheets()))+"' data-behaviour='backbone_link'>Timesheets</a>\n        <a href='"+e(t(Paydirt.Routes.reports_projects()))+"' data-behaviour='backbone_link'>Project Budgets</a>\n      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["reports/index"]=function(t){return function(){var t,e,i,n,s,r,a,o,l,c;e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='middle'>\n  <div class='container'>\n    <div class='reports'>\n      <div class='span-24'>\n        <div class='span-5'>\n          <h2>Time</h2>\n          <hr>\n          <span class='amount'>"+t(Paydirt.Formatters.secondsToHours(this.blocks.duration))+"</span>\n          <br>\n          <span class='grey'>hours logged last 30 days</span>\n          <hr class='space'>\n          <span class='amount'>"),i.push("            "+t(Paydirt.Formatters.secondsToHours(this.blocks.billable_duration))),i.push("          </span>\n          <br>\n          <span class='grey'>billable hours</span>\n          <hr class='space'>\n          <span class='amount'>"),i.push("            "+t(Paydirt.Formatters.secondsToHours(this.blocks.unbillable_duration))),i.push("          </span>\n          <br>\n          <span class='grey'>unbillable hours</span>\n          <hr class='space'>\n          <p class='grey'>\n            <a href='"+e(t(Paydirt.Routes.reports_timesheets()))+"' data-behaviour='backbone_link'>Timesheets</a>\n            |\n            <a href='"+e(t(Paydirt.Routes.blocks()))+"' data-behaviour='backbone_link'>Full Report</a>\n          </p>\n        </div>\n        <div class='span-1'>&nbsp;</div>\n        <div class='span-5'>\n          <h2>Quotes</h2>\n          <hr>"),o=Paydirt.quotes.groupBy(function(t){return t.currency().id}),_.isEmpty(o)&&i.push("          <span class='grey'>No current quotes</span>\n          <hr class='space'>");for(s in o)c=o[s],c=new Paydirt.Collections.Quotes(c),i.push("          <span class='currency'>"+t(c.first().currency().get("sign"))+"</span>\n          <span class='amount'>"+t(c.amountDrafted().format({sign:""}))+"</span>\n          <br>\n          <span class='grey'>"),i.push("            "+t(c.first().currency().get("code"))),i.push("            drafted\n          </span>\n          <hr class='space'>\n          <span class='currency'>"+t(c.first().currency().get("sign"))+"</span>\n          <span class='amount'>"+t(c.amountAwaitingApproval().format({sign:""}))+"</span>\n          <br>\n          <span class='grey'>"),i.push("            "+t(c.first().currency().get("code"))),i.push("            awaiting approval\n          </span>\n          <hr class='space'>");i.push("          <p class='grey'>\n            <a href='"+e(t(Paydirt.Routes.quotes()))+"' data-behaviour='backbone_link'>Current</a>\n            |\n            <a href='"+e(t(Paydirt.Routes.quotes_history()))+"' data-behaviour='backbone_link'>Historical</a>\n          </p>\n        </div>\n        <div class='span-1'>&nbsp;</div>\n        <div class='span-5'>\n          <h2>Invoices</h2>\n          <hr>"),a=Paydirt.invoices.groupBy(function(t){return t.currency().id}),_.isEmpty(a)&&i.push("          <span class='grey'>No current invoices</span>\n          <hr class='space'>");for(s in a)l=a[s],l=new Paydirt.Collections.Invoices(l),i.push("          <span class='currency'>"+t(l.first().currency().get("sign"))+"</span>\n          <span class='amount'>"+t(l.amountOwing().format({sign:""}))+"</span>\n          <br>\n          <span class='grey'>"),i.push("            "+t(l.first().currency().get("code"))),i.push("            owing\n          </span>\n          <hr class='space'>\n          <span class='currency'>"+t(l.first().currency().get("sign"))+"</span>\n          <span class='amount'>"+t(l.amountOverdue().format({sign:""}))+"</span>\n          <br>\n          <span class='grey'>"),i.push("            "+t(l.first().currency().get("code"))),i.push("            overdue\n          </span>\n          <hr class='space'>");i.push("          <p class='grey'>\n            <a href='"+e(t(Paydirt.Routes.invoices()))+"' data-behaviour='backbone_link'>Current</a>\n            |\n            <a href='"+e(t(Paydirt.Routes.invoices_history()))+"' data-behaviour='backbone_link'>Historical</a>\n          </p>\n        </div>\n        <div class='span-1'>&nbsp;</div>\n        <div class='last span-5'>\n          <h2>Unbilled</h2>\n          <hr>"),r=Paydirt.clients.groupBy(function(t){return t.currency().id});for(s in r)n=r[s],n=new Paydirt.Collections.Clients(n),i.push("          <span class='currency'>"+t(n.first().currency().get("sign"))+"</span>\n          <span class='amount'>"+t(n.totalAmountUnbilled().format({sign:""}))+"</span>\n          <br>\n          <span class='grey'>"),i.push("            "+t(n.first().currency().get("code"))),i.push("            unbilled\n          </span>\n          <hr class='space'>");return i.push("          <p class='grey'>\n            <a href='"+e(t(Paydirt.Routes.clients()))+"' data-behaviour='backbone_link'>Full Report</a>\n          </p>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["reports/projects"]=function(t){return function(){var t;return t=[],t.push("<div id='middle'>\n  <div class='container'>\n    <div class='report'>\n      <div class='loading report-body'></div>\n    </div>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["reports/timesheets"]=function(t){return function(){var t;return t=[],t.push("<div id='middle'>\n  <div class='container'>\n    <div class='report'>\n      <div class='nav-row'>\n        <span class='grey'>Report by</span>\n        <select class='form-12' name='target' data-onchange='setTarget' data-behaviour='chosen'>\n          <option value='team'>Team member</option>\n          <option value='client'>Client</option>\n          <option value='project'>Project</option>\n        </select>\n        <span class='grey'>for the</span>\n        <select class='form-8' name='range' data-onchange='setRange' data-behaviour='chosen'>\n          <option value='day'>Day</option>\n          <option value='week'>Week</option>\n          <option value='month'>Month</option>\n          <option value='quarter'>Quarter</option>\n          <option value='year'>Year</option>\n          <option value='custom'>Custom</option>\n        </select>\n        <span data-bind='toggle:customRange'>\n          <input type='text' data-behaviour='datepicker' data-bind='value:formattedStart'>\n          <span class='grey'>&nbsp;to&nbsp;</span>\n          <input type='text' data-behaviour='datepicker' data-bind='value:formattedEnd'>\n        </span>\n        <span data-bind='toggle:not(customRange)'>\n          <div class='date-range' data-bind='text:formattedDateRange'></div>\n          <span class='grey' data-bind='html:humanRange'></span>\n        </span>\n        &nbsp;\n        &nbsp;\n        <span>\n          <a class='grey' href='#dowload' data-onclick='export'>\n            Download as CSV\n          </a>\n        </span>\n        <div class='right'>\n          <button href='#' data-onclick='previousPeriod' data-bind='disabled:customRange' data-behaviour='tooltip' title='previous period'>\n            <i class='icon-chevron-left'></i>\n          </button>\n          <button href='#' data-onclick='currentPeriod' data-bind='disabled:customRange' data-behaviour='tooltip' title='current period'>\n            <i class='icon-home'></i>\n          </button>\n          <button href='#' data-onclick='nextPeriod' data-bind='disabled:customRange' data-behaviour='tooltip' title='next period'>\n            <i class='icon-chevron-right'></i>\n          </button>\n        </div>\n      </div>\n      <hr class='double space'>\n      <div class='loading report-body'></div>\n    </div>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["settings/invoice_email"]=function(t){return function(){var t,e,i;switch(e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='midset title'>\n  <div class='toggle_view'>\n    <a class='preview_link selected' href='#'>\n      <i class='icon-eye-open'></i>\n      Preview\n    </a>\n    <a class='edit_link' href='#'>\n      <i class='icon-pencil'></i>\n      Edit\n    </a>\n  </div>\n  <h2>"+t(this.title)+"</h2>\n</div>\n<div class='clearfix edit_email'>\n  <div class='preview'>\n    <div class='span-2'>\n      <label class='email_field'>Subject</label>\n    </div>\n    <div class='last span-22'>\n      <div class='preview_field preview_subject'>"+t(this.subject)+"</div>\n    </div>\n    <div class='span-2'>\n      <label class='email_field'>Body</label>\n    </div>\n    <div class='last span-22'>\n      <pre class='preview_body preview_field'>"+t(this.body)+"</pre>\n    </div>\n  </div>\n  <div class='edit hide'>\n    <div class='span-2'>\n      <label class='email_field' for='"+e(t(this.id))+"_body'>Subject</label>\n    </div>\n    <div class='last span-22'>\n      <input class='invoice_email subject' id='"+this.id+"_subject' type='text' name='account["+e(t(this.id))+"_subject]' value='"+e(t(this.subject))+"'>\n    </div>\n    <div class='span-2'>\n      <label class='email_field'>Body</label>\n    </div>\n    <div class='last span-22'>\n      <textarea class='body invoice_email' id='"+this.id+"_body' name='account["+e(t(this.id))+"_body]' rows='"+e(t(6))+"'>"+t(this.body)+"</textarea>\n    </div>\n    <br class='clear'>\n    <div class='clearfix info'>\n      <div class='span-13'>\n        <p>\n          Email tags are automatically substituted when you compose an email.  Select a tag to be inserted at the current cursor positon.\n        </p>\n      </div>\n      <div class='last span-11'>\n        <select class='form-24 tag' data-behaviour='chosen' data-placeholder='Select a tag to insert...'>\n          <option value=''></option>\n          <option value='{{ client_business_name }}'>The client's business name</option>\n          <option value='{{ client_contact_name }}'>The client's full name</option>\n          <option value='{{ client_contact_first_name }}'>The client's first name</option>\n          <option value='{{ our_business_name }}'>Your business name</option>\n          <option value='{{ our_contact_name }}'>Your business billing contact name</option>"),this.type){case"invoice":i.push("          <option value='{{ invoice_number }}'>The unique invoice number</option>\n          <option value='{{ invoice_due_date }}'>The due date of the invoice</option>\n          <option value='{{ invoice_total }}'>The invoice's total price</option>\n          <option value='{{ invoice_description }}'>The invoice description</option>"),"invoice_reminder_email"===this.id&&i.push("          <option value='{{ invoice_days_overdue }}'>The number of days since the invoice was due</option>"),"invoice_thankyou_email"===this.id&&i.push("          <option value='{{ invoice_payment_amount }}'>The payment amount</option>");
break;case"quote":i.push("          <option value='{{ quote_number }}'>The unique quote number</option>\n          <option value='{{ quote_total }}'>The quote's total price</option>\n          <option value='{{ quote_description }}'>The quote description</option>")}return i.push("        </select>\n      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["settings/line_item_creation"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div id='block_grouping_container'>\n  <div class='span-12'>\n    <h4>Converting logged time to line items</h4>\n    <div class='line_item_option'>\n      <input id='no_grouping' type='radio' name='any_grouping' value='false'>\n      <label for='no_grouping'>Create one line item for each log entry</label>\n    </div>\n    <div class='line_item_option'>\n      <input id='some_grouping' type='radio' name='any_grouping' value='true'>\n      <label for='some_grouping'>Group log entries together into line items</label>\n      <div class='hide' id='grouping_options'>\n        <input id='date_grouping' type='checkbox'>\n        <label for='date_grouping'>Group by time period:</label>\n        <select class='form-6' id='date_grouping_select' data-behaviour='chosen' disabled>\n          <option value='"+e(t(0))+"' selected>day</option>\n          <option value='"+e(t(1))+"'>week</option>\n          <option value='"+e(t(2))+"'>month</option>\n        </select>\n        <br class='clear'>\n        <input id='job_grouping' type='checkbox'>\n        <label for='job_grouping'>Group by task</label>\n      </div>\n    </div>\n  </div>\n  <div class='last span-12' id='description_components'>\n    <h4>Line item descriptions</h4>\n    <div class='line_item_option'>\n      <input id='include_project_names' type='checkbox' checked>\n      <label for='include_project_names'>Include project name</label>\n    </div>\n    <div class='line_item_option'>\n      <input id='include_job_names' type='checkbox' checked>\n      <label for='include_job_names'>Include task name</label>\n    </div>\n    <div class='line_item_option'>\n      <input id='include_block_descriptions' type='checkbox' checked>\n      <label for='include_block_descriptions'>Include billable time log descriptions</label>\n    </div>\n  </div>\n  <div class='hide'>\n    <input type='hidden' name='account[group_line_items_by_date]'>\n    <input type='hidden' name='account[group_line_items_by_job]'>\n    <input type='hidden' name='account[include_block_descriptions_in_line_item_descriptions]'>\n    <input type='hidden' name='account[include_job_names_in_line_item_descriptions]'>\n    <input type='hidden' name='account[include_project_names_in_line_item_descriptions]'>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["taxes/form"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<form class='backbone inline_form'>\n  <div class='span-24 tax_form'>\n    <div class='span-6'>\n      <input class='form-4' id='tax_name' type='text' name='name' value='"+e(t(this.model.get("name")))+"' autocomplete='off' data-validates-presence placeholder='Name'>\n    </div>\n    <div class='span-4'>\n      <input class='form-4' id='tax_percentage' type='text' name='percentage' value='"+e(t(Paydirt.Formatters.numberToPercentage(this.model.get("percentage"))))+"' autocomplete='off' placeholder='Percentage'>\n    </div>\n    <div class='last span-14'>\n      <div class='right'>\n        <a class='cancel' href='#'>Cancel</a>\n        &nbsp;\n        or\n        &nbsp;\n        <input type='submit' value='Save'>\n      </div>\n    </div>\n  </div>\n</form>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["taxes/show"]=function(t){return function(){var t,e;return t=window.HAML.cleanValue,e=[],e.push("<div class='span-6'>"),e.push("  "+t(this.model.get("name"))),e.push("</div>\n<div class='span-4'>"),e.push("  "+t(Paydirt.Formatters.numberToPercentage(this.model.get("percentage")))),e.push("</div>\n<div class='last span-14'>\n  <div class='right'>\n    <a class='edit_link tooltip' href='#' tooltip='Edit'>\n      <i class='icon-pencil'></i>\n    </a>\n    &nbsp;&nbsp;&nbsp;\n    <a class='delete tooltip' href='#' tooltip='Delete'>&times;</a>\n  </div>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["tracker/chrome_ticker"]=function(t){return function(){var t,e;return t=window.HAML.cleanValue,e=[],e.push(this.get("hours")>0?this.get("seconds")%2===0||this.get("paused_at")?""+t(""+Paydirt.Formatters.paddedNumber(this.get("hours"),{length:2})+":"+Paydirt.Formatters.paddedNumber(this.get("minutes"),{length:2})):""+t(""+Paydirt.Formatters.paddedNumber(this.get("hours"),{length:2})+" "+Paydirt.Formatters.paddedNumber(this.get("minutes"),{length:2})):""+t(""+Paydirt.Formatters.paddedNumber(this.get("minutes"),{length:2})+":"+Paydirt.Formatters.paddedNumber(this.get("seconds"),{length:2}))),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["tracker/job"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='clearfix job' data-tracker-job-id='"+e(t(this.model.id))+"'>\n  <div class='span-20'>\n    <div class='job_name' data-onclick='expandJobOptions' title='"+e(t(this.model.get("name")))+"'>"+t(this.model.get("name"))+"</div>\n  </div>\n  <div class='last span-4'>\n    <a class='start-button timer-button' href='#' data-minutes-ago='"+e(t(0))+"' data-onclick='startTracker'>\n      <i class='icon-play'></i>\n    </a>\n  </div>\n  <div class='opts'>\n    <div class='span-12'>"),i.push("extension"===Paydirt.tracker.get("mode")?"      <br>\n      <a href='/extensions/time/log/"+e(t(this.model.id))+"' data-behaviour='extension_link'>Add a log entry</a>\n      <br>\n      <br>\n      <a href='#' data-onclick='editKeywords'>Edit keywords</a>":"      <a href='"+e(t(Paydirt.baseURL))+e(t(Paydirt.Routes.new_block(this.model.id)))+"' data-behaviour='backbone_link'>Add a log entry</a>"),i.push("    </div>\n    <div class='last span-12'>\n      <a class='ago start-button timer-button' href='#' data-minutes-ago='"+e(t(5))+"' rel='nofollow' tabindex='-1' data-onclick='startTracker'>\n        <i>5 mins ago</i>\n      </a>\n      <a class='ago start-button timer-button' href='#' data-minutes-ago='"+e(t(10))+"' rel='nofollow' tabindex='-1' data-onclick='startTracker'>\n        <i>10 mins ago</i>\n      </a>\n      <a class='ago start-button timer-button' href='#' data-minutes-ago='"+e(t(20))+"' rel='nofollow' tabindex='-1' data-onclick='startTracker'>\n        <i>20 mins ago</i>\n      </a>\n      <a class='ago start-button timer-button' href='#' data-minutes-ago='"+e(t(30))+"' rel='nofollow' tabindex='-1' data-onclick='startTracker'>\n        <i>30 mins ago</i>\n      </a>\n      <a class='ago start-button timer-button' href='#' data-minutes-ago='"+e(t(60))+"' rel='nofollow' tabindex='-1' data-onclick='startTracker'>\n        <i>1 hour ago</i>\n      </a>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["tracker/project"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='clearfix title'>\n  <div class='span-3'>\n    <a href='"+e(t(Paydirt.baseURL))+e(t(Paydirt.Routes.client(this.model.get("client_id"))))+"' data-behaviour='backbone_link' data-bind='html:clientBadge'></a>\n  </div>\n  <div class='for last span-21'>\n    <span class='client_business_name' data-bind='text:client_business_name,attr:{title:client_business_name}'></span>\n    <span class='project_name' data-bind='text:name,attr:{title:name}'></span>\n  </div>\n</div>\n<div class='jobs'></div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["tracker/running"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='running' data-bind='classes:{paused:paused_at}'>\n  <div class='main-ticker'>\n    <div class='span-14'>\n      <div class='span-24 ticker'>\n        <div class='clearfix counter' data-bind='text:formattedDuration'></div>\n      </div>\n      <div class='tunit'>\n        HR\n      </div>\n      <div class='tunit'>\n        MIN\n      </div>\n      <div class='tunit'>\n        SEC\n      </div>\n    </div>\n    <div class='last span-10'>\n      <div class='span-12'>\n        <a class='timer-button' id='pause-block-button' href='#' data-onclick='pause'>\n          <i class='icon-pause'></i>\n        </a>\n        <a class='timer-button' id='resume-block-button' href='#' data-onclick='resume'>\n          <i class='icon-play'></i>\n        </a>\n      </div>\n      <div class='last span-12'>\n        <a class='timer-button' id='stop-block-button' href='#' data-onclick='stop'>\n          <i class='icon-stop'></i>\n        </a>\n      </div>\n    </div>\n  </div>\n  <div class='paused_duration' data-bind='toggle:paused_duration'>\n    <span class='grey' data-bind='text:wordedPausedDuration'></span>\n  </div>\n  <div class='currently_working'>\n    <form class='backbone clearfix'>\n      <textarea id='block_description' placeholder='What are you working on?' data-bind='html:description' data-onchange='updateBlock'></textarea>\n      <div class='attr'>\n        <div class='show'>\n          Started at\n          <span class='started_at_time'>"),i.push("            "+t(this.model.startTime())),i.push("          </span>\n          <span data-bind='text:formattedStartDate'></span>\n          <i class='edit icon-pencil right'></i>\n        </div>\n        <div class='field'>\n          Started at\n          <input class='form-5 t-center' id='started_at_time' type='text' value='"+e(t(this.model.startTime()))+"' autocomplete='off' data-attr='started_at_time'>\n          <a class='cancel right' href='#'>Cancel</a>\n        </div>\n      </div>\n      <hr>\n      <div class='attr'>\n        <div class='show'>\n          This time is\n          <span class='billableDescription'>"+t(this.model.billableDescription())+"</span>"),(this.model.job().perUser()||this.model.job().perHour())&&i.push("          <i class='edit icon-pencil right'></i>"),i.push("        </div>\n        <div class='field'>\n          This time is \n          <select class='form-8' id='block_billable'>\n            <option selected='"+e(t(this.model.get("billable")))+"' value='true'>billable</option>\n            <option selected='"+e(t(!this.model.get("billable")))+"' value='false'>not billable</option>\n          </select>\n          <a class='cancel right' href='#'>Cancel</a>\n        </div>\n      </div>\n      <hr>\n      <a id='cancel-block-button' href='#' data-onclick='cancel' tabindex='-1'>Discard timer</a>\n      <div class='right'>\n        <button class='no-click tracker-save'>Saved</button>\n      </div>\n    </form>\n  </div>\n  <div class='project'>\n    <div class='clearfix title'>\n      <div class='span-3'>\n        <a href='"+e(t(Paydirt.baseURL))+e(t(Paydirt.Routes.client(this.model.job().get("client_id"))))+"' data-behaviour='backbone_link' data-bind='html:clientBadge'></a>\n      </div>\n      <div class='for last span-21'>\n        <span class='client_business_name' data-bind='text:client_business_name,attr:{title:client_business_name}'></span>\n        <span class='project_name' data-bind='text:project_name,attr:{title:project_name}'></span>\n      </div>\n    </div>\n    <div class='jobs'>\n      <div class='clearfix job'>\n        <div class='span-20'>\n          <div class='job_name' data-bind='attr:{title:job_name},text:job_name'></div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='out ticker' data-onclick='show'>\n    <div class='clearfix counter' data-bind='text:formattedDuration'></div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["tracker/show"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div class='"+this.mode+" "+(Paydirt.user.get("permissions").log_time_without_assignment&&Paydirt.account.get("features").assignment?"with_assignment":void 0)+"' id='tracker' data-bind='classes:{running:tracker_block,stopped:not(tracker_block),showing:tracker_showing}'>\n  <div class='flash-message'>\n    <span class='text'></span>\n  </div>\n  <div class='head-container'>\n    <div class='head'>\n      <div class='search'>\n        <input id='tracker_search' type='text' placeholder='Search for a Client, Project or Task' data-onkeyup='debounceSearchTracker'>\n        <a class='hide' id='clear_tracker_search' href='#' data-onclick='clearTrackerSearch'>\n          <i class='icon-remove'></i>\n        </a>"),Paydirt.user.get("permissions").log_time_without_assignment&&Paydirt.account.get("features").assignment&&i.push("        <div id='tracker_filters'>\n          <input id='only-assigned' type='checkbox' name='only-assigned' value='assigned' checked='"+e(t("true"===Paydirt.Cookies.read("trackerOnlyAssignedJobs")))+"' data-onchange='searchTracker'>\n          <label for='only-assigned'>Only show tasks assigned to me</label>\n        </div>"),i.push("      </div>\n    </div>\n  </div>\n  <div id='tracker_running'></div>\n  <div id='active_jobs' data-bind='toggle:not(tracker_block)'>\n    <div class='nano'>\n      <div class='content' data-bind='collection:$collection'></div>\n    </div>\n    <div class='out ticker' data-onclick='show'>Time Tracker</div>\n  </div>\n  <div id='tracker-docking-controls'>\n    <div class='toolbar'>"),i.push("in-app"===this.mode?this.docked?"      <a id='undock-tracker' href='#' data-onclick='undockTracker'>\n        Undock\n        <i class='icon-upload-alt'></i>\n      </a>\n      <a id='hide-tracker' href='#' data-onclick='hide'>\n        Hide\n        <i class='icon-circle-arrow-right'></i>\n      </a>":"      <a href='"+e(t(Paydirt.baseURL))+"'>\n        Paydirt\n        <i class='icon-external-link'></i>\n      </a>\n      <a id='dock-tracker' href='#' data-onclick='dockTracker'>\n        Dock\n        <i class='icon-download-alt'></i>\n      </a>":"      <a href='"+e(t(Paydirt.baseURL))+"'>\n        Paydirt\n        <i class='icon-external-link'></i>\n      </a>\n      <a id='hide-tracker' href='#' data-onclick='hide'>\n        Hide\n        <i class='icon-circle-arrow-right'></i>\n      </a>"),i.push("    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["users/invite_row"]=function(t){return function(){var t,e,i,n;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],n=(new Date).getTime(),i.push("<tr>\n  <td>\n    <input type='text' name='users[attributes]["+e(t(n))+"][name]' placeholder='Full name' data-validates-presence>\n  </td>\n  <td>\n    <input type='text' name='users[attributes]["+e(t(n))+"][email]' placeholder='Email address' data-validates-presence>\n  </td>\n  <td>\n    <select name='users[attributes]["+e(t(n))+"][role]'>\n      <option value='admin'>Admin</option>\n      <option value='employee' selected>Employee</option>\n      <option value='contractor'>Contractor</option>\n    </select>\n  </td>\n  <td>\n    <input class='form-4 inline-input' type='text' name='users[attributes]["+e(t(n))+"][hourly_rate]' placeholder='Rate' data-behaviour='currency_input' value='"+e(t(Paydirt.Formatters.currency(Paydirt.user.get("hourly_rate"))))+"'>\n    <span class='grey'>&nbsp;/ hour</span>\n  </td>\n  <td>"),i.push(this.options.hide_remove_link?"    &nbsp;":"    <a class='delete' href='#' data-onclick='removeUser'>&times;</a>"),i.push("  </td>\n</tr>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["work_signals/form"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<form class='backbone inline_form'>\n  <div class='span-24 work_signal_form'>\n    <div class='span-12'>\n      <input class='form-14 work_signal_text' type='text' data-onsubmit='save-work-signal' value='"+e(t(this.model.get("text")))+"'>\n    </div>\n    <div class='last span-12'>\n      <div class='right'>\n        <a class='cancel' href='#' tabindex='"+e(t(5))+"' data-onclick='remove-view'>Cancel</a>\n        &nbsp;or&nbsp;\n        <input type='submit' value='Save' data-onclick='save-work-signal'>\n      </div>\n    </div>\n  </div>\n</form>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["work_signals/index"]=function(t){return function(){var t,e;return t=window.HAML.cleanValue,e=[],e.push("<div class='box settings top'>\n  <div class='title'>\n    <a class='add' href='#' data-onclick='add-work-signal'>\n      Add a keyword\n    </a>\n    <h2>"),this.include_prefix&&e.push("      Keywords for"),e.push("      "+t(this.model.get("business_name"))),e.push("    </h2>\n  </div>\n  <div class='pad ten work_signals'>\n    <div class='empty hide' data-bind='toggle:not(length($collection))'>\n      <p>No keywords means no notifications!</p>\n      <p>\n        You should \n        <a href='#' data-onclick='add-work-signal'>add your first keyword</a>\n        for "+this.model.get("business_name")+".\n      </p>\n    </div>\n    <div class='hide work_signals_form'></div>\n    <div class='work-signals-list' data-bind='collection:$collection'></div>\n  </div>\n</div>\n<hr class='space'>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t;null==window.Paydirt&&(window.Paydirt={}),null==(t=window.Paydirt).Templates&&(t.Templates={}),window.Paydirt.Templates["work_signals/show"]=function(t){return function(){var t,e,i;return e=window.HAML.escape,t=window.HAML.cleanValue,i=[],i.push("<div>\n  <div class='ws' data-bind='text:text'></div>\n  <div class='test'>"),i.push(Paydirt.user.get("installed_extension")?"    <a target='_blank' href='https://www.google.com/search?q="+e(t(encodeURI(this.model.get("text"))))+"'>Test this keyword</a>":"    Install the\n    <a target='_blank' href='/help/guides/browser-extensions'>Paydirt extension for Chrome</a>\n    to use keywords"),i.push("  </div>\n  <div class='right'>\n    <a class='edit_link' href='#' data-onclick='edit-work-signal'>"+t(Paydirt.Utilities.spriteTag("icons-edit"))+"</a>\n    &nbsp;\n    <a class='delete' href='#' data-onclick='destroy-work-signal'>&times;</a>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){Paydirt.Mixins.EnableDisableRecurringInvoice={enableRecurring:function(t){return t.preventDefault(),this.model.save({},{url:"/recurring_invoices/"+this.model.id+"/enable",success:this.success})},disableRecurring:function(t){return t.preventDefault(),this.model.save({},{url:"/recurring_invoices/"+this.model.id+"/disable",success:this.success})},success:function(t,e){var i;return i=Paydirt.recurring_invoices.get(t.id),i.set({enabled:t.get("enabled")}),Paydirt.Flash.notice(e.flash)}}}.call(this),function(){Paydirt.Mixins.JobComputeds={humanPriceType:{deps:["price_type"],get:function(){return this.model.humanPriceType()}},formattedEstimate:{deps:["estimate"],get:function(){return Paydirt.Formatters.secondsToHours(this.model.get("estimate")||0)},set:function(t){return this.model.set({estimate:Paydirt.Formatters.hoursToSeconds(t)})}},formattedUnbilledValue:{deps:["unbilled_value"],get:function(){return this.model.get("unbilled_value").format()}},formattedPrice:{deps:["price"],get:function(){return this.model.get("price").format({sign:this.model.client().currency().get("sign")})},set:function(t){return this.model.set({price:Paydirt.Formatters.currencyToFloat(t)})}}}}.call(this),function(){Paydirt.Mixins.ReportComputeds={customRange:{deps:["range"],get:function(t){return"custom"===t}},formattedDateRange:{deps:["start","end"],get:function(t,e){switch(this.model.get("range")){case"day":return t.format("D MMM, YYYY");case"week":case"month":return t.isSame(e,"month")?""+t.format("D")+" to "+e.format("D MMM, YYYY"):""+t.format("D MMM")+" to "+e.format("D MMM, YYYY");case"quarter":case"year":return""+t.format("D MMM")+" to "+e.format("D MMM, YYYY")}}},formattedStart:{deps:["start"],get:function(t){return moment(t).format()},set:function(t){return this.model.setStart(t)}},formattedEnd:{deps:["end"],get:function(t){return moment(t).format()},set:function(t){return this.model.setEnd(t)}},humanRange:{deps:["range","start"],get:function(t,e){var i,n;return i=moment().startOf(t),n=moment().startOf(t).subtract(1,t),e.isSame(i)?"day"===t?"&nbsp;&nbsp;&nbsp;(today)":"&nbsp;&nbsp;&nbsp;(this "+t+")":e.isSame(n)?"day"===t?"&nbsp;&nbsp;&nbsp;(yesterday)":"&nbsp;&nbsp;&nbsp;(last "+t+")":""}}}}.call(this),function(){Paydirt.Views.Blocks={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Blocks.ClientSummary=function(e){function n(){return this.filterToClient=t(this.filterToClient,this),this.refresh=t(this.refresh,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["blocks/client_summary"],n.prototype.className="client_summary tooltip",n.prototype.events={click:"filterToClient"},n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.client=t.client},n.prototype.render=function(){return this.$el.html(this.template(this.client)).attr("title",this.client.get("business_name")),this},n.prototype.refresh=function(t){var e,i,n,s;return i=_.inject(t,function(){return function(t,e){return t+e.get("duration")}}(this),0),s=_.inject(t,function(){return function(t,e){return t+parseFloat(e.get("value"))}}(this),0),n=""+Paydirt.Formatters.secondsToHours(i)+"<span class='unit'>h</span>",e=this.model.get("blockable"),null!=e?+e.id===this.client.id?this.$el.removeClass("deselected zero_duration").addClass("selected"):(this.$el.removeClass("selected").addClass("deselected"),1>i?this.$el.addClass("zero_duration"):this.$el.removeClass("zero_duration")):(this.$el.removeClass("deselected selected"),1>i?this.$el.addClass("zero_duration"):this.$el.removeClass("zero_duration")),this.$(".duration").html(n)},n.prototype.filterToClient=function(t){var e;return t.preventDefault(),e=$("#autocompleter"),e.val(this.$el.hasClass("selected")?"":"client-"+this.client.get("id")),e.trigger("liszt:updated").trigger("change")},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Blocks.Duplicate=function(e){function n(){return this.cancel=t(this.cancel,this),this.save=t(this.save,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["blocks/duplicate"],n.prototype.events={"valid form.block_form":"save","click a.cancel":"cancel"},n.prototype.render=function(){var t;return this.$el.html(this.template({block:this.model})),this.subViews.form=t=new Paydirt.Views.Blocks.Form({model:this.model}),this.$(".block_form_container").html(t.render().el),this},n.prototype.save=function(t){var e;return t.preventDefault(),e=this.$("input:submit"),e.addClass("no-click"),this.model.save({},{success:function(t){return function(e,i){return t.model.markClean(),Paydirt._blocks.add(e),Paydirt.router.navigate(Paydirt.Routes.blocks(),{trigger:!0}),Paydirt.Flash.notice(i.flash)}}(this),error:function(){return function(){return e.removeClass("no-click")}}(this)})},n.prototype.cancel=function(t){return t.preventDefault(),this.model.markClean(),this.model.destroy(),window.history.back()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Blocks.Edit=function(e){function n(){return this.cancel=t(this.cancel,this),this.destroy=t(this.destroy,this),this.removeExternalBillingReference=t(this.removeExternalBillingReference,this),this.save=t(this.save,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["blocks/edit"],n.prototype.events={"valid form.block_form":"save","confirm a.remove_external_billing_reference":"removeExternalBillingReference","click a.cancel":"cancel","confirm #delete_log":"destroy"},n.prototype.render=function(){var t;return this.$el.html(this.template(this.model)),this.subViews.form=t=new Paydirt.Views.Blocks.Form({model:this.model}),this.$(".block_form_container").html(t.render().el),this},n.prototype.save=function(t){var e;return t.preventDefault(),e=this.$("input:submit"),e.addClass("no-click"),this.model.save({},{success:function(){return function(t,e){return Paydirt.blocks.remove(t.id),Paydirt.blocks.add(t),t.markClean(),Paydirt.router.navigateToBack(),Paydirt.Flash.notice(e.flash)}}(this),error:function(){return function(){return e.removeClass("no-click")}}(this)})},n.prototype.removeExternalBillingReference=function(){return this.model.save({},{url:""+Paydirt.Routes.block(this.model.id)+"/remove_external_billing_reference",success:function(){return function(t,e){return Paydirt.blocks.remove(t.id),Paydirt.blocks.add(t),t.markClean(),Paydirt.router.navigateToBack(),Paydirt.Flash.notice(e.flash)}}(this)})},n.prototype.destroy=function(t){return t.preventDefault(),this.model.destroy({success:function(){return function(t,e){return Paydirt.blocks.remove(t.id),Paydirt.Flash.deleted(e.flash),Paydirt.router.navigateToBack()}}(this)})},n.prototype.cancel=function(t){return t.preventDefault(),this.model.markClean(),window.history.back()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Blocks.Form=function(e){function n(){return this.saveIfCtrlEnter=t(this.saveIfCtrlEnter,this),this.validateForm=t(this.validateForm,this),this.setEndTime=t(this.setEndTime,this),this.setStartTime=t(this.setStartTime,this),this.setEndDate=t(this.setEndDate,this),this.setStartDate=t(this.setStartDate,this),this.removePausedDuration=t(this.removePausedDuration,this),this.setDuration=t(this.setDuration,this),this.incrementTime=t(this.incrementTime,this),this.incrementDuration=t(this.incrementDuration,this),this.setHourlyRate=t(this.setHourlyRate,this),this.setAttribute=t(this.setAttribute,this),this.setJob=t(this.setJob,this),this.setUser=t(this.setUser,this),this.refreshBillableToggle=t(this.refreshBillableToggle,this),this.setBillable=t(this.setBillable,this),this.refreshDatesAndTimes=t(this.refreshDatesAndTimes,this),this.refreshDuration=t(this.refreshDuration,this),this.showOptionalFields=t(this.showOptionalFields,this),this.showDurationType=t(this.showDurationType,this),this.toggleDurationType=t(this.toggleDurationType,this),this.render=t(this.render,this),this.teardown=t(this.teardown,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["blocks/form"],n.prototype.events={"change #block_billable":"setBillable","change #user_id":"setUser","change #job_id":"setJob","change #hourly_rate":"setHourlyRate","change #description":"setAttribute","keydown #description":"saveIfCtrlEnter","change #start_date":"setStartDate","change #end_date":"setEndDate","change #start_time":"setStartTime","change #end_time":"setEndTime","change #duration":"setDuration","keyup #duration":"incrementDuration","keyup #start_time":"incrementTime","keyup #end_time":"incrementTime","click #remove_paused_duration":"removePausedDuration","click .toggle_duration_type":"toggleDurationType","click .show_optional_fields":"showOptionalFields"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change:duration",this.refreshDuration),this.listenTo(this.model,"change:started_at change:ended_at",this.refreshDatesAndTimes),$(document).on("submit","form.block_form",this.validateForm)},n.prototype.teardown=function(){return n.__super__.teardown.apply(this,arguments),$(document).off("submit","form.block_form",this.validateForm)},n.prototype.render=function(){return this.$el.html(this.template({block:this.model})),this.refreshBillableToggle(),this.refreshDuration(),this.model.get("billable")?this.$(".hourly_rate_field").show():this.$(".hourly_rate_field").hide(),this.showDurationType(),this},n.prototype.toggleDurationType=function(t){return t.preventDefault(),this.model.set({duration_only:!this.model.get("duration_only")}),this.showDurationType()},n.prototype.showDurationType=function(){return this.$("a.toggle_duration_type").text(this.model.alternativeDurationTypeDescription()),this.model.get("duration_only")?(this.$(".start_and_end_mode").hide(),this.$("#paused_duration_container").hide(),this.$(".duration_only_mode").show()):(this.$(".start_and_end_mode").show(),this.$("#paused_duration_container").show(),this.$(".duration_only_mode").hide())},n.prototype.showOptionalFields=function(t){return null!=t&&t.preventDefault(),this.$(".summary_line").remove(),this.$(".optional_fields").show(),this.refreshBillableToggle()
},n.prototype.refreshDuration=function(){return this.$("#duration").val(Paydirt.Formatters.secondsToHM(this.model.get("duration"))),this.$("span.grey.calculated_duration").text("("+this.model.duration()+" hours)")},n.prototype.refreshDatesAndTimes=function(){return this.$("#start_date").val(this.model.startDate()),this.$("#start_time").val(this.model.startTime()),this.$("#end_date").val(this.model.endDate()),this.$("#end_time").val(this.model.endTime())},n.prototype.setBillable=function(t){var e;return e="1"===$(t.target).val(),this.model.set({billable:e}),this.$(".hourly_rate_field").toggle(e)},n.prototype.refreshBillableToggle=function(){var t,e;return this.$("#block_billable").val(this.model.get("billable")?"1":"0").trigger("liszt:updated"),this.$("#hourly_rate").val(Paydirt.Formatters.currency(this.model.get("hourly_rate"),{sign:null!=(t=this.model.job())?t.client().currency().get("sign"):void 0})),this.$("#hourly_rate").data("currency-sign",null!=(e=this.model.job())?e.client().currency().get("sign"):void 0),this.$(".billable_description").text(this.model.billableDescription()),this.model.get("billable")?this.$(".hourly_rate_field").fadeIn(200):this.$(".hourly_rate_field").fadeOut(200)},n.prototype.setUser=function(t){var e,i;return e=$(t.target).val(),this.model.set({user_id:e}),(null!=(i=this.model.job())?i.perUser():void 0)&&this.model.set({hourly_rate:this.model.user().get("hourly_rate")}),this.refreshBillableToggle()},n.prototype.setJob=function(t){var e;return e=Paydirt.jobs.get($(t.target).val()),this.model.associateWithJob(e),this.refreshBillableToggle()},n.prototype.setAttribute=function(t){var e;return e=$(t.target),this.model.set(e.prop("id"),e.val())},n.prototype.setHourlyRate=function(t){var e;return e=$(t.target),this.model.set({hourly_rate:Paydirt.Formatters.currencyToFloat(e.val())})},n.prototype.incrementDuration=function(t){var e,i,n;return e=t.keyCode||t.which,e=parseInt(e,10),(38===e||40===e)&&(n=38===e?1:-1,i=+this.model.get("duration")+900*n,i>=0)?this.model.set({duration:i}):void 0},n.prototype.incrementTime=function(t){var e,i,n,s;return i=t.keyCode||t.which,i=parseInt(i,10),38===i||40===i?(e="end_time"===$(t.target).attr("id")?"endTime":"startTime",n=38===i?1:-1,s=this.model.timeTraverse(e,900*n)):void 0},n.prototype.setDuration=function(t){var e,i;return t.preventDefault(),e=$(t.target),i=Paydirt.Formatters.hoursMinutesToSeconds(e.val()),this.model.set({duration:i}),this.model.trigger("change:duration")},n.prototype.removePausedDuration=function(t){return t.preventDefault(),this.$("#paused_duration_container").hide(),this.model.set({paused_duration:0})},n.prototype.setStartDate=function(t){var e;return e=$(t.target).val(),""!==e?this.model.setStartDate(e):void 0},n.prototype.setEndDate=function(t){var e;return e=$(t.target).val(),""!==e?this.model.setEndDate(e):void 0},n.prototype.setStartTime=function(t){var e;return e=Paydirt.Formatters.time($(t.target).val()),this.model.setStartTime(e)},n.prototype.setEndTime=function(t){var e,i,n,s;return e=$(t.target),s=e.val(),n=this.model.startTime(),i=Paydirt.Formatters.time(s,n),this.model.setEndTime(i)},n.prototype.validateForm=function(t){var e,i;return t.preventDefault(),t.stopImmediatePropagation(),i=this.$("#start_time"),e=this.$("#end_time"),this.model.get("duration_only")?(i.removeClass("invalid"),e.removeClass("invalid")):(i.toggleClass("invalid",""===i.val()),e.toggleClass("invalid",""===e.val())),!Paydirt.Utilities.validateForm($("form.block_form"))||i.hasClass("invalid")||e.hasClass("invalid")?$('form.block_form input[type="submit"]').shake():$("form.block_form").trigger("valid")},n.prototype.saveIfCtrlEnter=function(t){var e;return e=t.keyCode||t.which,13===e&&t.ctrlKey?($(t.currentTarget).trigger("blur"),this.validateForm(t)):void 0},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.Graphs={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Graphs.Base=function(e){function n(){return this.setGraphData=t(this.setGraphData,this),this.refresh=t(this.refresh,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.collection,"reset",this.refresh),this.clients=t.clients,$(window).resize(function(t){return function(){return clearTimeout(t.resizeTimeout),t.resizeTimeout=setTimeout(function(){return+t.w!==t.calculateSvgWidth()?t.render():void 0},200)}}(this))},n.prototype.calculateSvgWidth=function(){return+$("#header .container").first().innerWidth()-90-this.p[1]-this.p[3]},n.prototype.render=function(){return this.p=[10,20,20,5],this.w=this.calculateSvgWidth(),this.h=250-this.p[0]-this.p[2],this.x=d3.time.scale().rangeRound([0,this.w]),this.y=d3.scale.linear().rangeRound([0,this.h]),this.y_axis_scale=d3.time.scale().rangeRound([this.h,0]),this.z=d3.scale.ordinal().range(this.clients.pluck("color")),this.xAxis=d3.svg.axis().orient("bottom").scale(this.x).tickSize(0,0,0).ticks(d3.time.days,1).tickPadding(0),this.yAxis=d3.svg.axis().scale(this.y_axis_scale).orient("right").tickSize(this.w,this.w,0).ticks(d3.time.hours,1).tickFormat(function(t){var e;return e=Math.round(t.valueOf()/36e5),e>0?e:""}),this.$el.empty(),this.chart=d3.select(this.el).append("svg").attr("class","chart").attr("width",this.w+this.p[1]+this.p[3]).attr("height",this.h+this.p[0]+this.p[2]).append("svg:g").attr("transform","translate("+this.p[3]+","+this.p[0]+")"),this.chart.append("svg:g").attr("class","x axis").call(this.xAxis),this.chart.append("svg:g").attr("class","y axis").call(this.yAxis),this.refresh({initializing:!0}),this},n.prototype.refresh=function(t){var e,i,n,s,r,a,o,l;return null==t&&(t={}),0!==this.clients.length?(this.setGraphData(),s=_(this.clientChartData).inject(function(t,e){return t+e.length},0),e=s>1500||t.initializing?0:800,this.layers=this.chart.selectAll("g.client").data(this.clientChartData),this.layers.enter().append("svg:g").attr("class","client").style("fill",function(t){return function(e,i){return t.z(i)}}(this)),this.layers.exit().remove(),this.existing_rects=this.rects=this.layers.selectAll("rect").data(Object,function(t){return t.ident}),this.rects.enter().append("svg:rect").attr("height",function(t){return function(e){return.1*t.y(e.y)}}(this)).attr("width",this.w/this.interval*.9).attr("y",function(t){return function(e){return t.h-.1*t.y(e.y0)-.1*t.y(e.y)}}(this)).attr("x",function(t){return function(e){var i;return"date"===t.model.get("lastFilterBy")?(i=e.x>t.model.get("previousEndDate")?t.w+t.x(e.x):-t.w+t.x(e.x),i+t.w/(t.interval+1)*.05):t.x(e.x)+t.w/(t.interval+1)*.05}}(this)).style("opacity",0),this.rects.transition().duration(e).attr("y",function(t){return function(e){return t.h-t.y(e.y0)-t.y(e.y)}}(this)).attr("x",function(t){return function(e){return t.x(e.x)+t.w/(t.interval+1)*.05}}(this)).attr("height",function(t){return function(e){return t.y(e.y)}}(this)).attr("width",this.w/this.interval*.9).style("opacity",1),this.rects.exit().transition().duration(e).attr("x",function(t){return function(e){var i;return"date"===t.model.get("lastFilterBy")?(i=e.x>t.end.toDate()?t.w+t.x(e.x):-t.w+t.x(e.x),i+t.w/t.interval*.1):t.x(e.x)+t.w/(t.interval+1)*.05}}(this)).attr("height",function(t){return function(e){return"date"===t.model.get("lastFilterBy")?t.y(e.y):0}}(this)).attr("y",function(t){return function(e){return"date"===t.model.get("lastFilterBy")?t.h-t.y(e.y0)-t.y(e.y):t.h}}(this)).attr("width",this.w/this.interval*.9).style("opacity",0).remove(),r=this.maxValue>86400?4:this.maxValue>50400?2:1,this.yAxis.ticks(d3.time.hours,r),this.chart.transition().duration(e).select("g.y.axis").call(this.yAxis),this.interval<14?(o=d3.time.days,a=d3.time.format("%a, %b %d"),l=0,n=this.rangeBand/2,i="middle"):this.interval<40?(o=d3.time.weeks,a=d3.time.format("%a, %b %d"),l=this.h,n=5,i="start"):this.interval<365?(o=d3.time.months,a=d3.time.format("%b, %Y"),l=this.h,n=5,i="start"):(o=d3.time.years,a=d3.time.format("%Y"),l=this.h,n=5,i="start"),this.xAxis.tickPadding(this.h-l+5).tickSize(l,0,0).tickFormat(function(t){return function(e){return e>t.end.toDate()?"":a(e)}}(this)).ticks(o,1),this.chart.transition().duration(e).select("g.x.axis").call(this.xAxis).selectAll("g.x.axis text").attr("dx",n).attr("text-anchor",i)):void 0},n.prototype.setGraphData=function(){var t;return t=this.collection.groupBy(this.groupingFunction),this.clientChartData=d3.layout.stack()(this.clients.map(function(e){return function(i){var n;return e.client=i,n=[],_.keys(t).forEach(function(i){var s,r,a;return r=t[i],s=r.filter(e.filteringFunction),a=_(s).inject(e.summingFunction,0),n.push({x:new Date(i),y:a,ident:i+"_"+e.client.get("id")})}),n}}(this))),this.maxValue=this.clientChartData.length>0&&_(this.clientChartData).last().length>0?d3.max(_(this.clientChartData).last(),function(t){return t.y0+t.y}):0,this.maxValue=1.1*Math.max(this.maxValue,28e3),this.y.domain([0,this.maxValue]),this.y_axis_scale.domain([new Date(0),new Date(1e3*this.maxValue)]),"all-time"===this.model.get("dateRangeType")?(0===this.collection.length?(this.end=moment(),this.start=this.end.clone().subtract("days",7)):(this.start=this.firstObjectDate(),this.end=this.lastObjectDate()),this.end-this.start<6048e5&&(this.end=this.start.clone().add("days",6))):(this.start=this.model.cloneStartDate(),this.end=this.model.cloneEndDate()),this.interval=Math.round((this.end-this.start)/864e5)+1,this.x.domain([this.start,this.end.clone().add("days",1).toDate()]),this.rangeBand=this.x(this.start.clone().add("d",1).toDate())},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Blocks.Graph=function(e){function n(){return this.lastObjectDate=t(this.lastObjectDate,this),this.firstObjectDate=t(this.firstObjectDate,this),this.summingFunction=t(this.summingFunction,this),this.filteringFunction=t(this.filteringFunction,this),this.groupingFunction=t(this.groupingFunction,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.groupingFunction=function(t){return t.date()},n.prototype.filteringFunction=function(t){return t.client().id===this.client.id},n.prototype.summingFunction=function(t,e){return t+e.get("duration")},n.prototype.firstObjectDate=function(){return moment(this.collection.last().date())},n.prototype.lastObjectDate=function(){return moment(this.collection.first().date())},n}(Paydirt.Views.Graphs.Base)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Blocks.Index=function(e){function n(){return this.toggleAdvancedSearch=t(this.toggleAdvancedSearch,this),this.addExternalBillingReference=t(this.addExternalBillingReference,this),this.print=t(this.print,this),this["export"]=t(this["export"],this),this.nextPeriod=t(this.nextPeriod,this),this.previousPeriod=t(this.previousPeriod,this),this.setEndDate=t(this.setEndDate,this),this.setStartDate=t(this.setStartDate,this),this.setBilled=t(this.setBilled,this),this.setBillable=t(this.setBillable,this),this.setDateRangeType=t(this.setDateRangeType,this),this.setInvoice=t(this.setInvoice,this),this.setUser=t(this.setUser,this),this.changeBlockable=t(this.changeBlockable,this),this.filterBlocks=t(this.filterBlocks,this),this.fetchBlocks=t(this.fetchBlocks,this),this.refresh=t(this.refresh,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["blocks/index"],n.prototype.events={"click #previous":"previousPeriod","click #next":"nextPeriod","change #start_date":"setStartDate","change #end_date":"setEndDate","change #date_range_type":"setDateRangeType","change #user_name":"setUser","change #invoice_number":"setInvoice","change #billable_type":"setBillable","change #billed_type":"setBilled","change #autocompleter":"changeBlockable","click #export_csv":"export","click #print_blocks":"print","click #add_external_billing_reference":"addExternalBillingReference","click #toggle_advanced_search":"toggleAdvancedSearch"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.clients=Paydirt.clients,this.model=new Paydirt.Models.BlockBrowser,this.model.setState({initializing:!0}),Paydirt.router.onpopstate=function(t){return function(e){return null!=e.state?t.model.setState({from:e.state,popped:!0}):void 0}}(this),this.fullyFilteredBlocks=new Paydirt.Collections.Blocks(this.collection.models),this.filteredBlocks=new Paydirt.Collections.Blocks(this.collection.models),this.filterBlocks(),this.listenTo(this.model,"dateRangeChanged change:blockable change:user change:invoice change:billable change:billed",this.fetchBlocks),this.listenTo(this.collection,"add remove change reset",this.filterBlocks),this.listenTo(this.fullyFilteredBlocks,"reset",this.refresh),this.subViews.graph=new Paydirt.Views.Blocks.Graph({collection:this.fullyFilteredBlocks,model:this.model,clients:this.clients}),this.subViews.summary=new Paydirt.Views.Blocks.Summary({collection:this.filteredBlocks,totalsCollection:this.fullyFilteredBlocks,model:this.model,clients:this.clients}),this.subViews.blockList=new Paydirt.Views.Blocks.List({collection:this.fullyFilteredBlocks})},n.prototype.render=function(){return this.$el.html(this.template()),this.$("#blocks_summary").html(this.subViews.summary.render().el),this.$("#block_list").html(this.subViews.blockList.render().el),this.$("#graph").html(this.subViews.graph.render().el),this.refresh(),this.fetchBlocks(),this},n.prototype.refresh=function(){var t,e,i,n,s;return this.$("#date_range_type").val(this.model.get("dateRangeType")).trigger("liszt:updated"),"all-time"===this.model.get("dateRangeType")?this.$("#date_fields").hide():(this.$("#date_fields").show(),this.$("#start_date").val(new moment(this.model.get("startDate")).format()),this.$("#end_date").val(new moment(this.model.get("endDate")).format())),i=this.model.get("blockable"),null!=i?this.$("#autocompleter").val(""+i.type+"-"+i.id).trigger("change"):this.$("#autocompleter").val("").trigger("change"),s=this.model.get("user"),this.$("#user_name").val(s).trigger("change"),t=this.model.get("billable"),e=this.model.get("billed"),n=this.model.get("invoice"),this.$("#billable_type").val(t).trigger("liszt:updated"),this.$("#billed_type").val(e).trigger("liszt:updated"),this.$("#invoice_number").val(n).trigger("liszt:updated"),null!=t||null!=e||null!=n?this.$("#advanced_filters_row").show():this.$("#advanced_filters_row").hide(),this},n.prototype.fetchBlocks=function(){return this.$("#graph").addClass("loading"),$.get("/time/search",this.model.toJSON()).done(function(t){return function(e){return t.collection.add(e.blocks,{silent:!0}),t.filteredBlocks.reset(e.blocks),t.fullyFilteredBlocks.reset(t.filteredBlocks.filter(function(e){var i,n;if(i=t.model.get("blockable"),null!=i)switch(i.type){case"project":if((null!=(n=e.project())?n.id:void 0)!==+i.id)return!1;break;case"client":if(e.client().id!==+i.id)return!1;break;default:if(e.get(""+i.type+"_id")!==+i.id)return!1}return!0})),t.$("#graph").removeClass("loading")}}(this))},n.prototype.filterBlocks=function(){var t,e,i,n,s,r,a,o,l,c,d,u,p;return a="all-time"===this.model.get("dateRangeType")?!1:!0,u=this.model.get("startDate"),c=this.model.get("endDate"),p=this.model.get("user"),null!=p&&""!==p&&(l=!0,p=+p),d=this.model.get("invoice"),null!=d&&""!==d&&(o=!0,d=+d),t=this.model.get("billable"),null!=t&&""!==t&&(n=!0,t="true"===t?!0:!1),e=this.model.get("billed"),null!=e&&""!==e&&(s=!0,e="true"===e?!0:!1),i=this.model.get("blockable"),r=null!=i,this.filteredBlocks.reset(this.collection.filter(function(){return function(i){var r,h;return!a||u<=(r=i.date())&&c>=r?l&&p!==i.get("user_id")?!1:o&&d!==(null!=(h=i.invoice())?h.id:void 0)?!1:n&&i.get("billable")!==t?!1:s&&i.get("billed")!==e?!1:!0:!1}}(this))),this.fullyFilteredBlocks.reset(this.filteredBlocks.filter(function(){return function(t){var e;if(r)switch(i.type){case"project":if((null!=(e=t.project())?e.id:void 0)!==+i.id)return!1;break;case"client":if(t.client().id!==+i.id)return!1;break;default:if(t.get(""+i.type+"_id")!==+i.id)return!1}return!0}}(this)))},n.prototype.changeBlockable=function(){var t,e,i,n,s;return t=this.$("#autocompleter"),s=t.val(),""===s?this.model.unset("blockable"):(n=s.split("-"),e=n[0],i=n[1],this.model.set({blockable:{type:e,id:i}}))},n.prototype.setUser=function(t){return t.preventDefault(),this.model.set({user:this.$("#user_name").val()})},n.prototype.setInvoice=function(t){return t.preventDefault(),this.model.set({invoice:$(t.target).val()})},n.prototype.setDateRangeType=function(t){return t.preventDefault(),this.model.set({dateRangeType:$(t.target).val()})},n.prototype.setBillable=function(t){return t.preventDefault(),this.model.set({billable:$(t.target).val()})},n.prototype.setBilled=function(t){return t.preventDefault(),this.model.set({billed:$(t.target).val()})},n.prototype.setStartDate=function(t){var e;return t.preventDefault(),e=new Date($(t.target).val()),"Invalid Date"===e.toString()?this.$("#start_date").addClass("invalid"):(this.$("#start_date").removeClass("invalid"),this.model.setStartDateTo(e))},n.prototype.setEndDate=function(t){var e;return t.preventDefault(),e=new Date($(t.target).val()),"Invalid Date"===e.toString()?this.$("#end_date").addClass("invalid"):(this.$("#end_date").removeClass("invalid"),this.model.setEndDateTo(e))},n.prototype.previousPeriod=function(t){return t.preventDefault(),this.model.previousPeriod()},n.prototype.nextPeriod=function(t){return t.preventDefault(),this.model.nextPeriod()},n.prototype["export"]=function(t){return t.preventDefault(),window.location.href="/time/export?"+$.param(this.model.toJSON())},n.prototype.print=function(t){return t.preventDefault(),window.open("/time/print?"+$.param(this.model.toJSON()),"_blank")},n.prototype.addExternalBillingReference=function(t){var e,i,n;return t.preventDefault(),i="",e=$.Deferred(),e.done(function(t){return function(){return t.fullyFilteredBlocks.addExternalBillingReference(i)}}(this)),n="If you proceed, all "+this.fullyFilteredBlocks.length+" log entries will be marked as billed, with the reference you specify below.\n<br />\n<br />\nYou may want to do this if you already billed for this work outside of Paydirt.\n<br />\n<br />\nIf you send invoices through Paydirt, you probably don't want to do this. Creating an invoice for time logged in Paydirt will <i>automatically</i> mark it as billed.\n<br />\n<br />\n<label for='external_billing_reference'>This work was billed outside of Paydirt in:</label>\n<input type='text' id='external_billing_reference' placeholder='eg. Xero inv-331, MYOB, Excel...' />",$(document).on("keyup","#external_billing_reference",function(){return i=$(this).val(),""===i?$("#fancyConfirm_ok").addClass("no-click"):$("#fancyConfirm_ok").removeClass("no-click")}),fancyConfirm({message:n,cancel:"Cancel",confirm:"Mark list as billed"},function(t){return t===!0?e.resolve():void 0}),$("#fancyConfirm_ok").addClass("no-click")},n.prototype.toggleAdvancedSearch=function(t){var e;return t.preventDefault(),this.$("#advanced_filters_row").toggle(),e=this.$("#advanced_filters_row").is(":visible")?"up":"down",this.$("#toggle_advanced_search i").removeClass().addClass("icon-circle-arrow-"+e)},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Blocks.List=function(e){function n(){return this.destroy=t(this.destroy,this),this.showDescription=t(this.showDescription,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.events={"click .item":"showDescription","confirm a.delete":"destroy"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.collection,"reset",this.render)},n.prototype.render=function(){var t,e,i,n,s,r,a,o,l,c,d;if(null!=(c=this.subViews.links)&&c.teardown(),this.$el.empty(),s="",this.collection.length>0){a=null,this.subViews.links=new Paydirt.Views.Blocks.ListLinks({collection:this.collection}),d=this.collection.groupBy(function(){return function(t){return t.date().getTime()}}(this));for(i in d)for(e=d[i],n=new Paydirt.Collections.Blocks(e).duration(),r=moment(+i),s+="<div class='row'><div class='span-20'>"+r.format("dddd DD MMM, YYYY")+"</div> <div class='span-4 last'><span class='total'>"+n+" <span class='unit'>hrs</span></span></div></div>",o=0,l=e.length;l>o;o++)t=e[o],s+=Paydirt.Templates["blocks/list_item"]({block:t,description:t.get("description"),user:t.user(),client:t.client()});this.$el.append(s),this.$el.append(this.subViews.links.render().el),this.$el.fadeIn()}else this.$el.fadeOut();return this},n.prototype.showDescription=function(t){var e;return t.preventDefault(),e=$(t.currentTarget),e.parents(".block").toggleClass("current"),e.parents(".block").hasClass("current")?e.parents(".block").find(".full-detail-container").slideDown(200):e.parents(".block").find(".full-detail-container").slideUp(200)},n.prototype.destroy=function(t){var e;return t.preventDefault(),e=Paydirt.blocks.get($(t.currentTarget).data("block-id")),null!=e?e.destroy({success:function(){return function(t,e){return Paydirt.blocks.remove(t.id),Paydirt.Flash.deleted(e.flash)}}(this)}):void 0},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Blocks.ListLinks=function(e){function n(){return this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["blocks/list_links"],n.prototype.render=function(){var t,e,i,n,s;return e=this.collection.filter(function(){return function(t){return t.get("billed")}}(this)),e.length>0?(i="disabled",t="tooltip",s="Unable to mark list as billed, because one or more log entries has already been billed."):n="add_external_billing_reference",this.$el.html(this.template({id:n,"class":i,behaviour:t,title:s})),this},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Blocks.New=function(e){function n(){return this.cancel=t(this.cancel,this),this.save=t(this.save,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["blocks/new"],n.prototype.events={"valid form.block_form":"save","click a.cancel":"cancel"},n.prototype.initialize=function(t){var e;return n.__super__.initialize.apply(this,arguments),null!=t.jobId?(e=Paydirt.jobs.get(t.jobId),Paydirt.block.associateWithJob(e),Paydirt.dirty=null):void 0},n.prototype.render=function(){var t;return this.$el.html(this.template()),this.subViews.form=t=new Paydirt.Views.Blocks.Form({model:this.model}),this.$(".block_form_container").html(t.render().el),this},n.prototype.save=function(t){var e;return t.preventDefault(),e=this.$("input:submit"),e.addClass("no-click"),this.model.save({},{success:function(t){return function(e,i){return t.model.markClean(),Paydirt._blocks.add(e),Paydirt.router.navigateToBack(),Paydirt.Flash.notice(i.flash)}}(this),error:function(){return function(){return e.removeClass("no-click")}}(this)})},n.prototype.cancel=function(t){return t.preventDefault(),this.model.markClean(),this.model.destroy(),window.history.back()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Blocks.Summary=function(e){function n(){return this.refreshTotals=t(this.refreshTotals,this),this.refreshClients=t(this.refreshClients,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["blocks/summary"],n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.totalsCollection=t.totalsCollection,this.clients=t.clients,this.listenTo(this.collection,"reset",this.refreshClients),this.listenTo(this.totalsCollection,"reset",this.refreshTotals)},n.prototype.render=function(){return this.$el.html(this.template()),this.clients.each(function(t){return function(e){var i;return t.subViews["client-"+e.cid]=i=new Paydirt.Views.Blocks.ClientSummary({model:t.model,client:e}),t.$("#summary").prepend(i.render().el)}}(this)),this.refreshClients(),this.refreshTotals(),this},n.prototype.refreshClients=function(){var t;return t=this.collection.groupBy(function(){return function(t){return t.client().id}}(this)),this.clients.each(function(e){return function(i){var n;return null!=(n=e.subViews["client-"+i.cid])?n.refresh(t[i.id.toString()]):void 0}}(this))},n.prototype.refreshTotals=function(){var t,e,i,n,s,r,a;s=this.totalsCollection.duration(),this.$("#total-duration .amount").html(""+s+" <span class='unit'>hrs</span>"),r=_(this.totalsCollection.where({billable:!0})).groupBy(function(t){return t.client().currency().id}),this.$("#total-value").html("<div class='t-right'><span class='amount'>&ndash;</span></div>"),_.isEmpty(r)||this.$("#total-value").html("");for(n in r)e=r[n],i=Paydirt.currencies.get(n),a=new Paydirt.Collections.Blocks(e).value(),this.$("#total-value").append("<div class='t-right'> <span class='currency'>"+i.get("sign")+"</span> <span class='amount'>"+Paydirt.Formatters.currency(a,{sign:"",code:i.get("code")})+"</span> </div> <hr class='space' />");return s>0?this.$(".empty").hide():(t=this.model.get("blockable"),null!=t?"client"===t.type?t=Paydirt.clients.get(t.id).attributes.business_name:"project"===t.type?t=Paydirt.projects.get(t.id).attributes.name:"job"===t.type&&(t=Paydirt.jobs.get(t.id).attributes.name):t="any client",this.$(".empty").text("No time logged for "+t).show())},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.Clients={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Clients.Edit=function(e){function n(){return this.toggleActive=t(this.toggleActive,this),this.destroy=t(this.destroy,this),this.save=t(this.save,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["clients/edit"],n.prototype.events={"valid form.client_form":"save","confirm a.delete_client":"destroy","confirm a.archive":"toggleActive"},n.prototype.render=function(){var t,e;return this.$el.html(this.template(this.model)),null!=(e=this.subViews.form)&&e.teardown(),this.subViews.form=t=new Paydirt.Views.Clients.Form({model:this.model}),this.$(".form").html(t.render().el),this},n.prototype.save=function(t){return t.preventDefault(),this.subViews.form.save()},n.prototype.destroy=function(t){return t.preventDefault(),this.model.destroy({success:function(){return function(t,e){return Paydirt.router.navigate(Paydirt.Routes.clients(),{trigger:!0}),Paydirt.Flash.deleted(e.flash)}}(this)})},n.prototype.toggleActive=function(t){var e,i;return t.preventDefault(),this.model.get("active")?(e=!1,i="Moved "+this.model.get("business_name")+" to your list of archived clients"):(e=!0,i="Moved "+this.model.get("business_name")+" to your list of current clients"),this.model.save({active:e},{wait:!0,success:function(){return function(){return Paydirt.router.navigate(Paydirt.Routes.clients(),{trigger:!0}),Paydirt.Flash.notice(i)}}(this)})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Clients.Form=function(e){function n(){return this.save=t(this.save,this),this.previewLogo=t(this.previewLogo,this),this.selectLogo=t(this.selectLogo,this),this.populateShortname=t(this.populateShortname,this),this.populateMonogram=t(this.populateMonogram,this),this.toggleShortname=t(this.toggleShortname,this),this.renderBadge=t(this.renderBadge,this),this.changeBadgeType=t(this.changeBadgeType,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["clients/form"],n.prototype.events={'change [name="badge_type"]':"changeBadgeType","change #business_name":"populateMonogram","change #monogram":"renderBadge","keyup #monogram":"renderBadge","blur #business_name":"populateShortname","change #shortname_type":"toggleShortname","blur #shortname":"populateShortname","click .select_logo":"selectLogo","change #logo":"previewLogo"},n.prototype.render=function(){return this.$el.html(this.template(this.model)),this.$(".colorpicker").minicolors({theme:"bootstrap",change:function(t){return function(){return t.renderBadge()}}(this)}),this.changeBadgeType(),this},n.prototype.changeBadgeType=function(){return this.new_badge_type=this.$('[name="badge_type"]:checked').val(),this.$("#logo_selector").toggle("logo"===this.new_badge_type),this.$("#monogram_selector").toggle("monogram"===this.new_badge_type),this.renderBadge()},n.prototype.renderBadge=function(){return this.$(".demo").html(this.model.badge({size:"big",type:this.new_badge_type,color:this.$("#color").val(),logo_path:this.logo,monogram:this.$("#monogram").val()}))},n.prototype.toggleShortname=function(){var t;return t=this.$("#shortname_type"),"new"===t.val()?(this.$("#shortname").show(),this.populateShortname()):this.$("#shortname").hide().val(t.val())},n.prototype.populateMonogram=function(){return""===this.$("#monogram").val()?this.$("#monogram").val(this.$("#business_name").val().substring(0,2)).trigger("change"):void 0},n.prototype.populateShortname=function(){var t,e,i;if("new"===this.$("#shortname_type").val()){for(e=""===this.$("#shortname").val()&&""!==this.$("#business_name").val()?this.$("#business_name").val().substring(0,3).toLowerCase():this.$("#shortname").val(),i=e,t=0;-1!==Paydirt.clients.pluck("shortname").indexOf(i);)t+=1,i=""+e+t;return this.$("#shortname").val(i)}},n.prototype.selectLogo=function(t){return t.preventDefault(),this.$("#logo").click()},n.prototype.previewLogo=function(t){var e;return t.preventDefault(),e=new FileReader,e.onload=function(t){return function(e){return t.logo=e.target.result,t.$(".badge.big.client_logo").css("background-image","url("+t.logo+")"),t.$(".select_logo").text(t.file.name)}}(this),this.file=$(t.target).get(0).files[0],this.file.size/1024>100?($(t.target).val(""),this.$("#logo_error").show()):(this.$("#logo_error").hide(),e.readAsDataURL(this.file))},n.prototype.save=function(){var t,e,i;return e=this.model.get("hourly_rate"),t=new Money(Paydirt.Formatters.currencyToFloat(this.$("#hourly_rate").val())),i=function(e){return function(i){return null==i&&(i=!1),e.model.save({business_name:e.$("#business_name").val(),billing_contact_name:e.$("#billing_contact_name").val(),billing_email_address:e.$("#billing_email_address").val(),billing_address:e.$("#billing_address").val(),shortname:e.$("#shortname").val(),hourly_rate:t,color:e.$("#color").val(),currency_id:+e.$("#currency_id").val(),locale:e.$("#locale").val(),invoicing_threshold:Paydirt.Formatters.currencyToFloat(e.$("#invoicing_threshold").val()),logo:null!=e.logo?e.logo:void 0,monogram:e.$("#monogram").val(),new_badge_type:e.$('[name="badge_type"]:checked').val(),update_blocks:i},{success:function(t,i){return Paydirt.clients.add(t),null!=i.project&&Paydirt.projects.add(i.project),Paydirt.router.navigate(Paydirt.Routes.client(e.model.id),{trigger:!0}),Paydirt.Flash.notice(i.flash)
}})}}(this),+e!==+t?fancyConfirm({heading:"Do you want to update the hourly rate of existing time logs?",message:"You're changing the hourly rate for this client from <b>"+e.format()+"</b> to <b>"+t.format()+"</b>. \n<br /><br />\nDo you want to also update all unbilled time logs that were logged at the client's hourly rate to the new rate of <b>"+t.format()+"</b> per hour?\n<br /><br />\nThis won't update any time logs that you've already billed.",cancel:"Don't update time logs",confirm:"Update my unbilled time logs"},function(t){return i(t)}):i()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Clients.Index=function(e){function n(){return this.showClientForm=t(this.showClientForm,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["clients/index"],n.prototype.render=function(){var t;return this.$el.html(this.template({active:this.options.active})),0===this.collection.length?(this.$(".empty").show(),this.$(".clients").hide()):(this.subViews.clientsList=t=new Paydirt.Views.Clients.List({collection:this.collection}),this.$(".clients").append(t.render().el)),this.subViews.newClient=t=new Paydirt.Views.Clients.InlineNew({model:new Paydirt.Models.Client}),this.$(".new_client_form_container").html(t.render().el),this.$(".secondary_navigation").find("a[href$='"+window.location.pathname+"']").addClass("selected"),this},n.prototype.showClientForm=function(t){return t.preventDefault(),this.$(".action-bar.new_client").slideToggle("fast").find("input:first").focus()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Clients.InlineNew=function(e){function n(){return this.editClientDetails=t(this.editClientDetails,this),this.addNewClient=t(this.addNewClient,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["clients/inline_new"],n.prototype.addNewClient=function(t){return t.preventDefault(),this.model.save({business_name:this.$("#client_business_name").val()},{success:function(t){return function(e,i){return Paydirt.clients.add(t.model),Paydirt.projects.add(i.project),Paydirt.router.navigate(Paydirt.Routes.client(t.model.id),{trigger:!0}),Paydirt.Flash.notice(i.flash)}}(this)})},n.prototype.editClientDetails=function(t){return t.preventDefault(),this.model.save({business_name:this.$("#client_business_name").val()},{success:function(t){return function(e,i){return Paydirt.clients.add(t.model),Paydirt.projects.add(i.project),Paydirt.router.navigate(Paydirt.Routes.edit_client(t.model.id),{trigger:!0}),Paydirt.Flash.notice(i.flash)}}(this)})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Clients.Invoices=function(e){function n(){return this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["clients/invoices"],n.prototype.render=function(){var t;return this.$el.html(this.template()),t=new Paydirt.Views.Invoices.List({collection:this.model.invoices,client:this.model}),this.$(".invoices_list").append(t.render().el),t=new Paydirt.Views.Invoices.ListSummary({collection:this.model.invoices}),this.$(".invoices_summary").append(t.render().el),this},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Clients.Keywords=function(e){function n(){return this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["clients/keywords"],n.prototype.render=function(){var t,e;return null!=(e=this.subViews.workSignals)&&e.teardown(),this.subViews.workSignals=t=new Paydirt.Views.WorkSignals.Index({model:Paydirt.client,collection:Paydirt.client.work_signals,include_prefix:!0}),this.$el.html(this.template()),this.$(".keywords_container").append(t.render().el),this},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Clients.List=function(e){function n(){return this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["clients/list"],n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.collection,"add remove reset",this.render)},n.prototype.render=function(){var t,e,i,n,s,r;r=this.subViews;for(s in r)n=r[s],n.teardown();this.collection.each(function(t){return function(e){return t.subViews["client-"+e.cid]=n=new Paydirt.Views.Clients.ListItem({model:e}),t.$el.append(n.render().el)}}(this)),i=this.collection.groupBy(function(t){return t.currency().id});for(e in i)t=i[e],i[e]=new Paydirt.Collections.Clients(t);return this.$el.append(this.template({groupedClients:i})),this},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Clients.ListItem=function(e){function n(){return this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["clients/list_item"],n.prototype.initialize=function(){return this.listenTo(this.model,"change",this.render),this.listenTo(this.model.jobs,"add remove change reset",this.render)},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Clients.New=function(e){function n(){return this.save=t(this.save,this),this.cancel=t(this.cancel,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["clients/new"],n.prototype.events={"valid form.client_form":"save","click a.cancel":"cancel"},n.prototype.render=function(){var t,e;return this.$el.html(this.template(this.model)),null!=(e=this.subViews.form)&&e.teardown(),this.subViews.form=t=new Paydirt.Views.Clients.Form({model:this.model}),this.$(".form").html(t.render().el),this},n.prototype.cancel=function(){return this.model.destroy(),!0},n.prototype.save=function(t){return t.preventDefault(),this.subViews.form.save()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Clients.NewInvoice=function(e){function n(){return this.invoiceParams=t(this.invoiceParams,this),this.showPreview=t(this.showPreview,this),this.draftWorkInvoice=t(this.draftWorkInvoice,this),this.setDateRange=t(this.setDateRange,this),this.toggleInvoiceOptions=t(this.toggleInvoiceOptions,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["clients/new_invoice"],n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.itemView=Paydirt.Views.Projects.InvoiceFields,this.model=t.client,this.invoice=t.invoice,this.projects=new Paydirt.Collections.Projects(null!=t.invoiceFor?this.model.projects.get(t.invoiceFor):this.model.projects.select(function(t){return t.expenses.length||t.jobs.any(function(t){return t.canBeInvoiced()})})),this.collection=this.projects,this.projects.itemView=Paydirt.Views.Projects.InvoiceFields,this.line_item_creation_options=new Backbone.Model(Paydirt.account.get("line_item_creation_options"))},n.prototype.render=function(){var t;return n.__super__.render.apply(this,arguments),this.subViews.options=t=new Paydirt.Views.Settings.LineItemCreation({model:this.line_item_creation_options}),this.$("#line_item_creation_options").html(t.render().el),this.listenTo(this.line_item_creation_options,"change",this.showPreview),this.showPreview(),this},n.prototype.toggleInvoiceOptions=function(t){var e;return t.preventDefault(),e=this.$("#invoice_creation_options").is(":visible"),e?($(t.currentTarget).find("span.text").text("Show options"),this.$("#invoice_creation_options").hide()):($(t.currentTarget).find("span.text").text("Hide options"),this.$("#invoice_creation_options").show())},n.prototype.setDateRange=function(){return"true"===this.$('[name="date_range"]:checked').val()?(this.start_date=this.$('[name="block_start_date"]').val(),this.end_date=this.$('[name="block_end_date"]').val(),this.$('[name="block_start_date"]').parents(".faux_input").toggleClass("invalid",""===this.start_date),this.$('[name="block_end_date"]').parents(".faux_input").toggleClass("invalid",""===this.end_date)):(this.start_date=this.end_date=null,this.$('[name="block_start_date"]').parents(".faux_input").removeClass("invalid"),this.$('[name="block_end_date"]').parents(".faux_input").removeClass("invalid")),this.$('[name="date_range"]').each(function(){var t;return t=$(this).is(":checked"),$(this).parents(".line_item_option").toggleClass("selected",t)}),this.showPreview()},n.prototype.draftWorkInvoice=function(t){var e;return t.preventDefault(),$(t.currentTarget).addClass("no-click"),e=this.invoiceParams(),this.invoice?Paydirt.Utilities.post("/invoices/"+this.invoice.id+"/add_items",e):Paydirt.Utilities.post("/invoices",e)},n.prototype.showPreview=function(){var t,e,i;return this.$("#invoice-page").addClass("loading"),e=this.invoiceParams(),this.invoice?(i="/invoices/"+this.invoice.id+"/preview_adding_more_items",t="Update this invoice"):(i="/invoices/preview",t=0===e.jobs.length&&0===e.expenses.length?"Draft a blank invoice":"Draft this invoice"),this.$("button:submit span").text(t),$.post(i,e,function(t){return function(e){return t.$("#invoice-page").removeClass("loading"),t.$("#invoice_contents").html(e)}}(this))},n.prototype.invoiceParams=function(){var t,e;return e=_.map(this.$(".invoice_builder").find("input:checked[data-job-id]"),function(t){return function(e){var i;return i=t.model.jobs.get($(e).data("job-id")),{id:i.id,amount_to_invoice:i.get("amount_to_invoice").valueOf()}}}(this)),t=_.map(this.$(".invoice_builder").find("input:checked[data-expense-id]"),function(t){return function(e){var i;return i=t.model.expenses.get($(e).data("expense-id")),{id:i.id}}}(this)),this.includeBlockDescriptions=this.$("#include_block_descriptions").is(":checked")?!0:!1,this.includeTotalHours=this.$("#include_total_hours").is(":checked")?!0:!1,{client_id:this.model.id,jobs:e,expenses:t,include_total_hours_in_invoice_description:this.includeTotalHours,options:this.line_item_creation_options.attributes,start_date:this.start_date,end_date:this.end_date}},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Clients.Quotes=function(e){function n(){return this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["clients/quotes"],n.prototype.render=function(){var t;return this.$el.html(this.template()),t=new Paydirt.Views.Quotes.List({collection:this.model.quotes,client:this.model}),this.$(".quotes_list").append(t.render().el),t=new Paydirt.Views.Quotes.ListSummary({collection:this.model.quotes}),this.$(".quotes_summary").append(t.render().el),this},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Clients.Show=function(e){function n(){return this.render=t(this.render,this),this.draftInvoice=t(this.draftInvoice,this),this.draftQuote=t(this.draftQuote,this),this.importProject=t(this.importProject,this),this.importRedboothProject=t(this.importRedboothProject,this),this.importTrelloBoard=t(this.importTrelloBoard,this),this.importBasecampProject=t(this.importBasecampProject,this),this.addProject=t(this.addProject,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["clients/show"],n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render),this.subViewType=t.subView,this.subViewOptions=t.subViewOptions},n.prototype.addProject=function(t){return t.preventDefault(),Paydirt.projects.add(new Paydirt.Models.Project({client_id:this.model.id,editing:!0}))},n.prototype.importBasecampProject=function(){return this.importProject({client_id:this.model.id,importServiceName:"Basecamp",importTarget:"Basecamp project",jobName:"todo",fetchURL:"/integrations/basecamp/fetch_current_projects",createURL:"/integrations/basecamp/create_project_from_basecamp_project"})},n.prototype.importTrelloBoard=function(){return this.importProject({client_id:this.model.id,importServiceName:"Trello",importTarget:"Trello board",jobName:"card",fetchURL:"/integrations/trello/fetch_open_boards",createURL:"/integrations/trello/create_project_from_board"})},n.prototype.importRedboothProject=function(){return this.importProject({client_id:this.model.id,importServiceName:"Redbooth",importTarget:"Redbooth project",jobName:"task",fetchURL:"/integrations/redbooth/fetch_current_projects",createURL:"/integrations/redbooth/create_project_from_redbooth_project"})},n.prototype.importProject=function(t){var e;return null!=(e=this.subViews["import"])&&e.teardown(),this.subViews["import"]=new Paydirt.Views.Projects.Import(t),$.fancybox({modal:!0,content:this.subViews["import"].render().$el,padding:0})},n.prototype.draftQuote=function(t){return t.preventDefault(),Paydirt.Utilities.post("/quotes",{client_id:this.model.id})},n.prototype.draftInvoice=function(t){return t.preventDefault(),Paydirt.Utilities.post("/invoices",{client_id:this.model.id})},n.prototype.render=function(){var t;return this.$el.html(this.template(this.model)),null!=(t=this.subViews.main)&&t.teardown(),this.subViews.main=new this.subViewType(_.extend({model:this.model},this.subViewOptions)),this.$(".subview").html(this.subViews.main.render().el),this.$(".secondary_navigation").find("a[href$='"+window.location.pathname+"']").addClass("selected"),this},n}(Paydirt.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.Clients.Work=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.template=Paydirt.Templates["clients/work"],i.prototype.initialize=function(){return i.__super__.initialize.apply(this,arguments),this.itemView=Paydirt.Views.Projects.Show,this.collection=this.model.projects,this},i}(Paydirt.View)}.call(this),function(){Paydirt.Views.DocumentActivities={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.DocumentActivities.Index=function(e){function n(){return this.refreshNanoScroller=t(this.refreshNanoScroller,this),this.refresh=t(this.refresh,this),this.render=t(this.render,this),this.submitForm=t(this.submitForm,this),this.hideForm=t(this.hideForm,this),this.showForm=t(this.showForm,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["document_activities/index"],n.prototype.events={"click #add_invoice_activity":"showForm","click #cancel_invoice_activity":"hideForm","submit form":"submitForm",mouseenter:"refreshNanoScroller"},n.prototype.initialize=function(t){return this.document=t.document,n.__super__.initialize.apply(this,arguments),this.listenTo(this.collection,"add reset",this.render),this.listenTo(this.collection,"remove",this.refresh)},n.prototype.showForm=function(t){return t.preventDefault(),this.$("#add_invoice_activity").fadeOut(),this.$("#invoice_activity_form").slideDown()},n.prototype.hideForm=function(t){return null!=t&&t.preventDefault(),this.$("input[name=description]").val(""),this.$("#add_invoice_activity").fadeIn(),this.$("#invoice_activity_form").slideUp()},n.prototype.submitForm=function(t){var e;return t.preventDefault(),e=new Paydirt.Models.DocumentActivity({type:"Custom",document_id:this.document.id}),e.set({date:this.$("[name=date]").val(),description:this.$("[name=description]").val()}),e.get("description").length>0?(this.collection.add(e),e.save({},{success:function(t){return function(e,i){return t.hideForm(),Paydirt.Flash.notice(i.flash)}}(this),error:function(t){return function(e){return t.collection.remove(e)}}(this)})):this.$("#submit_invoice_activity").shake()},n.prototype.render=function(){return this.$el.html(this.template()),this.collection.each(function(t){return function(e){var i;return i=new Paydirt.Views.DocumentActivities.Show({model:e}),t.$("#invoice-activity").append(i.render())}}(this)),this.refresh(),this},n.prototype.refresh=function(){return setTimeout(this.refreshNanoScroller,500)},n.prototype.refreshNanoScroller=function(){return this.$(".nano").nanoScroller()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.DocumentActivities.Show=function(e){function n(){return this.destroy=t(this.destroy,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["document_activities/show"],n.prototype.events={"confirm a.delete":"destroy"},n.prototype.render=function(){var t;return t=this.model.document()instanceof Paydirt.Models.Quote?"Quote":"Invoice",this.$el.html(this.template({activity:this.model,documentType:t}))},n.prototype.destroy=function(t){return t.preventDefault(),this.model.destroy({success:function(t){return function(e,i){return Paydirt.Flash.deleted(i.flash),t.remove()}}(this)})},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.Documents={}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.Documents.Add=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.template=Paydirt.Templates["documents/add"],i.prototype.render=function(){var t;return i.__super__.render.call(this),this.$("#invoice_header").html(Paydirt.Templates["invoices/add_header"]({model:this.model})),this.subViews.builder=t=new Paydirt.Views.Clients.NewInvoice({invoice:Paydirt.invoice,client:Paydirt.invoice.client()}),this.$("#add_to_invoice").html(t.render().el),this},i}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Documents.Edit=function(e){function n(){return this.save=t(this.save,this),this.setFooter=t(this.setFooter,this),this.setDescription=t(this.setDescription,this),this.setDueAtOffset=t(this.setDueAtOffset,this),this.setDueAt=t(this.setDueAt,this),this.setIssuedAt=t(this.setIssuedAt,this),this.toggleInvoiceOptions=t(this.toggleInvoiceOptions,this),this.toggleSorting=t(this.toggleSorting,this),this.refreshNumber=t(this.refreshNumber,this),this.updateClientAddress=t(this.updateClientAddress,this),this.updateClientContactName=t(this.updateClientContactName,this),this.updateClientBusinessName=t(this.updateClientBusinessName,this),this.updateAccountAddress=t(this.updateAccountAddress,this),this.updateAccountContactName=t(this.updateAccountContactName,this),this.updateAccountBusinessName=t(this.updateAccountBusinessName,this),this.updateNumber=t(this.updateNumber,this),this.renderTaxes=t(this.renderTaxes,this),this.renderLineItem=t(this.renderLineItem,this),this.renderLineItems=t(this.renderLineItems,this),this.addLineItem=t(this.addLineItem,this),this.showOptions=t(this.showOptions,this),this.refreshDates=t(this.refreshDates,this),this.refreshTotals=t(this.refreshTotals,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["documents/edit"],n.prototype.events={"click .add_line_item":"addLineItem","click #toggle-invoice-options":"toggleInvoiceOptions","change .number":"updateNumber","change [name=account_business_name]":"updateAccountBusinessName","change [name=account_contact_name]":"updateAccountContactName","change [name=account_address]":"updateAccountAddress","change [name=client_business_name]":"updateClientBusinessName","change [name=client_contact_name]":"updateClientContactName","change [name=client_address]":"updateClientAddress","change .issued_at":"setIssuedAt","change .due_at":"setDueAt","change .due_at_offset":"setDueAtOffset","blur .invoice_description":"setDescription","blur .invoice_footer":"setFooter","click #invoice-options .title":"showOptions","submit form":"save"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change:subtotal change:total",this.refreshTotals),this.listenTo(this.model,"change:issued_at change:due_at change:due_at_offset",this.refreshDates),this.listenTo(this.model,"change:number",this.refreshNumber),this.listenTo(this.model,"change:currency_id change:locale",this.render),this.listenTo(this.model.line_items,"add",this.renderLineItem),this.listenTo(this.model.line_items,"reset add remove",this.toggleSorting),this.listenTo(this.model.taxes,"reset change add remove",this.renderTaxes)},n.prototype.render=function(){var t,e;switch(this.$el.html(this.template({document:this.model})),this.renderLineItems(),this.renderTaxes(),this.refreshDates(),this.refreshNumber(),this.refreshTotals(),this.model.get("type")){case"FreeformInvoice":this.subViews.sidebar=new Paydirt.Views.Invoices.EditSidebarFree({model:this.model}),t=Paydirt.Templates["invoices/edit_header_free"]({model:this.model});break;case"ClientInvoice":this.subViews.sidebar=new Paydirt.Views.Invoices.EditSidebar({model:this.model}),t=Paydirt.Templates["invoices/edit_header"]({model:this.model});break;case"FreeformQuote":this.subViews.sidebar=new Paydirt.Views.Quotes.EditSidebarFree({model:this.model}),t=Paydirt.Templates["quotes/edit_header_free"]({model:this.model});break;case"ClientQuote":this.subViews.sidebar=new Paydirt.Views.Quotes.EditSidebar({model:this.model}),t=Paydirt.Templates["quotes/edit_header"]({model:this.model});break;case"RecurringInvoice":this.subViews.sidebar=new Paydirt.Views.Invoices.EditSidebarRecurring({model:this.model}),this.subViews.header=e=new Paydirt.Views.Invoices.EditHeaderRecurring({model:this.model}),t=e.render().$el}return this.$("#invoice_sidebar").html(this.subViews.sidebar.render().el),this.$("#invoice_header").html(t),this.subViews.logoUploader=e=new Paydirt.Views.Invoices.LogoUploader({model:this.model}),this.$("#logo_uploader_container").html(e.render().el),this.subViews.taxes=e=new Paydirt.Views.InvoiceTaxes.Index({collection:this.model.taxes}),this.$("#taxes_container").html(e.render().el),this.$sortables=this.$("tbody#line_items"),this.$sortables.sortable({helper:function(t,e){return e.children().each(function(){return $(this).width($(this).width())}),e},update:function(t){return function(){return t.$sortables.find("tr").each(function(t){var e;return e=$(this).find('input[name="position"]'),e.val(t).trigger("change")})}}(this)}),this.toggleSorting(),this},n.prototype.refreshTotals=function(){return this.$("#invoice_subtotal").html(this.model.get("subtotal").format({precision:2,code:this.model.currency().get("code")})),this.$("#invoice_tax_0").html(this.model.get("tax0").format({precision:2,code:this.model.currency().get("code")})),this.$("#invoice_tax_1").html(this.model.get("tax1").format({precision:2,code:this.model.currency().get("code")})),this.$("#invoice_total").html(this.model.get("total").format({precision:2,code:this.model.currency().get("code")}))},n.prototype.refreshDates=function(){return this.$(".issued_at").val(I18n.l("date.formats.default",this.model.get("issued_at").toDate())),this.model instanceof Paydirt.Models.Invoice?(this.$(".due_at").val(I18n.l("date.formats.default",this.model.get("due_at").toDate())),this.$(".due_at_offset").val(this.model.get("due_at_offset"))):void 0},n.prototype.showOptions=function(t){var e;return e=$(t.currentTarget),e.toggleClass("showing"),e.siblings(".setting").slideToggle(250)},n.prototype.addLineItem=function(t){var e,i,n,s;return t.preventDefault(),e=$(t.target),i=e.data("line-item-description")||"",s=new Money(e.data("line-item-rate")||0).amount(),n=new Paydirt.Models.LineItem({invoice:this.model,quantity:1,description:i,rate:s}),this.model.line_items.add(n)},n.prototype.renderLineItems=function(){return this.$("tbody#line_items").empty(),this.model.line_items.each(function(t){return function(e){return t.renderLineItem(e)}}(this))},n.prototype.renderLineItem=function(t){var e;return e=new Paydirt.Views.LineItems.Edit({model:t,invoice:this.model}),this.$("tbody#line_items").append(e.render().el)},n.prototype.renderTaxes=function(){return this.$(".tax_header").hide(),this.$(".tax_total").hide(),this.model.taxes.current().each(function(t){return function(e,i){var n,s;return n=e.get("name"),s=e.get("percentage"),t.$(".tax_header[data-id="+i+"]").text(n).show(),t.$(".tax_total[data-id="+i+"]").show().find("b").text(""+n+" ("+Paydirt.Formatters.numberToPercentage(s)+")")}}(this)),this.$("td[colspan]").each(function(t){return function(e,i){return $(i).prop({colspan:$(i).data("original-colspan")+t.model.taxes.current().size()})}}(this)),"ClientInvoice"===this.model.get("type")||"FreeformInvoice"===this.model.get("type")?this.$(".invoice-type").text(this.model.taxes.current().size()>0?I18n.t("tax_invoice"):I18n.t("invoice")):void 0},n.prototype.updateNumber=function(t){var e,i,n;return e=$(t.target),i=e.val(),n=parseFloat(i).toFixed(0),n=+n,_.isNaN(n)||0===n?this.model.unset("number").set({number:1}):this.model.set({number:n})},n.prototype.updateAccountBusinessName=function(t){return this.model.set({account_business_name:$(t.target).val()})},n.prototype.updateAccountContactName=function(t){return this.model.set({account_contact_name:$(t.target).val()})},n.prototype.updateAccountAddress=function(t){return this.model.set({account_address:$(t.target).val()})},n.prototype.updateClientBusinessName=function(t){return this.model.set({client_business_name:$(t.target).val()})},n.prototype.updateClientContactName=function(t){return this.model.set({client_contact_name:$(t.target).val()})},n.prototype.updateClientAddress=function(t){return this.model.set({client_address:$(t.target).val()})},n.prototype.refreshNumber=function(){return this.$(".number").val(Paydirt.Formatters.paddedNumber(this.model.get("number"),{length:3}))},n.prototype.toggleSorting=function(){return this.model.line_items.current().size()>=2?(this.$(".reorder").show(),this.$sortables.sortable("enable")):(this.$(".reorder").hide(),this.$sortables.sortable("disable"))},n.prototype.toggleInvoiceOptions=function(t){return t.preventDefault(),this.$("#invoice-options").is(":visible")?($(t.target).find(".state").text("Show"),this.$("#invoice-options").slideUp()):($(t.target).find(".state").text("Hide"),this.$("#invoice-options").slideDown())},n.prototype.setIssuedAt=function(t){return this.model.set({issued_at:moment($(t.target).val())})},n.prototype.setDueAt=function(t){return this.model.set({due_at:moment($(t.target).val())})},n.prototype.setDueAtOffset=function(t){return this.model.set({due_at_offset:$(t.target).val()})},n.prototype.setDescription=function(t){return this.model.set({description:$(t.target).val()})},n.prototype.setFooter=function(t){return this.model.set({footer:$(t.target).val()})},n.prototype.addItems=function(t){var e;return t.preventDefault(),e=Paydirt.Routes.add_to_invoice(this.model.id),Paydirt.dirty?fancyConfirm({heading:"You need to save your changes first",message:"You have unsaved changes. Would you like to save your changes and then add more items to this invoice?",cancel:"cancel",confirm:"Save and continue"},function(t){return function(i){return i===!0?t.subViews.sidebar.save({afterSavePath:e}):void 0}}(this)):Paydirt.router.navigate(e,{trigger:!0})},n.prototype.save=function(t){return t.preventDefault(),this.subViews.sidebar.save()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Documents.NewClient=function(e){function n(){return this.save=t(this.save,this),this.cancel=t(this.cancel,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["documents/new_client"],n.prototype.events={"valid form.client_form":"save","click a.cancel":"cancel"},n.prototype.render=function(){return this.$el.html(this.template({model:this.model,type:this.options.type})),this},n.prototype.cancel=function(t){return t.preventDefault(),this.model.destroy(),$.fancybox.close(),!0},n.prototype.save=function(t){return t.preventDefault(),this.model.save({business_name:this.$("#business_name").val(),billing_email_address:this.$("#billing_email_address").val(),currency_id:+this.$("#currency_id").val(),locale:this.$("#locale").val()},{success:function(t){return function(e){return Paydirt.clients.add(e),null!=t.options.afterSave?t.options.afterSave(t.model.id):(Paydirt.router.navigate(Paydirt.Routes.client(t.model.id),{trigger:!0}),$.fancybox.close())}}(this)})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Documents.Schedule=function(e){function n(){return this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["documents/schedule"],n.prototype.mixins=[Paydirt.Mixins.EnableDisableRecurringInvoice],n.prototype.computeds={scheduleList:{get:function(){var t,e,i;return e=function(){var e,n,s,r;for(s=this.getBinding("upcoming_recurring_dates"),r=[],e=0,n=s.length;n>e;e++)t=s[e],i=new moment(t),r.push("<li>"+i.format()+" <span class='from-now'>"+i.fromNow(!0)+" from now</span></li>");return r}.call(this)
}}},n.prototype.render=function(){var t;return n.__super__.render.call(this),this.subViews.form=t=new Paydirt.Views.RecurringInvoices.ScheduleForm({model:this.model}),this.$("#schedule_form").html(t.render().el),this},n.prototype.save=function(t){var e,i;return e=$(t.currentTarget),e.addClass("no-click"),i=this.model.pick("every","interval","recurring_start_date"),this.model.save({invoice:i},{patch:!0,url:Paydirt.Routes.schedule_recurring_invoice(this.model.id),success:function(){return function(t,i){return Paydirt.recurring_invoices.remove(t.id),Paydirt.recurring_invoices.add(t),t.markClean(),Paydirt.Flash.notice(i.flash),e.removeClass("no-click")}}(this),error:function(){return e.removeClass("no-click")}})},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.Expenses={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Expenses.InvoiceFields=function(e){function n(){return this.toggleSelected=t(this.toggleSelected,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["expenses/invoice_fields"],n.prototype.viewModel=function(){return new Backbone.Model({selected:!0})},n.prototype.toggleSelected=function(){return this.viewModel.set({selected:!this.viewModel.get("selected")}),this.$(".invoice_job_checkbox").trigger("change")},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Expenses.InvoiceList=function(e){function n(){return this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.itemView=Paydirt.Views.Expenses.InvoiceFields,n.prototype.el="<div data-bind='collection:$collection'></div>",n.prototype.render=function(){return this.applyBindings(),this},n}(Paydirt.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.Expenses.List=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.template=Paydirt.Templates["expenses/list"],i.prototype.initialize=function(){return i.__super__.initialize.apply(this,arguments),this.itemView=Paydirt.Views.Expenses.Show},i}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Expenses.Show=function(e){function n(){return this.destroyExpense=t(this.destroyExpense,this),this.saveExpense=t(this.saveExpense,this),this.cancelEditExpense=t(this.cancelEditExpense,this),this.editExpense=t(this.editExpense,this),this.viewModel=t(this.viewModel,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["expenses/show"],n.prototype.viewModel=function(){return new Backbone.Model({editing:this.model.isNew()})},n.prototype.editExpense=function(t){return null!=t&&t.preventDefault(),this.viewModel.set({editing:!0})},n.prototype.cancelEditExpense=function(t){return t.preventDefault(),this.viewModel.set({editing:!1}),this.model.isNew()?this.model.destroy():void 0},n.prototype.saveExpense=function(t){var e,i,n,s;return t.preventDefault(),i=this.$("input[name=name]").val(),n=this.$("input[name=quantity]").val(),s=Paydirt.Formatters.currencyToFloat(this.$("input[name=value]").val()),e=this.$("input:submit"),e.addClass("no-click"),this.model.save({name:i,quantity:n,value:s},{wait:!0,success:function(t){return function(i,n){return Paydirt.Flash.notice(n.flash),Paydirt.expenses.add(i),t.viewModel.set({editing:!1}),e.removeClass("no-click")}}(this),error:function(){return function(){return e.removeClass("no-click")}}(this)})},n.prototype.destroyExpense=function(t){return t.preventDefault(),this.model.destroy({success:function(){return function(t,e){return Paydirt.Flash.deleted(e.flash)}}(this)})},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.Extensions={}}.call(this),function(){Paydirt.Views.Extensions.Blocks={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Extensions.Blocks.New=function(e){function n(){return this.cancel=t(this.cancel,this),this.save=t(this.save,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["extensions/blocks/new"],n.prototype.events={"valid form.block_form":"save","click a.cancel":"cancel"},n.prototype.initialize=function(t){var e;return n.__super__.initialize.apply(this,arguments),null!=t.jobId?(e=Paydirt.jobs.get(t.jobId),Paydirt.block.associateWithJob(e)):void 0},n.prototype.render=function(){var t;return this.$el.html(this.template()),this.subViews.form=t=new Paydirt.Views.Blocks.Form({model:this.model}),this.$(".block_form_container").html(t.render().el),this},n.prototype.save=function(t){var e;return t.preventDefault(),e=this.$("input:submit"),e.addClass("no-click"),this.model.save({},{success:function(t){return function(e,i){return Paydirt._blocks.add(e),t.subViews.notice=new Paydirt.Views.Notification({cssClass:"shrinkable shrunk success-message centered",icon:"<i class='icon-ok-sign'></i>",message:i.flash}),t.$el.append(t.subViews.notice.render().el),t.$("form#new-block").addClass("shrunk"),setTimeout(function(){return t.subViews.notice.$el.find(".shrunk").removeClass("shrunk")},100),setTimeout(Paydirt.router.close,3e3)}}(this),error:function(){return function(){return e.removeClass("no-click")}}(this)})},n.prototype.cancel=function(t){return t.preventDefault(),Paydirt.router.close()},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.InvoicePayments={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.InvoicePayments.Index=function(e){function n(){return this.refresh=t(this.refresh,this),this.submitForm=t(this.submitForm,this),this.hideForm=t(this.hideForm,this),this.cancelPayment=t(this.cancelPayment,this),this.showForm=t(this.showForm,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoice_payments/index"],n.prototype.events={"click #add_invoice_payment":"showForm","click #cancel_invoice_payment":"cancelPayment","submit form":"submitForm"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change:sent",this.refresh),this.listenTo(this.collection,"add remove reset",this.render),this.listenTo(this.collection,"remove",this.refresh)},n.prototype.render=function(){var t,e,i;i=this.subViews;for(e in i)t=i[e],t.teardown();return this.$el.html(this.template()),this.collection.length>0?this.collection.each(function(e){return function(i){return e.subViews["payment-"+i.cid]=t=new Paydirt.Views.InvoicePayments.Show({model:i}),e.$("#invoice_payments").append(t.render())}}(this)):this.$("#invoice_payments").hide(),this},n.prototype.showForm=function(t){return t.preventDefault(),this.$("#add_invoice_payment").fadeOut(),this.$("#invoice_payment_form").slideDown()},n.prototype.cancelPayment=function(){return this.$("#add_invoice_payment").fadeIn(),this.hideForm()},n.prototype.hideForm=function(t){return null!=t&&t.preventDefault(),this.$("#invoice_payment_description").val(""),this.$("#invoice_payment_form").slideUp()},n.prototype.submitForm=function(t){var e;return t.preventDefault(),e=new Paydirt.Models.InvoicePayment({received_at:this.$("#invoice_payment_received_at").val(),description:this.$("#invoice_payment_description").val(),amount:new Money(Paydirt.Formatters.currencyToFloat(this.$("#invoice_payment_amount").val())).amount()}),e.save({},{success:function(t){return function(e,i){return Paydirt.Flash.notice(i.flash),Paydirt.invoice.activities.reset(i.invoice_activities),t.collection.add(e),t.refresh()}}(this)}),$(".submit_invoice_payment").prop("disabled",!0)},n.prototype.refresh=function(){return this.$("#invoice_amount_paid .totals span").html(Paydirt.invoice.amountPaid().format({precision:2})),this.$("#invoice_amount_owing .totals span").html(Paydirt.invoice.amountOwing().format({precision:2})),this.hideForm(),this.$("#invoice_payment_amount").val(Paydirt.invoice.amountOwing().format({sign:Paydirt.invoice.currency().get("sign")})).trigger("blur"),this.model.get("sent")?(this.$("#payments").find(".contents").slideDown(),Paydirt.invoice.amountOwing().zero()?(this.$("#add_invoice_payment").fadeOut(),this.$("#invoice_amount_paid").find(".totals").addClass("complete"),this.$("#invoice_amount_owing").hide()):(this.$("#add_invoice_payment").fadeIn(),this.$("#invoice_amount_paid").find(".totals").removeClass("complete"),this.$("#invoice_amount_owing").show())):(this.$("#payments").find(".contents").slideUp(),this.$("#add_invoice_payment").fadeOut())},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.InvoicePayments.Settings=function(e){function n(){return this._openModal=t(this._openModal,this),this.setupStripe=t(this.setupStripe,this),this.setupPayPal=t(this.setupPayPal,this),this.hide=t(this.hide,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoice_payments/settings"],n.prototype.events={"click #hide_payment_settings":"hide","change #accept_paypal":"setupPayPal","change #accept_stripe":"setupStripe"},n.prototype.render=function(){return this.$el.html(this.template()),this},n.prototype.hide=function(){return Paydirt.Flash.notice("You can always update your payment preferences in your Invoicing Settings."),this.$el.slideUp(300,function(t){return function(){return t.teardown()}}(this))},n.prototype.setupPayPal=function(t){return $(t.target).is(":checked")?this._openModal("/settings/paypal"):void 0},n.prototype.setupStripe=function(t){return $(t.target).is(":checked")?this._openModal("/settings/stripe"):void 0},n.prototype._openModal=function(t){return $.fancybox.open({type:"ajax",href:t,openSpeed:600,closeSpeed:200,margin:0,padding:0,scrolling:"visible",modal:!0})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.InvoicePayments.Show=function(e){function n(){return this.destroy=t(this.destroy,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoice_payments/show"],n.prototype.events={"confirm a.delete":"destroy"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render)},n.prototype.render=function(){return this.$el.html(this.template({payment:this.model}))},n.prototype.destroy=function(t){return t.preventDefault(),this.model.destroy({success:function(t){return function(e,i){return t.remove(),Paydirt.Flash.deleted(i.flash),Paydirt.invoice.payments.remove(e),Paydirt.invoice.activities.reset(i.invoice_activities)}}(this)})},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.InvoiceTaxes={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.InvoiceTaxes.Form=function(e){function n(){return this.updatePercentage=t(this.updatePercentage,this),this.updateName=t(this.updateName,this),this.removeView=t(this.removeView,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoice_taxes/form"],n.prototype.events={"blur .name":"updateName","blur .percentage":"updatePercentage","click a.delete":"removeView"},n.prototype.removeView=function(t){return t.preventDefault(),this.model.destroy(),this.teardown()},n.prototype.updateName=function(t){return this.model.set({name:$(t.target).val()})},n.prototype.updatePercentage=function(t){var e;return e=$(t.target),this.model.setPercentage(e.val()),e.val(this.model.getPercentage())},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.InvoiceTaxes.Index=function(e){function n(){return this.showHideEmptyState=t(this.showHideEmptyState,this),this.renderTax=t(this.renderTax,this),this.addTax=t(this.addTax,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoice_taxes/index"],n.prototype.events={"click #add_tax":"addTax"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"add",this.renderTax),this.listenTo(this.collection,"reset add remove change",this.showHideEmptyState)},n.prototype.render=function(){return this.$el.html(this.template()),this.collection.current().each(this.renderTax),this.showHideEmptyState(),this},n.prototype.addTax=function(t){var e;return t.preventDefault(),e=new Paydirt.Models.InvoiceTax,this.collection.add(e)},n.prototype.renderTax=function(t){var e;return e=new Paydirt.Views.InvoiceTaxes.Form({model:t}),this.$("#taxes").append(e.render().el),e.$("input:first").focus()},n.prototype.showHideEmptyState=function(){return this.collection.current().size()>0?this.$("#taxes .empty").hide():this.$("#taxes .empty").show(),this.collection.current().size()>=2?this.$("#add_tax").addClass("hide"):this.$("#add_tax").removeClass("hide")},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.Invoices={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.Browser=function(e){function n(){return this.exportCSV=t(this.exportCSV,this),this.toggleAdvancedSearch=t(this.toggleAdvancedSearch,this),this.setEndDate=t(this.setEndDate,this),this.setStartDate=t(this.setStartDate,this),this.setDateRangeType=t(this.setDateRangeType,this),this.changeDateCriteria=t(this.changeDateCriteria,this),this.changeInvoiceable=t(this.changeInvoiceable,this),this.filterInvoices=t(this.filterInvoices,this),this.refresh=t(this.refresh,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoices/browser"],n.prototype.events={"click #previous":"previousPeriod","click #next":"nextPeriod","change #start_date":"setStartDate","change #end_date":"setEndDate","change #date_range_type":"setDateRangeType","change #autocompleter":"changeInvoiceable","change #date_criteria":"changeDateCriteria","click #toggle_advanced_search":"toggleAdvancedSearch"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.model=new Paydirt.Models.InvoiceBrowser({collectionMode:this.options.collectionMode}),this.clients=Paydirt.clients,this.model.setState({initializing:!0}),Paydirt.router.onpopstate=function(t){return function(e){return null!=e.state?t.model.setState({from:e.state,popped:!0}):void 0}}(this),this.filteredInvoices=new Paydirt.Collections.Invoices(this.collection.models),this.filterInvoices(),this.listenTo(this.model,"dateRangeChanged change:invoiceable change:dateCriteria",this.filterInvoices),this.listenTo(this.collection,"add remove reset",this.filterInvoices),this.listenTo(this.filteredInvoices,"reset",this.refresh),this.subViews.invoiceList=new Paydirt.Views.Invoices.List({collection:this.filteredInvoices,filtered:!0})},n.prototype.render=function(){return this.$el.html(this.template()),this.$("#invoice_list").html(this.subViews.invoiceList.render().el),this.refresh(),this},n.prototype.refresh=function(){var t,e,i,n,s;this.$("#date_range_type").val(this.model.get("dateRangeType")).trigger("liszt:updated"),"all-time"===this.model.get("dateRangeType")?this.$("#date_fields").hide():(this.$("#date_fields").show(),this.$("#start_date").val(new moment(this.model.get("startDate")).format()),this.$("#end_date").val(new moment(this.model.get("endDate")).format())),n=this.model.get("invoiceable"),null!=n?this.$("#autocompleter").val(""+n.type+"-"+n.id).trigger("liszt:updated"):this.$("#autocompleter").val("").trigger("liszt:updated"),e=this.model.get("dateCriteria"),this.$("#date_criteria").val(e).trigger("liszt:updated"),null!=n||null!=e?this.$("#advanced_filters_row").show():this.$("#advanced_filters_row").hide(),i=this.filteredInvoices.groupBy(function(t){return t.currency().id});for(t in i)s=i[t],i[t]=new Paydirt.Collections.Invoices(s);return this.$("#invoice_browser_summary").html(Paydirt.Templates["invoices/browser_summary"]({groupedInvoices:i})),this.$("#export_csv").toggle(this.filteredInvoices.length>0),this},n.prototype.filterInvoices=function(){var t,e,i;return i=this.model.get("invoiceable"),e=this.model.get("dateRangeType"),t=this.model.get("dateCriteria"),this.filteredInvoices.reset(this.collection.filter(function(n){return function(s){var r,a,o;return"all-time"===e?(a=!0,"paid_at"!==t||s.paid()||(a=!1),"issued_at"!==t||s.sent()||(a=!1)):(r="paid_at"===t?s.paid()?s.paidAt():null:"issued_at"===t?s.sent()?s.issuedAt():null:s.createdAt(),a=n.model.get("startDate")<=r&&r<=n.model.get("endDate")),o=null!=i?"project"===i.type?_.include(s.projects(),Paydirt.projects.get(i.id)):s.get(""+i.type+"_id")===+i.id:!0,a&&o}}(this)))},n.prototype.changeInvoiceable=function(t){var e,i;return e=$(t.target),i=e.find("option:selected"),""===i.val()?this.model.unset("invoiceable"):this.model.set({invoiceable:{type:i.data("type"),id:i.data("id")}})},n.prototype.changeDateCriteria=function(t){var e;return e=$(t.target).val(),this.model.set({dateCriteria:e})},n.prototype.setDateRangeType=function(t){return t.preventDefault(),this.model.set({dateRangeType:$(t.target).val()})},n.prototype.setStartDate=function(t){var e;return t.preventDefault(),e=new Date($(t.target).val()),"Invalid Date"===e.toString()?this.$("#start_date").addClass("invalid"):(this.$("#start_date").removeClass("invalid"),this.model.setStartDateTo(e))},n.prototype.setEndDate=function(t){var e;return t.preventDefault(),e=new Date($(t.target).val()),"Invalid Date"===e.toString()?this.$("#end_date").addClass("invalid"):(this.$("#end_date").removeClass("invalid"),this.model.setEndDateTo(e))},n.prototype.previousPeriod=function(t){return t.preventDefault(),this.model.previousPeriod()},n.prototype.nextPeriod=function(t){return t.preventDefault(),this.model.nextPeriod()},n.prototype.toggleAdvancedSearch=function(t){return t.preventDefault(),this.$("#advanced_filters_row").toggle()},n.prototype.exportCSV=function(t){return t.preventDefault(),window.location.href="/invoices/export_csv?"+$.param({ids:this.filteredInvoices.pluck("id")})},n}(Paydirt.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.Invoices.EditHeaderRecurring=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.template=Paydirt.Templates["invoices/edit_header_recurring"],i.prototype.mixins=[Paydirt.Mixins.EnableDisableRecurringInvoice],i}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.EditSidebar=function(e){function n(){return this.save=t(this.save,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoices/edit_sidebar"],n.prototype.render=function(){return this.$el.html(this.template({invoice:this.model})),this},n.prototype.save=function(t){var e;return e=(null!=t?t.afterSavePath:void 0)||Paydirt.Routes.invoice(this.model.id),this.$("#save-invoice").val("Saving...").addClass("no-click"),this.model.save({},{success:function(){return function(t,i){return _(t.line_items.where({_destroy:1})).each(function(t){return _(Paydirt.blocks.where({line_item_id:t.id})).each(function(t){return t.set({line_item_id:null,billed:!1}),t.markClean()})}),Paydirt.invoices.remove(t.id),Paydirt.invoices.add(t),t.markClean(),Paydirt.Flash.notice(i.flash),Paydirt.router.navigate(e,{trigger:!0})}}(this),error:function(t){return function(){return t.$("#save-invoice").val("Save").removeClass("no-click")}}(this)})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.EditSidebarFree=function(e){function n(){return this.setLocale=t(this.setLocale,this),this.setCurrency=t(this.setCurrency,this),this.downloadPDF=t(this.downloadPDF,this),this.print=t(this.print,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoices/edit_sidebar_free"],n.prototype.events={"click #print_invoice":"print","click #download_pdf":"downloadPDF","change #currency_id":"setCurrency","change #locale":"setLocale"},n.prototype.render=function(){return this.$el.html(this.template({invoice:this.model})),this},n.prototype.print=function(t){return t.preventDefault(),Paydirt.Utilities.post("/free_invoice_creator/print",this.model.toJSON(),"_blank")},n.prototype.downloadPDF=function(t){return t.preventDefault(),Paydirt.Utilities.post("/free_invoice_creator/pdf",this.model.toJSON(),"_blank")},n.prototype.setCurrency=function(t){var e,i;return e=$(t.target),i=Paydirt.currencies.get(e.val()),this.model.set({currency_id:i.id})},n.prototype.setLocale=function(t){var e;return e=$(t.target).val(),I18n.locale=e,this.model.set({locale:e})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.EditSidebarRecurring=function(e){function n(){return this.save=t(this.save,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoices/edit_sidebar_recurring"],n.prototype.save=function(){return this.$("#save-invoice").val("Saving...").addClass("no-click"),this.model.save({},{success:function(t){return function(e,i){return Paydirt.recurring_invoices.remove(e.id),Paydirt.recurring_invoices.add(e),e.markClean(),Paydirt.Flash.notice(i.flash),Paydirt.router.navigate(Paydirt.Routes.recurring_invoice(t.model.id),{trigger:!0})}}(this),error:function(t){return function(){return t.$("#save-invoice").val("Save").removeClass("no-click")}}(this)})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.Graph=function(e){function n(){return this.lastObjectDate=t(this.lastObjectDate,this),this.firstObjectDate=t(this.firstObjectDate,this),this.summingFunction=t(this.summingFunction,this),this.filteringFunction=t(this.filteringFunction,this),this.groupingFunction=t(this.groupingFunction,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.groupingFunction=function(t){return t.issuedAtWeek()},n.prototype.filteringFunction=function(t){return t.get("client_id")===this.client.id},n.prototype.summingFunction=function(t,e){return t+parseFloat(e.get("total"))},n.prototype.firstObjectDate=function(){return moment(this.collection.first().issuedAtWeek())},n.prototype.lastObjectDate=function(){return moment(this.collection.last().issuedAtWeek())},n}(Paydirt.Views.Graphs.Base)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.Index=function(e){function n(){return this.showRecurringInvoiceModal=t(this.showRecurringInvoiceModal,this),this.toggleInvoiceBuilder=t(this.toggleInvoiceBuilder,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.render=function(){var t,e;return this.options.recurring?(this.collection=Paydirt.recurring_invoices,this.$el.html(Paydirt.Templates["invoices/recurring"]()),this.subViews.currentInvoicesList=e=new Paydirt.Views.RecurringInvoices.List({collection:this.collection}),this.$(".current_invoices_list").html(e.render().el)):this.options.paid?(this.options.current?(t="all",this.collection=Paydirt.invoices,this.$el.html(Paydirt.Templates["invoices/all"]())):(t="paid",this.collection=Paydirt.invoices.paid(),this.$el.html(Paydirt.Templates["invoices/paid"]())),this.subViews.invoiceBrowser=e=new Paydirt.Views.Invoices.Browser({collection:this.collection,collectionMode:t}),this.$(".invoice_browser").html(e.render().el)):(this.collection=Paydirt.invoices.current(),this.$el.html(Paydirt.Templates["invoices/index"]()),this.subViews.currentInvoicesList=e=new Paydirt.Views.Invoices.List({collection:this.collection}),this.$(".current_invoices_list").html(e.render().el),this.subViews.currentInvoicesSummary=e=new Paydirt.Views.Invoices.ListSummary({collection:this.collection}),this.$(".current_invoices_list_summary").html(e.render().el)),this.subViews.newInvoice=e=new Paydirt.Views.Invoices.New,this.$(".new_invoice_button").html(e.render().el),this.$(".secondary_navigation").find("a[href$='"+window.location.pathname+"']").addClass("selected"),this},n.prototype.toggleInvoiceBuilder=function(t){return t.preventDefault(),this.$(".action-bar.new_invoice").slideToggle("fast")},n.prototype.showRecurringInvoiceModal=function(t){var e;return t.preventDefault(),e=new Paydirt.Views.RecurringInvoices.New,$.fancybox.open({openSpeed:600,closeSpeed:200,margin:0,padding:0,scrolling:"visible",modal:!0,content:e.render().$el})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.List=function(e){function n(){return this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoices/list"],n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.collection,"add remove change reset",this.render),this.client=t.client,this.filtered=t.filtered},n.prototype.render=function(){return this.$el.html(this.template()),this.collection.length>0?(this.$(".box.empty").hide(),this.$("hr.double").show(),this.collection.each(function(t){return function(e){var i;return t.subViews["invoice-"+e.cid]=i=new Paydirt.Views.Invoices.ListItem({model:e}),t.$(".invoices").append(i.render().el)}}(this))):(this.$(".box.empty p").html(null!=this.client?"You haven't created an invoice for "+this.client.get("business_name")+" yet. <a href='"+Paydirt.Routes.client_invoices_new(this.client.get("id"))+"' data-behaviour='backbone_link'>Create one here.</a>":this.filtered?"No invoices match those filters.":"No outstanding or unsent invoices. <a href='/help/guides/invoicing/create' target='_blank'>Learn how to create an invoice</a>."),this.$(".box.empty").show(),this.$("hr.double").hide()),this},n}(Paydirt.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.Invoices.ListItem=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.template=Paydirt.Templates["invoices/list_item"],i.prototype.className="inline",i}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.ListSummary=function(e){function n(){return this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoices/list_summary"],n.prototype.render=function(){var t,e,i;e=this.collection.groupBy(function(t){return t.currency().id});for(t in e)i=e[t],e[t]=new Paydirt.Collections.Invoices(i);return this.$el.html(this.template({groupedInvoices:e})),this},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.LogoUploader=function(e){function n(){return this.submitLogo=t(this.submitLogo,this),this.previewLogo=t(this.previewLogo,this),this.showLogoFields=t(this.showLogoFields,this),this.hide=t(this.hide,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoices/logo_uploader"],n.prototype.events={"click .dismiss":"hide","click #show_logo_fields":"showLogoFields","click .cancel":"showLogoFields","change input#logo":"previewLogo","click #submit_logo":"submitLogo"},n.prototype.render=function(){return this.$el.html(this.template({invoice:this.model})),this},n.prototype.hide=function(t){return t.preventDefault(),this.$("#logo_widget").slideUp()},n.prototype.showLogoFields=function(){return this.$("#logo").val(""),this.$("#show_logo_fields_container").hide(),this.$("#logo_fields").show(),this.$("#logo_preview").hide()},n.prototype.previewLogo=function(t){var e;return t.preventDefault(),e=new FileReader,e.onload=function(t){return function(e){var i;return i=new Image,i.src=e.target.result,t.$("#temporary_logo").html(i),t.$("#logo_fields").hide(),t.$("#logo_preview").show()}}(this),this.file=$(t.target).get(0).files[0],e.readAsDataURL(this.file)},n.prototype.submitLogo=function(t){var e,i;return t.preventDefault(),$(t.target).addClass("no-click"),e=new FormData,i=this.$("input#logo").get(0).files[0],i?(e.append("account[logo]",i),$.ajax({url:"/settings/logo",data:e,processData:!1,contentType:!1,type:"PUT",success:function(t){return function(e){var i;return Paydirt.Flash.notice("Added logo to your account"),i=$("<img>").attr({src:e.logo_path}),t.$(".logo_bar").replaceWith(i),Paydirt.account.set({logo_path:e.logo_path})
}}(this)})):void 0},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.New=function(e){function n(){return this.openNewClientModal=t(this.openNewClientModal,this),this.draftBlankInvoice=t(this.draftBlankInvoice,this),this.showInvoiceBuilder=t(this.showInvoiceBuilder,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoices/new"],n.prototype.showInvoiceBuilder=function(t){var e;return t.preventDefault(),e=this.$("#new_invoice_client_id").val(),""===e?this.$("#new_invoice_client_id_chzn").shake():"new"===e?this.openNewClientModal({callback:function(t){return Paydirt.router.navigate(Paydirt.Routes.client_invoices_new(t),{trigger:!0}),$.fancybox.close()}}):Paydirt.router.navigate(Paydirt.Routes.client_invoices_new(e),{trigger:!0})},n.prototype.draftBlankInvoice=function(t){var e,i;return t.preventDefault(),e=this.$("#new_invoice_client_id").val(),""===e?this.$("#new_invoice_client_id_chzn").shake():"new"===e?this.openNewClientModal({callback:function(t){return function(e){return t.$('button[type="submit"]').addClass("disabled").html('<i class="icon-refresh icon-spin"></i> &nbsp;Working...'),Paydirt.Utilities.post("/invoices",{client_id:e})}}(this)}):(i={client_id:e},Paydirt.Utilities.post("/invoices",i))},n.prototype.openNewClientModal=function(t){var e;return Paydirt.client=new Paydirt.Models.Client,this.subViews.new_client=e=new Paydirt.Views.Documents.NewClient({model:Paydirt.client,afterSave:t.callback,type:"Invoice"}),$.fancybox.open({openSpeed:600,closeSpeed:200,margin:0,padding:0,scrolling:"visible",modal:!0,content:e.render().$el})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.Page=function(e){function n(){return this.refreshFlag=t(this.refreshFlag,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoices/page"],n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change:sent change:paid_at",this.refreshFlag),this.listenTo(this.model.payments,"add remove change reset",this.refreshFlag)},n.prototype.render=function(){return this.$el.html(this.template({invoice:this.model})),this.$("#invoice-page").addClass("loading"),$.ajax(this.model.url()).done(function(t){return function(e){var i;return t.$("#invoice_contents").html($(e)),t.subViews.logoUploader=i=new Paydirt.Views.Invoices.LogoUploader({model:t.model}),t.$(".logo_bar").replaceWith(i.render().el)}}(this)).fail(function(){return function(t){return Paydirt.Flash.error(t.responseText)}}(this)).always(function(t){return function(){return t.$("#invoice-page").removeClass("loading")}}(this)),this},n.prototype.refreshFlag=function(){var t;return t="."+this.model.state(),this.$(".overlays div").not(t).removeClass("current"),this.$(".overlays div").filter(t).addClass("current")},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.Show=function(e){function n(){return this.deleteInvoice=t(this.deleteInvoice,this),this.editSentInvoice=t(this.editSentInvoice,this),this.duplicateInvoice=t(this.duplicateInvoice,this),this.convertToDraft=t(this.convertToDraft,this),this.markAsSent=t(this.markAsSent,this),this.refresh=t(this.refresh,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoices/show"],n.prototype.events={"click #mark_invoice_as_sent":"markAsSent","click #convert_invoice_to_draft":"convertToDraft","confirm #convert_sent_invoice_to_draft":"convertToDraft","click #duplicate_invoice":"duplicateInvoice","confirm .edit_sent_invoice":"editSentInvoice","confirm #delete_invoice":"deleteInvoice"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change:sent",this.refresh),this.listenTo(this.model.payments,"add remove",this.refresh)},n.prototype.render=function(){var t;return this.$el.html(this.template({invoice:this.model})),this.subViews.invoicePaymentsSettings=t=new Paydirt.Views.InvoicePayments.Settings,this.$("#invoice_payments_settings_container").html(t.render().el),this.subViews.invoicePayments=t=new Paydirt.Views.InvoicePayments.Index({model:this.model,collection:Paydirt.invoice.payments}),this.$("#invoice_payments_container").html(t.render().el),this.subViews.activities=t=new Paydirt.Views.DocumentActivities.Index({collection:Paydirt.invoice.activities,document:this.model}),this.$("#invoice_activity_container").html(t.render().el),this.subViews.page=t=new Paydirt.Views.Invoices.Page({model:this.model}),this.$("#invoice_page_container").html(t.render().el),this.refresh(),this},n.prototype.refresh=function(){return this.$("#show_edit_links").html(Paydirt.Templates["invoices/show_edit_links"]({model:this.model,mode:"show"})),this.$("#email_button").html(Paydirt.Templates["invoices/email_button"]({invoice:this.model}))},n.prototype.markAsSent=function(t){return t.preventDefault(),this.model.save({},{url:"/invoices/"+this.model.id+"/mark_sent",success:function(t,e){return Paydirt.Flash.notice(e.flash)}})},n.prototype.convertToDraft=function(t){return t.preventDefault(),this.model.save({},{url:Paydirt.Routes.convert_to_draft_invoice(this.model.id),success:function(t,e){return Paydirt.Flash.notice(e.flash)}})},n.prototype.duplicateInvoice=function(t){return t.preventDefault(),Paydirt.Utilities.post(Paydirt.Routes.duplicate_invoice(this.model.id))},n.prototype.editSentInvoice=function(t){return t.preventDefault(),this.model.save({},{url:Paydirt.Routes.convert_to_draft_invoice(this.model.id),success:function(t,e){return Paydirt.router.navigate(Paydirt.Routes.edit_invoice(t.id),{trigger:!0}),Paydirt.Flash.notice(e.flash)}})},n.prototype.deleteInvoice=function(t){return t.preventDefault(),this.model.destroy({success:function(t,e){return Paydirt.router.navigate(Paydirt.Routes.invoices(),{trigger:!0}),Paydirt.Flash.notice(e.flash)}})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.ShowRecurring=function(e){function n(){return this.duplicateRecurringInvoice=t(this.duplicateRecurringInvoice,this),this.deleteInvoice=t(this.deleteInvoice,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoices/show_recurring"],n.prototype.mixins=[Paydirt.Mixins.EnableDisableRecurringInvoice],n.prototype.render=function(){var t;return n.__super__.render.call(this),this.subViews.page=t=new Paydirt.Views.Invoices.Page({model:this.model}),this.$("#invoice_page_container").html(t.render().el),this},n.prototype.deleteInvoice=function(t){return t.preventDefault(),this.model.destroy({success:function(t,e){return Paydirt.router.navigate(Paydirt.Routes.recurring_invoices(),{trigger:!0}),Paydirt.Flash.notice(e.flash)}})},n.prototype.duplicateRecurringInvoice=function(t){return t.preventDefault(),Paydirt.Utilities.post("/recurring_invoices/"+this.model.id+"/duplicate")},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.Jobs={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Jobs.Edit=function(e){function n(){return this.removeEstimate=t(this.removeEstimate,this),this.addEstimate=t(this.addEstimate,this),this.changePriceType=t(this.changePriceType,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["jobs/edit"],n.prototype.computeds=_.extend({showJobPrice:{deps:["price_type"],get:function(){return this.model.perHour()||this.model.fixedPrice()}}},Paydirt.Mixins.JobComputeds),n.prototype.changePriceType=function(t){var e;return t.preventDefault(),e=this.$(t.currentTarget),this.model.set({price_type:+e.data("price-type")})},n.prototype.addEstimate=function(){return this.model.set({add_estimate:!0}),this.$("input[name='estimate']").select()},n.prototype.removeEstimate=function(){return this.model.set({add_estimate:!1,estimate:null}),this.model.set({estimate:0})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Jobs.InvoiceFields=function(e){function n(){return this.toggleSelected=t(this.toggleSelected,this),this.setAmountToInvoice=t(this.setAmountToInvoice,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["jobs/invoice_fields"],n.prototype.viewModel=function(){return new Backbone.Model({selected:!0})},n.prototype.computeds={perHour:{deps:["price_type"],get:function(){return this.model.perHour()}},fixedPrice:{deps:["price_type"],get:function(){return this.model.fixedPrice()}},perUser:{deps:["price_type"],get:function(){return this.model.perUser()}},formattedUnbilledDuration:{deps:["unbilled_duration"],get:function(t){return Paydirt.Formatters.secondsToHours(t)}},formattedTotalDuration:{deps:["duration"],get:function(t){return Paydirt.Formatters.secondsToHours(t)}},formattedEstimate:{deps:["estimate"],get:function(){return Paydirt.Formatters.secondsToHours(this.model.get("estimate")||0)}}},n.prototype.setAmountToInvoice=function(t){return this.model.set({amount_to_invoice:Paydirt.Formatters.currencyToFloat($(t.target).val())})},n.prototype.toggleSelected=function(){return this.viewModel.set({selected:!this.viewModel.get("selected")}),this.$(".invoice_job_checkbox").trigger("change")},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Jobs.InvoiceList=function(e){function n(){return this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.itemView=Paydirt.Views.Jobs.InvoiceFields,n.prototype.el="<div data-bind='collection:$collection'></div>",n.prototype.render=function(){return this.applyBindings(),this},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Jobs.List=function(e){function n(){return this.showAllJobs=t(this.showAllJobs,this),this.repaginateCollection=t(this.repaginateCollection,this),this.initialize=t(this.initialize,this),this.bindingSources=t(this.bindingSources,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["jobs/list"],n.prototype.pageSize=20,n.prototype.bindingSources=function(){return{childCollection:this.childCollection}},n.prototype.initialize=function(t){return null==t&&(t={}),n.__super__.initialize.apply(this,arguments),this.itemView=Paydirt.Views.Jobs.Show,this.viewModel=new Backbone.Model,this.paginatedCollection=new Backbone.CollectionSubset({parent:this.collection,filter:function(t){return function(e){return t.collection.indexOf(e)<t.pageSize}}(this)}),this.childCollection=this.paginatedCollection.child,this.listenTo(this.collection,"add remove",this.repaginateCollection),this.repaginateCollection()},n.prototype.repaginateCollection=function(){return this.viewModel.set(this.collection.length>this.pageSize?{collectionIsPaginated:!0}:{collectionIsPaginated:!1}),this.viewModel.set({fullCollectionSize:this.collection.length})},n.prototype.showAllJobs=function(){return this.viewModel.set({collectionIsPaginated:!1}),this.paginatedCollection.setFilter(function(){return function(){return!0}}(this)),this.paginatedCollection.refresh()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Jobs.Show=function(e){function n(){return this.finishEditing=t(this.finishEditing,this),this.save=t(this.save,this),this.submitJob=t(this.submitJob,this),this.toggleAssignment=t(this.toggleAssignment,this),this.toggleUserAssignmentsWidget=t(this.toggleUserAssignmentsWidget,this),this.startTimer=t(this.startTimer,this),this.destroyJob=t(this.destroyJob,this),this.cancelJobEdit=t(this.cancelJobEdit,this),this.editJob=t(this.editJob,this),this.logTime=t(this.logTime,this),this.markComplete=t(this.markComplete,this),this.markCurrent=t(this.markCurrent,this),this.render=t(this.render,this),this.bindingSources=t(this.bindingSources,this),this.viewModel=t(this.viewModel,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["jobs/show"],n.prototype.className="job_container span-24",n.prototype.viewModel=function(){return new Backbone.Model({editing:this.model.isNew(),assignmentsOpen:!1})},n.prototype.bindingSources=function(){return{assignments:this.model.assignments}},n.prototype.computeds=_.extend({hasAssignments:function(){return Paydirt.account.get("features").assignment},assigneeNames:function(){var t,e;return e=this.getBinding("$assignments"),t=e.length?this.model.assignments.collect(function(){return function(t){return Paydirt.users.get(t.get("user_id")).get("name")}}(this)).join(", "):"nobody"},assigneeIds:function(){var t;return t=this.getBinding("$assignments"),this.model.assignments.collect(function(){return function(t){return t.get("user_id")}}(this))},formattedTotalDuration:{deps:["duration"],get:function(t){return Paydirt.Formatters.secondsToHours(t)}},formattedEstimate:{deps:["estimate"],get:function(){return Paydirt.Formatters.secondsToHours(this.model.get("estimate")||0)}},formattedUnbilledDuration:{get:function(){return Paydirt.Formatters.secondsToHours(this.getBinding("unbilled_duration"))}},priceWithPriceType:{deps:["price","price_type"],get:function(){var t;return t=$("<span />"),this.model.clientHourlyRate()?t.append("Client rate &rarr; "+this.model.client().get("hourly_rate").format()+" <span class='grey'>per hour</span>"):this.model.perUser()||this.model.notBillable()?t.append(this.getBinding("humanPriceType")):(t.append($("<span />",{"class":"amount"}).html(this.getBinding("formattedPrice"))),t.append("&nbsp;"),t.append($("<span />",{"class":"grey t-lowercase"}).html(this.getBinding("humanPriceType"))))}},progressPercent:{deps:["estimate_progress"],get:function(t){return""+Paydirt.Formatters.numberWithPrecision(t)+"%"}},progressComplete:{deps:["estimate_progress"],get:function(t){return t>=100?!0:void 0}},progressWarning:{deps:["estimate_progress"],get:function(t){return 100>t&&t>80?!0:void 0}},showUserAssignments:{get:function(){return this.getBinding("assignmentsOpen")?!0:this.getBinding("completed")?!1:this.getBinding("$assignments").length?!0:!1}}},Paydirt.Mixins.JobComputeds),n.prototype.render=function(){return n.__super__.render.apply(this,arguments),this.$el.data({job:this.model}),this.model.isNew()&&this.editJob(),this},n.prototype.markCurrent=function(){return this.model.save({completed:!1}),Paydirt.Flash.notice("Marked task '"+this.model.get("name")+" as current.")},n.prototype.markComplete=function(){return this.model.save({completed:!0}),Paydirt.Flash.notice("Marked task '"+this.model.get("name")+" as complete.")},n.prototype.logTime=function(){return Paydirt.router.navigate(Paydirt.Routes.new_block(this.model.id),{trigger:!0})},n.prototype.editJob=function(){var t;return this.editModel=this.model.clone(),t=this.subViews.form=new Paydirt.Views.Jobs.Edit({model:this.editModel}),this.$(".job-form-container").html(t.render().el),this.viewModel.set({editing:!0}),this.model.isNew()?setTimeout(function(t){return function(){return t.$(".job-form-container").find("input:first").focus()}}(this),200):void 0},n.prototype.cancelJobEdit=function(){return $("body").first().trigger("jobCancelled"),this.model.isNew()&&this.model.destroy(),this.finishEditing()},n.prototype.destroyJob=function(){return this.model.destroy(),Paydirt.Flash.deleted("Removed task '"+this.model.get("name")+"' and all time logged towards it.")},n.prototype.startTimer=function(){var t;return Paydirt.trackerView.show(),(null!=(t=Paydirt.tracker.get("block"))?t.job().id:void 0)!==this.model.id?Paydirt.tracker.start({jobId:this.model.id}):void 0},n.prototype.toggleUserAssignmentsWidget=function(){var t;return t=!this.viewModel.get("assignmentsOpen"),this.viewModel.set({assignmentsOpen:t}),t?this.$('[data-behaviour~="select2"]:first').select2("open"):void 0},n.prototype.toggleAssignment=function(t){var e;return t.added?(e=Paydirt.users.get(t.added.id),e.assignTo(this.model)):t.removed?(e=Paydirt.users.get(t.removed.id),e.unassignFrom(this.model)):void 0},n.prototype.submitJob=function(){var t,e,i,n,s;if(this.$("input:submit").addClass("no-click"),t=this.editModel.pick(["name","estimate","price_type","price"]),t.estimate<=0&&(t.estimate=null),s=this.model.get("price"),!this.model.isNew()&&this.model.get("unbilled_duration")>0){if(n="Do you want to update the hourly rate of existing time logs?",e="Don't update time logs",i="Update my unbilled time logs",this.model.perHour()&&this.editModel.perHour()&&s.valueOf()!==t.price.valueOf())return void fancyConfirm({heading:n,message:"You're changing the hourly rate for this task from <b>"+s.format()+"</b> to <b>"+t.price.format()+"</b>.\n<br /><br />\nDo you also want to update all unbilled time logs with the old rate of <b>"+s.format()+"</b> to the new rate of <b>"+t.price.format()+"</b> per hour?\n<br /><br />\nThis won't update any time logs that have already been billed.",cancel:e,confirm:i},function(e){return function(i){return e.save(t,i)}}(this));if(this.editModel.perUser()&&!this.model.perUser())return void fancyConfirm({heading:n,message:"You're changing the price type for this task from <b>"+this.model.humanPriceType()+"</b> to <b>"+this.editModel.humanPriceType()+"</b>.\n<br /><br />\nDo you also want to update all unbilled time logs to the hourly rate of the team member that logged that time?\n<br /><br />\nThis won't update any time logs that have already been billed, and won't mark any unbillable time logs as billable.",cancel:e,confirm:i},function(e){return function(i){return e.save(t,i)}}(this));if(this.editModel.notBillable()&&!this.model.notBillable())return void fancyConfirm({heading:"Do you want to mark existing time logs as 'Not billable'?",message:"You're changing the price type for this task from <b>"+this.model.humanPriceType()+"</b> to <b>"+this.editModel.humanPriceType()+"</b>.\n<br /><br />\nDo you also want to mark existing time logs as not billable?\n<br /><br />\nThis won't update any time logs that have already been billed.",cancel:e,confirm:i},function(e){return function(i){return e.save(t,i)}}(this))}return this.save(t)},n.prototype.save=function(t,e){var i;return null==t&&(t={}),null==e&&(e=!1),i=this.model.isNew(),_.extend(t,{update_blocks:e}),this.model.save(t,{success:function(t){return function(e){return $("body").first().trigger("jobSaved"),i?(Paydirt.Flash.notice("Added task '"+t.model.get("name")+"' to '"+t.model.project().get("name")+"'"),Paydirt.jobs.add(e)):(Paydirt.Flash.notice("Saved task '"+t.model.get("name")+"'."),Paydirt.jobs.add(e,{merge:!0})),t.finishEditing()}}(this),error:function(t){return function(){return t.$("input:submit").removeClass("no-click")}}(this)})},n.prototype.finishEditing=function(){var t;return this.viewModel.set({editing:!1}),this.editModel=null,null!=(t=this.subViews.form)?t.teardown():void 0},n}(Paydirt.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.Jobs.UserAssignments=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.initialize=function(t){return this.job=t.job},i}(Paydirt.View)}.call(this),function(){Paydirt.Views.LineItemTaxes={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.LineItemTaxes.Edit=function(e){function n(){return this.updateApplies=t(this.updateApplies,this),this.refresh=t(this.refresh,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["line_item_taxes/edit"],n.prototype.tagName="td",n.prototype.className="tax",n.prototype.events={"change .includes_tax":"updateApplies"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"destroy",this.teardown)},n.prototype.render=function(){return this.$el.html(this.template(this.model.toJSON())),this.refresh(),this},n.prototype.refresh=function(){return this.$(":checkbox").prop({checked:this.model.get("applies")})},n.prototype.updateApplies=function(t){return this.model.set({applies:$(t.target).is(":checked")})},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.LineItems={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.LineItems.Edit=function(e){function n(){return this.hoverOff=t(this.hoverOff,this),this.hoverOn=t(this.hoverOn,this),this.removeLineItem=t(this.removeLineItem,this),this.updateDescription=t(this.updateDescription,this),this.updatePosition=t(this.updatePosition,this),this.updateRate=t(this.updateRate,this),this.updateQuantity=t(this.updateQuantity,this),this.refresh=t(this.refresh,this),this.renderTaxes=t(this.renderTaxes,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["line_items/edit"],n.prototype.tagName="tr",n.prototype.className="fields line_item",n.prototype.events={"blur .line_item_quantity":"updateQuantity","blur .line_item_rate":"updateRate","change input[name=position]":"updatePosition","change textarea[name=description]":"updateDescription","click .remove_line_item":"removeLineItem",mouseenter:"hoverOn",mouseleave:"hoverOff"},n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.invoice=t.invoice,this.listenTo(this.model,"change:quantity change:rate",this.refresh),this.listenTo(this.model.line_item_taxes,"add destroy change reset",this.renderTaxes),this.listenTo(this.invoice.taxes,"add destroy change reset",this.renderTaxes)},n.prototype.render=function(){return this.$el.html(this.template(this.model.attributes)),this.renderTaxes(),this.refresh(),this},n.prototype.renderTaxes=function(){return this.$("td.tax").remove(),this.model.line_item_taxes.each(function(t){return function(e){return t.$("td.line_item_subtotal").before(new Paydirt.Views.LineItemTaxes.Edit({model:e}).render().el)}}(this))},n.prototype.refresh=function(){return this.$(".line_item_quantity").val(this.model.getQuantity()),this.$(".line_item_rate").val(this.model.getRate().format()),this.$(".line_item_subtotal span").text(this.model.get("subtotal").format({precision:2}))},n.prototype.updateQuantity=function(t){return this.model.setQuantity($(t.target).val())},n.prototype.updateRate=function(t){return this.model.setRate($(t.target).val())},n.prototype.updatePosition=function(t){return this.model.set({position:$(t.target).val()})},n.prototype.updateDescription=function(t){return this.model.set({description:$(t.target).val()})},n.prototype.removeLineItem=function(t){return t.preventDefault(),this.model.destroy(),this.teardown()},n.prototype.hoverOn=function(){return this.$el.hasClass("reorder")||this.$(".outset_left_container").show(),this.$el.addClass("hover")},n.prototype.hoverOff=function(){return this.$(".outset_left_container").hide(),this.$el.removeClass("hover")},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Notification=function(e){function n(){return this.decline=t(this.decline,this),this.confirm=t(this.confirm,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates.notification,n.prototype.initialize=function(t){return this.options=t,n.__super__.initialize.call(this,t)},n.prototype.render=function(){return this.$el.html(this.template(this.options)),this.applyBindings(),this},n.prototype.confirm=function(){var t;return"function"==typeof(t=this.options).onConfirm?t.onConfirm():void 0},n.prototype.decline=function(){var t;return"function"==typeof(t=this.options).onDecline?t.onDecline():void 0},n}(Paydirt.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.PageNotFound=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.template=Paydirt.Templates.page_not_found,i}(Paydirt.View)}.call(this),function(){Paydirt.Views.PresetLineItems={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.PresetLineItems.Form=function(e){function n(){return this.save=t(this.save,this),this.removeView=t(this.removeView,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["preset_line_items/form"],n.prototype.events={"click .cancel":"removeView","submit form":"save"},n.prototype.removeView=function(t){return t.preventDefault(),this.model.isNew()?this.model.destroy():this.model.trigger("show"),this.teardown()},n.prototype.save=function(t){return t.preventDefault(),t.stopPropagation(),this.model.save({description:this.$("[name=description]").val(),rate:Paydirt.Formatters.currencyToFloat(this.$("[name=rate]").val())},{success:function(t){return function(e,i){return t.model.trigger("show"),Paydirt.Flash.success(i.flash)}}(this)})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.PresetLineItems.Index=function(e){function n(){return this.add=t(this.add,this),this.renderLineItem=t(this.renderLineItem,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["preset_line_items/index"],n.prototype.events={"click #add_preset_line_item":"add"},n.prototype.render=function(){return this.$el.html(this.template()),this.collection.each(function(t){return function(e){return t.renderLineItem(e)}}(this)),this},n.prototype.renderLineItem=function(t,e){var i;return null==e&&(e={}),this.subViews["line_item-"+t.cid]=i=new Paydirt.Views.PresetLineItems.Show({model:t}),this.$("#preset_line_items").append(i.render().el),e.edit?i.edit():void 0},n.prototype.add=function(t){var e;return t.preventDefault(),e=new Paydirt.Models.PresetLineItem,this.renderLineItem(e,{edit:!0})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.PresetLineItems.Show=function(e){function n(){return this.destroy=t(this.destroy,this),this.edit=t(this.edit,this),this.show=t(this.show,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["preset_line_items/show"],n.prototype.className="row-item",n.prototype.events={"click .edit_link":"edit","click .delete":"destroy"},n.prototype.initialize=function(){return this.listenTo(this.model,"show",this.show),this.listenTo(this.model,"change",this.render),n.__super__.initialize.apply(this,arguments)},n.prototype.show=function(){var t;return null!=(t=this.subViews.form)&&t.teardown(),this.$el.show()},n.prototype.edit=function(t){var e;return null!=t&&t.preventDefault(),this.subViews.form=e=new Paydirt.Views.PresetLineItems.Form({model:this.model}),this.$el.hide(),this.$el.after(e.render().el),e.$(":input:first").focus()},n.prototype.destroy=function(t){return t.preventDefault(),this.model.destroy({success:function(t){return function(e,i){return t.teardown(),Paydirt.Flash.show(i.flash,"deleted")}}(this)})},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.Projects={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Projects.Import=function(e){function n(){return this.close=t(this.close,this),this.error=t(this.error,this),this.loading=t(this.loading,this),this.reset=t(this.reset,this),this.submitProjectId=t(this.submitProjectId,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["projects/import"],n.prototype.initialize=function(t){return _.defaults(t,{closeOnSuccess:!0}),this.model=new Paydirt.Models.Project,n.__super__.initialize.call(this,t)},n.prototype.render=function(){return this.$el.html(this.template(this.options)),this.$("#sync-options").html(Paydirt.Templates["projects/sync_options_fields"](this.options)),this.applyBindings(),this.options.project_id?(this.$("#project-form").slideDown(),this.$("#client-select").slideDown()):(this.loading("Retrieving your projects..."),$.get(this.options.fetchURL).success(function(t){return function(e){var i,n,s,r,a;for(i="",a=e.projects,s=0,r=a.length;r>s;s++)n=a[s],i+="<option value='"+n.id+"' data-basecamp-account-id='"+n.basecamp_account_id+"'>"+n.name+"</option>";return t.$("#project-progress").slideUp(200),t.$("select[name='project-id']").html(i),t.$("#project-form").slideDown(200,$.fancybox.reposition),t.$("#submit-button").removeAttr("disabled")}}(this))),this},n.prototype.submitProjectId=function(){var t,e,i,n,s,r,a;return e=this.options.basecamp_account_id||this.$('[name="project-id"]').find("option:selected").data("basecamp-account-id"),a=this.options.project_id||this.$('[name="project-id"]').find("option:selected").val(),i=this.options.client_id||this.$('[name="client-id"]').val(),r=this.$('[name="import-jobs"]:checked').val(),t=this.$('[name="accept-completeness"]:checked').val(),s=+this.$('[name="default-price-type"]').val(),this.loading("Creating project from "+this.options.importTarget+"..."),n={basecamp_account_id:e,project_id:a,client_id:i,import_jobs:r,accept_completeness:t,default_price_type:s},$.post(this.options.createURL,n).success(function(t){return function(e){return t.$("#project-progress").find('[state="loading"]').hide(),t.$("#project-progress").find('[state="success"]').show(),Paydirt.projects.add(e.project),Paydirt.jobs.add(e.jobs),setTimeout(function(){var i;
return"function"==typeof(i=t.options).success&&i.success(e),t.options.closeOnSuccess?t.close():void 0},2500)}}(this)).error(this.error)},n.prototype.reset=function(t){return t.preventDefault(),this.$("#project-form").slideDown(),this.$("#project-progress").slideUp(),this.$("#project-error").slideUp(),this.$("#submit-button").removeAttr("disabled")},n.prototype.loading=function(t){return this.$(".progress-message").text(t),this.$("#project-form").slideUp(),this.$("#project-progress").slideDown(),this.$("#project-progress").find('[state="loading"]').show(),this.$("#project-progress").find('[state="success"]').hide(),this.$("#submit-button").attr("disabled","disabled")},n.prototype.error=function(t){return this.$("#error-message").text(t.responseText),this.$("#project-form").slideUp(),this.$("#project-progress").slideUp(),this.$("#project-error").slideDown(),this.$("#submit-button").removeAttr("disabled")},n.prototype.close=function(){return this.options.extension?Paydirt.router.close():$.fancybox.close(),this.teardown()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Projects.InvoiceFields=function(e){function n(){return this.render=t(this.render,this),this.initialize=t(this.initialize,this),this.bindingSources=t(this.bindingSources,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["projects/invoice_fields"],n.prototype.bindingSources=function(){return{jobs:this.jobs,expenses:this.expenses}},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.jobs=new Paydirt.Collections.Jobs(this.model.jobs.select(function(t){return t.canBeInvoiced()})),this.jobs.select(function(t){return t.fixedPrice()}).forEach(function(t){return t.set({amount_to_invoice:t.get("unbilled_fixed_value")})}),this.expenses=new Paydirt.Collections.Expenses(this.model.expenses.select(function(t){return!t.isNew()}))},n.prototype.render=function(){var t;return n.__super__.render.apply(this,arguments),this.subViews.jobsList=t=new Paydirt.Views.Jobs.InvoiceList({collection:this.jobs}),this.$(".jobs-list").html(t.render().el),this.subViews.expensesList=t=new Paydirt.Views.Expenses.InvoiceList({collection:this.expenses}),this.$(".expenses-list").html(t.render().el),this},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Projects.Show=function(e){function n(){return this.sync=t(this.sync,this),this.syncWithRedbooth=t(this.syncWithRedbooth,this),this.syncWithBasecamp=t(this.syncWithBasecamp,this),this.syncWithTrello=t(this.syncWithTrello,this),this.syncWithIntegration=t(this.syncWithIntegration,this),this.showSyncOptions=t(this.showSyncOptions,this),this.addExpense=t(this.addExpense,this),this.addJob=t(this.addJob,this),this.saveProject=t(this.saveProject,this),this.markProjectCurrent=t(this.markProjectCurrent,this),this.markProjectComplete=t(this.markProjectComplete,this),this.hideProjectDetails=t(this.hideProjectDetails,this),this.showProjectDetails=t(this.showProjectDetails,this),this.toggleProjectDetails=t(this.toggleProjectDetails,this),this.cancelEditProject=t(this.cancelEditProject,this),this.destroyProject=t(this.destroyProject,this),this.editProject=t(this.editProject,this),this.initializeJobSorting=t(this.initializeJobSorting,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),this.computeds=t(this.computeds,this),this.bindingSources=t(this.bindingSources,this),this.viewModel=t(this.viewModel,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["projects/show"],n.prototype.viewModel=function(){return new Backbone.Model({editing:this.model.isNew(),force_show_details:void 0})},n.prototype.bindingSources=function(){return{jobs:this.model.jobs,expenses:this.model.expenses}},n.prototype.computeds=function(){return{formattedTotalDuration:{deps:["duration"],get:function(t){return Paydirt.Formatters.secondsToHours(t)}},progressPercent:{deps:["estimate_progress"],get:function(t){return""+Paydirt.Formatters.numberWithPrecision(t)+"%"}},progressComplete:{deps:["estimate_progress"],get:function(t){return t>=100?!0:void 0}},humanProgressDescription:{deps:["estimate_progress"],get:function(t){return""+Paydirt.Formatters.numberWithPrecision(t)+"% of estimate"}},showDetails:{deps:["id","completed","force_show_details"],get:function(t,e,i){return null!=i?i:t&&!e}}}},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model.jobs,"add",this.initializeJobSorting)},n.prototype.render=function(){var t;return n.__super__.render.apply(this,arguments),this.subViews.jobs=t=new Paydirt.Views.Jobs.List({collection:this.model.jobs}),this.$(".jobs-list-container").html(t.render().el),this.subViews.expenses=t=new Paydirt.Views.Expenses.List({collection:this.model.expenses}),this.$(".expenses-list").html(t.render().el),this.initializeJobSorting(),this},n.prototype.initializeJobSorting=function(){return this.$sortables=this.$(".jobs-list"),this.jobSortingInitialized?this.$sortables.sortable("refresh"):(this.$sortables.sortable({placeholder:"job-placeholder",connectWith:".jobs-list",revert:200,distance:10,start:function(){return function(t,e){return $('<div class="overlay_message" />').text("Drag this job to a different position or project.").hide().appendTo("body").fadeIn(200),e.item.find(".job-dropdown.open").removeClass("open")}}(this),stop:function(){return function(t,e){var i,n,s,r,a,o,l,c;return $(".overlay_message").fadeOut(200,function(){return $(this).remove()}),n=e.item.data("job"),i=n.get("position"),a=null!=(l=e.item.prev(".job_container").data("job"))?l.get("position"):void 0,r=null!=(c=e.item.next(".job_container").data("job"))?c.get("position"):void 0,s=null!=a&&null!=r&&(a>i||i>r)?PositionGenerator.between(a,r):null!=a&&a>i?PositionGenerator.raise(a):null!=r&&i>r?PositionGenerator.reduce(r):i,o=e.item.parents(".manage-project").data("project-id"),n.get("project_id")!==o||s!==i?(n.set({project_id:o,position:s}),n.isNew()?void 0:n.save({},{success:function(){var t,e;return Paydirt.Flash.notice("Moved task "+n.get("name")+"."),null!=(t=n.project())&&t.jobs.sort(),null!=(e=n.project())?e.trackerJobs.sort().trigger("change"):void 0}})):void 0}}(this)}),this.jobSortingInitialized=!0)},n.prototype.editProject=function(){return this.viewModel.set({editing:!0})},n.prototype.destroyProject=function(){return this.model.destroy(),Paydirt.Flash.deleted("Removed project '"+this.model.get("name")+"' and all tasks, expenses, and time logged towards it.")},n.prototype.cancelEditProject=function(){return this.viewModel.set({editing:!1}),this.model.isNew()?($("body").first().trigger("projectCancelled"),this.model.destroy()):void 0},n.prototype.toggleProjectDetails=function(){var t;return t=null!=this.viewModel.get("force_show_details")?!this.viewModel.get("force_show_details"):this.model.get("id")&&this.model.get("completed"),this.viewModel.set({force_show_details:t})},n.prototype.showProjectDetails=function(){return this.viewModel.set({force_show_details:!0})},n.prototype.hideProjectDetails=function(){return this.viewModel.set({force_show_details:!1})},n.prototype.markProjectComplete=function(){return this.model.save({completed:!0}),Paydirt.Flash.notice("Marked project '"+this.model.get("name")+"' as complete.")},n.prototype.markProjectCurrent=function(){return this.model.save({completed:!1}),Paydirt.Flash.notice("Marked project '"+this.model.get("name")+"' as current.")},n.prototype.saveProject=function(){var t,e;return t=this.$("input:submit"),t.addClass("no-click"),e=this.model.isNew(),this.model.save({name:this.$("input[name=name]").val()},{success:function(i){return function(){return $("body").first().trigger("projectSaved"),i.viewModel.set({editing:!1}),Paydirt.Flash.notice(e?"Added project '"+i.model.get("name")+"'.":"Updated project '"+i.model.get("name")+"'."),t.removeClass("no-click")}}(this),error:function(){return function(){return t.removeClass("no-click")}}(this)})},n.prototype.addJob=function(){var t,e;return t=new Paydirt.Models.Job({project_id:this.model.id,client_id:this.model.client().id,position:PositionGenerator.reduce(null!=(e=this.model.jobs.first())?e.get("position"):void 0)}),this.model.jobs.add(t)},n.prototype.addExpense=function(){var t;return t=new Paydirt.Models.Expense({project_id:this.model.id,client_id:this.model.client().id}),this.model.expenses.add(t)},n.prototype.showSyncOptions=function(){var t,e;return null!=(e=this.subViews.syncOptions)&&e.teardown(),t={model:this.model,importServiceName:this.model.integrationServiceName(),importTarget:""+this.model.integrationServiceName()+" "+this.model.integrationProjectName(),jobName:this.model.integrationJobName()},this.subViews.syncOptions=new Paydirt.Views.Projects.SyncOptions(t),$.fancybox({modal:!0,content:this.subViews.syncOptions.render().$el,padding:0})},n.prototype.syncWithIntegration=function(t){return t.preventDefault(),null!=this.model.get("trello_board_id")?this.syncWithTrello():null!=this.model.get("basecamp_project_id")?this.syncWithBasecamp():null!=this.model.get("redbooth_project_id")?this.syncWithRedbooth():void 0},n.prototype.syncWithTrello=function(){var t;return t="<ul>\n  "+(this.model.get("import_jobs")?"<li>New cards on the Trello board will be imported as tasks.</li>":"")+"\n  "+(this.model.get("accept_completeness")?"<li>Cards that are archived on the Trello board will be marked as complete in Paydirt</li>":"")+"\n  "+(this.model.get("accept_completeness")?"<li>Cards that aren't archived on the Trello board will be marked as current in Paydirt</li>":"")+"\n  <li>Your Trello board won't be touched.</li>\n</ul>\n<p>Go ahead and Sync?</p>",this.sync("Trello","board","cards",t,"/integrations/trello/create_jobs_from_cards?project_id="+this.model.id)},n.prototype.syncWithBasecamp=function(){var t;return t="<ul>\n  "+(this.model.get("import_jobs")?"<li>New todos on the Basecamp project will be imported as tasks.</li>":"")+"\n  "+(this.model.get("accept_completeness")?"<li>Todos that are marked as completed in Basecamp will be marked as completed in Paydirt.</li>":"")+"\n  "+(this.model.get("accept_completeness")?"<li>Todos that aren't marked as completed in Basecamp will be marked as current in Paydirt.</li>":"")+"\n  <li>Your Basecamp project won't be touched.</li>\n</ul>\n<p>Go ahead and Sync?</p>",this.sync("Basecamp","project","todos",t,"/integrations/basecamp/create_jobs_from_todos?project_id="+this.model.id)},n.prototype.syncWithRedbooth=function(){var t;return t="<ul>\n  "+(this.model.get("import_jobs")?"<li>New tasks on the Redbooth project will be imported as tasks.</li>":"")+"\n  "+(this.model.get("accept_completeness")?"<li>Tasks that are marked as completed in Redbooth will be marked as completed in Paydirt.</li>":"")+"\n  "+(this.model.get("accept_completeness")?"<li>Tasks that aren't marked as completed in Redbooth will be marked as current in Paydirt.</li>":"")+"\n  <li>Your Redbooth project won't be touched.</li>\n</ul>\n<p>Go ahead and Sync?</p>",this.sync("Redbooth","project","tasks",t,"/integrations/redbooth/create_jobs_from_tasks?project_id="+this.model.id)},n.prototype.sync=function(t,e,i,n,s){return fancyConfirm({heading:"Here's what will happen",message:n,cancel:"Never mind",confirm:"Sync with "+t+" now"},function(){return function(n){return n===!0?(fancyConfirm({heading:"Syncing with "+t+" "+e+"...",message:"Please wait while we fetch your "+i+" from "+t+".",cancel:"",confirm:""}),$.ajax({type:"PUT",url:s,success:function(t){return t.jobs.forEach(function(t){return Paydirt.jobs.updateFromPush(t)}),fancyConfirm({heading:"All done!",message:t.success_message,cancel:"",confirm:"Okay"})},error:function(){return fancyConfirm({heading:"Something went wrong.",message:"<p>Sorry, we weren't able to sync with "+t+". Please try again later.</p> <p>If you continue to have trouble, please contact talk@paydirtapp.com for support.</p>",cancel:"",confirm:"Okay"})}})):void 0}}(this))},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Projects.SyncOptions=function(e){function n(){return this.close=t(this.close,this),this.submitOptions=t(this.submitOptions,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["projects/sync_options"],n.prototype.render=function(){return this.$el.html(this.template(this.options)),this.$("#sync-options").html(Paydirt.Templates["projects/sync_options_fields"](this.options)),this.applyBindings(),this},n.prototype.submitOptions=function(t){var e,i,n,s,r,a;return e=$(t.currentTarget),e.addClass("no-click"),a="/clients/"+this.model.get("client_id")+"/projects/"+this.model.id+"/sync_options",r=this.$('[name="import-jobs"]:checked').val(),i=this.$('[name="accept-completeness"]:checked').val(),s=+this.$('[name="default-price-type"]').val(),n={import_jobs:r,accept_completeness:i,default_price_type:s},$.post(a,n).success(function(t){return function(){return t.close(),Paydirt.Flash.show("Updated project sync options - you may want to sync again now.","notice")}}(this)).error(function(){return function(){return e.removeClass("no-click")}}(this))},n.prototype.close=function(){return $.fancybox.close(),this.teardown()},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.Quotes={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Quotes.Browser=function(e){function n(){return this.exportCSV=t(this.exportCSV,this),this.toggleAdvancedSearch=t(this.toggleAdvancedSearch,this),this.setEndDate=t(this.setEndDate,this),this.setStartDate=t(this.setStartDate,this),this.setDateRangeType=t(this.setDateRangeType,this),this.changeDateCriteria=t(this.changeDateCriteria,this),this.changeClient=t(this.changeClient,this),this.filterQuotes=t(this.filterQuotes,this),this.refresh=t(this.refresh,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["quotes/browser"],n.prototype.events={"click #previous":"previousPeriod","click #next":"nextPeriod","change #start_date":"setStartDate","change #end_date":"setEndDate","change #date_range_type":"setDateRangeType","change #autocompleter":"changeClient","change #date_criteria":"changeDateCriteria","click #toggle_advanced_search":"toggleAdvancedSearch"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.model=new Paydirt.Models.QuoteBrowser,this.clients=Paydirt.clients,this.model.setState({initializing:!0}),Paydirt.router.onpopstate=function(t){return function(e){return null!=e.state?t.model.setState({from:e.state,popped:!0}):void 0}}(this),this.filteredQuotes=new Paydirt.Collections.Quotes(this.collection.models),this.filterQuotes(),this.listenTo(this.model,"dateRangeChanged change:client_id change:dateCriteria",this.filterQuotes),this.listenTo(this.collection,"add remove reset",this.filterQuotes),this.listenTo(this.filteredQuotes,"reset",this.refresh),this.subViews.quoteList=new Paydirt.Views.Quotes.List({collection:this.filteredQuotes,filtered:!0})},n.prototype.render=function(){return this.$el.html(this.template()),this.$("#invoice_list").html(this.subViews.quoteList.render().el),this.refresh(),this},n.prototype.refresh=function(){var t,e,i,n,s;this.$("#date_range_type").val(this.model.get("dateRangeType")).trigger("liszt:updated"),"all-time"===this.model.get("dateRangeType")?this.$("#date_fields").hide():(this.$("#date_fields").show(),this.$("#start_date").val(new moment(this.model.get("startDate")).format()),this.$("#end_date").val(new moment(this.model.get("endDate")).format())),t=this.model.get("client_id"),null!=t?this.$("#autocompleter").val("client-"+t).trigger("liszt:updated"):this.$("#autocompleter").val("").trigger("liszt:updated"),i=this.model.get("dateCriteria"),this.$("#date_criteria").val(i).trigger("liszt:updated"),null!=t||null!=i?this.$("#advanced_filters_row").show():this.$("#advanced_filters_row").hide(),n=this.filteredQuotes.groupBy(function(t){return t.currency().id});for(e in n)s=n[e],n[e]=new Paydirt.Collections.Quotes(s);return this.$("#invoice_browser_summary").html(Paydirt.Templates["quotes/browser_summary"]({groupedQuotes:n})),this.$("#export_csv").toggle(this.filteredQuotes.length>0),this},n.prototype.filterQuotes=function(){var t,e,i;return t=this.model.get("client_id"),i=this.model.get("dateRangeType"),e=this.model.get("dateCriteria"),this.filteredQuotes.reset(this.collection.filter(function(n){return function(s){var r,a,o;switch(e){case"issued_at":case null:case void 0:r=s.issuedAt();break;case"accepted_at":s.get("accepted_at")&&(r=s.acceptedAt());break;case"declined_at":s.get("declined_at")&&(r=s.declinedAt())}return o=null!=r?"all-time"===i?!0:n.model.get("startDate")<=r&&r<=n.model.get("endDate"):!1,a=null!=t?s.get("client_id")===+t:!0,o&&a}}(this)))},n.prototype.changeClient=function(t){var e,i;return e=$(t.target),i=e.find("option:selected"),""===i.val()?this.model.unset("client_id"):this.model.set({client_id:i.data("id")})},n.prototype.changeDateCriteria=function(t){var e;return e=$(t.target).val(),this.model.set({dateCriteria:e})},n.prototype.setDateRangeType=function(t){return t.preventDefault(),this.model.set({dateRangeType:$(t.target).val()})},n.prototype.setStartDate=function(t){var e;return t.preventDefault(),e=new Date($(t.target).val()),"Invalid Date"===e.toString()?this.$("#start_date").addClass("invalid"):(this.$("#start_date").removeClass("invalid"),this.model.setStartDateTo(e))},n.prototype.setEndDate=function(t){var e;return t.preventDefault(),e=new Date($(t.target).val()),"Invalid Date"===e.toString()?this.$("#end_date").addClass("invalid"):(this.$("#end_date").removeClass("invalid"),this.model.setEndDateTo(e))},n.prototype.previousPeriod=function(t){return t.preventDefault(),this.model.previousPeriod()},n.prototype.nextPeriod=function(t){return t.preventDefault(),this.model.nextPeriod()},n.prototype.toggleAdvancedSearch=function(t){return t.preventDefault(),this.$("#advanced_filters_row").toggle()},n.prototype.exportCSV=function(t){return t.preventDefault(),window.location.href="/quotes/export_csv?"+$.param({ids:this.filteredQuotes.pluck("id")})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Quotes.EditSidebar=function(e){function n(){return this.save=t(this.save,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["quotes/edit_sidebar"],n.prototype.render=function(){return this.$el.html(this.template({quote:this.model})),this},n.prototype.save=function(){return this.$("#save-invoice").val("Saving...").addClass("no-click"),this.model.save({},{success:function(t){return function(e,i){return _(e.line_items.where({_destroy:1})).each(function(t){return _(Paydirt.blocks.where({line_item_id:t.id})).each(function(t){return t.set({line_item_id:null,billed:!1}),t.markClean()})}),Paydirt.quotes.remove(e.id),Paydirt.quotes.add(e),e.markClean(),Paydirt.Flash.notice(i.flash),Paydirt.router.navigate(Paydirt.Routes.quote(t.model.id),{trigger:!0})}}(this),error:function(t){return function(){return t.$("#save-invoice").val("Save").removeClass("no-click")}}(this)})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Quotes.EditSidebarFree=function(e){function n(){return this.setLocale=t(this.setLocale,this),this.setCurrency=t(this.setCurrency,this),this.downloadPDF=t(this.downloadPDF,this),this.print=t(this.print,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["quotes/edit_sidebar_free"],n.prototype.events={"click #print_invoice":"print","click #download_pdf":"downloadPDF","change #currency_id":"setCurrency","change #locale":"setLocale"},n.prototype.render=function(){return this.$el.html(this.template({quote:this.model})),this},n.prototype.print=function(t){return t.preventDefault(),Paydirt.Utilities.post("/free_quote_template/print",this.model.toJSON(),"_blank")},n.prototype.downloadPDF=function(t){return t.preventDefault(),Paydirt.Utilities.post("/free_quote_template/pdf",this.model.toJSON(),"_blank")},n.prototype.setCurrency=function(t){var e,i;return e=$(t.target),i=Paydirt.currencies.get(e.val()),this.model.set({currency_id:i.id})},n.prototype.setLocale=function(t){var e;return e=$(t.target).val(),I18n.locale=e,this.model.set({locale:e})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.Graph=function(e){function n(){return this.lastObjectDate=t(this.lastObjectDate,this),this.firstObjectDate=t(this.firstObjectDate,this),this.summingFunction=t(this.summingFunction,this),this.filteringFunction=t(this.filteringFunction,this),this.groupingFunction=t(this.groupingFunction,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.groupingFunction=function(t){return t.issuedAtWeek()},n.prototype.filteringFunction=function(t){return t.get("client_id")===this.client.id},n.prototype.summingFunction=function(t,e){return t+parseFloat(e.get("total"))},n.prototype.firstObjectDate=function(){return moment(this.collection.first().issuedAtWeek())},n.prototype.lastObjectDate=function(){return moment(this.collection.last().issuedAtWeek())},n}(Paydirt.Views.Graphs.Base)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Quotes.Index=function(e){function n(){return this.toggleQuoteBuilder=t(this.toggleQuoteBuilder,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["quotes/index"],n.prototype.render=function(){var t;return this.$el.html(this.template({current:this.options.current})),this.options.current?(this.subViews.currentQuotesList=t=new Paydirt.Views.Quotes.List({collection:this.collection}),this.$(".quotes_main").html(t.render().el),this.subViews.currentQuotesSummary=t=new Paydirt.Views.Quotes.ListSummary({collection:Paydirt.quotes.current()}),this.$(".quotes_summary").html(t.render().el)):(this.subViews.quoteBrowser=t=new Paydirt.Views.Quotes.Browser({collection:this.collection}),this.$(".quotes_body").html(t.render().el)),this.subViews.newQuote=t=new Paydirt.Views.Quotes.New,this.$(".new_quote_button").html(t.render().el),this.$(".secondary_navigation").find("a[href$='"+window.location.pathname+"']").addClass("selected"),this},n.prototype.toggleQuoteBuilder=function(t){return t.preventDefault(),this.$(".action-bar.new_quote").slideToggle("fast")},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Quotes.List=function(e){function n(){return this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["quotes/list"],n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.collection,"add remove change reset",this.render),this.client=t.client,this.filtered=t.filtered},n.prototype.render=function(){return this.$el.html(this.template()),this.collection.length>0?(this.$(".box.empty").hide(),this.$("hr.double").show(),this.collection.each(function(t){return function(e){var i;return t.subViews["quote-"+e.cid]=i=new Paydirt.Views.Quotes.ListItem({model:e}),t.$(".quotes").append(i.render().el)}}(this))):(this.$(".box.empty p").html(null!=this.client?"You haven't created a quote for "+this.client.get("business_name")+" yet.":this.filtered?"No quotes match those filters.":"No outstanding or unsent quotes. <a href='/help/guides/quoting' target='_blank'>Learn how to create a quote</a>."),this.$(".box.empty").show(),this.$("hr.double").hide()),this},n}(Paydirt.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.Quotes.ListItem=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.template=Paydirt.Templates["quotes/list_item"],i.prototype.className="inline",i}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Quotes.ListSummary=function(e){function n(){return this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["quotes/list_summary"],n.prototype.render=function(){var t,e,i;e=this.collection.groupBy(function(t){return t.currency().id});for(t in e)i=e[t],e[t]=new Paydirt.Collections.Quotes(i);return this.$el.html(this.template({groupedQuotes:e})),this},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Invoices.LogoUploader=function(e){function n(){return this.submitLogo=t(this.submitLogo,this),this.previewLogo=t(this.previewLogo,this),this.showLogoFields=t(this.showLogoFields,this),this.hide=t(this.hide,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["invoices/logo_uploader"],n.prototype.events={"click .dismiss":"hide","click #show_logo_fields":"showLogoFields","click .cancel":"showLogoFields","change input#logo":"previewLogo","click #submit_logo":"submitLogo"},n.prototype.render=function(){return this.$el.html(this.template({invoice:this.model})),this},n.prototype.hide=function(t){return t.preventDefault(),this.$("#logo_widget").slideUp()},n.prototype.showLogoFields=function(){return this.$("#logo").val(""),this.$("#show_logo_fields_container").hide(),this.$("#logo_fields").show(),this.$("#logo_preview").hide()},n.prototype.previewLogo=function(t){var e;return t.preventDefault(),e=new FileReader,e.onload=function(t){return function(e){var i;return i=new Image,i.src=e.target.result,t.$("#temporary_logo").html(i),t.$("#logo_fields").hide(),t.$("#logo_preview").show()}}(this),this.file=$(t.target).get(0).files[0],e.readAsDataURL(this.file)},n.prototype.submitLogo=function(t){var e,i;return t.preventDefault(),$(t.target).addClass("no-click"),e=new FormData,i=this.$("input#logo").get(0).files[0],i?(e.append("account[logo]",i),$.ajax({url:"/settings/logo",data:e,processData:!1,contentType:!1,type:"PUT",success:function(t){return function(e){var i;return Paydirt.Flash.notice("Added logo to your account"),i=$("<img>").attr({src:e.logo_path}),t.$(".logo_bar").replaceWith(i),Paydirt.account.set({logo_path:e.logo_path})}}(this)})):void 0},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Quotes.New=function(e){function n(){return this.openNewClientModal=t(this.openNewClientModal,this),this.draftQuote=t(this.draftQuote,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["quotes/new"],n.prototype.draftQuote=function(t){var e;return t.preventDefault(),e=this.$("#new_quote_client_id").val(),""===e?this.$("#new_quote_client_id_chzn").shake():"new"===e?this.openNewClientModal({callback:function(t){return function(e){return t.$('button[type="submit"]').addClass("disabled").html('<i class="icon-refresh icon-spin"></i> &nbsp;Working...'),Paydirt.Utilities.post("/quotes",{client_id:e})}}(this)}):Paydirt.Utilities.post("/quotes",{client_id:e})},n.prototype.openNewClientModal=function(t){var e;return Paydirt.client=new Paydirt.Models.Client,this.subViews.new_client=e=new Paydirt.Views.Documents.NewClient({model:Paydirt.client,afterSave:t.callback,type:"Quote"}),$.fancybox.open({openSpeed:600,closeSpeed:200,margin:0,padding:0,scrolling:"visible",modal:!0,content:e.render().$el})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Quotes.Page=function(e){function n(){return this.refreshFlag=t(this.refreshFlag,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["quotes/page"],n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change:sent change:accepted_at change:declined_at",this.refreshFlag)},n.prototype.render=function(){return this.$el.html(this.template({quote:this.model})),this.$("#invoice-page").addClass("loading"),$.ajax(this.model.url()).done(function(t){return function(e){return t.$("#invoice_contents").html($(e))}}(this)).fail(function(){return function(t){return Paydirt.Flash.error(t.responseText)}}(this)).always(function(t){return function(){return t.$("#invoice-page").removeClass("loading")}}(this)),this},n.prototype.refreshFlag=function(){var t;return t="."+this.model.state(),this.$(".overlays div").not(t).removeClass("current"),this.$(".overlays div").filter(t).addClass("current")},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Quotes.Show=function(e){function n(){return this.deleteQuote=t(this.deleteQuote,this),this.editSentQuote=t(this.editSentQuote,this),this.convertQuoteToInvoice=t(this.convertQuoteToInvoice,this),this.duplicateQuote=t(this.duplicateQuote,this),this.markAsSent=t(this.markAsSent,this),this.refresh=t(this.refresh,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["quotes/show"],n.prototype.events={"click #mark_quote_as_sent":"markAsSent","click #convert_quote_to_draft":"convertToDraft","click #duplicate_quote":"duplicateQuote","confirm .edit_sent_quote":"editSentQuote","confirm #delete_quote":"deleteQuote"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change:sent",this.refresh)
},n.prototype.render=function(){var t;return this.$el.html(this.template({quote:this.model})),this.subViews.activities=t=new Paydirt.Views.DocumentActivities.Index({collection:Paydirt.quote.activities,document:this.model}),this.$("#invoice_activity_container").html(t.render().el),this.subViews.page=t=new Paydirt.Views.Quotes.Page({model:this.model}),this.$("#quote_page_container").html(t.render().el),this.subViews.state=t=new Paydirt.Views.Quotes.State({model:this.model}),this.$("#state_container").html(t.render().el),this.refresh(),this},n.prototype.refresh=function(){return this.$("#show_edit_links").html(Paydirt.Templates["quotes/show_edit_links"]({model:this.model,mode:"show"})),this.$("#email_button").html(Paydirt.Templates["quotes/email_button"]({quote:this.model}))},n.prototype.markAsSent=function(t){return t.preventDefault(),this.model.save({},{url:"/quotes/"+this.model.id+"/mark_sent",success:function(t,e){return Paydirt.Flash.notice(e.flash)}})},n.prototype.duplicateQuote=function(t){return t.preventDefault(),Paydirt.Utilities.post(Paydirt.Routes.duplicate_quote(this.model.id))},n.prototype.convertQuoteToInvoice=function(t){return t.preventDefault(),Paydirt.Utilities.post(Paydirt.Routes.convert_quote_to_invoice(this.model.id))},n.prototype.editSentQuote=function(t){return t.preventDefault(),this.model.save({},{url:Paydirt.Routes.mark_quote(this.model.id,"draft"),success:function(t,e){return Paydirt.router.navigate(Paydirt.Routes.edit_quote(t.id),{trigger:!0}),Paydirt.Flash.notice(e.flash)}})},n.prototype.deleteQuote=function(t){return t.preventDefault(),this.model.destroy({success:function(t,e){return Paydirt.router.navigate(Paydirt.Routes.quotes(),{trigger:!0}),Paydirt.Flash.notice(e.flash)}})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Quotes.State=function(e){function n(){return this.setState=t(this.setState,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["quotes/state"],n.prototype.events={"click a[data-state]":"setState"},n.prototype.initialize=function(t){return this.model=t.model,this.listenTo(this.model,"change",this.render)},n.prototype.render=function(){return this.$el.html(this.template({quote:this.model})),this},n.prototype.setState=function(t){var e;return this.$(".icon-caret-down").removeClass().addClass("icon-refresh icon-spin"),e=$(t.currentTarget).data("state"),t.preventDefault(),this.model.save({},{url:Paydirt.Routes.mark_quote(this.model.id,e),success:function(t,e){return Paydirt.Flash.notice(e.flash)}})},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.RecurringInvoices={}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.RecurringInvoices.List=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.template=Paydirt.Templates["recurring_invoices/list"],i}(Paydirt.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.RecurringInvoices.ListItem=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.template=Paydirt.Templates["recurring_invoices/list_item"],i.prototype.mixins=[Paydirt.Mixins.EnableDisableRecurringInvoice],i.prototype.tagName="tr",i.prototype.className="recurring-invoice-list-item",i}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.RecurringInvoices.New=function(e){function n(){return this.save=t(this.save,this),this.render=t(this.render,this),this.setClientId=t(this.setClientId,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["recurring_invoices/new"],n.prototype.computeds={scheduleList:{get:function(){var t,e,i;return e=function(){var e,n,s,r;for(s=this.getBinding("upcoming_recurring_dates"),r=[],e=0,n=s.length;n>e;e++)t=s[e],i=new moment(t),r.push("<li>"+i.format()+"</li>");return r}.call(this)}}},n.prototype.initialize=function(){return n.__super__.initialize.call(this),this.model=new Paydirt.Models.Invoice({type:"RecurringInvoice"}),this},n.prototype.setClientId=function(t){return this.client_id=this.$(t.currentTarget).val()},n.prototype.render=function(){var t;return n.__super__.render.call(this),this.subViews.form=t=new Paydirt.Views.RecurringInvoices.ScheduleForm({model:this.model}),this.$("#schedule_form").html(t.render().el),this},n.prototype.save=function(t){var e;return Paydirt.Utilities.validateForm(this.$("form"))?(e=this.model.pick("every","interval","recurring_start_date"),$(t.currentTarget).addClass("no-click"),Paydirt.Utilities.post(this.model.urlRoot(),{invoice:e,client_id:this.client_id})):$(t.currentTarget).shake()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.RecurringInvoices.ScheduleForm=function(e){function n(){return this.updateStartOptions=t(this.updateStartOptions,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.viewModel=new Backbone.Model,n.prototype.template=Paydirt.Templates["recurring_invoices/schedule_form"],n.prototype.events={'change [name="invoice[interval]"]':"setInterval",'change [name="invoice[every]"]':"setEvery",'change [name="invoice[week_on]"]':"setWeekOn",'change [name="invoice[month_on]"]':"setMonthOn",'change [name="invoice[recurring_start_date]"]':"setStartDate",'change [name="invoice[annual_recurring_start_date]"]':"setStartDate"},n.prototype.initialize=function(t){var e;return e=+this.model.get("every"),this.viewModel.set({week:0===e,month:1===e,year:2===e,week_on:0===e?this.model.get("on"):0,month_on:1===e?this.model.get("on"):1,startDates:[]}),n.__super__.initialize.call(this,t)},n.prototype.render=function(){return n.__super__.render.call(this),this.model.isNew()?this.updateStartOptions():this.updateStartOptions(this.model.get("recurring_start_date")),this},n.prototype.setInterval=function(){var t;return t=+this.$('[name="invoice[interval]"]').val(),t>0?this.model.set({interval:t}):this.$('[name="invoice[interval]"]').val(1),this.updateSchedule()},n.prototype.setEvery=function(){var t;return t=+this.$('[name="invoice[every]"]').val(),this.model.set({every:t}),this.viewModel.set({week:0===t,month:1===t,year:2===t}),this.setOn()},n.prototype.setWeekOn=function(){return this.viewModel.set({week_on:this.$('[name="invoice[week_on]"]').val()}),this.setOn()},n.prototype.setMonthOn=function(){return this.viewModel.set({month_on:this.$('[name="invoice[month_on]"]').val()}),this.setOn()},n.prototype.setOn=function(){switch(+this.model.get("every")){case 0:return this.model.set({on:this.viewModel.get("week_on")}),this.updateStartOptions();case 1:return this.model.set({on:this.viewModel.get("month_on")}),this.updateStartOptions();case 2:return this.model.set({on:null}),this.setStartDate()}},n.prototype.setStartDate=function(){var t;return t=2===+this.model.get("every")?this.$('[name="invoice[annual_recurring_start_date]"]').val():this.$('[name="invoice[recurring_start_date]"]').val(),this.model.set({recurring_start_date:t}),null!=t&&""!==t?this.updateSchedule():console.log("This shouldn't happen.")},n.prototype.updateStartOptions=function(t){return this.$('[name="invoice[recurring_start_date]"]').html('<option selected="selected">loading...</option>').addClass("loading"),$.ajax({type:"get",url:"/recurring_invoices/start_dates_for",data:{invoice:this.model.pick("every","on")},success:function(e){return function(i){var n;return e.$('[name="invoice[recurring_start_date]"]').empty().removeClass("loading"),null!=i.dates&&(n=i.dates,null!=t&&n.unshift(t),n=_.uniq(n),e.viewModel.set({startDates:_.map(n,function(t){return{label:moment(t).format(),value:t}})})),e.setStartDate()}}(this)})},n.prototype.updateSchedule=function(){return $(".schedule-list").addClass("loading"),$.ajax({type:"get",url:"/recurring_invoices/recurring_dates_for",data:{invoice:this.model.pick("every","on","interval","recurring_start_date","id")},success:function(t){return function(e){return t.model.set({upcoming_recurring_dates:e.dates}),$(".schedule-list").removeClass("loading")}}(this)})},n}(Paydirt.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.ReportsIndex=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.header=Paydirt.Templates["reports/header"],i.prototype.body=Paydirt.Templates["reports/index"],i.prototype.render=function(){return this.$el.html(this.header()),this.$(".secondary_navigation").find("a[href$='"+window.location.pathname+"']").addClass("selected"),this.applyBindings(),$.get(Paydirt.Routes.reports()).success(function(t){return function(e){return t.$el.append(t.body({blocks:e.blocks}))}}(this)),this},i}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.ReportsProjects=function(e){function n(){return this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.header=Paydirt.Templates["reports/header"],n.prototype.body=Paydirt.Templates["reports/projects"],n.prototype.render=function(){return this.$el.html(this.header({report:"Project Budgets"})),this.$el.append(this.body()),this.$(".secondary_navigation").find("a[href$='"+window.location.pathname+"']").addClass("selected"),this.applyBindings(),this.$(".report-body").addClass("loading"),$.get(Paydirt.Routes.reports_projects()).success(function(t){return function(e){return t.$(".report-body").html(e).removeClass("loading")}}(this)),this},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.ReportsTimesheets=function(e){function n(){return this.currentPeriod=t(this.currentPeriod,this),this.nextPeriod=t(this.nextPeriod,this),this.previousPeriod=t(this.previousPeriod,this),this.setRange=t(this.setRange,this),this.setTarget=t(this.setTarget,this),this["export"]=t(this["export"],this),this.refresh=t(this.refresh,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.header=Paydirt.Templates["reports/header"],n.prototype.body=Paydirt.Templates["reports/timesheets"],n.prototype.computeds=_.extend({},Paydirt.Mixins.ReportComputeds),n.prototype.render=function(){return this.model=new Paydirt.Models.Report,this.model.setState($.deparam(window.location.search.substring(1))),this.$el.html(this.header({report:"Timesheets"})),this.$el.append(this.body({model:this.model})),this.$(".secondary_navigation").find("a[href$='"+window.location.pathname+"']").addClass("selected"),this.applyBindings(),Paydirt.router.onpopstate=function(t){return function(e){var i;return null!=e.state?(i=$.deparam(window.location.search.substring(1)),i.popped=!0,t.model.setState(i)):void 0}}(this),this.listenTo(this.model,"change",this.refresh),this.refresh(),this},n.prototype.refresh=function(){return this.$("select[name=range]").val(this.model.get("range")).trigger("liszt:updated"),this.$("select[name=target]").val(this.model.get("target")).trigger("liszt:updated"),this.$(".report-body").addClass("loading"),$.get(Paydirt.Routes.reports_timesheets()+".html",{target:this.model.get("target"),range:this.model.get("range"),start:this.model.get("start").format("YYYY-MM-DD"),end:this.model.get("end").format("YYYY-MM-DD")}).success(function(t){return function(e){return t.$(".report-body").html(e).removeClass("loading")}}(this))},n.prototype["export"]=function(){var t;return t=""+Paydirt.Routes.reports_timesheets()+".csv?"+$.param({target:this.model.get("target"),range:this.model.get("range"),start:this.model.get("start").format("YYYY-MM-DD"),end:this.model.get("end").format("YYYY-MM-DD")}),window.location.href=t},n.prototype.setTarget=function(t){return this.model.setTarget(this.$(t.target).val())},n.prototype.setRange=function(t){return this.model.setRange(this.$(t.target).val())},n.prototype.previousPeriod=function(){return this.model.previousPeriod()},n.prototype.nextPeriod=function(){return this.model.nextPeriod()},n.prototype.currentPeriod=function(){return this.model.currentPeriod()},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.Settings={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Settings.InvoiceEmail=function(e){function n(){return this.insertTag=t(this.insertTag,this),this.storePosition=t(this.storePosition,this),this.edit=t(this.edit,this),this.preview=t(this.preview,this),this.toggleMode=t(this.toggleMode,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["settings/invoice_email"],n.prototype.events={"click .toggle_view a":"toggleMode","change .tag":"insertTag","blur .subject":"storePosition","blur .body":"storePosition"},n.prototype.render=function(){return this.$el.html(this.template({title:this.options.title,type:this.options.type,id:this.options.id,subject:this.options.subject,body:this.options.body})),this.preview(),this},n.prototype.toggleMode=function(t){var e;return t.preventDefault(),e=$(t.currentTarget),e.addClass("selected"),e.siblings("a").removeClass("selected"),e.hasClass("preview_link")?this.preview():this.edit()},n.prototype.preview=function(){var t,e;return t=new Paydirt.Models.InvoiceEmail({subject:this.$(".subject").val(),body:this.$(".body").val()}),e=t.interpolate(),this.$(".preview_subject").html(e.subject),this.$(".preview_subject").html(e.subject),this.$(".preview_body").html(e.body),this.$(".preview").show(),this.$(".edit").hide()},n.prototype.edit=function(){return this.$(".preview").hide(),this.$(".edit").show()},n.prototype.storePosition=function(t){var e;return e=$(t.target),this.input=e,this.start=e.prop("selectionStart"),this.end=e.prop("selectionEnd")},n.prototype.insertTag=function(t){var e,i,n;return t.preventDefault(),e=$(t.currentTarget),i=e.val(),null==this.input&&(this.input=this.$(".body"),this.start=this.end=this.input.val().length),n=this.input.val(),n=""+n.slice(0,this.start)+i+n.slice(this.end),this.input.val(n),this.input.prop({selectionStart:this.start+i.length,selectionEnd:this.start+i.length}),this.input.focus(),e.val("").trigger("liszt:updated")},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Settings.LineItemCreation=function(e){function n(){return this.deserialise=t(this.deserialise,this),this.setDescriptionComponent=t(this.setDescriptionComponent,this),this.setJobGrouping=t(this.setJobGrouping,this),this.setDateGrouping=t(this.setDateGrouping,this),this.setAnyGrouping=t(this.setAnyGrouping,this),this.refresh=t(this.refresh,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["settings/line_item_creation"],n.prototype.settings=["group_line_items_by_date","group_line_items_by_job","include_block_descriptions_in_line_item_descriptions","include_job_names_in_line_item_descriptions","include_project_names_in_line_item_descriptions"],n.prototype.events={"change #date_grouping":"setDateGrouping","change #date_grouping_select":"setDateGrouping","change #job_grouping":"setJobGrouping","change #description_components input":"setDescriptionComponent",'change [name="any_grouping"]':"setAnyGrouping","change input":"refresh"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.deserialise)},n.prototype.render=function(){return this.$el.html(this.template(this)),this.refresh(),this.deserialise(),this},n.prototype.refresh=function(){var t;return this.$("#job_grouping").prop({checked:this.model.get("group_line_items_by_job")}),null!=this.model.get("group_line_items_by_date")?(this.$("#date_grouping").prop({checked:!0}),this.$("#date_grouping_select").val(this.model.get("group_line_items_by_date"))):this.$("#date_grouping").prop({checked:!1}),this.$("#date_grouping").is(":checked")?this.$("#date_grouping_select").prop({disabled:!1}).trigger("liszt:updated"):this.$("#date_grouping_select").prop({disabled:!0}).trigger("liszt:updated"),t=this.model.get("group_line_items_by_job")||null!=this.model.get("group_line_items_by_date")||"true"===this.$("[name='any_grouping']:checked").val(),this.$("[name='any_grouping'][value='"+!!t+"']").prop({checked:!0}),t?this.$("#grouping_options").slideDown():this.$("#grouping_options").slideUp(),["include_block_descriptions","include_project_names","include_job_names"].forEach(function(t){return function(e){return t.$("#"+e).prop({checked:t.model.get(""+e+"_in_line_item_descriptions")})}}(this)),this.$(".line_item_option").each(function(){var t;return t=$(this).find("input:checked").length>0,$(this).toggleClass("selected",t)})},n.prototype.setAnyGrouping=function(t){return"true"===$(t.currentTarget).val()?this.model.set("group_line_items_by_job",!0):(this.model.set("group_line_items_by_date",null),this.model.set("group_line_items_by_job",!1))},n.prototype.setDateGrouping=function(){var t;return t=this.$("#date_grouping_select"),this.model.set(this.$("#date_grouping").is(":checked")?{group_line_items_by_date:t.val()}:{group_line_items_by_date:null})},n.prototype.setJobGrouping=function(t){return this.model.set({group_line_items_by_job:$(t.target).is(":checked")})},n.prototype.setDescriptionComponent=function(t){return this.model.set(""+this.$(t.currentTarget).attr("id")+"_in_line_item_descriptions",$(t.currentTarget).prop("checked"))},n.prototype.deserialise=function(){return this.settings.forEach(function(t){return function(e){return t.$("[name='account["+e+"]']").val(t.model.get(e))}}(this))},n}(Paydirt.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.Settings.UserPermissions=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.events={"click .user-permission-select":"togglePermission",'change .user-permission-select input[type="checkbox"]':"permissionChanged",'change input[name="user_role"]':"setPresetRole"},i.prototype.setPresetRole=function(t){var e,i;return t.preventDefault(),e=this.$('[name="user_role"]').filter(":checked"),null!=(i=e.data("permissions"))?(_.keys(i).forEach(function(t){return function(e){return t.$("[name='user["+e+"]']").prop({checked:i[e]}).trigger("change")}}(this)),this.$("#user-permissions-selects-container").slideUp()):this.$("#user-permissions-selects-container").slideDown()},i.prototype.togglePermission=function(t){var e;return e=$(t.currentTarget).find('input[type="checkbox"]').prop("checked"),$(t.currentTarget).find('input[type="checkbox"]').prop("checked",!e).trigger("change")},i.prototype.permissionChanged=function(t){var e;return e=$(t.currentTarget).prop("checked"),$(t.currentTarget).parents(".user-permission-select").toggleClass("selected",e),$(t.currentTarget).is("#user_view_financial_information")&&($(t.currentTarget).prop("checked")||$("#user_manage_invoices").prop("checked",!1).trigger("change")),$(t.currentTarget).is("#user_manage_invoices")&&$(t.currentTarget).prop("checked")?$("#user_view_financial_information").prop("checked",!0).trigger("change"):void 0},i}(Paydirt.View)}.call(this),function(){Paydirt.Views.Taxes={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Taxes.Form=function(e){function n(){return this.save=t(this.save,this),this.removeView=t(this.removeView,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["taxes/form"],n.prototype.events={"click .cancel":"removeView","submit form":"save"},n.prototype.removeView=function(t){return null!=t&&t.preventDefault(),this.model.isNew()?this.model.destroy():this.model.trigger("show"),this.teardown()},n.prototype.save=function(t){return t.preventDefault(),t.stopPropagation(),this.model.save({name:$("#tax_name").val(),percentage:Paydirt.Formatters.percentageToNumber($("#tax_percentage").val())},{success:function(t){return function(e,i){return Paydirt.Flash.success(i.flash),t.removeView()}}(this)})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Taxes.Index=function(e){function n(){return this.showHideEmptyState=t(this.showHideEmptyState,this),this.addTax=t(this.addTax,this),this.renderTax=t(this.renderTax,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.el="#taxes_container",n.prototype.events={"click #add_tax":"addTax"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"add",this.renderTax),this.listenTo(this.collection,"reset add remove change",this.showHideEmptyState),this.listenTo(this.collection,"editing:stop",this.showHideEmptyState)},n.prototype.render=function(){return this.collection.each(this.renderTax),this.showHideEmptyState(),this},n.prototype.renderTax=function(t){var e;return e=new Paydirt.Views.Taxes.Show({model:t}),this.$("#taxes").append(e.render().el)},n.prototype.addTax=function(t){var e,i,n;return t.preventDefault(),i=new Paydirt.Models.Tax,this.collection.add(i),this.$("#add_tax").hide(),n=new Paydirt.Views.Taxes.Show({model:i}),n.render(),i.trigger("hide"),e=new Paydirt.Views.Taxes.Form({model:i}),this.$("#taxes_form").html(e.render().el),e.$(":text:first").focus()},n.prototype.showHideEmptyState=function(){return this.collection.length>0?this.$("#taxes .empty").hide():this.$("#taxes .empty").show(),this.collection.length>=2?this.$("#add_tax").hide():this.$("#add_tax").show()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Taxes.Show=function(e){function n(){return this.edit=t(this.edit,this),this.removeView=t(this.removeView,this),this.hideView=t(this.hideView,this),this.showView=t(this.showView,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["taxes/show"],n.prototype.className="row-item",n.prototype.events={"click .edit_link":"edit","click .delete":"destroy"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.removeView),this.listenTo(this.model,"show",this.showView),this.listenTo(this.model,"hide",this.hideView)},n.prototype.showView=function(){return this.$el.show()},n.prototype.hideView=function(){return this.$el.hide()},n.prototype.removeView=function(){return this.remove()},n.prototype.edit=function(t){var e;return t.preventDefault(),this.model.trigger("hide"),e=new Paydirt.Views.Taxes.Form({model:this.model}),this.$el.after(e.render().el),e.$(":text").focus()},n.prototype.destroy=function(t){return t.preventDefault(),this.model.destroy({success:function(){return function(t,e){return Paydirt.Flash.show(e.flash,"deleted")}}(this)})},n}(Paydirt.View)}.call(this),function(){Paydirt.Views.Tracker={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Tracker.ChromeTicker=function(e){function n(){return this.setBlock=t(this.setBlock,this),this.renderDuration=t(this.renderDuration,this),this.renderBlank=t(this.renderBlank,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["tracker/chrome_ticker"],n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.tracker=t.tracker,this.listenTo(this.tracker,"change:block",this.setBlock),this.setBlock()},n.prototype.renderBlank=function(){return chrome.browserAction.setBadgeText({text:""}),chrome.browserAction.setBadgeBackgroundColor({color:[50,50,50,150]}),this},n.prototype.renderDuration=function(){return Paydirt.online&&"true"===localStorage.apiKeyValid?(chrome.browserAction.setBadgeBackgroundColor({color:Paydirt.Formatters.hexToRgba(this.block.job().client().get("color"),150)}),chrome.browserAction.setBadgeText({text:this.template(this.block)})):chrome.browserAction.setBadgeText({text:""}),this},n.prototype.setBlock=function(){var t;return null!=(t=this.block)&&t.off("change:duration",this.renderDuration),this.block=this.tracker.get("block"),null!=this.block?(this.renderDuration(),this.block.on("change:duration",this.renderDuration)):this.renderBlank()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Tracker.Project=function(e){function n(){return this.editKeywords=t(this.editKeywords,this),this.startTracker=t(this.startTracker,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),this.bindingSources=t(this.bindingSources,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["tracker/project"],n.prototype.className="project",n.prototype.bindingSources=function(){return{client:this.model.client()}},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model.trackerJobs,"add remove change",this.render)},n.prototype.render=function(){var t,e,i;return n.__super__.render.apply(this,arguments),e="",t=this.$(".jobs"),i=Paydirt.Templates["tracker/job"],this.model.trackerJobs.each(function(){return function(e){return t.append(i({model:e}))}}(this)),this},n.prototype.startTracker=function(t){var e,i;return e=$(t.currentTarget),e.addClass("no-click"),i=e.parents(".job").data("tracker-job-id"),Paydirt.tracker.start({minutesAgo:$(t.currentTarget).data("minutes-ago"),jobId:i}).success(function(){return e.removeClass("no-click")})},n.prototype.editKeywords=function(t){var e,i,n;return e=$(t.currentTarget),n=e.parents(".job").data("tracker-job-id"),i=Paydirt.jobs.get(n),window.editWorkSignalsForClientId(i.client().id)},n.prototype.computeds={clientBadge:function(){var t,e,i,n;return t=this.getBinding("client_business_name"),e=this.getBinding("client_color"),n=this.getBinding("client_logo_path"),i=this.getBinding("client_monogram"),this.model.client().badge()}},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Tracker.Running=function(e){function n(){return this.formatStartedAtTime=t(this.formatStartedAtTime,this),this.updateForm=t(this.updateForm,this),this.updateBlock=t(this.updateBlock,this),this.enableSaveButton=t(this.enableSaveButton,this),this.hideFields=t(this.hideFields,this),this.showField=t(this.showField,this),this.resume=t(this.resume,this),this.pause=t(this.pause,this),this.stop=t(this.stop,this),this.cancel=t(this.cancel,this),this.bindingSources=t(this.bindingSources,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["tracker/running"],n.prototype.events={"submit form.backbone":"updateBlock","keyup  #started_at_time,#hourly_rate,#block_description":"enableSaveButton","change  #block_billable":"enableSaveButton","click i.edit":"showField","click .attr .cancel":"hideFields","blur #started_at_time":"formatStartedAtTime"},n.prototype.bindingSources=function(){return{client:this.model.client(),project:this.model.project(),job:this.model.job()}},n.prototype.computeds={clientBadge:function(){var t,e,i,n;return t=this.getBinding("client_business_name"),e=this.getBinding("client_color"),n=this.getBinding("client_logo_path"),i=this.getBinding("client_monogram"),this.model.client().badge()},wordedPausedDuration:function(){var t;return t=this.getBinding("paused_duration"),this.model.wordedPausedDuration()},formattedDuration:{deps:["duration"],get:function(){return""+Paydirt.Formatters.paddedNumber(this.model.get("hours"),{length:2})+":"+Paydirt.Formatters.paddedNumber(this.model.get("minutes"),{length:2})+":"+Paydirt.Formatters.paddedNumber(this.model.get("seconds"),{length:2})}},formattedStartDate:{deps:["started_at"],get:function(t){return moment(t).calendar()}}},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change:started_at_time change:started_at change:hourly_rate change:billable",this.updateForm)},n.prototype.cancel=function(t){return t.preventDefault(),this.model.cancel({success:function(){return function(t,e){return Paydirt.tracker.stopped(),Paydirt.trackerView.showFlash(e.flash)}}(this),error:function(){return function(t,e){return 410===e.status&&Paydirt.tracker.stopped(),Paydirt.trackerView.showFlash(e.responseText)}}(this)})},n.prototype.stop=function(t){return t.preventDefault(),this.$("#stop-block-button").addClass("no-click").find("i").removeClass("icon-stop").addClass("icon-refresh icon-spin"),this.model.stop({success:function(){return function(t,e){return Paydirt.trackerView.showFlash(e.flash)}}(this),error:function(t){return function(e,i){return 410===i.status&&Paydirt.tracker.stopped(),t.$("#stop-block-button").removeClass("no-click"),Paydirt.trackerView.showFlash(i.responseText)}}(this)})},n.prototype.pause=function(t){return t.preventDefault(),this.$("#pause-block-button").addClass("no-click"),this.model.pause({success:function(t){return function(e,i){return t.$("#pause-block-button").removeClass("no-click"),Paydirt.trackerView.showFlash(i.flash)}}(this),error:function(t){return function(e,i){return t.$("#pause-block-button").removeClass("no-click"),410===i.status&&Paydirt.tracker.stopped(),Paydirt.trackerView.showFlash(i.responseText)
}}(this)})},n.prototype.resume=function(t){return t.preventDefault(),this.$("#resume-block-button").addClass("no-click"),this.model.resume({success:function(t){return function(e,i){return t.$("#resume-block-button").removeClass("no-click"),Paydirt.trackerView.showFlash(i.flash)}}(this),error:function(t){return function(e,i){return t.$("#resume-block-button").removeClass("no-click"),410===i.status&&Paydirt.tracker.stopped(),Paydirt.trackerView.showFlash(i.responseText)}}(this)})},n.prototype.showField=function(t){var e;return t.preventDefault(),e=$(t.currentTarget).closest(".attr"),e.find(".field").show(),e.find(".show").hide()},n.prototype.hideFields=function(t){return null!=t&&t.preventDefault(),this.$(".attr .field").hide(),this.$(".attr .show").show()},n.prototype.enableSaveButton=function(t){var e;return e=t.keyCode||t.which,-1===_.indexOf([9,16,17,18,20,33,34,35,36,37,38,39,40,45,91,93,144],parseInt(e,10))?this.$(".tracker-save").text("Save").removeClass("no-click"):void 0},n.prototype.updateBlock=function(t){return null!=t&&t.preventDefault(),this.hideFields(),this.$(".tracker-save").text("Saving").addClass("no-click"),this.model.set({started_at_time:Paydirt.Formatters.time(this.$("#started_at_time").val()),billable:"true"===this.$("#block_billable").val(),description:this.$("#block_description").val()}),this.model.update({success:function(t){return function(e,i){return t.$(".tracker-save").text("Saved").addClass("no-click"),Paydirt.trackerView.showFlash(i.flash)}}(this),error:function(t){return function(e,i){return t.$(".tracker-save").text("Save").removeClass("no-click"),Paydirt.trackerView.showFlash(i.flash)}}(this)})},n.prototype.updateForm=function(){return this.$("#started_at_time").val(this.model.startTime()),this.$(".show .started_at_time").text(this.model.startTime()),this.$("#block_billable").val(this.model.get("billable").toString()),this.$(".show .billableDescription").text(this.model.billableDescription()),this.hideFields()},n.prototype.formatStartedAtTime=function(t){var e;return t.preventDefault(),e=this.$(t.target),e.val(Paydirt.Formatters.time(e.val()))},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.Tracker.Show=function(e){function n(){return this.expandJobOptions=t(this.expandJobOptions,this),this.clearTrackerSearch=t(this.clearTrackerSearch,this),this.searchTracker=t(this.searchTracker,this),this.refreshNanoScroller=t(this.refreshNanoScroller,this),this.poppedOutCheck=t(this.poppedOutCheck,this),this.close=t(this.close,this),this.hide=t(this.hide,this),this.show=t(this.show,this),this.toggle=t(this.toggle,this),this.changeVisibility=t(this.changeVisibility,this),this.dockTracker=t(this.dockTracker,this),this.undockTracker=t(this.undockTracker,this),this.showFlash=t(this.showFlash,this),this.renderStopped=t(this.renderStopped,this),this.renderRunning=t(this.renderRunning,this),this.bindingSources=t(this.bindingSources,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["tracker/show"],n.prototype.bindingSources=function(){return{tracker:this.tracker}},n.prototype.initialize=function(t){return null==t&&(t={}),n.__super__.initialize.apply(this,arguments),this.tracker=t.tracker,this.itemView=Paydirt.Views.Tracker.Project,this.collection=Paydirt.trackerProjects,this.listenTo(this.tracker,"started",this.renderRunning),this.listenTo(this.tracker,"stopped",this.renderStopped),this.listenTo(this.tracker,"change:visible",this.changeVisibility),this.debounceSearchTracker=_.debounce(this.searchTracker,100)},n.prototype.render=function(){return this.$el.html(this.template({mode:this.tracker.get("mode"),docked:this.tracker.get("docked")})),this.applyBindings(),null!=this.tracker.get("block")?this.renderRunning():this.renderStopped(),this.searchTracker(),this.tracker.get("docked")?this.initializeDocked():this.initializeUndocked(),this},n.prototype.renderRunning=function(){var t,e;return null!=(e=this.subViews.trackerRunning)&&e.teardown(),this.subViews.trackerRunning=t=new Paydirt.Views.Tracker.Running({model:this.tracker.get("block")}),this.$("#tracker_running").html(t.render().el),this.$(".job").removeClass("open"),this.tracker.get("flash")&&(this.showFlash(this.tracker.get("flash")),this.tracker.unset("flash")),"extension"===this.tracker.get("mode")&&this.tracker.get("autohide")===!0?setTimeout(this.hide,1e3):void 0},n.prototype.renderStopped=function(){var t;return null!=(t=this.subViews.trackerRunning)&&t.teardown(),Paydirt.tracker.get("suggestedClientId")&&this.suggest(Paydirt.tracker.get("suggestedClientId")),this.refreshNanoScroller()},n.prototype.showFlash=function(t){var e;return this.$(".flash-message .text").html(t),null!=this.flashHideTimeout&&clearTimeout(this.flashHideTimeout),"in-app"===this.tracker.get("mode")&&this.tracker.get("docked")||"extension"===this.tracker.get("mode")?(this.$(".flash-message").clearQueue().fadeIn(300),null!=(e=Paydirt.router)&&"function"==typeof e.dimensionsChanging&&e.dimensionsChanging(!0),this.flashHideTimeout=setTimeout(function(t){return function(){var e;return t.$(".flash-message").fadeOut(300),null!=(e=Paydirt.router)&&"function"==typeof e.dimensionsChanging?e.dimensionsChanging():void 0}}(this),7e3)):(this.$(".flash-message").css({bottom:"0px",opacity:"hide"}).animate({bottom:"40px",opacity:"show"}),this.flashHideTimeout=setTimeout(function(t){return function(){return t.$(".flash-message").animate({bottom:"0px",opacity:"hide"})}}(this),7e3))},n.prototype.undockTracker=function(){var t;return t="menubar=no,location=no,resizable=yes,scrollbars=yes,status=no, width=325, height=622",Paydirt.Cookies.write("trackerPoppedOut",Paydirt.Utilities.timeStamp()),this.window=window.open("/tracker","tracker",t),this.tracker.set({visible:!1})},n.prototype.dockTracker=function(){return this.close(),window.close()},n.prototype.changeVisibility=function(){return this.tracker.get("visible")?this.$el.stop(!0,!0).show():this.$el.stop(!0,!0).hide()},n.prototype.toggle=function(){return this.tracker.get("showing")?this.hide():this.show()},n.prototype.show=function(){var t;return clearTimeout(this.hiddenClassTimeout),this.$("#tracker").removeClass("hidden"),this.tracker.set({showing:!0}),null!=(t=Paydirt.router)&&"function"==typeof t.dimensionsChanging?t.dimensionsChanging(!0):void 0},n.prototype.hide=function(){var t;return this.tracker.set({showing:!1}),this.hiddenClassTimeout=setTimeout(function(t){return function(){return t.$("#tracker").addClass("hidden")}}(this),1e3),null!=(t=Paydirt.router)&&"function"==typeof t.dimensionsChanging?t.dimensionsChanging():void 0},n.prototype.close=function(){return"in-app"===this.tracker.get("mode")?(clearInterval(this.stillOpenInterval),Paydirt.Cookies.write("trackerPoppedOut","false")):void 0},n.prototype.poppedOutCheck=function(){var t;if("in-app"===this.tracker.get("mode"))if(Paydirt.Cookies.write("lastCheck",Paydirt.Utilities.timeStamp()),t=Paydirt.Cookies.read("trackerPoppedOut"),"false"===t||null===t||Paydirt.Utilities.timeStamp()-t>8){if(this.tracker.get("visible")===!1)return this.tracker.set({visible:!0})}else if(this.tracker.get("visible")===!0)return this.tracker.set({visible:!1})},n.prototype.initializeDocked=function(){return this.tracker.set({visible:!0}),"in-app"===this.tracker.get("mode")?(this.poppedOutCheck(),this.poppedOutCheckInterval=setInterval(this.poppedOutCheck,1e3)):void 0},n.prototype.initializeUndocked=function(){return"in-app"===this.tracker.get("mode")&&($(window).load(function(){return Paydirt.Cookies.write("trackerPoppedOut",Paydirt.Utilities.timeStamp())}),$(window).unload(function(t){return function(){return t.close()}}(this)),this.stillOpenInterval=setInterval(function(){return Paydirt.Cookies.write("trackerPoppedOut",Paydirt.Utilities.timeStamp())},1e3)),this.$el.on("click","a",function(t){return"#"!==$(this).attr("href")?(t.preventDefault(),t.stopImmediatePropagation(),window.open($(this).attr("href"))):void 0})},n.prototype.suggest=function(t){var e;return e=Paydirt.clients.get(t),this.tracker.set({suggestedClientId:e.id}),null!=e?this.$("#tracker_search").val(e.get("business_name")).trigger("keyup"):void 0},n.prototype.refreshNanoScroller=function(){return this.nanoTimeout||(this.nanoTimeout=null),clearTimeout(this.nanoTimeout),this.nanoTimeout=setTimeout(function(){return $("#active_jobs .nano").nanoScroller({preventPageScrolling:!0})},450)},n.prototype.searchTracker=function(){var t,e,i,n,s,r,a,o,l,c;return o=this.$("#tracker_search").val(),this.$("#clear_tracker_search").toggleClass("hide",!o),l=Paydirt.jobs.search(o),this.$('[name="only-assigned"]').prop("checked")?(Paydirt.Cookies.write("trackerOnlyAssignedJobs","true",1e3),l=_(l).filter(function(t){return Paydirt.user.isAssignedTo(t)})):Paydirt.Cookies.destroy("trackerOnlyAssignedJobs"),c=_(l).pluck("id"),t=Paydirt.jobs.filter(function(t){return!_(c).include(t.id)}),e=_(t).pluck("id"),i=this.$("#active_jobs [data-tracker-job-id]"),s=i.filter(function(t){return function(e,i){return _.contains(c,t.$(i).data("tracker-job-id"))}}(this)),n=i.filter(function(t){return function(i,n){return _.contains(e,t.$(n).data("tracker-job-id"))}}(this)),s.removeClass("tracker_hidden"),n.addClass("tracker_hidden"),r=this.$("#active_jobs .project"),a=r.filter(function(t){return function(e,i){return t.$(i).find("[data-tracker-job-id]:not(.tracker_hidden)").length}}(this)),r.addClass("tracker_hidden"),a.removeClass("tracker_hidden"),this.refreshNanoScroller()},n.prototype.clearTrackerSearch=function(){return this.$("#tracker_search").val(""),this.searchTracker()},n.prototype.expandJobOptions=function(t){return $(t.currentTarget).parents(".job").toggleClass("open")},n}(Paydirt.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Views.UsersInviteMultiple=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.render=function(){return this.addUser({hide_remove_link:!0})},i.prototype.addUser=function(t){return null==t&&(t={}),this.$el.find("table").append(Paydirt.Templates["users/invite_row"]({options:t}))},i.prototype.removeUser=function(t){return t.preventDefault(),$(t.currentTarget).closest("tr").remove()},i}(Paydirt.View)}.call(this),function(){Paydirt.Views.WorkSignals={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.WorkSignals.Form=function(e){function n(){return this.saveWorkSignal=t(this.saveWorkSignal,this),this.removeView=t(this.removeView,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["work_signals/form"],n.prototype.removeView=function(t){return null!=t&&t.preventDefault(),this.model.isNew()?this.model.destroy():this.model.trigger("show"),this.remove()},n.prototype.saveWorkSignal=function(t){var e;return t.preventDefault(),this.$("input:submit").addClass("no-click"),e=this.model.isNew(),this.model.save({text:this.$(".work_signal_text").val()},{success:function(t){return function(i,n){return Paydirt.work_signals.add(i),Paydirt.Flash.success(n.flash),e&&$("body").trigger("work_signal_created"),t.removeView()}}(this),error:function(t){return function(){return t.$("input:submit").removeClass("no-click")}}(this)})},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.WorkSignals.Index=function(e){function n(){return this.addWorkSignal=t(this.addWorkSignal,this),this.render=t(this.render,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["work_signals/index"],n.prototype.render=function(){return this.$el.html(this.template({model:this.model,include_prefix:this.options.include_prefix})),this.applyBindings(),this},n.prototype.addWorkSignal=function(t){var e;return null!=t&&t.preventDefault(),window.workSignal=new Paydirt.Models.WorkSignal({client_id:this.model.id}),this.$(".work_signals .empty").hide(),e=new Paydirt.Views.WorkSignals.Form({model:workSignal}),this.$(".work_signals_form").html(e.render().el).show(),e.$(":text").focus()},n}(Paydirt.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Views.WorkSignals.Show=function(e){function n(){return this.editWorkSignal=t(this.editWorkSignal,this),this.hideView=t(this.hideView,this),this.showView=t(this.showView,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.template=Paydirt.Templates["work_signals/show"],n.prototype.className="work_signal",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"show",this.showView),this.listenTo(this.model,"hide",this.hideView)},n.prototype.showView=function(){return this.$el.show()},n.prototype.hideView=function(){return this.$el.hide()},n.prototype.editWorkSignal=function(t){var e;return t.preventDefault(),this.model.trigger("hide"),e=new Paydirt.Views.WorkSignals.Form({model:this.model}),this.$el.after(e.render().el),e.$(":text").focus()},n.prototype.destroyWorkSignal=function(t){return t.preventDefault(),this.model.destroy({success:function(){return function(t,e){return Paydirt.Flash.show(e.flash,"deleted")}}(this)})},n}(Paydirt.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Models.Account=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.canAddClient=function(){return!this.has("allowed_clients")||this.get("allowed_clients")>Paydirt.clients.active().size()},i.prototype.currency=function(){return Paydirt.currencies.get(this.get("currency_id"))},i.prototype.features=function(t){return this.get("features")[t]?!0:void 0},i}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.Block=function(e){function n(){return this.wordedPausedDuration=t(this.wordedPausedDuration,this),this.timeTraverse=t(this.timeTraverse,this),this.calculateEndDate=t(this.calculateEndDate,this),this.setEndTime=t(this.setEndTime,this),this.setStartTime=t(this.setStartTime,this),this.setEndDate=t(this.setEndDate,this),this.setStartDate=t(this.setStartDate,this),this.alternativeDurationTypeDescription=t(this.alternativeDurationTypeDescription,this),this.billableDescription=t(this.billableDescription,this),this.stopUpdatingDuration=t(this.stopUpdatingDuration,this),this.updateDuration=t(this.updateDuration,this),this.toJSON=t(this.toJSON,this),this.recalculateDuration=t(this.recalculateDuration,this),this.duration=t(this.duration,this),this.endedAt=t(this.endedAt,this),this.startedAt=t(this.startedAt,this),this.endDate=t(this.endDate,this),this.startDate=t(this.startDate,this),this.endTime=t(this.endTime,this),this.startTime=t(this.startTime,this),this.date=t(this.date,this),this.invoice=t(this.invoice,this),this.associateWithJob=t(this.associateWithJob,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.urlRoot="/time",n.prototype.defaults=function(){return{duration:0,duration_only:!0,billable:!1,user_id:Paydirt.user.id,paused_duration:0,started_at:(new moment).format(Paydirt.isoDateFormat),description:""}},n.prototype.initialize=function(){return this.isNew()&&this.set({ended_at:(new moment).format(Paydirt.isoDateFormat)}),this.on("change:line_item_id",this.clearCachedInvoice),this.on("change:started_at change:ended_at",this.clearCachedDates),this.on("change:started_at change:ended_at change:paused_duration change:duration_only",this.recalculateDuration),this.on("change",this.markDirty),this.automateEndDate=this.get("duration_only")||!this.get("running")&&this.startDate()===this.endDate(),this.get("running")?(this.on("change:paused_at",this.pauseOrResume),this.on("change:started_at",this.setLocalTimeStartedAt),this.on("change:ended_at",this.stopUpdatingDuration),this.setLocalTimeStartedAt(),this.updateDuration(),this.pauseOrResume()):void 0},n.prototype.associateWithJob=function(t){var e,i,n,s,r;return t.perHour()?(i=t.get("price"),e=!0):t.perUser()?(i=Paydirt.user.get("hourly_rate")||0,e=!0):t.fixedPrice()?(i=(null!=(n=t.client())?n.get("hourly_rate"):void 0)||0,e=!1):t.clientHourlyRate()?(i=(null!=(s=t.client())?s.get("hourly_rate"):void 0)||0,e=!0):t.notBillable()&&(i=(null!=(r=t.client())?r.get("hourly_rate"):void 0)||0,e=!1),this.set({job_id:t.id,billable:e,hourly_rate:i})},n.prototype.parse=function(t){return t=n.__super__.parse.call(this,t),t.block},n.prototype.client=function(){return this.job().client()},n.prototype.job=function(){return Paydirt.jobs.get(this.get("job_id"))},n.prototype.project=function(){return Paydirt.projects.get(this.job().get("project_id"))},n.prototype.user=function(){return Paydirt.users.get(this.get("user_id"))},n.prototype.clearCachedInvoice=function(){return this._invoice=void 0},n.prototype.invoice=function(){return null!=this._invoice?this._invoice:this._invoice=Paydirt.invoices.find(function(t){return function(e){return-1!==e.line_items.pluck("id").indexOf(t.get("line_item_id"))}}(this))},n.prototype.clearCachedDates=function(){return this._date=null,this._startTime=null,this._startDate=null,this._endTime=null,this._endDate=null,this._startedAt=null,this._endedAt=null},n.prototype.date=function(){return null!=this._date?this._date:this._date=this.startedAt().clone().startOf("day").toDate()},n.prototype.startTime=function(){return null!=this._startTime?this._startTime:this._startTime=this.startedAt().format("h:mma")},n.prototype.endTime=function(){var t;return null!=this._endTime?this._endTime:this._endTime=null!=(t=this.endedAt())?t.format("h:mma"):void 0},n.prototype.startDate=function(){return null!=this._startDate?this._startDate:this._startDate=this.startedAt().format()},n.prototype.endDate=function(){var t;return null!=this._endDate?this._endDate:this._endDate=null!=(t=this.endedAt())?t.format():void 0},n.prototype.startedAt=function(){return this._startedAt?this._startedAt:this._startedAt=moment(new Date(this.get("started_at")))},n.prototype.endedAt=function(){return this._endedAt?this._endedAt:this._endedAt=moment(new Date(this.get("ended_at")))},n.prototype.duration=function(){return Paydirt.Formatters.numberWithPrecision(this.get("duration")/3600)},n.prototype.recalculateDuration=function(){var t;return this.get("duration_only")||this.get("running")?void 0:(t=(this.endedAt()-this.startedAt())/1e3-this.get("paused_duration"),0>t&&(t=0),this.set({duration:t}))},n.prototype.toJSON=function(){return{user_id:this.get("user_id"),job_id:this.get("job_id"),billable:this.get("billable"),hourly_rate:this.get("hourly_rate"),description:this.get("description"),duration:this.get("duration"),duration_only:this.get("duration_only"),paused_at:this.get("paused_at"),paused_duration:this.get("duration_only")?0:this.get("paused_duration"),started_at:this.get("started_at"),started_at_time:this.get("started_at_time"),ended_at:this.get("duration_only")?void 0:this.get("ended_at")}},n.prototype.setLocalTimeStartedAt=function(){return this.localTimeStartedAt=Paydirt.Utilities.timeStamp()-parseInt(this.get("duration"),10),this.get("paused_at")?this.updateDuration():void 0},n.prototype.updateDuration=function(){var t,e;return t=parseInt(Paydirt.Utilities.timeStamp()-this.localTimeStartedAt,10),e=Paydirt.Formatters.secondsToHMS(t),this.set({duration:t,hours:e.hours,minutes:e.minutes,seconds:e.seconds})},n.prototype.stopUpdatingDuration=function(){return clearInterval(this.durationInterval),this.get("running")?void 0:(this.off("change:paused_at",this.pauseOrResume),this.off("change:started_at",this.setLocalTimeStartedAt),this.off("change:ended_at",this.stopUpdatingDuration))},n.prototype.pauseOrResume=function(){return this.get("paused_at")?this.stopUpdatingDuration():(this.setLocalTimeStartedAt(),this.updateDuration(),this.durationInterval=setInterval(this.updateDuration,1e3))},n.prototype.stop=function(t){return this.get("running")?(t.url=Paydirt.baseURL+"/tracker/stop",this.save({},t)):void 0},n.prototype.pause=function(t){return this.get("running")?(t.url=Paydirt.baseURL+"/tracker/pause",this.save({},t)):void 0},n.prototype.resume=function(t){return this.get("running")?(t.url=Paydirt.baseURL+"/tracker/resume",this.save({},t)):void 0},n.prototype.cancel=function(t){return this.get("running")?(t.url=Paydirt.baseURL+"/tracker/cancel",this.destroy(t)):void 0},n.prototype.update=function(t){return this.get("running")?(t.url=Paydirt.baseURL+"/tracker/save",this.save({},t)):void 0},n.prototype.billableDescription=function(){return this.job()?this.get("billable")?Paydirt.user.canViewFinancialInformation()?"billable at "+Paydirt.Formatters.currency(this.get("hourly_rate"),{sign:this.client().currency().get("sign")})+"/hr":"billable":this.job().fixedPrice()?"for a fixed price job":"not billable":"not billable"},n.prototype.alternativeDurationTypeDescription=function(){return this.get("duration_only")?"enter start and end times":"just enter a duration"},n.prototype.dirtyMessage=function(){return"this time log"},n.prototype.setStartDate=function(t){var e;return e=moment(""+t+" "+this.startTime(),"MMM D, YYYY h:mma"),this.set({started_at:e.format(Paydirt.isoDateFormat)}),this.calculateEndDate()},n.prototype.setEndDate=function(t){var e;return e=moment(""+t+" "+this.endTime(),"MMM D, YYYY h:mma"),this.set({ended_at:e.format(Paydirt.isoDateFormat)})},n.prototype.setStartTime=function(t){var e;return e=moment(""+this.startDate()+" "+t,"MMM D, YYYY h:mma"),this.set({started_at:e.format(Paydirt.isoDateFormat)},{silent:!0}),this.trigger("change:started_at"),this.calculateEndDate()},n.prototype.setEndTime=function(t){var e;return e=moment(""+this.endDate()+" "+t,"MMM D, YYYY h:mma"),this.set({ended_at:e.format(Paydirt.isoDateFormat)},{silent:!0}),this.trigger("change:ended_at"),this.calculateEndDate()},n.prototype.calculateEndDate=function(){var t;if(this.automateEndDate)return t=moment(""+this.startDate()+" "+this.endTime(),"MMM D, YYYY h:mma"),this.startedAt()>t&&t.add("d",1),this.set({ended_at:t.format(Paydirt.isoDateFormat)})},n.prototype.timeTraverse=function(t,e){var i;return"startTime"===t?(i=moment(this.startTime(),"h:mma"),i.add("s",e),this.setStartTime(i.format("h:mma"))):"endTime"===t?(i=moment(this.endTime(),"h:mma"),i.add("s",e),this.setEndTime(i.format("h:mma"))):void 0},n.prototype.wordedPausedDuration=function(){return"Timer paused for "+Paydirt.Formatters.secondsToWordedDuration(this.get("paused_duration"))},n}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.BlockBrowser=function(e){function n(){return this.cloneEndDate=t(this.cloneEndDate,this),this.cloneStartDate=t(this.cloneStartDate,this),this.setPreviousEndDate=t(this.setPreviousEndDate,this),this.setPreviousStartDate=t(this.setPreviousStartDate,this),this.pushState=t(this.pushState,this),this.toJSON=t(this.toJSON,this),this.interval=t(this.interval,this),this.updateDates=t(this.updateDates,this),this.setEndDateTo=t(this.setEndDateTo,this),this.setStartDateTo=t(this.setStartDateTo,this),this.updateInterval=t(this.updateInterval,this),this.nextPeriod=t(this.nextPeriod,this),this.previousPeriod=t(this.previousPeriod,this),this.setState=t(this.setState,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.initialize=function(){return this.on("change:dateRangeType",this.updateInterval),this.on("change:startDate",this.setPreviousStartDate),this.on("change:endDate",this.setPreviousEndDate),this.on("change:blockable",function(t){return function(){return t.set({lastFilterBy:"blockable"})}}(this)),this.on("change:user",function(t){return function(){return t.set({lastFilterBy:"user"})}}(this)),this.on("change:invoice",function(t){return function(){return t.set({lastFilterBy:"invoice"})}}(this)),this.on("change:billable",function(t){return function(){return t.set({lastFilterBy:"billable"})}}(this)),this.on("change:billed",function(t){return function(){return t.set({lastFilterBy:"billed"})}}(this)),this.on("change:dateRangeType",function(t){return function(){return t.set({lastFilterBy:"date"})}}(this)),this.on("change",this.pushState)},n.prototype.setState=function(t){var e,i,n,s,r,a,o,l,c,d,u,p,h,m;return null==t&&(t={}),o="7-days",l=7,a=Paydirt.Utilities.getParameterByName("range",t.from)||o,m=Paydirt.Utilities.getParameterByName("user",t.from),p=Paydirt.Utilities.getParameterByName("invoice",t.from),e=Paydirt.Utilities.getParameterByName("billable",t.from),i=Paydirt.Utilities.getParameterByName("billed",t.from),h=Paydirt.Utilities.getParameterByName("from",t.from),null!=h?h=moment(h).startOf("day").toDate():(d=moment().day(Paydirt.account.get("first_day_of_week")).startOf("day"),d>moment()&&(d=d.subtract("weeks",1)),h=d),c=Paydirt.Utilities.getParameterByName("to",t.from),c=null!=c?moment(c).startOf("day").toDate():moment().day(Paydirt.account.get("first_day_of_week")).startOf("day").add("days",l).toDate(),u=null!=h&&null!=c?Math.round((this.cloneEndDate()-this.cloneStartDate().subtract("days",1))/864e5):l,r=Paydirt.Utilities.getParameterByName("for",t.from),s=Paydirt.Utilities.getParameterByName("id",t.from),"job"!==r||s||(s=Paydirt.Utilities.getJobIdFromExternalId(t.from)),null!=r&&null!=s&&(n={type:r,id:s}),this.set({dateRangeType:a,user:m,invoice:p,billable:e,billed:i,startDate:h,endDate:c,interval:u,blockable:n,popped:t.popped,initializing:t.initializing}),this.trigger("dateRangeChanged")},n.prototype.previousPeriod=function(){return this.updateDates(this.cloneStartDate().subtract("days",this.interval()).toDate(),this.cloneEndDate().subtract("days",this.interval()).toDate())},n.prototype.nextPeriod=function(){return this.updateDates(this.cloneStartDate().add("days",this.interval()).toDate(),this.cloneEndDate().add("days",this.interval()).toDate())},n.prototype.updateInterval=function(){switch(this.get("dateRangeType")){case"7-days":this.set({interval:7,endDate:this.cloneStartDate().add("days",6).toDate()});break;case"30-days":this.set({interval:30,endDate:this.cloneStartDate().add("days",29).toDate()});break;case"custom":this.set({interval:function(t){return function(){return Math.round((t.cloneEndDate()-t.cloneStartDate().subtract("days",1))/864e5)}}(this)})}return this.trigger("dateRangeChanged")},n.prototype.setStartDateTo=function(t){return"custom"===this.get("dateRangeType")?t>=this.get("endDate")?this.updateDates(t,moment(t).clone().add("days",this.interval()-1).toDate()):this.updateDates(t,this.get("endDate")):this.updateDates(t,moment(t).clone().add("days",this.interval()-1).toDate())},n.prototype.setEndDateTo=function(t){return"custom"===this.get("dateRangeType")?t<=this.get("startDate")?this.updateDates(moment(t).clone().subtract("days",this.interval()-1).toDate(),t):this.updateDates(this.get("startDate"),t):this.updateDates(moment(t).clone().subtract("days",this.interval()-1).toDate(),t)},n.prototype.updateDates=function(t,e){return this.set({startDate:t,endDate:e,lastFilterBy:"date"}),this.trigger("dateRangeChanged")},n.prototype.interval=function(){return"function"==typeof this.get("interval")?this.get("interval")():this.get("interval")},n.prototype.toJSON=function(){var t,e,i,n,s,r;return s={},s.range=this.get("dateRangeType"),"all-time"!==s.range&&(s.from=this.cloneStartDate().format("YYYY-MM-DD"),s.to=this.cloneEndDate().format("YYYY-MM-DD")),i=this.get("blockable"),null!=i&&(s["for"]=i.type,s.id=i.id),r=this.get("user"),null!=r&&""!==r&&(s.user=r),n=this.get("invoice"),null!=n&&""!==n&&(s.invoice=n),t=this.get("billable"),null!=t&&""!==t&&(s.billable=t),e=this.get("billed"),null!=e&&""!==e&&(s.billed=e),s},n.prototype.pushState=function(){var t,e,i,n;if(this.get("popped"))return void this.unset("popped",{silent:!0});e="",n=this.toJSON();for(t in n)i=n[t],null!=i&&(e+=""+t+"="+i+"&");return e.match(/&$/)&&(e=e.substring(0,e.length-1)),this.get("initializing")?this.unset("initializing",{silent:!0}):window.history.pushState("?"+e,"","/time?"+e)},n.prototype.setPreviousStartDate=function(){return this.set("previousStartDate",this.previous("startDate"))},n.prototype.setPreviousEndDate=function(){return this.set("previousEndDate",this.previous("endDate"))},n.prototype.cloneStartDate=function(){return moment(this.get("startDate")).clone()},n.prototype.cloneEndDate=function(){return moment(this.get("endDate")).clone()},n}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.Client=function(e){function n(){return this.teardown=t(this.teardown,this),this.badge=t(this.badge,this),this.badgeType=t(this.badgeType,this),this.amountPaid=t(this.amountPaid,this),this.amountOverdue=t(this.amountOverdue,this),this.amountOwing=t(this.amountOwing,this),this.amountUnbilled=t(this.amountUnbilled,this),this.parse=t(this.parse,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.urlRoot="/clients",n.prototype.defaults=function(){return{business_name:"",color:"#66a1d2",hourly_rate:0,currency_id:Paydirt.account.currency().id,invoicing_threshold:1e3,monogram:""}},n.prototype.types={hourly_rate:Types.Money},n.prototype.initialize=function(){return this.work_signals=Paydirt.work_signals.subcollection({filter:function(t){return function(e){return e.get("client_id")===t.id}}(this)}),this.projects=Paydirt.projects.subcollection({filter:function(t){return function(e){return e.get("client_id")===t.id}}(this)}),this.jobs=Paydirt.jobs.subcollection({filter:function(t){return function(e){return e.get("client_id")===t.id}}(this)}),this.expenses=Paydirt.expenses.subcollection({filter:function(t){return function(e){return e.get("client_id")===t.id&&!e.has("line_item_id")}}(this)}),this.invoices=Paydirt.invoices.subcollection({filter:function(t){return function(e){return e.get("client_id")===t.id}}(this)}),this.quotes=Paydirt.quotes.subcollection({filter:function(t){return function(e){return e.get("client_id")===t.id}}(this)}),this.on("destroy",this.teardown)},n.prototype.parse=function(t){return t=n.__super__.parse.call(this,t),t.client},n.prototype.currency=function(){return Paydirt.currencies.get(this.get("currency_id"))},n.prototype.amountUnbilled=function(){return this.jobs.totalUnbilledAmount()+this.expenses.sum("total")},n.prototype.amountOwing=function(){return this.invoices.amountOwing()},n.prototype.amountOverdue=function(){return this.invoices.amountOverdue()},n.prototype.amountPaid=function(){return this.invoices.amountPaid()},n.prototype.badgeType=function(){return this.has("logo_path")?"logo":"monogram"},n.prototype.badge=function(t){return null==t&&(t={}),_.defaults(t,{size:"",type:this.badgeType(),color:this.get("color"),logo_path:this.get("logo_path"),monogram:this.get("monogram")}),"logo"===t.type?"<div class='badge "+t.size+" client_logo' style='background-image: url("+t.logo_path+")'>"+t.monogram+"</div>":"<div class='badge "+t.size+"' style='background-color: "+t.color+"'>"+t.monogram+"</div>"},n.prototype.teardown=function(){return Paydirt.work_signals.remove(this.work_signals.models),this.projects.each(function(t){return t.teardown()
}),Paydirt.projects.remove(this.projects.models),this.invoices.each(function(t){return t.teardown()}),Paydirt.invoices.remove(this.invoices.models),this.quotes.each(function(t){return t.teardown()}),Paydirt.quotes.remove(this.quotes.models),Paydirt.invoice=null,Paydirt.quote=null},n}(Paydirt.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Models.Currency=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.Document=function(e){function n(){return this.calculateTaxes=t(this.calculateTaxes,this),this.calculateSubtotal=t(this.calculateSubtotal,this),this.calculateTotals=t(this.calculateTotals,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.initialize=function(t){var e;return this.set({issued_at:moment(t.issued_at)}),this.taxes=new Paydirt.Collections.InvoiceTaxes(t.taxes),this.line_items=new Paydirt.Collections.LineItems(t.line_items,{invoice:this}),this.line_items.on("reset change add remove",this.calculateTotals),this.taxes.on("add",this.line_items.addLineItemTax),this.taxes.on("remove",this.line_items.removeLineItemTax),this.taxes.on("reset change add remove",this.calculateTotals),this.emails=new Paydirt.Collections.InvoiceEmails(t.emails),this.activities=new Paydirt.Collections.DocumentActivities(t.activities),e=this.calculateTaxes(),this.set({subtotal:new Money(this.get("subtotal")),tax0:new Money(e[0]),tax1:new Money(e[1]),total:new Money(this.get("total"))}),this.on("change",this.markDirty),this.line_items.on("change",this.markDirty),this.taxes.on("change",this.markDirty)},n.prototype.client=function(){return Paydirt.clients.get(this.get("client_id"))},n.prototype.currency=function(){return this.get("currency_id")?Paydirt.currencies.get(this.get("currency_id")):this.client().currency()},n.prototype.locale=function(){return this.get("locale")?this.get("locale"):this.client().get("locale")},n.prototype.logoPath=function(){return null!=Paydirt.account?Paydirt.account.get("logo_path"):void 0},n.prototype.calculateTotals=function(){var t,e,i;return t=this.calculateSubtotal(),e=this.calculateTaxes(),i=_.inject(e,function(t,e){return t+e},t),this.set({subtotal:new Money(t),tax0:new Money(e[0]),tax1:new Money(e[1]),total:new Money(i)})},n.prototype.calculateSubtotal=function(){return this.line_items.current().reduce(function(t,e){return t+e.get("subtotal")},0)},n.prototype.calculateTaxes=function(){var t;return t=[],this.taxes.current().each(function(e){return function(i,n){return t[n]=e.line_items.current().reduce(function(t,e){var n;return n=e.line_item_taxes.findByTax(i),n&&n.get("applies")?t+new Money(i.get("percentage")/100*e.get("subtotal")):t},0)}}(this)),t},n.prototype.formattedNumber=function(){var t;return t="RecurringInvoice"===this.get("type")?"recurring":this.client().get("shortname"),""===t||null==t?this.paddedNumber():""+t+"-"+this.paddedNumber()},n.prototype.paddedNumber=function(){return Paydirt.Formatters.paddedNumber(this.get("number"),{length:3})},n.prototype.sent=function(){return this.get("sent")},n.prototype.createdAt=function(){return null!=this._created_at?this._created_at:this._created_at=moment(this.get("created_at")).startOf("day").toDate()},n.prototype.issuedAt=function(){return null!=this._issued_at?this._issued_at:this._issued_at=moment(this.get("issued_at")).startOf("day").toDate()},n.prototype.issuedAtWeek=function(){return null!=this._issued_at_date?this._issued_at_date:(this._issued_at_date=moment(this.get("issued_at")).startOf("day"),this._issued_at_date=this._issued_at_date.subtract("days",this._issued_at_date.toDate().getDay()),this._issued_at_date=this._issued_at_date.toDate())},n}(Paydirt.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Models.DocumentActivity=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.urlRoot=function(){return"/documents/"+this.document().id+"/activities"},i.prototype.parse=function(t){return t=i.__super__.parse.call(this,t),t.document_activity},i.prototype.document=function(){return Paydirt.document(this.get("document_id"))},i.prototype.document_email=function(){return this.document().emails.where({document_activity_id:this.id})[0]},i}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.Expense=function(e){function n(){return this.urlRoot=t(this.urlRoot,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.urlRoot=function(){return"/clients/"+this.client().id+"/expenses"},n.prototype.defaults={name:"",quantity:1,value:void 0,total:void 0},n.prototype.types={quantity:Types.Float,value:Types.Money,total:Types.Money},n.prototype.initialize=function(){return this.on("change:quantity change:value",this.setTotal),this.setTotal()},n.prototype.client=function(){return Paydirt.clients.get(this.get("client_id"))},n.prototype.project=function(){return Paydirt.projects.get(this.get("project_id"))},n.prototype.setTotal=function(){return this.set({total:parseFloat(this.get("quantity"))*parseFloat(this.get("value"))})},n}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.Invoice=function(e){function n(){return this.teardown=t(this.teardown,this),this.markDirty=t(this.markDirty,this),this.humanOn=t(this.humanOn,this),this.humanEvery=t(this.humanEvery,this),this.calculatePaid=t(this.calculatePaid,this),this.toJSON=t(this.toJSON,this),this.setDueAtOffset=t(this.setDueAtOffset,this),this.setDueAt=t(this.setDueAt,this),this.setIssuedAt=t(this.setIssuedAt,this),this.parse=t(this.parse,this),this.initialize=t(this.initialize,this),this.defaults=t(this.defaults,this),this.urlRoot=t(this.urlRoot,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.urlRoot=function(){return"FreeformInvoice"===this.get("type")?"/free_invoice_creator":"RecurringInvoice"===this.get("type")?"/recurring_invoices":"/invoices"},n.prototype.defaults=function(){return{interval:1,every:1,on:1,recurring_start_date:moment().format(),upcoming_recurring_dates:[]}},n.prototype.initialize=function(t){return this.set({due_at:moment(t.due_at)}),this.setDueAtOffset(),this.payments=new Paydirt.Collections.InvoicePayments(t.payments),this.payments.on("reset change add remove",this.calculatePaid),this.on("change:issued_at change:due_at_offset",this.setDueAt),this.on("change:due_at",this.setDueAtOffset),this.on("destroy",this.teardown),n.__super__.initialize.call(this,t)},n.prototype.parse=function(t){var e;return t=n.__super__.parse.call(this,t),_.isEmpty(t)?t:(e=t.invoice,e.issued_at=moment(e.issued_at),e.due_at=moment(e.due_at),this.emails.reset(e.emails),this.activities.reset(e.activities),this.payments.reset(e.payments),this.set({subtotal:new Money(e.subtotal),total:new Money(e.total)}),delete e.subtotal,delete e.total,e)},n.prototype.projects=function(){return _.uniq(_.map(this.jobs(),function(t){return t.project()}))},n.prototype.jobs=function(){return _(this.get("job_ids")).map(function(t){return Paydirt.jobs.get(t)})},n.prototype.setIssuedAt=function(){var t,e;return t=this.get("due_at"),e=this.get("due_at_offset"),this.set({issued_at:t.clone().subtract("days",e)})},n.prototype.setDueAt=function(){var t,e;return e=this.get("issued_at"),t=this.get("due_at_offset")||null,null!=e&&null!=t?this.set({due_at:e.clone().add("days",t)}):null==e?this.setIssuedAt():null==t?this.setDueAtOffset():void 0},n.prototype.setDueAtOffset=function(){var t,e,i;return t=this.get("due_at"),null!=t?(e=864e5,i=Math.round((t-this.get("issued_at"))/e),this.set({due_at_offset:i})):this.setDueAt()},n.prototype.toJSON=function(t){var e;return null==t&&(t={}),t.computed?n.__super__.toJSON.apply(this,arguments):e={invoice:{currency_id:this.get("currency_id"),locale:this.get("locale"),number:this.get("number"),issued_at:this.get("issued_at").format("YYYYMMDD"),due_at:this.get("due_at").format("YYYYMMDD"),description:this.get("description"),footer:this.get("footer"),line_items_attributes:this.line_items.toJSON(),taxes_attributes:this.taxes.toJSON(),account_business_name:this.get("account_business_name"),account_contact_name:this.get("account_contact_name"),account_address:this.get("account_address"),client_business_name:this.get("client_business_name"),client_contact_name:this.get("client_contact_name"),client_address:this.get("client_address")}}},n.prototype.calculatePaid=function(){return this.set(this.paid()?{paid_at:this.payments.first().get("received_at")}:{paid_at:""}),this.markClean()},n.prototype.amountPaid=function(){return new Money(this.payments.reduce(function(t,e){return t+e.amount()},0))},n.prototype.amountOwing=function(){return new Money(Math.max(0,this.get("total")-this.amountPaid()))},n.prototype.paid=function(){return this.payments.length>0&&this.amountOwing()<=0},n.prototype.overdue=function(){return this.sent()&&this.get("due_at")<moment()&&!this.paid()?!0:void 0},n.prototype.paidAt=function(){return null!=this._paid_at?this._paid_at:this._paid_at=moment(this.get("paid_at")).startOf("day").toDate()},n.prototype.state=function(){return"RecurringInvoice"===this.get("type")?"recurring":this.overdue()?"overdue":this.sent()?this.sent()&&!this.paid()?"sent":this.sent()&&this.paid()?"paid":void 0:"draft"},n.prototype.humanEvery=function(){var t;switch(+this.get("every")){case 0:t="week";break;case 1:t="month";break;case 2:t="year"}return""+t+(1===+this.get("interval")?"":"s")},n.prototype.humanOn=function(){var t;switch(+this.get("every")){case 0:return Paydirt.day_names[+this.get("on")].capitalize();case 1:return t=31===this.get("on")?"last":""+moment().lang().ordinal(this.get("on")),"the "+t+" day of the month";case 2:return"the "+moment(this.get("recurring_start_date")).format("Do of MMMM")}},n.prototype.dirtyMessage=function(){return"the invoice "+this.formattedNumber()},n.prototype.markDirty=function(){return"ClientInvoice"===this.get("type")||"RecurringInvoice"===this.get("type")?n.__super__.markDirty.call(this):void 0},n.prototype.teardown=function(){var t;return this.line_items.each(function(t){var e;return e=t.job(),null!=e?e.set({unbilled_fixed_value:e.get("unbilled_fixed_value")+t.get("subtotal").amount()}):void 0}),_(Paydirt.blocks.select(function(t){return function(e){var i;return(null!=(i=e.invoice())?i.id:void 0)===t.id}}(this))).each(function(t){return t.set({line_item_id:null,billed:!1}),t.markClean()}),t=this.line_items.pluck("id"),_(Paydirt.expenses.select(function(){return function(e){return _.include(t,e.get("line_item_id"))}}(this))).each(function(t){return t.set({line_item_id:null}),t.markClean()})},n}(Paydirt.Models.Document)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.InvoiceBrowser=function(e){function n(){return this.cloneEndDate=t(this.cloneEndDate,this),this.cloneStartDate=t(this.cloneStartDate,this),this.setPreviousEndDate=t(this.setPreviousEndDate,this),this.setPreviousStartDate=t(this.setPreviousStartDate,this),this.pushState=t(this.pushState,this),this.toJSON=t(this.toJSON,this),this.interval=t(this.interval,this),this.updateDates=t(this.updateDates,this),this.setEndDateTo=t(this.setEndDateTo,this),this.setStartDateTo=t(this.setStartDateTo,this),this.updateInterval=t(this.updateInterval,this),this.nextPeriod=t(this.nextPeriod,this),this.previousPeriod=t(this.previousPeriod,this),this.setState=t(this.setState,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.initialize=function(t){return this.options=t,this.on("change:dateRangeType",this.updateInterval),this.on("change:startDate",this.setPreviousStartDate),this.on("change:endDate",this.setPreviousEndDate),this.on("change:invoiceable",function(t){return function(){return t.set({lastFilterBy:"invoiceable"})}}(this)),this.on("change:dateRangeType",function(t){return function(){return t.set({lastFilterBy:"date"})}}(this)),this.on("change",this.pushState)},n.prototype.setState=function(t){var e,i,n,s,r,a,o,l,c,d;return null==t&&(t={}),n="30-days",s=30,i=Paydirt.Utilities.getParameterByName("range",t.from)||n,e=Paydirt.Utilities.getParameterByName("by",t.from),d=Paydirt.Utilities.getParameterByName("from",t.from),d=null!=d?moment(d).startOf("day").toDate():moment().subtract("days",s-1).startOf("day").toDate(),r=Paydirt.Utilities.getParameterByName("to",t.from),r=null!=r?moment(r).startOf("day").toDate():moment().startOf("day").toDate(),a=null!=d&&null!=r?Math.round((this.cloneEndDate()-this.cloneStartDate().subtract("days",1))/864e5):s,c=Paydirt.Utilities.getParameterByName("for",t.from),l=Paydirt.Utilities.getParameterByName("id",t.from),null!=c&&null!=l&&(o={type:c,id:l}),this.set({dateRangeType:i,startDate:d,endDate:r,interval:a,invoiceable:o,dateCriteria:e,popped:t.popped,initializing:t.initializing}),this.trigger("dateRangeChanged")},n.prototype.previousPeriod=function(){return this.updateDates(this.cloneStartDate().subtract("days",this.interval()).toDate(),this.cloneEndDate().subtract("days",this.interval()).toDate())},n.prototype.nextPeriod=function(){return this.updateDates(this.cloneStartDate().add("days",this.interval()).toDate(),this.cloneEndDate().add("days",this.interval()).toDate())},n.prototype.updateInterval=function(){switch(this.get("dateRangeType")){case"30-days":this.set({interval:30,endDate:this.cloneStartDate().add("days",29).toDate()});break;case"custom":this.set({interval:function(t){return function(){return Math.round((t.cloneEndDate()-t.cloneStartDate().subtract("days",1))/864e5)}}(this)})}return this.trigger("dateRangeChanged")},n.prototype.setStartDateTo=function(t){return"custom"===this.get("dateRangeType")?t>=this.get("endDate")?this.updateDates(t,moment(t).clone().add("days",this.interval()-1).toDate()):this.updateDates(t,this.get("endDate")):this.updateDates(t,moment(t).clone().add("days",this.interval()-1).toDate())},n.prototype.setEndDateTo=function(t){return"custom"===this.get("dateRangeType")?t<=this.get("startDate")?this.updateDates(moment(t).clone().subtract("days",this.interval()-1).toDate(),t):this.updateDates(this.get("startDate"),t):this.updateDates(moment(t).clone().subtract("days",this.interval()-1).toDate(),t)},n.prototype.updateDates=function(t,e){return this.set({startDate:t,endDate:e,lastFilterBy:"date"}),this.trigger("dateRangeChanged")},n.prototype.interval=function(){return"function"==typeof this.get("interval")?this.get("interval")():this.get("interval")},n.prototype.toJSON=function(){var t,e,i,n,s;return n={},n.range=this.get("dateRangeType"),"all-time"!==n.range&&(n.from=this.cloneStartDate().format("YYYY-MM-DD"),n.to=this.cloneEndDate().format("YYYY-MM-DD")),i=this.get("invoiceable"),null!=i&&(n["for"]=i.type,n.id=i.id),t=this.get("dateCriteria"),null!=t&&(n.by=t),s=this.get("user"),null!=s&&""!==s&&(n.user=s),e=this.get("invoice"),null!=e&&""!==e&&(n.invoice=e),n},n.prototype.pushState=function(){var t,e,i,n;if(this.get("popped"))return void this.unset("popped",{silent:!0});e="",n=this.toJSON();for(t in n)i=n[t],null!=i&&(e+=""+t+"="+i+"&");return e.match(/&$/)&&(e=e.substring(0,e.length-1)),this.get("initializing")?this.unset("initializing",{silent:!0}):window.history.pushState("?"+e,"","/invoices/"+this.options.collectionMode+"?"+e)},n.prototype.setPreviousStartDate=function(){return this.set("previousStartDate",this.previous("startDate"))},n.prototype.setPreviousEndDate=function(){return this.set("previousEndDate",this.previous("endDate"))},n.prototype.cloneStartDate=function(){return moment(this.get("startDate")).clone()},n.prototype.cloneEndDate=function(){return moment(this.get("endDate")).clone()},n}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.InvoiceEmail=function(e){function n(){return this.invoice=t(this.invoice,this),this.interpolate=t(this.interpolate,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.interpolate=function(){var t,e,i,n,s,r;t={client_business_name:"The Bluth Company",client_contact_name:"Michael Bluth",client_contact_first_name:"Michael",invoice_number:"blu-001",quote_number:"blu-001",invoice_due_date:moment().subtract("days",6).format(),invoice_days_overdue:6,invoice_total:Paydirt.Formatters.currency(2450,{sign:Paydirt.account.currency().get("sign")}),quote_total:Paydirt.Formatters.currency(2450,{sign:Paydirt.account.currency().get("sign")}),invoice_payment_amount:Paydirt.Formatters.currency(1450,{sign:Paydirt.account.currency().get("sign")}),invoice_description:"Monthly land surveying fee for October",quote_description:"Land surveying for Swing City",our_business_name:Paydirt.account.get("business_name"),our_contact_name:Paydirt.account.get("billing_contact_name")};for(n in t)r=t[n],(""===r||null==r)&&(t[n]="["+n+" is missing]");try{s=_.template(this.get("subject"),t,{interpolate:/\{\{(.+?)\}\}/g})}catch(a){i=a,s="One of the email variables is wrong: "+i.message}try{e=_.template(this.get("body"),t,{interpolate:/\{\{(.+?)\}\}/g})}catch(a){i=a,e="One of the email variables is wrong: "+i.message}return{subject:s,body:e}},n.prototype.invoice=function(){return Paydirt.invoices.get(this.get("invoice_id"))},n}(Paydirt.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Models.InvoicePayment=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.urlRoot=function(){return"/invoices/"+Paydirt.invoice.id+"/invoice_payments"},i.prototype.parse=function(t){return t=i.__super__.parse.call(this,t),t.invoice_payment},i.prototype.amount=function(){return new Money(this.get("amount"))},i.prototype.toJSON=function(){return{invoice_payment:{received_at:this.get("received_at"),amount:this.get("amount").toString(),description:this.get("description")}}},i}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.InvoiceTax=function(e){function n(){return this.toJSON=t(this.toJSON,this),this.setPercentage=t(this.setPercentage,this),this.getPercentage=t(this.getPercentage,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.defaults={name:"Tax",percentage:10},n.prototype.destroy=function(){return this.isNew()?n.__super__.destroy.apply(this,arguments):(this.set({_destroy:1}),this.collection.trigger("remove",this),this.trigger("destroy"))},n.prototype.getPercentage=function(){return Paydirt.Formatters.numberToPercentage(this.get("percentage"))},n.prototype.setPercentage=function(t){return this.set({percentage:Paydirt.Formatters.percentageToNumber(t)})},n.prototype.toJSON=function(){return{id:this.get("id"),cid:this.cid,name:this.get("name"),percentage:this.get("percentage"),_destroy:this.get("_destroy")}},n}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.Job=function(e){function n(){return this.humanPriceType=t(this.humanPriceType,this),this.notBillable=t(this.notBillable,this),this.clientHourlyRate=t(this.clientHourlyRate,this),this.perUser=t(this.perUser,this),this.fixedPrice=t(this.fixedPrice,this),this.perHour=t(this.perHour,this),this.canBeInvoiced=t(this.canBeInvoiced,this),this.estimate=t(this.estimate,this),this.teardown=t(this.teardown,this),this.initialize=t(this.initialize,this),this.defaults=t(this.defaults,this),this.urlRoot=t(this.urlRoot,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.urlRoot=function(){return"/clients/"+this.client().id+"/jobs"},n.prototype.defaults=function(){var t;return{id:void 0,completed:!1,estimate:void 0,add_estimate:!1,name:"",price:null!=(t=Paydirt.client)?t.get("hourly_rate"):void 0,price_type:3,position:"1",amount_to_invoice:0,duration:0,unbilled_duration:0,unbilled_hourly_value:0,unbilled_value:0,estimate_progress:0}},n.prototype.types={price:Types.Money,price_type:Types.Integer,unbilled_hourly_value:Types.Money,unbilled_fixed_value:Types.Money,unbilled_value:Types.Money,amount_to_invoice:Types.Money},n.prototype.initialize=function(t){return null==t&&(t={}),t.client&&this.set({client_id:t.client.id}),t.project&&this.set({project_id:t.project.id}),this.on("destroy",this.teardown),this.assignments=Paydirt.user_assignments.subcollection({filter:function(t){return function(e){return e.get("assignable_id")===t.id&&"Job"===e.get("assignable_type")}}(this)})},n.prototype.teardown=function(){return Paydirt._blocks.remove(Paydirt._blocks.where({job_id:this.id}))},n.prototype.client=function(){return Paydirt.clients.get(this.get("client_id"))},n.prototype.project=function(){return Paydirt.projects.get(this.get("project_id"))},n.prototype.estimate=function(){return+Paydirt.Formatters.secondsToHours(this.get("estimate"))},n.prototype.canBeInvoiced=function(){return this.get("unbilled_value")>0},n.prototype.perHour=function(){return 0===this.get("price_type")},n.prototype.fixedPrice=function(){return 1===this.get("price_type")},n.prototype.perUser=function(){return 2===this.get("price_type")},n.prototype.clientHourlyRate=function(){return 3===this.get("price_type")},n.prototype.notBillable=function(){return 4===this.get("price_type")},n.prototype.humanPriceType=function(){return this.perHour()?"Per hour":this.fixedPrice()?"Fixed price":this.perUser()?"User hourly rate":this.clientHourlyRate()?"Client rate ("+this.client().get("hourly_rate").format()+" /hr)":this.notBillable()?"Not billable":void 0},n}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.LineItem=function(e){function n(){return this.destroy=t(this.destroy,this),this.toJSON=t(this.toJSON,this),this.taxesChanged=t(this.taxesChanged,this),this.setRate=t(this.setRate,this),this.getRate=t(this.getRate,this),this.setQuantity=t(this.setQuantity,this),this.getQuantity=t(this.getQuantity,this),this.calculateTotals=t(this.calculateTotals,this),this.job=t(this.job,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.defaults={description:"",quantity:0,rate:0,subtotal:0,position:""},n.prototype.initialize=function(t){return this.invoice=t.invoice||this.collection.invoice,this.on("change:rate change:quantity",this.calculateTotals),this.line_item_taxes=new Paydirt.Collections.LineItemTaxes(t.line_item_taxes,{lineItem:this}),this.invoice.taxes.current().each(function(t){return function(e){return t.line_item_taxes.addForTax(e)}}(this)),this.line_item_taxes.on("change:applies",this.taxesChanged),this.calculateTotals()},n.prototype.job=function(){return Paydirt.jobs.get(this.get("job_id"))},n.prototype.calculateTotals=function(){var t,e,i;return t=this.get("quantity"),e=this.get("rate"),i="TimeLineItem"===this.get("type")?t/3600*e:t*e,this.set({subtotal:new Money(i)})},n.prototype.getQuantity=function(){var t;return t=this.get("quantity"),"TimeLineItem"===this.get("type")?Paydirt.Formatters.secondsToHM(t):Paydirt.Formatters.numberWithPrecision(t)},n.prototype.setQuantity=function(t){return"TimeLineItem"===this.get("type")?(t=Paydirt.Formatters.hoursMinutesToSeconds(t),this.set({quantity:t},{silent:!0})):(t=parseFloat(t),isNaN(t)&&(t=0),this.set({quantity:t},{silent:!0})),this.trigger("change:quantity")},n.prototype.getRate=function(){return new Money(this.get("rate"))},n.prototype.setRate=function(t){return this.set({rate:new Money(Paydirt.Formatters.currencyToFloat(t)).amount()})},n.prototype.taxesChanged=function(){return this.trigger("change")},n.prototype.toJSON=function(){var t;return t={id:this.get("id"),cid:this.cid,type:this.get("type"),description:this.get("description"),quantity:this.get("quantity"),rate:this.get("rate"),position:this.get("position"),_destroy:this.get("_destroy"),line_item_taxes_attributes:this.line_item_taxes.toJSON()}},n.prototype.destroy=function(){return this.isNew()?n.__super__.destroy.call(this):(this.set({_destroy:1}),this.collection.trigger("remove",this),this.trigger("destroy"))},n}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.LineItemTax=function(e){function n(){return this.toJSON=t(this.toJSON,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.defaults={applies:!0},n.prototype.destroy=function(){return this.isNew()?n.__super__.destroy.apply(this,arguments):(this.set({_destroy:1}),this.collection.remove(this),this.trigger("destroy"))},n.prototype.toJSON=function(){var t,e,i;return{id:this.get("id"),cid:this.cid,line_item_id:null!=(t=this.get("line_item"))?t.id:void 0,tax_id:(null!=(e=this.get("tax"))?e.id:void 0)||this.get("tax_id"),tax_cid:(null!=(i=this.get("tax"))?i.cid:void 0)||this.get("tax_cid"),applies:this.get("applies"),_destroy:this.get("_destroy")}},n}(Paydirt.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Models.PresetLineItem=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.urlRoot="/preset_line_items",i.prototype.defaults={description:""},i.prototype.parse=function(t){return t=i.__super__.parse.call(this,t),t.preset_line_item},i}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.Project=function(e){function n(){return this.integrationJobName=t(this.integrationJobName,this),this.integrationProjectName=t(this.integrationProjectName,this),this.integrationServiceName=t(this.integrationServiceName,this),this.setUnbilledValue=t(this.setUnbilledValue,this),this.setExpensesUnbilledValue=t(this.setExpensesUnbilledValue,this),this.setJobsUnbilledValue=t(this.setJobsUnbilledValue,this),this.setEstimateProgress=t(this.setEstimateProgress,this),this.setEstimate=t(this.setEstimate,this),this.setHasEstimate=t(this.setHasEstimate,this),this.setDuration=t(this.setDuration,this),this.expensesChanged=t(this.expensesChanged,this),this.jobsChanged=t(this.jobsChanged,this),this.teardown=t(this.teardown,this),this.setShowInTracker=t(this.setShowInTracker,this),this.urlRoot=t(this.urlRoot,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.urlRoot=function(){return"/clients/"+Paydirt.client.id+"/projects"},n.prototype.defaults={id:void 0,completed:!1,name:"",created_at:new Date,import_jobs:!1,accept_completeness:!0,default_price_type:3},n.prototype.initialize=function(){var t;return this.jobs=Paydirt.jobs.subcollection({filter:function(t){return function(e){return e.get("project_id")===t.id}}(this)}),this.trackerJobs=this.jobs.subcollection({filter:function(){return function(t){return!t.get("completed")&&!t.isNew()&&Paydirt.user.canLogTimeFor(t)}}(this)}),this.expenses=Paydirt.expenses.subcollection({filter:function(t){return function(e){return e.get("project_id")===t.id&&!e.has("line_item_id")}}(this)}),this.on("destroy",this.teardown),this.jobs.on("add remove change reset",this.jobsChanged),this.expenses.on("add remove change reset",this.expensesChanged),this.on("change:estimate",this.setEstimateProgress),this.on("change:completed change:id",this.setShowInTracker),null!=(t=this.client())&&t.on("change:active",this.setShowInTracker),this.jobsChanged(),this.expensesChanged(),this.setEstimateProgress()},n.prototype.setShowInTracker=function(){var t;return this.set("show_in_tracker",!this.get("completed")&&(null!=(t=this.client())?t.get("active"):void 0)&&null!=this.get("id")&&!!this.trackerJobs.length)},n.prototype.client=function(){return Paydirt.clients.get(this.get("client_id"))},n.prototype.unbilledValue=function(){return this.jobs.totalUnbilledAmount()+this.expenses.totalUnbilledAmount()},n.prototype.fullyInvoiced=function(){return this.unbilledValue()<=0?!0:void 0},n.prototype.teardown=function(){return this.jobs.each(function(t){return t.teardown()}),Paydirt.jobs.remove(this.jobs.models)},n.prototype.jobsChanged=function(){return this.setDuration(),this.setHasEstimate(),this.setEstimate(),this.setEstimateProgress(),this.setJobsUnbilledValue(),this.setUnbilledValue(),this.setShowInTracker()},n.prototype.expensesChanged=function(){return this.setExpensesUnbilledValue(),this.setUnbilledValue()},n.prototype.setDuration=function(){return this.set({duration:this.sum(this.jobs,"duration")})},n.prototype.setHasEstimate=function(){return this.set({has_estimate:_.any(this.jobs.pluck("estimate"))})},n.prototype.setEstimate=function(){return this.set({estimate:this.sum(this.jobs,"estimate")})},n.prototype.setEstimateProgress=function(){return this.set({estimate_progress:_.reduce(this.jobs.filter(function(t){return t.get("estimate")}),function(t,e){return t+(+e.get("duration")||0)},0)/this.get("estimate")*100})},n.prototype.setJobsUnbilledValue=function(){return this.set({jobs_unbilled_value:new Money(this.jobs.sum("unbilled_value"))})},n.prototype.setExpensesUnbilledValue=function(){return this.set({expenses_unbilled_value:new Money(this.expenses.sum("total"))})},n.prototype.setUnbilledValue=function(){return this.set({unbilled_value:new Money(this.get("jobs_unbilled_value")+this.get("expenses_unbilled_value"))})},n.prototype.integrationServiceName=function(){return null!=this.get("trello_board_id")?"Trello":null!=this.get("basecamp_project_id")?"Basecamp":null!=this.get("redbooth_project_id")?"Redbooth":null},n.prototype.integrationProjectName=function(){return null!=this.get("trello_board_id")?"board":null!=this.get("basecamp_project_id")?"project":null!=this.get("redbooth_project_id")?"project":null},n.prototype.integrationJobName=function(){return null!=this.get("trello_board_id")?"card":null!=this.get("basecamp_project_id")?"todo":null!=this.get("redbooth_project_id")?"task":null},n}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.Quote=function(e){function n(){return this.markDirty=t(this.markDirty,this),this.toJSON=t(this.toJSON,this),this.parse=t(this.parse,this),this.urlRoot=t(this.urlRoot,this),n.__super__.constructor.apply(this,arguments)
}return i(n,e),n.prototype.urlRoot=function(){return"FreeformQuote"===this.get("type")?"/free_quote_template":"/quotes"},n.prototype.parse=function(t){var e;return t=n.__super__.parse.call(this,t),_.isEmpty(t)?t:(e=t.quote,e.issued_at=moment(e.issued_at),this.emails.reset(e.emails),this.activities.reset(e.activities),this.set({subtotal:new Money(e.subtotal),total:new Money(e.total)}),delete e.subtotal,delete e.total,e)},n.prototype.toJSON=function(){var t;return t={quote:{currency_id:this.get("currency_id"),locale:this.get("locale"),number:this.get("number"),issued_at:this.get("issued_at").format("YYYYMMDD"),description:this.get("description"),footer:this.get("footer"),line_items_attributes:this.line_items.toJSON(),taxes_attributes:this.taxes.toJSON(),account_business_name:this.get("account_business_name"),account_contact_name:this.get("account_contact_name"),account_address:this.get("account_address"),client_business_name:this.get("client_business_name"),client_contact_name:this.get("client_contact_name"),client_address:this.get("client_address")}}},n.prototype.current=function(){return!this.get("accepted_at")&&!this.get("declined_at")},n.prototype.state=function(){return this.get("declined_at")?"declined":this.get("accepted_at")?"accepted":this.get("sent")?this.get("sent")?"sent":void 0:"draft"},n.prototype.dirtyMessage=function(){return"the quote "+this.formattedNumber()},n.prototype.markDirty=function(){return"ClientQuote"===this.get("type")?n.__super__.markDirty.call(this):void 0},n.prototype.acceptedAt=function(){return null!=this._accepted_at?this._accepted_at:this._accepted_at=moment(this.get("accepted_at")).startOf("day").toDate()},n.prototype.declinedAt=function(){return null!=this._declined_at?this._declined_at:this._declined_at=moment(this.get("declined_at")).startOf("day").toDate()},n}(Paydirt.Models.Document)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.QuoteBrowser=function(e){function n(){return this.cloneEndDate=t(this.cloneEndDate,this),this.cloneStartDate=t(this.cloneStartDate,this),this.setPreviousEndDate=t(this.setPreviousEndDate,this),this.setPreviousStartDate=t(this.setPreviousStartDate,this),this.pushState=t(this.pushState,this),this.toJSON=t(this.toJSON,this),this.interval=t(this.interval,this),this.updateDates=t(this.updateDates,this),this.setEndDateTo=t(this.setEndDateTo,this),this.setStartDateTo=t(this.setStartDateTo,this),this.updateInterval=t(this.updateInterval,this),this.nextPeriod=t(this.nextPeriod,this),this.previousPeriod=t(this.previousPeriod,this),this.setState=t(this.setState,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.initialize=function(){return this.on("change:dateRangeType",this.updateInterval),this.on("change:startDate",this.setPreviousStartDate),this.on("change:endDate",this.setPreviousEndDate),this.on("change:client_id",function(t){return function(){return t.set({lastFilterBy:"client"})}}(this)),this.on("change:dateRangeType",function(t){return function(){return t.set({lastFilterBy:"date"})}}(this)),this.on("change",this.pushState)},n.prototype.setState=function(t){var e,i,n,s,r,a,o,l;return null==t&&(t={}),s="30-days",r=30,n=Paydirt.Utilities.getParameterByName("range",t.from)||s,i=Paydirt.Utilities.getParameterByName("by",t.from),l=Paydirt.Utilities.getParameterByName("from",t.from),l=null!=l?moment(l).startOf("day").toDate():moment().subtract("days",r-1).startOf("day").toDate(),a=Paydirt.Utilities.getParameterByName("to",t.from),a=null!=a?moment(a).startOf("day").toDate():moment().startOf("day").toDate(),o=null!=l&&null!=a?Math.round((this.cloneEndDate()-this.cloneStartDate().subtract("days",1))/864e5):r,e=Paydirt.Utilities.getParameterByName("client_id",t.from),this.set({dateRangeType:n,startDate:l,endDate:a,interval:o,client_id:e,dateCriteria:i,popped:t.popped,initializing:t.initializing}),this.trigger("dateRangeChanged")},n.prototype.previousPeriod=function(){return this.updateDates(this.cloneStartDate().subtract("days",this.interval()).toDate(),this.cloneEndDate().subtract("days",this.interval()).toDate())},n.prototype.nextPeriod=function(){return this.updateDates(this.cloneStartDate().add("days",this.interval()).toDate(),this.cloneEndDate().add("days",this.interval()).toDate())},n.prototype.updateInterval=function(){switch(this.get("dateRangeType")){case"30-days":this.set({interval:30,endDate:this.cloneStartDate().add("days",29).toDate()});break;case"custom":this.set({interval:function(t){return function(){return Math.round((t.cloneEndDate()-t.cloneStartDate().subtract("days",1))/864e5)}}(this)})}return this.trigger("dateRangeChanged")},n.prototype.setStartDateTo=function(t){return"custom"===this.get("dateRangeType")?t>=this.get("endDate")?this.updateDates(t,moment(t).clone().add("days",this.interval()-1).toDate()):this.updateDates(t,this.get("endDate")):this.updateDates(t,moment(t).clone().add("days",this.interval()-1).toDate())},n.prototype.setEndDateTo=function(t){return"custom"===this.get("dateRangeType")?t<=this.get("startDate")?this.updateDates(moment(t).clone().subtract("days",this.interval()-1).toDate(),t):this.updateDates(this.get("startDate"),t):this.updateDates(moment(t).clone().subtract("days",this.interval()-1).toDate(),t)},n.prototype.updateDates=function(t,e){return this.set({startDate:t,endDate:e,lastFilterBy:"date"}),this.trigger("dateRangeChanged")},n.prototype.interval=function(){return"function"==typeof this.get("interval")?this.get("interval")():this.get("interval")},n.prototype.toJSON=function(){var t,e,i,n,s;return i={},i.range=this.get("dateRangeType"),"all-time"!==i.range&&(i.from=this.cloneStartDate().format("YYYY-MM-DD"),i.to=this.cloneEndDate().format("YYYY-MM-DD")),t=this.get("client_id"),null!=t&&(i.client_id=t),e=this.get("dateCriteria"),null!=e&&(i.by=e),s=this.get("user"),null!=s&&""!==s&&(i.user=s),n=this.get("quote"),null!=n&&""!==n&&(i.quote=n),i},n.prototype.pushState=function(){var t,e,i,n;if(this.get("popped"))return void this.unset("popped",{silent:!0});e="",n=this.toJSON();for(t in n)i=n[t],null!=i&&(e+=""+t+"="+i+"&");return e.match(/&$/)&&(e=e.substring(0,e.length-1)),this.get("initializing")?this.unset("initializing",{silent:!0}):window.history.pushState("?"+e,"","/quotes/history?"+e)},n.prototype.setPreviousStartDate=function(){return this.set("previousStartDate",this.previous("startDate"))},n.prototype.setPreviousEndDate=function(){return this.set("previousEndDate",this.previous("endDate"))},n.prototype.cloneStartDate=function(){return moment(this.get("startDate")).clone()},n.prototype.cloneEndDate=function(){return moment(this.get("endDate")).clone()},n}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.Report=function(e){function n(){return this.toJSON=t(this.toJSON,this),this.pushState=t(this.pushState,this),this.setState=t(this.setState,this),this.setEnd=t(this.setEnd,this),this.setStart=t(this.setStart,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.initialize=function(t,e){return null==t&&(t={}),null==e&&(e={}),n.__super__.initialize.apply(this,arguments),this.set({initializing:!0}),this.on("change",this.pushState)},n.prototype.setRange=function(t){return this.set("custom"===t?{range:t}:{range:t,start:moment().startOf(t),end:moment().endOf(t)})},n.prototype.setTarget=function(t){return this.set({target:t})},n.prototype.nextPeriod=function(){return this.changePeriod(1)},n.prototype.previousPeriod=function(){return this.changePeriod(-1)},n.prototype.currentPeriod=function(){return this.set({start:moment().startOf(this.get("range")),end:moment().endOf(this.get("range"))})},n.prototype.changePeriod=function(t){var e,i;return i=this.get("start").clone().add(t,this.get("range")),e=i.clone().endOf(this.get("range")),this.set({start:i,end:e})},n.prototype.setStart=function(t){var e;return t=moment(t),e=this.get("end").clone(),t.isValid()?this.set(e>t?{start:t}:{start:t,end:t}):this.trigger("change:start")},n.prototype.setEnd=function(t){var e;return e=this.get("start").clone(),t=moment(t),t.isValid()?this.set(t>e?{end:t}:{start:t,end:t}):this.trigger("change:end")},n.prototype.setState=function(t){var e,i,n,s;return null==t&&(t={}),s=t.target||"team",i=t.range||"week",n=null!=t.start?moment(t.start):moment().startOf(i),e=null!=t.end?moment(t.end):moment().endOf(i),this.set({target:s,range:i,start:n,end:e,popped:t.popped})},n.prototype.pushState=function(){var t;return this.get("popped")?void this.unset("popped",{silent:!0}):this.get("initializing")?void this.unset("initializing",{silent:!0}):(t=$.param(this.toJSON()),window.history.pushState(t,"",""+window.location.pathname+"?"+t))},n.prototype.toJSON=function(){return{target:this.get("target"),range:this.get("range"),start:this.get("start").clone().format("YYYY-MM-DD"),end:this.get("end").clone().format("YYYY-MM-DD")}},n}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.Tax=function(e){function n(){return this.toJSON=t(this.toJSON,this),this.setPercentage=t(this.setPercentage,this),this.getPercentage=t(this.getPercentage,this),this.initialize=t(this.initialize,this),this.parse=t(this.parse,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.defaults={name:"Tax",percentage:10},n.prototype.parse=function(t){return t=n.__super__.parse.call(this,t),t.tax},n.prototype.initialize=function(t){return this.set({percentage:+(null!=t?t.percentage:void 0)})},n.prototype.getPercentage=function(){return Paydirt.Formatters.numberToPercentage(this.get("percentage"))},n.prototype.setPercentage=function(t){return this.set({percentage:Paydirt.Formatters.percentageToNumber(t)})},n.prototype.toJSON=function(){return{id:this.get("id"),cid:this.cid,name:this.get("name"),percentage:this.get("percentage"),_destroy:this.get("_destroy")}},n}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.Tracker=function(e){function n(){return this.spotClientsIn=t(this.spotClientsIn,this),this.unsetBlock=t(this.unsetBlock,this),this.start=t(this.start,this),this.initializeBlock=t(this.initializeBlock,this),this.refreshFromServer=t(this.refreshFromServer,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.initialize=function(t){var e;return null==t&&(t={}),null!=(e=Paydirt.runningBlocks)&&e.on("add remove reset",this.initializeBlock),null!=t.block&&this.set({block:t.block}),"in-app"===this.get("mode")?(this.set({showing:"true"===Paydirt.Cookies.read("trackerShowing")}),this.on("change:showing",function(t){return function(){return Paydirt.Cookies.write("trackerShowing",t.get("showing").toString())}}(this))):this.set({showing:!1})},n.prototype.refreshFromServer=function(){return $.getJSON(Paydirt.baseURL+"/data/tracker",function(t){return function(e){var i,n,s,r,a,o,l,c,d,u,p,h,m;return i=e.data,null!=(n=Paydirt.runningBlocks)&&n.off("add remove reset",t.initializeBlock),Paydirt.currencies=(null!=(s=Paydirt.currencies)?s.reset(i.currencies):void 0)||new Paydirt.Collections.Currencies(i.currencies),Paydirt.account=(null!=(o=Paydirt.account)?o.set(i.account):void 0)||new Paydirt.Models.Account(i.account),Paydirt.user_assignments=(null!=(l=Paydirt.user_assignments)?l.reset(i.user_assignments):void 0)||new Paydirt.Collections.UserAssignments(i.user_assignments),Paydirt.users=(null!=(c=Paydirt.users)?c.reset(i.users):void 0)||new Paydirt.Collections.Users(i.users),null==Paydirt.user&&(Paydirt.user=Paydirt.users.get(i.user_id)),Paydirt.work_signals=(null!=(d=Paydirt.work_signals)?d.reset(i.work_signals):void 0)||new Paydirt.Collections.WorkSignals(i.work_signals),null!=Paydirt._blocks?Paydirt._blocks.reset(i.blocks):(Paydirt._blocks=new Paydirt.Collections.Blocks(i.blocks),Paydirt.blocks=Paydirt._blocks.subcollection({filter:function(t){return!t.get("running")}}),Paydirt.runningBlocks=Paydirt._blocks.subcollection({filter:function(t){return t.get("user_id")===Paydirt.user.id&&t.get("running")}})),null!=(u=Paydirt.runningBlocks)&&u.on("add remove reset",t.initializeBlock),Paydirt.jobs=(null!=(p=Paydirt.jobs)?p.reset(i.jobs):void 0)||new Paydirt.Collections.Jobs(i.jobs),Paydirt.expenses=(null!=(h=Paydirt.expenses)?h.reset(i.expenses):void 0)||new Paydirt.Collections.Expenses(i.expenses),Paydirt.projects=new Paydirt.Collections.Projects,Paydirt.trackerProjects=Paydirt.projects.subcollection({filter:function(t){return!t.get("completed")}}),Paydirt.invoices=(null!=(m=Paydirt.invoices)?m.reset(i.invoices):void 0)||new Paydirt.Collections.Invoices(i.invoices),Paydirt.quotes=(null!=(r=Paydirt.quotes)?r.reset(i.quotes):void 0)||new Paydirt.Collections.Quotes(i.quotes),Paydirt.clients=(null!=(a=Paydirt.clients)?a.reset(i.clients):void 0)||new Paydirt.Collections.Clients(i.clients),Paydirt.projects.reset(i.projects),t.initializeBlock()}}(this))},n.prototype.initializeBlock=function(){var t;return Paydirt.runningBlocks.length>0?(t=Paydirt.runningBlocks.first(),this.set({block:t}),this.running()):this.stopped()},n.prototype.start=function(t){return null==t&&(t={}),$.ajax({type:"POST",url:""+Paydirt.baseURL+"/tracker/start",data:{extension:"extension"===this.get("mode"),minutes_ago:t.minutesAgo,job_id:t.jobId,suggestion:Paydirt.jobs.get(t.jobId).client().id===this.get("suggestedClientId")}}).success(function(t){return function(e){var i;return i=new Paydirt.Models.Block(e.block),Paydirt._blocks.add(i),t.set({block:i,flash:e.flash}),t.unset("suggestedClientId"),t.running()}}(this)).error(function(){return function(t){var e;return null!=(e=Paydirt.trackerView)?e.showFlash(t.responseText):void 0}}(this))},n.prototype.running=function(){return this.trigger("started")},n.prototype.stopped=function(){return this.unsetBlock(),this.trigger("stopped")},n.prototype.unsetBlock=function(){return this.get("block")?(this.get("block").stopUpdatingDuration(),this.unset("block")):void 0},n.prototype.spotClientsIn=function(t,e){var i,n;return n=[],i=(-(100/Math.log(101))*Math.log(parseInt(e.suggestionThreshold)+1)+100+.001)/100,Paydirt.clients.filter(function(t){return t.get("active")&&(null!=t.get("not_working_until")?t.get("not_working_until")<=moment():!0)&&t.jobs.where({completed:!1}).length>0&&t.jobs.filter(function(t){return Paydirt.user.canLogTimeFor(t)}).length>0?!0:!1}).forEach(function(e){return function(s){var r,a,o;return r=[],o={},t.forEach(function(t){var i;return t=e.searchify(t),i=0,s.work_signals.each(function(n){var s,r;return s=t.split(e.searchify(n.get("text"))).length-1,s>0?(o[r=n.get("text")]||(o[r]=0),o[n.get("text")]+=s,i+=s*n.get("text").length/t.length):void 0}),r.push(i)}),a=Math.max.apply(Math,r),a>i&&(!e.get("block")||s.id!==e.get("block").client().id)?n.push({client:s,hitDensity:a,signalsHit:o}):void 0}}(this)),n.length>0?(n.sort(function(t,e){return e.hitDensity-t.hitDensity}),n[0]):null},n.prototype.searchify=function(t){return t.toLowerCase().replace(/[\-\&\_]/g,"-")},n}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Models.User=function(e){function n(){return this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.initialize=function(){return this.assignments=Paydirt.user_assignments.subcollection({filter:function(t){return function(e){return e.get("user_id")===t.id}}(this)})},n.prototype.canManageInvoices=function(){return this.get("permissions").manage_invoices},n.prototype.canViewAllTimeLogged=function(){return this.get("permissions").view_all_time_logged},n.prototype.canViewFinancialInformation=function(){return this.get("permissions").view_financial_information},n.prototype.canLogTimeFor=function(t){return this.get("permissions").log_time_without_assignment?!0:this.isAssignedTo(t)},n.prototype.isAssignedTo=function(t){return this.assignments.find(function(e){return e.get("assignable_id")===t.id&&"Job"===e.get("assignable_type")})?!0:!1},n.prototype.assignTo=function(t){return $.ajax(""+this.url()+"/assign_to",{type:"put",data:{assignable_type:"Job",assignable_id:t.id}}).done(function(t){return Paydirt.user_assignments.add(t.user_assignment),Paydirt.Flash.notice(t.flash)})},n.prototype.unassignFrom=function(t){return $.ajax(""+this.url()+"/unassign_from",{type:"put",data:{assignable_type:"Job",assignable_id:t.id}}).done(function(t){return Paydirt.user_assignments.remove(t.user_assignment),Paydirt.Flash.notice(t.flash)})},n}(Paydirt.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Models.UserAssignment=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i}(Paydirt.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Models.WorkSignal=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.urlRoot=function(){return"/clients/"+this.get("client_id")+"/work_signals"},i.prototype.parse=function(t){return t=i.__super__.parse.call(this,t),t.work_signal},i}(Paydirt.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.Blocks=function(e){function n(){return this.addExternalBillingReference=t(this.addExternalBillingReference,this),this.comparator=t(this.comparator,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.Block,n.prototype.comparator=function(t,e){return t.date().getTime()<e.date().getTime()?1:t.date().getTime()>e.date().getTime()?-1:t.get("duration_only")?-1:e.get("duration_only")?1:+t.startedAt()<+e.startedAt()?-1:1},n.prototype.duration=function(){return+Paydirt.Formatters.numberWithPrecision(this.reduce(function(){return function(t,e){return t+ +Paydirt.Formatters.secondsToHours(e.get("duration"))}}(this),0),{precision:2})},n.prototype.value=function(){return this.sum("value")},n.prototype.addExternalBillingReference=function(t){return Paydirt.Utilities.post("/time/add_external_billing_reference",{ids:this.pluck("id"),external_billing_reference:t})},n}(Paydirt.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.Clients=function(e){function n(){return this.totalAmountPaid=t(this.totalAmountPaid,this),this.totalAmountOverdue=t(this.totalAmountOverdue,this),this.totalAmountOwing=t(this.totalAmountOwing,this),this.totalAmountUnbilled=t(this.totalAmountUnbilled,this),this.inactive=t(this.inactive,this),this.active=t(this.active,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.Client,n.prototype.comparator=function(t){var e;return null!=(e=t.get("business_name"))?e.toLowerCase():void 0},n.prototype.active=function(){return new Paydirt.Collections.Clients(this.where({active:!0}))},n.prototype.inactive=function(){return new Paydirt.Collections.Clients(this.where({active:!1}))},n.prototype.totalAmountUnbilled=function(){return new Money(this.reduce(function(){return function(t,e){return t+e.amountUnbilled()}}(this),0))},n.prototype.totalAmountOwing=function(){return new Money(this.reduce(function(){return function(t,e){return t+e.amountOwing()}}(this),0))},n.prototype.totalAmountOverdue=function(){return new Money(this.reduce(function(){return function(t,e){return t+e.amountOverdue()}}(this),0))},n.prototype.totalAmountPaid=function(){return new Money(this.reduce(function(){return function(t,e){return t+e.amountPaid()}}(this),0))},n}(Paydirt.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Collections.Currencies=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.model=Paydirt.Models.Currency,i}(Paydirt.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.DocumentActivities=function(e){function n(){return this.comparator=t(this.comparator,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.DocumentActivity,n.prototype.comparator=function(t,e){var i,n,s,r;return s=new Date(t.get("date")),r=new Date(e.get("date")),r>s?1:s>r?-1:(i=new Date(t.get("created_at")),n=new Date(e.get("created_at")),n>i?1:i>n?-1:t.id<e.id?1:-1)},n}(Paydirt.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Collections.Expenses=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.model=Paydirt.Models.Expense,i.prototype.url=function(){return"/clients/"+Paydirt.client.id+"/expenses"},i.prototype.comparator=function(t,e){return t=t.get("created_at"),e=e.get("created_at"),t>e?1:-1},i}(Paydirt.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Collections.InvoiceEmails=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.model=Paydirt.Models.InvoiceEmail,i}(Paydirt.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.InvoicePayments=function(e){function n(){return this.comparator=t(this.comparator,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.InvoicePayment,n.prototype.comparator=function(t,e){var i,n;return i=moment(t.get("received_at")),n=moment(e.get("received_at")),n>i?1:i>n?-1:moment(t.get("created_at"))<moment(e.get("created_at"))?1:-1},n}(Paydirt.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.InvoiceTaxes=function(e){function n(){return this.current=t(this.current,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.InvoiceTax,n.prototype.current=function(){return _(this.where({_destroy:void 0}))},n}(Paydirt.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.Invoices=function(e){function n(){return this.paid=t(this.paid,this),this.current=t(this.current,this),this.amountTotal=t(this.amountTotal,this),this.amountOverdue=t(this.amountOverdue,this),this.amountOwing=t(this.amountOwing,this),this.amountPaid=t(this.amountPaid,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.Invoice,n.prototype.comparator=function(t){return t.get("issued_at")},n.prototype.amountPaid=function(){return new Money(this.reduce(function(){return function(t,e){return t+e.amountPaid()}}(this),0))},n.prototype.amountOwing=function(){return new Money(this.reduce(function(){return function(t,e){return t+e.amountOwing()}}(this),0))},n.prototype.amountOverdue=function(){return new Money(_(this.filter(function(t){return t.overdue()})).reduce(function(){return function(t,e){return t+e.amountOwing()}}(this),0))},n.prototype.amountTotal=function(){return new Money(this.reduce(function(){return function(t,e){return t+e.get("total")}}(this),0))},n.prototype.current=function(){return new Paydirt.Collections.Invoices(this.filter(function(t){return!t.paid()}))},n.prototype.paid=function(){return new Paydirt.Collections.Invoices(this.filter(function(t){return t.paid()}))},n}(Paydirt.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.Jobs=function(e){function n(){return this.totalUnbilledAmount=t(this.totalUnbilledAmount,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.Job,n.prototype.url=function(){return"/clients/"+Paydirt.client.id+"/jobs"},n.prototype.comparator=function(t,e){return t=t.get("position"),e=e.get("position"),t>e?1:e>t?-1:0},n.prototype.search=function(t){var e,i;return i=t.split(" "),e=this.models,i.forEach(function(t){var i;return i=new RegExp(Paydirt.Utilities.escapeRegExp(t),"i"),e=_.filter(e,function(t){return i.test(t.get("name"))||i.test(t.project().get("name"))||i.test(t.client().get("business_name"))})}),e},n.prototype.totalUnbilledAmount=function(){return this.reduce(function(){return function(t,e){return t+e.get("unbilled_value")}}(this),0)},n}(Paydirt.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.LineItemTaxes=function(e){function n(){return this.removeForTax=t(this.removeForTax,this),this.addForTax=t(this.addForTax,this),this.findByTax=t(this.findByTax,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.LineItemTax,n.prototype.initialize=function(t,e){return this.lineItem=e.lineItem},n.prototype.findByTax=function(t){var e;return e=this.where({tax:t}),0===e.length&&null!=t.id&&(e=this.where({tax_id:t.id})),0===e.length?!1:e[0]},n.prototype.addForTax=function(t){return this.findByTax(t)?void 0:this.add(new this.model({tax:t,line_item:this.lineItem}))},n.prototype.removeForTax=function(t){var e;return e=this.findByTax(t),e.destroy()},n}(Paydirt.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.LineItems=function(e){function n(){return this.removeLineItemTax=t(this.removeLineItemTax,this),this.addLineItemTax=t(this.addLineItemTax,this),this.current=t(this.current,this),this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.LineItem,n.prototype.initialize=function(t,e){return this.invoice=e.invoice},n.prototype.current=function(){return _(this.where({_destroy:void 0}))},n.prototype.addLineItemTax=function(t){return this.each(function(e){return e.line_item_taxes.addForTax(t)})},n.prototype.removeLineItemTax=function(t){return this.each(function(e){return e.line_item_taxes.removeForTax(t)})},n}(Paydirt.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Collections.PresetLineItems=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.model=Paydirt.Models.PresetLineItem,i}(Paydirt.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Collections.Projects=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.model=Paydirt.Models.Project,i.prototype.comparator=function(t,e){var i,n,s,r,a,o;return a=new Date(t.get("created_at")),s=t.get("completed"),i=t.client().get("business_name"),o=new Date(e.get("created_at")),r=e.get("completed"),n=e.client().get("business_name"),n>i?-1:i>n?1:t.isNew()&&!e.isNew()?-1:!t.isNew()&&e.isNew()?1:s&&!r?1:!s&&r?-1:o>a?1:-1},i}(Paydirt.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.Quotes=function(e){function n(){return this.amountTotal=t(this.amountTotal,this),this.amountDeclined=t(this.amountDeclined,this),this.amountAccepted=t(this.amountAccepted,this),this.amountAwaitingApproval=t(this.amountAwaitingApproval,this),this.amountSent=t(this.amountSent,this),this.amountDrafted=t(this.amountDrafted,this),this.declined=t(this.declined,this),this.accepted=t(this.accepted,this),this.historical=t(this.historical,this),this.current=t(this.current,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.Quote,n.prototype.comparator=function(t){return t.get("issued_at")},n.prototype.current=function(){return new Paydirt.Collections.Quotes(this.filter(function(t){return t.current()}))},n.prototype.historical=function(){return new Paydirt.Collections.Quotes(this.filter(function(t){return!t.current()}))},n.prototype.accepted=function(){return new Paydirt.Collections.Quotes(this.filter(function(t){return t.get("accepted_at")}))},n.prototype.declined=function(){return new Paydirt.Collections.Quotes(this.filter(function(t){return t.get("declined_at")}))},n.prototype.amountDrafted=function(){return new Money(_(this.filter(function(t){return!t.sent()})).reduce(function(){return function(t,e){return t+e.get("total")}}(this),0))},n.prototype.amountSent=function(){return new Money(_(this.filter(function(t){return t.sent()})).reduce(function(){return function(t,e){return t+e.get("total")}}(this),0))},n.prototype.amountAwaitingApproval=function(){return new Money(_(this.filter(function(t){return t.sent()&&t.current()})).reduce(function(){return function(t,e){return t+e.get("total")}}(this),0))},n.prototype.amountAccepted=function(){return new Money(_(this.filter(function(t){return t.get("accepted_at")})).reduce(function(){return function(t,e){return t+e.get("total")}}(this),0))},n.prototype.amountDeclined=function(){return new Money(_(this.filter(function(t){return t.get("declined_at")})).reduce(function(){return function(t,e){return t+e.get("total")
}}(this),0))},n.prototype.amountTotal=function(){return new Money(this.reduce(function(){return function(t,e){return t+e.get("total")}}(this),0))},n}(Paydirt.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Collections.RecurringInvoices=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.model=Paydirt.Models.Invoice,i.prototype.view=Paydirt.Views.RecurringInvoices.ListItem,i.prototype.comparator=function(t){return t.get("created_at")},i}(Paydirt.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.Taxes=function(e){function n(){return this.initialize=t(this.initialize,this),this.url=t(this.url,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.Tax,n.prototype.url=function(){return this.taxableType&&this.taxableId?"/"+this.taxableType+"/"+this.taxableId+"/taxes":"/taxes"},n.prototype.initialize=function(t,e){return this.taxableType=null!=e?e.taxableType:void 0,this.taxableId=null!=e?e.taxableId:void 0},n}(Paydirt.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.UserAssignments=function(e){function n(){return this.initialize=t(this.initialize,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.UserAssignment,n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.on("add remove",function(t){var e;return e=Paydirt.jobs.get(t.get("assignable_id")),e.trigger("change",e)})},n}(Paydirt.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Paydirt.Collections.Users=function(e){function n(){return this.current=t(this.current,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=Paydirt.Models.User,n.prototype.url="/users",n.prototype.comparator=function(t){var e;return null!=(e=t.get("name"))?e.toLowerCase():void 0},n.prototype.current=function(){return _(this.where({archived:!1}))},n}(Paydirt.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Paydirt.Collections.WorkSignals=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.model=Paydirt.Models.WorkSignal,i.prototype.view=Paydirt.Views.WorkSignals.Show,i}(Paydirt.Collection)}.call(this),function(){Paydirt.Guiders.Clients={}}.call(this),function(){Paydirt.Guiders.Clients.Show={initialize:function(){return $("body").addClass("tour"),$(document).on("click.tour","[data-behaviour~=end_tour]",function(t){return function(e){return e.preventDefault(),t.tour.end()}}(this)),Paydirt.trackerView.close(),Paydirt.trackerView.hide(),guiders.createGuider({id:"guider-intro",overlay:!0,title:"Creating tasks and tracking time",description:"<p>We'll take you on a quick tour, and help you set up your work for "+Paydirt.client.get("business_name")+".</p><p>This tour takes less than two minutes.</p>",buttons:[{name:"Let's go "+arwRight,onclick:this.tour.introduceJobs}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-introduce-jobs",overlay:!0,title:"Create a task for "+Paydirt.client.get("business_name"),width:450,description:"<p>A task is simply the work you do, and the way in which it's billed.</p>\n<p>\n  <b>For example:</b>\n  <br />\n  <span class='highlight'>Web Development</span> at <span class='highlight'>$50 per hour</span>\n  <br />\n  <span class='highlight'>Logo Design</span> for <span class='highlight'>$1200 total</span>\n  <br />\n  <span class='highlight'>Consulting</span> at <span class='highlight'>Each user's own hourly rate</span> (for teams)\n</p>\n<p>A client can have as few or as many tasks as you like.</p>",buttons:[{name:"Help me create a task "+arwRight,onclick:this.tour.highlightGeneralWork}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-general-work-tip",attachTo:"[data-onclick='addJob']",position:3,title:!1,width:250,description:"Click here to create a task",classString:"tip",buttons:[]}),guiders.createGuider({id:"guider-job-name-tip",attachTo:".job_form input[name=name]",highlight:".job_container",overlay:!0,position:12,title:!1,width:380,description:"<h2>Name the task you're doing</h2><p class='grey'>Copywriting, Design, Development, Consulting...</p>",buttons:[]}),guiders.createGuider({id:"guider-job-price-tip",attachTo:".job_form .price-type-select",position:12,title:!1,width:250,description:"<h2>How is this work billed?</h2><p class='grey'>Hit <span class='highlight'>Save</span> when you're done.</p>",buttons:[]}),guiders.createGuider({id:"guider-introduce-tracker",highlight:".ticker.out",attachTo:".ticker.out",overlay:!0,position:8,title:"Track your time using the Time Tracker",description:"<p>The time tracker is available on every page in Paydirt, and allows you to track your time for any of your tasks.</p><p>Click the <span class='highlight'>Time Tracker</span> link to open the time tracker.</p>",buttons:[]}),guiders.createGuider({id:"guider-show-tracker",highlight:"#tracker",attachTo:"#tracker .job",overlay:!0,position:10,title:"Your tasks appear in the Time Tracker",description:"<p>When you start a timer, the billing rate is set automatically according to the price of the task.</p>",buttons:[{name:"Got it "+arwRight,onclick:this.tour.lastStep}]}),guiders.createGuider({id:"guider-highlight-new-invoice",highlight:".new_invoice_link",attachTo:".new_invoice_link",overlay:!0,position:6,title:!1,description:"When you're ready, head here to create an invoice. <br /><br />Creating an invoice from your fixed price tasks and billable time is <i>really easy</i>!",buttons:[{name:"Next",onclick:function(t){return function(){return t.tour.lastStep()}}(this)}]}),guiders.createGuider({id:"guider-last-step",title:"<i class='icon-check'></i> You've created a task",overlay:!0,description:"<p>Track your time towards tasks and Paydirt will tell you how much is outstanding for each client.</p><p>When you need to create an invoice, all of your billable hours can be imported in a snap.</p>",buttons:[{name:"Finish the tour",onclick:function(t){return function(){return t.tour.end()}}(this)}],buttonCustomHTML:checklistButton,classString:"done"})},tour:{start:function(){return $("body").one("navigate",function(){return Paydirt.Guiders.Clients.Show.tour.end()}),guiders.hideAll(),guiders.show("guider-intro")},introduceJobs:function(){return guiders.hideAll(!0),guiders.show("guider-introduce-jobs")},highlightGeneralWork:function(){return guiders.hideAll(),setTimeout(function(){return guiders.show("guider-general-work-tip"),$("[data-onclick='addJob']").off("click.tour",Paydirt.Guiders.Clients.Show.tour.helpAddJob),$("[data-onclick='addJob']").one("click.tour",Paydirt.Guiders.Clients.Show.tour.helpAddJob)},100)},helpAddJob:function(){return guiders.hideAll(),setTimeout(function(){return guiders.show("guider-job-price-tip"),guiders.show("guider-job-name-tip"),$("body").off("jobSaved").off("jobCancelled"),$("body").one("jobSaved",function(){return Paydirt.Guiders.Clients.Show.tour.introduceTracker(),$("[data-onclick='addJob']").off("click.tour",Paydirt.Guiders.Clients.Show.tour.helpAddJob),$("body").off("jobCancelled")}).one("jobCancelled",function(){return Paydirt.Guiders.Clients.Show.tour.highlightGeneralWork()})},100)},introduceTracker:function(){return guiders.hideAll(!0),guiders.show("guider-introduce-tracker"),$(".ticker.out").one("click.tour",function(){return Paydirt.Guiders.Clients.Show.tour.showTracker()})},showTracker:function(){return guiders.hideAll(!0),setTimeout(function(){return guiders.show("guider-show-tracker")},500)},highlightNewInvoice:function(){return guiders.hideAll(),$(".secondary_navigation").removeClass("temp_hide"),guiders.show("guider-highlight-new-invoice")},lastStep:function(){return guiders.hideAll(!0),guiders.show("guider-last-step")},end:function(){return guiders.hideAll(),$(".temp_hide").css({visibility:"visible",opacity:0}).fadeTo(1e3,1).removeClass("temp_hide"),$("body").removeClass("tour"),Paydirt.tour=!1,$(document).off("click.tour","[data-behaviour~=end_tour]")}}}}.call(this),function(){Paydirt.Guiders.Invoices={}}.call(this),function(){Paydirt.Guiders.Invoices.Edit={initialize:function(){return $("body").addClass("tour"),$("#logo_widget .dismiss").hide(),$(document).on("click.tour","[data-behaviour~=end_tour]",function(t){return function(e){return e.preventDefault(),t.tour.end()}}(this)),guiders.createGuider({id:"guider-intro",overlay:!0,title:"Sending invoices with ruthless efficiency",description:"<p>We've added a demo client and invoice to your account.</p><p>Let's finish this invoice, and then <i>send it</i>.</p>",buttons:[{name:"Let's do it <i class='icon-circle-arrow-right'></i>",onclick:this.tour.introduceLogo}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-introduce-logo",attachTo:"#logo_widget",highlight:"#logo_widget",overlay:!0,position:3,title:"Add your logo",description:"<p>Add your business logo to make your invoices look professional. Your logo will be used on all your invoices.</p>",buttons:[{name:"skip this step",classString:"skip",onclick:this.tour.introduceAccountDetails},{name:"Done <i class='icon-circle-arrow-right'></i>",onclick:this.tour.introduceAccountDetails}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-introduce-account-details",attachTo:".my_business",highlight:".my_business",overlay:!0,position:3,title:"Who are you?",description:"<p>Add your <span class='highlight'>business name</span>, <span class='highlight'>full name</span> and <span class='highlight'>address</span>.</p><p>These details will be used on all future invoices, so this is the only time you have to type them.</p>",buttons:[{name:"skip this step",classString:"skip",onclick:function(t){return function(){return $("[name=account_contact_name],[name=account_business_name]").removeClass("invalid"),t.tour.highlightSaveInvoice()}}(this)},{name:"Done <i class='icon-circle-arrow-right'></i>",classString:"done",onclick:function(t){return function(){var e,i;return i=$("[name=account_contact_name]").val(),e=$("[name=account_business_name]").val(),$("[name=account_contact_name]").toggleClass("invalid",""===i),$("[name=account_business_name]").toggleClass("invalid",""===e),""!==i||""!==e?($("[name=account_contact_name]").removeClass("invalid"),$("[name=account_business_name]").removeClass("invalid"),t.tour.highlightSaveInvoice()):$(".guider_button.done").shake()}}(this)}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-highlight-save-invoice",title:"Good work! You're done.",overlay:!0,highlight:"#save-invoice",attachTo:"#save-invoice",position:9,classString:"tip",description:"<p>Hit save and we'll see how it looks.</p>",width:280,buttons:[]}),guiders.createGuider({id:"guider-send-by-email",overlay:!0,attachTo:"#send_remind_link",highlight:"#send_remind_link",position:9,classString:"tip",title:"Your first invoice is ready to send!",description:"<p>Your invoice is still a <span class='highlight'>Draft</span> until you send it.</p><p><b>Click <span class='highlight'>Send Invoice</span> to send it to Tristan, one of the founders of Paydirt.</b></p>",buttons:[]}),guiders.createGuider({id:"guider-introduce-email",title:"",attachTo:"#send-invoice-email",position:9,description:"<div class='span-8'><div class='boomheadshot'><img src='/static_assets/tristan.png' alt='Tristan' /></div></div> <div class='span-16 last'><p class='boomcaption'>Send me your invoice!</p></div>",classString:"tip",width:285,buttons:[]}),guiders.createGuider({id:"guider-last-step",overlay:!0,title:"<i class='icon-check'></i> You've sent your first invoice",description:"<p>Now that you've sent the invoice, you can add payments to it. If the invoice falls overdue, you'll be notified by email and can send a reminder to your client.</p><p>To find out more about invoicing, check out our <a href='/help/guides/invoicing' target='_blank'>invoicing help guide</a>.<p>",buttons:[{name:"Finish the tour",onclick:this.tour.end}],classString:"done",buttonCustomHTML:checklistButton})},tour:{start:function(){return guiders.hideAll(!0),guiders.show("guider-intro")},introduceLogo:function(){return guiders.hideAll(!0),guiders.show("guider-introduce-logo")},introduceAccountDetails:function(){return guiders.hideAll(!0),guiders.show("guider-introduce-account-details")},highlightSaveInvoice:function(){return guiders.hideAll(!0),guiders.show("guider-highlight-save-invoice"),$("#save-invoice").off("click.tour").one("click.tour",Paydirt.Guiders.Invoices.Edit.tour.sendByEmail)},sendByEmail:function(){return $("#send_remind_link").livequery(function(){return function(){return $("#send_remind_link").expire(),guiders.hideAll(),guiders.show("guider-send-by-email"),$("#send_remind_link").off("click.tour").one("click.tour",Paydirt.Guiders.Invoices.Edit.tour.introduceEmail)}}(this))},introduceEmail:function(t){return function(){return guiders.hideAll(),$("#send-invoice-email").livequery(function(){return $("#send-invoice-email").expire(),guiders.show("guider-introduce-email"),Paydirt.invoice.get("sent")===!1&&Paydirt.invoice.on("change:sent",Paydirt.Guiders.Invoices.Edit.tour.lastStep),$(document).on("click.tour",".close-modal",function(){return t.tour.end()})})}}(this),lastStep:function(){return guiders.hideAll(),Paydirt.invoice.off("change:sent",Paydirt.Guiders.Invoices.Edit.tour.lastStep),setTimeout(function(){return guiders.show("guider-last-step")},2e3)},end:function(){return guiders.hideAll(),$(".temp_hide").css({visibility:"visible",opacity:0}).fadeTo(1e3,1).removeClass("temp_hide"),$("body").removeClass("tour"),Paydirt.invoice.off("change:sent",Paydirt.Guiders.Invoices.Edit.tour.lastStep),Paydirt.tour=!1,$(document).off("click.tour","[data-behaviour~=end_tour]")}}}}.call(this),function(){Paydirt.Guiders.Invoices.Index={initialize:function(){return Paydirt.Eventy.record("started_saved_free_invoice_tour"),$("body").addClass("tour"),$(document).on("click.tour","[data-behaviour~=end_tour]",function(t){return function(e){return e.preventDefault(),Paydirt.Eventy.record("cancelled_saved_free_invoice_tour"),t.tour.end()}}(this)),guiders.createGuider({id:"guider-intro",overlay:!0,title:["<i class='icon-check'></i> Your account has been created","<i class='icon-check'></i> Your invoice has been saved"],description:"<p>This short guide will show you how to manage your invoices</p>",classString:"done",buttons:[{name:"Show me <i class='icon-circle-arrow-right'></i>",onclick:this.tour.introduceInvoice}],buttonCustomHTML:"<a href='#' class='grey button_aligned' data-behaviour='end_tour'>No thanks, I'll just look around</a>"}),guiders.createGuider({id:"guider-introduce-invoice",attachTo:".invoices .invoice:first",highlight:".invoices .invoice:first",overlay:!0,position:3,title:"Your invoice is currently a draft",description:"Click on an invoice to view, manage, edit, and send it.",buttons:[],buttons:[{name:"Next <i class='icon-circle-arrow-right'></i>",onclick:function(){return function(){return $(".invoices .invoice:first a.overlay").first().click()}}(this)}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-introduce-invoice-page",attachTo:"#invoice_contents",highlight:"#invoice-page",overlay:!0,position:12,width:450,title:"",description:"Looking good! This is how your invoice will appear to your client.",buttons:[{name:"Next <i class='icon-circle-arrow-right'></i>",onclick:this.tour.introduceEditLink}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-introduce-edit-link",overlay:!1,attachTo:".secondary_navigation",highlight:".secondary_navigation",position:10,title:"Manage and Edit modes",description:"<p><b>Manage Mode</b> (this page) is where you can preview, print, download, and send your invoice. You can also manage payments and see the invoice's history.</p> <p><b>Edit Mode</b> is where you can modify the invoice's business details, line items, taxes, and dates.</p>",buttons:[{name:"Next <i class='icon-circle-arrow-right'></i>",onclick:this.tour.introduceSendButton}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-introduce-send-button",overlay:!1,attachTo:"#send_remind_link",highlight:"#send_remind_link",position:10,title:"Send your invoice by email",description:"<p>This button lets you send your invoice to your client with a link to view and pay the invoice online, and the invoice as a PDF attachment.</p><p>Emails are generated automatically from custom templates, which can be edited before sending.</p>",buttons:[{name:"Next <i class='icon-circle-arrow-right'></i>",onclick:this.tour.introducePayments}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-introduce-payments",overlay:!1,attachTo:"#payments .title",highlight:"#payments .title",position:9,title:"Keep track of payments",description:"<p>Once you've sent your invoice you're ready to receive payments.</p><p>Online payments appear here automatically, and you can manually log other payments as they arrive.</p>",buttons:[{name:"Next <i class='icon-circle-arrow-right'></i>",onclick:this.tour.introduceActivities}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-introduce-activities",overlay:!1,attachTo:"#invoice_activity_container .title",highlight:"#invoice_activity_container .title",position:9,title:"Everything's on the record",description:"<p>All activities and payments appear in your activity log, so you know exactly what happened, and when.</p><p>You can also add notes about this invoice here.</p>",buttons:[{name:"Next <i class='icon-circle-arrow-right'></i>",onclick:this.tour.lastStep}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-last-step",overlay:!0,title:"Happy Invoicing!",description:"<p>That's the end of this tour. Now you know how easy it is to manage your invoices with Paydirt.</p><p>Next, you might want to <a href='"+Paydirt.Routes.invoice(Paydirt.invoices.first().id)+"?tour=send-invoice'>learn how to send this invoice</a> to your client.",buttons:[{name:"Finish the Tour",onclick:this.tour.end}]})},tour:{start:function(){return guiders.hideAll(),guiders.show("guider-intro")},introduceInvoice:function(){return function(){return guiders.hideAll(!0),guiders.show("guider-introduce-invoice"),$("#send_remind_link").livequery(function(){return $("#send_remind_link").expire(),Paydirt.Guiders.Invoices.Index.tour.introduceInvoicePage(),$("body").one("navigate",Paydirt.Guiders.Invoices.Index.tour.end)})}}(this),introduceInvoicePage:function(){return function(){return guiders.hideAll(!0),guiders.show("guider-introduce-invoice-page")}}(this),introduceEditLink:function(){return function(){return guiders.hideAll(),guiders.show("guider-introduce-edit-link")}}(this),introduceSendButton:function(){return guiders.hideAll(),guiders.show("guider-introduce-send-button")},introducePayments:function(){return guiders.hideAll(),guiders.show("guider-introduce-payments")},introduceActivities:function(){return guiders.hideAll(),guiders.show("guider-introduce-activities")},lastStep:function(){return Paydirt.Eventy.record("finished_saved_free_invoice_tour"),guiders.hideAll(),guiders.show("guider-last-step")},end:function(){return guiders.hideAll(),$(".temp_hide").css({visibility:"visible",opacity:0}).fadeTo(1e3,1).removeClass("temp_hide"),$("body").removeClass("tour"),Paydirt.tour=!1,$(document).off("click.tour","[data-behaviour~=end_tour]"),$("body").off("navigate",Paydirt.Guiders.Invoices.Index.tour.end)}}}}.call(this),function(){Paydirt.Guiders.Invoices.Send={initialize:function(){return $("body").addClass("tour"),$(document).on("click.tour","[data-behaviour~=end_tour]",function(t){return function(e){return e.preventDefault(),Paydirt.Eventy.record("cancelled_send_free_invoice_tour"),t.tour.end()}}(this)),guiders.createGuider({id:"guider-intro",overlay:!0,title:["<i class='icon-check'></i> Your invoice has been saved","<i class='icon-check'></i> Your invoice is ready to be sent"],description:"<p>Awesome &ndash; now you can send your invoice!</p><p>This short guide will show you how.</p>",classString:"done",buttons:[{name:"Show me how <i class='icon-circle-arrow-right'></i>",onclick:this.tour.introduceInvoice}],buttonCustomHTML:"<a href='#' class='grey button_aligned' onClick='Paydirt.Guiders.Invoices.Send.tour.end(); return false;'>No thanks, I'll do it by myself</a>"}),guiders.createGuider({id:"guider-introduce-invoice",attachTo:"#invoice_contents",highlight:"#invoice-page",overlay:!0,position:12,width:450,title:"",description:"Looking good. This is how your invoice will appear to your client.",buttons:[{name:"Next <i class='icon-circle-arrow-right'></i>",onclick:this.tour.introducePaymentSettings}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-introduce-payment-settings",overlay:!0,attachTo:"#invoice_payments_settings_container",highlight:"#invoice_payments_settings_container",position:9,title:"Want to accept credit card payments?",description:"<p>Paydirt makes it easy for your clients to pay your invoices directly online with their credit card or PayPal account.</p><p>If you want your clients to be able pay by credit card, choose either <span class='highlight'>PayPal</span> or <span class='highlight'>Stripe</span> and we'll set it up now.</p>",buttons:[{name:"skip this step",classString:"skip",onclick:this.tour.introduceSendButton}],buttonCustomHTML:skipButton}),guiders.createGuider({id:"guider-introduce-send-button",overlay:!0,attachTo:"#send_remind_link",highlight:"#send_remind_link",position:9,title:"Let's send your invoice to your client",description:"Click here to compose an email. It includes a link to view this invoice online, and your invoice is attached as a PDF.",buttons:[]}),guiders.createGuider({id:"guider-last-step",overlay:!0,title:"<i class='icon-check'></i> Your invoice has been sent",classString:"done",description:"<p class='grey'> <i class='icon-check'></i>&nbsp; You can now add payments to your invoice <br/> <i class='icon-check'></i>&nbsp; You will be notified if your invoice falls overdue <br/> </p> <p>Next, you might want to <a href='/settings/documents/payments'>connect your PayPal account</a> for online payments, or <a href='/invoices'>view a list of your invoices</a>.</p>",buttons:[{name:"Finish the Tour",onclick:this.tour.end}]})},tour:{start:function(){return Paydirt.Eventy.record("started_send_free_invoice_tour"),$("body").one("navigate",function(){return Paydirt.Guiders.Invoices.Send.tour.end()}),guiders.hideAll(),guiders.show("guider-intro")},introduceInvoice:function(){return guiders.hideAll(!0),guiders.show("guider-introduce-invoice")},introducePaymentSettings:function(){return guiders.hideAll(!0),guiders.show("guider-introduce-payment-settings"),$("#accept_paypal, #accept_stripe").off("click.tour").one("click.tour",function(){return function(){return guiders.hideAll()}}(this))},introduceSendButton:function(){return guiders.hideAll(!0),guiders.show("guider-introduce-send-button"),$("#send_remind_link").off("click.tour").one("click.tour",function(){return function(){return guiders.hideAll(),Paydirt.invoice.get("sent")===!1&&Paydirt.invoice.on("change:sent",Paydirt.Guiders.Invoices.Send.tour.lastStep),$(document).on("click.tour",".close-modal",Paydirt.Guiders.Invoices.Send.tour.end)}}(this))},lastStep:function(){return Paydirt.Eventy.record("finished_send_free_invoice_tour"),guiders.hideAll(),Paydirt.invoice.off("change:sent",Paydirt.Guiders.Invoices.Send.tour.lastStep),setTimeout(function(){return guiders.show("guider-last-step")},2e3)},end:function(){return guiders.hideAll(),$(".temp_hide").css({visibility:"visible",opacity:0}).fadeTo(1e3,1).removeClass("temp_hide"),$("body").removeClass("tour"),Paydirt.invoice.off("change:sent",Paydirt.Guiders.Invoices.Send.tour.lastStep),Paydirt.tour=!1,$(document).off("click.tour","[data-behaviour~=end_tour]"),Paydirt.router.navigate(Paydirt.Routes.invoice(Paydirt.invoice.id))}}}}.call(this),function(){Paydirt.Guiders.Invoices.SetupPayments={initialize:function(){return $("body").addClass("tour"),$(document).on("click.tour","[data-behaviour~=end_tour]",function(t){return function(e){return e.preventDefault(),Paydirt.Eventy.record("cancelled_setup_payments_for_free_invoice_tour"),t.tour.end()}}(this)),guiders.createGuider({id:"guider-intro",overlay:!0,title:["<i class='icon-check'></i> Your invoice has been saved","<i class='icon-check'></i> Your invoice is ready to be sent"],description:"<p>Awesome &ndash; now you can set up <span class='highlight'>PayPal</span> or <span class='highlight'>Stripe</span> and receive credit card payments for your invoice!</p><p>This short guide will show you how.</p>",classString:"done",buttons:[{name:"Show me how <i class='icon-circle-arrow-right'></i>",onclick:this.tour.introducePaymentSettings}],buttonCustomHTML:"<a href='#' class='grey button_aligned' onClick='Paydirt.Guiders.Invoices.SetupPayments.tour.end(); return false;'>No thanks, I'll do it by myself</a>"}),guiders.createGuider({id:"guider-introduce-payment-settings",overlay:!0,attachTo:"#invoice_payments_settings_container",highlight:"#invoice_payments_settings_container",position:9,title:"Let's set up credit card payments",description:"<p>Paydirt makes it easy for your clients to pay your invoices directly online with their credit card or PayPal account.</p><p>Choose either <span class='highlight'>PayPal</span> or <span class='highlight'>Stripe</span> to start receiving credit card payments.</p>",buttons:[]}),guiders.createGuider({id:"guider-last-step",overlay:!0,title:"<i class='icon-check'></i> Credit card payments are enabled",classString:"done",description:"<p>Your clients can now pay your invoices by credit card!</p><p>Next, you might want to <a href='"+window.location.pathname+"?tour=send-invoice'>learn how to send this invoice</a>, or preview what your client will see when they <a href='"+Paydirt.Routes.public_invoice(Paydirt.invoice.id,Paydirt.invoice.get("private_id"))+"' target='_blank'>view it online</a>.</p>",buttons:[{name:"Finish the Tour",onclick:this.tour.end}]})},tour:{start:function(){return Paydirt.Eventy.record("started_setup_payments_for_free_invoice_tour"),$("body").one("navigate",function(){return Paydirt.Guiders.Invoices.SetupPayments.tour.end()}),guiders.hideAll(),guiders.show("guider-intro")},introducePaymentSettings:function(){return guiders.hideAll(!0),guiders.show("guider-introduce-payment-settings"),$("#accept_paypal, #accept_stripe").off("click.tour").one("click.tour",function(){return function(){return guiders.hideAll()}}(this))},lastStep:function(){return Paydirt.Eventy.record("finished_setup_payments_for_free_invoice_tour"),guiders.hideAll(),guiders.show("guider-last-step")},end:function(){return guiders.hideAll(),$(".temp_hide").css({visibility:"visible",opacity:0}).fadeTo(1e3,1).removeClass("temp_hide"),$("body").removeClass("tour"),Paydirt.tour=!1,$(document).off("click.tour","[data-behaviour~=end_tour]"),Paydirt.router.navigate(Paydirt.Routes.invoice(Paydirt.invoice.id))}}}}.call(this);